func void SQ508_NOVIZESMALLTALKCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(63322, 75, 4);
}

func void SQ508_NOVIZESMALLTALKCUTSCENE_APPLY() {
    var int SQ508_NOVIZESMALLTALKCUTSCENE_COUNT;
    SQ508_NOVIZESMALLTALKCUTSCENE_COUNT = (SQ508_NOVIZESMALLTALKCUTSCENE_COUNT) + (1);
    if ((SQ508_NOVIZESMALLTALKCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(93024);
    };
}

func void SQ508_TRIALOGNOVIZE_START() {
    SQ508_NOVIZESMALLTALKCUTSCENE_STATUS = 3;
    NOV_205_NOVIZE.AIVAR[92] = FALSE;
    NOV_208_NOVIZE.AIVAR[92] = FALSE;
    HERO.AIVAR[4] = FALSE;
    AI_STARTSTATE(NOV_205_NOVIZE, 61599, 1, "");
    AI_STARTSTATE(HERO, 61599, 1, "");
}

func void SQ508_TRIALOGNOVIZE_FINISH() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(63326, 75, 4);
}

func void SQ508_TRIALOGNOVIZE_FINISH_APPLY() {
    var int SQ508_TRIALOGNOVIZE_FINISH_COUNT;
    SQ508_TRIALOGNOVIZE_FINISH_COUNT = (SQ508_TRIALOGNOVIZE_FINISH_COUNT) + (1);
    if ((SQ508_TRIALOGNOVIZE_FINISH_COUNT) == (4)) {
        HERO.AIVAR[4] = FALSE;
        WLD_SENDUNTRIGGER("SQ508_NOVIZESMALLTALK_01");
        WLD_SENDUNTRIGGER("SQ508_NOVIZESMALLTALK_02");
        B_STARTOTHERROUTINE(NOV_208_NOVIZE, "SQ508_SMALLTALK");
        NPC_REFRESH(NOV_208_NOVIZE);
        B_STARTOTHERROUTINE(NOV_205_NOVIZE, "SQ508_SMALLTALK");
        NPC_REFRESH(NOV_205_NOVIZE);
    };
}

func void SQ508_CORPSESONGRAVEYARD_PREPARE() {
    FF_APPLYONCEEXTGT(63329, 0, -(1));
}

func void SQ508_CORPSESONGRAVEYARD_APPLY() {
    var ZCMOVER MOVER2;
    var int MOVPTR2;
    var int MOVPTR1;
    var ZCMOVER MOVER3;
    var int MOVPTR3;
    var ZCMOVER MOVER1;
    var int SQ508_CORPSESONGRAVEYARD_COUNT;
    if ((SQ508_CORPSESONGRAVEYARD_COUNT) == (0)) {
        PRINTD("Rozpoczynam - SQ508_CorpsesOnGraveyard_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_GOBBOCORPSE");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_WOLFCORPSE");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        MOVPTR3 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_LURKERCORPSE");
        MOVER3 = MEM_PTRTOINST(MOVPTR3);
        CHANGEVOBCOLLISION("SQ508_GOBBOCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_WOLFCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_LURKERCORPSE", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("SQ508_MOVER_GOBBOCORPSE");
        WLD_SENDTRIGGER("SQ508_MOVER_WOLFCORPSE");
        WLD_SENDTRIGGER("SQ508_MOVER_LURKERCORPSE");
        SQ508_CORPSESONGRAVEYARD_COUNT = 1;
    };
    if (((((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ508_CorpsesOnGraveyard_Apply");
        CHANGEVOBCOLLISION("SQ508_GOBBOCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_WOLFCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_LURKERCORPSE", FALSE, FALSE, FALSE, TRUE);
        FF_REMOVE(63329);
        SQ508_CORPSESONGRAVEYARD_COUNT = 0;
    };
}

func void SQ508_HELPNOVIZE_PREPARE() {
    MOB_CHANGEFOCUSNAME("SQ508_LURKERCORPSE", "MOBNAME_CORPSEINVESTIGATE");
    WLD_INSERTNPC(50391, "PART8_MOB_08");
    MOB_CHANGEFOCUSNAME("SQ508_WOLFCORPSE", "MOBNAME_CORPSEINVESTIGATE");
}

func void SQ508_CANDACREADYFORGRAVEYARD() {
    NPC_EXCHANGEROUTINE(PAL_100_CANDAC, "SQ508_WAIT");
    B_STARTOTHERROUTINE(NOV_208_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_208_NOVIZE);
    B_STARTOTHERROUTINE(NOV_205_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_205_NOVIZE);
}

func void SQ508_PREPAREGRAVEYARD() {
    SQ508_CANDACFIGHT = 1;
    B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_INNOS");
    NPC_REFRESH(NONE_6239_CASPAR);
    TELEPORTNPCTOWP(51954, NONE_6239_CASPAR.WP);
    FF_APPLYONCEEXTGT(63345, 0, -(1));
    WLD_INSERTNPC(50528, "PART8_SQ508_SPAWN_01");
    WLD_INSERTNPC(50529, "PART8_SQ508_SPAWN_02");
    WLD_INSERTNPC(50530, "PART8_SQ508_SPAWN_03");
    WLD_INSERTNPC(50531, "PART8_SQ508_SPAWN_04");
    WLD_INSERTNPC(50532, "PART8_SQ508_SPAWN_05");
}

func void SQ508_SPAWNSKELETONS() {
    FF_APPLYONCEEXT(63341, 1000, 5);
}

func void SQ508_SPAWNSKELETONS_APPLY() {
    var int SQ508_SPAWNSKELETONS_COUNT;
    SQ508_SPAWNSKELETONS_COUNT = (SQ508_SPAWNSKELETONS_COUNT) + (1);
    if ((SQ508_SPAWNSKELETONS_COUNT) == (1)) {
        WLD_INSERTNPC(50848, "PART8_SQ508_SPAWN_01");
        WLD_PLAYEFFECT("spellFX_INCOVATION_VIOLET", SKELETON_SQ508_01, SKELETON_SQ508_01, 0, 0, 0, FALSE);
        WLD_PLAYEFFECT("FX_EarthQuake", SKELETON_SQ508_01, SKELETON_SQ508_01, 0, 0, 0, FALSE);
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (2)) {
        WLD_INSERTNPC(50849, "PART8_SQ508_SPAWN_02");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (3)) {
        WLD_INSERTNPC(50850, "PART8_SQ508_SPAWN_03");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (4)) {
        WLD_INSERTNPC(50851, "PART8_SQ508_SPAWN_04");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (5)) {
        WLD_INSERTNPC(50852, "PART8_SQ508_SPAWN_05");
        SQ508_CANDACFIGHT = 3;
    };
}

func int SQ508_GOBBSAREDEAD() {
    if (((((NPC_ISDEAD(GOBBO_SKELETON_SQ508_01)) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_02))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_03))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_04))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_05))) {
        return TRUE;
    };
    return FALSE;
}

func int SQ508_SKELETONSAREDEAD() {
    if (((((NPC_ISDEAD(SKELETON_SQ508_01)) && (NPC_ISDEAD(SKELETON_SQ508_02))) && (NPC_ISDEAD(SKELETON_SQ508_03))) && (NPC_ISDEAD(SKELETON_SQ508_04))) && (NPC_ISDEAD(SKELETON_SQ508_05))) {
        return TRUE;
    };
    return FALSE;
}

func void SQ508_DOORSMOVER_APPLY() {
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int SQ508_DOORSMOVER_COUNT;
    if ((SQ508_DOORSMOVER_COUNT) == (0)) {
        PRINTD("Rozpoczynam - SQ508_DoorsMover_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_DOOR_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("SQ508_DOOR_01", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("SQ508_MOVER_DOOR_01");
        SQ508_DOORSMOVER_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ508_DoorsMover_Apply");
        CHANGEVOBCOLLISION("SQ508_DOOR_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_01", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_02", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_03", TRUE, FALSE, TRUE, TRUE);
        FF_REMOVE(63345);
        SQ508_DOORSMOVER_COUNT = 0;
    };
}

func void SQ508_JUDGMENTCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_WAIT");
    NPC_REFRESH(NONE_6239_CASPAR);
    B_STARTOTHERROUTINE(PAL_100_CANDAC, "SQ508_WAIT_INNOS");
    NPC_REFRESH(PAL_100_CANDAC);
    WLD_SENDTRIGGER("SQ508_MOVER_TRIGGERCUTSCENE");
    FF_APPLYONCEEXT(63350, 150, 4);
}

func void SQ508_JUDGMENTCUTSCENE_APPLY() {
    var int SQ508_JUDGMENTCUTSCENE_COUNT;
    SQ508_JUDGMENTCUTSCENE_COUNT = (SQ508_JUDGMENTCUTSCENE_COUNT) + (1);
    if ((SQ508_JUDGMENTCUTSCENE_COUNT) == (4)) {
        SQ508_JUDGMENT = 3;
        CUTSCENE_START(93016);
    };
}

func void SQ508_CANDACTRIALOG_START() {
    SQ508_JUDGMENT = 4;
    PAL_100_CANDAC.AIVAR[92] = FALSE;
    HERO.AIVAR[4] = FALSE;
    AI_STARTSTATE(NONE_6239_CASPAR, 61599, 1, "");
    AI_STARTSTATE(HERO, 61599, 1, "");
}

func void SQ508_KILLCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(63354, 75, 4);
}

func void SQ508_KILLCUTSCENE_APPLY() {
    var int SQ508_KILLCUTSCENE_COUNT;
    SQ508_KILLCUTSCENE_COUNT = (SQ508_KILLCUTSCENE_COUNT) + (1);
    if ((SQ508_KILLCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(93020);
    };
}

func void SQ508_FINISHCUTSCENES() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(63357, 75, 4);
}

func void SQ508_FINISHCUTSCENES_APPLY() {
    var int SQ508_FINISHCUTSCENES_COUNT;
    SQ508_FINISHCUTSCENES_COUNT = (SQ508_FINISHCUTSCENES_COUNT) + (1);
    if ((SQ508_FINISHCUTSCENES_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_01");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_02");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_03");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_04");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_05");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_06");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_07");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_08");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_09");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_10");
        DIACAM_ENABLE();
        B_STARTOTHERROUTINE(NOV_205_NOVIZE, "SQ508_SEARCH");
        NPC_REFRESH(NOV_205_NOVIZE);
        TELEPORTNPCTOWP(56595, NOV_205_NOVIZE.WP);
        B_STARTOTHERROUTINE(NOV_208_NOVIZE, "SQ508_SEARCH");
        NPC_REFRESH(NOV_208_NOVIZE);
        TELEPORTNPCTOWP(56601, NOV_208_NOVIZE.WP);
        if ((SQ508_RESULT) == (2)) {
            B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_FLEE");
            NPC_REFRESH(NONE_6239_CASPAR);
        };
        HERO.AIVAR[4] = FALSE;
    };
}

func void SQ508_JUDGMENT_RUNAWAY() {
    SQ508_RESULT = 2;
    SQ508_CASPARRUNAWAY = 1;
    SQ508_FINISHCUTSCENES();
}

func void SQ508_NOVIZEGOBACKTOWORK() {
    B_STARTOTHERROUTINE(NOV_208_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_208_NOVIZE);
    NPC_EXCHANGEROUTINE(NOV_205_NOVIZE, "NORMALDAY");
}

