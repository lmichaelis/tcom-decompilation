const int ZERROR_LEVELBAK = 0;
func void ZERROR_SETTEMPLEVEL(var int LOGLEVEL) {
    var ZERROR ERR;
    ERR = _^(ZERRPTR);
    ZERROR_LEVELBAK = ERR.FILTER_LEVEL;
    ERR.FILTER_LEVEL = LOGLEVEL;
}

func void STARTLOGFILE(var int LOGLEVEL) {
    var string TIMESTR;
    var int SYSTEMTIMEPTR;
    var string USER;
    var int USERCHRPTR;
    var int MAXCHAR;
    var ZERROR ERR;
    var int ONCE;
    if (ONCE) {
        return;
    };
    ONCE = 1;
    HOOKENGINEF(4513878, 7, 21578);
    ERR = _^(ZERRPTR);
    ERR.FILTER_LEVEL = LOGLEVEL;
    CALL_INTPARAM((ERR.TARGET) | (2));
    CALL__THISCALL(ZERRPTR, ZERROR__SETTARGET);
    MAXCHAR = 16;
    USERCHRPTR = MEM_ALLOC(MAXCHAR);
    CALL_INTPARAM(_@(MAXCHAR));
    CALL_PTRPARAM(USERCHRPTR);
    CALL__STDCALL(GETUSERNAMEA);
    USER = STR_FROMCHAR(USERCHRPTR);
    MEM_FREE(USERCHRPTR);
    SYSTEMTIMEPTR = MEM_ALLOC(16);
    CALL_PTRPARAM(SYSTEMTIMEPTR);
    CALL__STDCALL(GETLOCALTIME);
    TIMESTR = INTTOSTRING((MEM_READINT(SYSTEMTIMEPTR)) & (2047));
    TIMESTR = CONCATSTRINGS(CONCATSTRINGS(TIMESTR, "-"), INTTOSTRING((MEM_READINT((SYSTEMTIMEPTR) + (2))) & (2047)));
    TIMESTR = CONCATSTRINGS(CONCATSTRINGS(TIMESTR, "-"), INTTOSTRING((MEM_READINT((SYSTEMTIMEPTR) + (6))) & (2047)));
    TIMESTR = CONCATSTRINGS(CONCATSTRINGS(TIMESTR, " "), INTTOSTRING((MEM_READINT((SYSTEMTIMEPTR) + (8))) & (2047)));
    TIMESTR = CONCATSTRINGS(CONCATSTRINGS(TIMESTR, ":"), INTTOSTRING((MEM_READINT((SYSTEMTIMEPTR) + (10))) & (2047)));
    TIMESTR = CONCATSTRINGS(CONCATSTRINGS(TIMESTR, ":"), INTTOSTRING((MEM_READINT((SYSTEMTIMEPTR) + (12))) & (2047)));
    MEM_FREE(SYSTEMTIMEPTR);
    MEM_INFO("");
    ZERROR_SETTEMPLEVEL(1);
    MEM_INFO(CONCATSTRINGS("Time:               ", TIMESTR));
    MEM_INFO(CONCATSTRINGS("Log level:          ", INTTOSTRING(LOGLEVEL)));
    ZERROR_RESTORELEVEL();
    MEM_INFO("");
}

