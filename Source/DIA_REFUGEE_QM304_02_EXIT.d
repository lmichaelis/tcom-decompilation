instance DIA_REFUGEE_QM304_02_EXIT(C_INFO) {
    NPC = 53969;
    NR = 999;
    CONDITION = DIA_REFUGEE_QM304_02_EXIT_CONDITION;
    INFORMATION = DIA_REFUGEE_QM304_02_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_REFUGEE_QM304_02_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_REFUGEE_QM304_02_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_REFUGEE_QM304_02_GOLD(C_INFO) {
    NPC = 53969;
    NR = 1;
    CONDITION = DIA_REFUGEE_QM304_02_GOLD_CONDITION;
    INFORMATION = DIA_REFUGEE_QM304_02_GOLD_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Where did you get the money to pay for this visit?";
}

func int DIA_REFUGEE_QM304_02_GOLD_CONDITION() {
    if ((LOG_GETSTATUS(MIS_QM304)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_REFUGEE_QM304_02_GOLD_INFO() {
    QM304_REFUGEEARENAFIGHT_STATUS = 1;
    AI_STARTFACEANI(OTHER, S_SERIOUS, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Refugee_QM304_02_Gold_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_Gold_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Refugee_QM304_02_Gold_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_Gold_03_04");
    AI_RESETFACEANI(OTHER);
}

instance DIA_REFUGEE_QM304_02_LETSFIGHT(C_INFO) {
    NPC = 53969;
    NR = 1;
    CONDITION = DIA_REFUGEE_QM304_02_LETSFIGHT_CONDITION;
    INFORMATION = DIA_REFUGEE_QM304_02_LETSFIGHT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "I think it's time for a different form of persuasion. (Fight)";
}

func int DIA_REFUGEE_QM304_02_LETSFIGHT_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_QM304)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 68322))) && ((QM304_REFUGEEARENAFIGHT_STATUS) == (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void REFUGEE_QM304_ARENAFIGHT() {
    QM304_REFUGEEARENAFIGHT_STATUS = 2;
    HERO.AIVAR[96] = 10;
    SELF.AIVAR[96] = 15;
    SELF.AIVAR[45] = AF_RUNNING;
    B_ATTACK(SELF, OTHER, AR_NONE, 1);
}

func void DIA_REFUGEE_QM304_02_LETSFIGHT_INFO() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Refugee_QM304_02_LetsFight_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_LetsFight_03_02");
    AI_RESETFACEANI(OTHER);
    AI_STOPPROCESSINFOS(SELF);
    REFUGEE_QM304_ARENAFIGHT();
}

instance DIA_REFUGEE_QM304_02_AFTERFIGHT(C_INFO) {
    NPC = 53969;
    NR = 1;
    CONDITION = DIA_REFUGEE_QM304_02_AFTERFIGHT_CONDITION;
    INFORMATION = DIA_REFUGEE_QM304_02_AFTERFIGHT_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_REFUGEE_QM304_02_AFTERFIGHT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_QM304)) == (LOG_RUNNING)) && ((QM304_REFUGEEARENAFIGHT_STATUS) == (2))) {
        if (((SELF.AIVAR[64]) == (FALSE)) && ((SELF.AIVAR[0]) != (FIGHT_NONE))) {
            if ((SELF.AIVAR[45]) != (AF_NONE)) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_REFUGEE_QM304_02_AFTERFIGHT_INFO() {
    SELF.AIVAR[45] = AF_NONE;
    SELF.AIVAR[64] = TRUE;
    if ((SELF.AIVAR[0]) == (FIGHT_WON)) {
        QM304_REFUGEEARENAFIGHT_STATUS = 1;
        AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_AfterFight_03_01");
    };
    QM304_REFUGEEARENAFIGHT_STATUS = 3;
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_AfterFight_03_02");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Refugee_QM304_02_AfterFight_15_03");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_AfterFight_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Refugee_QM304_02_AfterFight_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Refugee_QM304_02_AfterFight_03_06");
    NPC_EXCHANGEROUTINE(SELF, TOT);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_QM304, LOG_QM304_REFUGEE_BROTHEL);
    QM304_COUNTHOWMANYEVENTS();
}

