instance Q305_PUSHCHESTCUTSCENE(CUTSCENE) {
    ONSTART = FUNCTION(92470);
}

func void Q305_PUSHCHESTCUTSCENE_START() {
    Q305_BERTELCUTSCENE = 2;
    WLD_SENDTRIGGER("KM_PUSHCHESTSWAMP_CAMERA_01");
    TELEPORTNPCTOWP(1819, "PART17_PATH_77");
    TELEPORTNPCTOWP(58580, "PART17_PATH_79");
    AI_TURNAWAY(HERO, NONE_6332_BERTEL);
    AI_TURNTONPC(NONE_6332_BERTEL, HERO);
    AI_USEMOB(HERO, "CHESTPUSH", 1);
    AI_WAIT(HERO, 1080033280);
    FADESCREENTOBLACKF(3, 92471, 1000);
    FF_APPLYONCEEXTGT(92472, 0, -(1));
}

func void Q305_PUSHCHESTCUTSCENE_FADESCREEN() {
    Q305_BERTELCUTSCENE = 3;
    WLD_SENDUNTRIGGER("KM_PUSHCHESTSWAMP_CAMERA_01");
    NPC_CLEARAIQUEUE(HERO);
    AI_USEMOB(HERO, "CHESTPUSH", -(1));
    TELEPORTNPCTOWP(1819, "P17_HAVEN_IN_10");
    B_STARTOTHERROUTINE(NONE_6332_BERTEL, "CHESTPIRATES");
    NPC_REFRESH(NONE_6332_BERTEL);
    TELEPORTNPCTOWP(58580, NONE_6332_BERTEL.WP);
    AI_TURNTONPC(HERO, NONE_6332_BERTEL);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(2);
}

func void Q305_PUSHCHESTCUTSCENE_APPLY() {
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int Q305_PUSHCHESTCUTSCENE_COUNT;
    if ((Q305_PUSHCHESTCUTSCENE_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q305_PushChestCutscene_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KM_SWAMPCHESTPIRATES_MOVER");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("KM_GOLDCHEST_PIRATES", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KM_SWAMPCHESTPIRATES_MOVER");
        Q305_PUSHCHESTCUTSCENE_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - Q305_PushChestCutscene_Apply");
        CHANGEVOBCOLLISION("KM_GOLDCHEST_PIRATES", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(92472);
        Q305_PUSHCHESTCUTSCENE_COUNT = 0;
    };
}

