func int B_STOPMAGICSLEEP() {
    NPC_PERCDISABLE(SELF, PERC_ASSESSDAMAGE);
    B_SAY_OVERLAY(SELF, OTHER, "$WHATWASSTHAT");
    AI_PLAYANI(SELF, "T_VICTIM_SLE_2_STAND");
    return 0 /* !broken stack! */;
}

func void B_ASSESSMAGICSLEEPTALK() {
    B_SAY(SELF, OTHER, "$YOUDISTURBEDMYSLUMBER");
    AI_STARTSTATE(SELF, 61582, 1, "");
}

var int BADULF_DEEPSLEEP;
func void ZS_MAGICSLEEP() {
    if (((SQ121_HELPINGRIORDIAN) == (1)) && ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(BAU_706_LOKVAR)))) {
        if ((SQ121_CHANGELOKVARRTN) == (0)) {
            SQ121_CHANGELOKVARRTN = 1;
            B_STARTOTHERROUTINE(BAU_706_LOKVAR, "SQ121_DEEPSLEEP");
            NPC_REFRESH(BAU_706_LOKVAR);
            SQ121_CHECKLOKVARSLEEPING();
        };
    };
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(SLD_13713_GUARD))) {
        if ((QA306_CHANGEGUARDRTN) == (FALSE)) {
            QA306_CHANGEGUARDRTN = TRUE;
            B_STARTOTHERROUTINE(SLD_13713_GUARD, "QA306_DEEPSLEEP");
            NPC_REFRESH(SLD_13713_GUARD);
        };
    };
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(KDW_214_BADULF))) {
        if ((BADULF_DEEPSLEEP) == (FALSE)) {
            BADULF_DEEPSLEEP = TRUE;
            B_STARTOTHERROUTINE(KDW_214_BADULF, "DEEPSLEEP");
            NPC_REFRESH(KDW_214_BADULF);
        };
    };
    NPC_PERCENABLE(SELF, PERC_ASSESSDAMAGE, 43878);
    NPC_PERCENABLE(SELF, PERC_ASSESSMAGIC, 43309);
    NPC_PERCENABLE(SELF, PERC_ASSESSTALK, 43879);
    SELF.AIVAR[12] = GP_NONE;
    NPC_SETREFUSETALK(SELF, 0);
    NPC_SETTEMPATTITUDE(SELF, NPC_GETPERMATTITUDE(SELF, HERO));
    B_STOPLOOKAT(SELF);
    AI_STOPPOINTAT(SELF);
    if (!(NPC_HASBODYFLAG(SELF, BS_FLAG_INTERRUPTABLE))) {
        AI_STANDUP(SELF);
    };
    AI_STANDUPQUICK(SELF);
    AI_PLAYANIBS(SELF, "T_STAND_2_VICTIM_SLE", BS_LIE);
}

func int ZS_MAGICSLEEP_LOOP() {
    if (((SQ121_HELPINGRIORDIAN) == (1)) && ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(BAU_706_LOKVAR)))) {
        return LOOP_CONTINUE;
    };
    if ((NPC_GETSTATETIME(SELF)) > (SPL_TIME_SLEEP)) {
        NPC_CLEARAIQUEUE(SELF);
        B_STOPMAGICSLEEP();
        return LOOP_END;
    };
    return 0 /* !broken stack! */;
}

func void ZS_MAGICSLEEP_END() {
}

