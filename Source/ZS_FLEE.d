func void ZS_FLEE() {
    var C_ITEM ARMOR;
    NPC_PERCENABLE(SELF, PERC_ASSESSMAGIC, 43309);
    B_VALIDATEOTHER();
    if ((SELF.AIVAR[65]) == (FALSE)) {
        B_SAY_OVERLAY(SELF, OTHER, "$RUNAWAY");
    };
    AI_REMOVEWEAPON(SELF);
    AI_SETWALKMODE(SELF, NPC_RUN);
    if (NPC_HASEQUIPPEDARMOR(SELF)) {
        ARMOR = NPC_GETEQUIPPEDARMOR(SELF);
        if (((((((((((HLP_ISITEM(ARMOR, 35554)) || (HLP_ISITEM(ARMOR, 35555))) || (HLP_ISITEM(ARMOR, 35556))) || (HLP_ISITEM(ARMOR, 35557))) || (HLP_ISITEM(ARMOR, 35558))) || (HLP_ISITEM(ARMOR, 35559))) || (HLP_ISITEM(ARMOR, 35560))) || (HLP_ISITEM(ARMOR, 35561))) || (HLP_ISITEM(ARMOR, 35562))) || (HLP_ISITEM(ARMOR, 35563))) || (HLP_ISITEM(ARMOR, 35564))) {
            MDL_APPLYOVERLAYMDS(SELF, "HumanS_Broken_Flee.MDS");
        } else if ((HLP_ISITEM(ARMOR, 35582)) == (FALSE)) {
            MDL_APPLYOVERLAYMDS(SELF, HUMANSFLEEMDS);
        };
    };
    MDL_APPLYOVERLAYMDS(SELF, HUMANSFLEEMDS);
}

func int ZS_FLEE_LOOP() {
    if ((NPC_GETDISTTONPC(SELF, OTHER)) > (FIGHT_DIST_CANCEL)) {
        NPC_CLEARAIQUEUE(SELF);
        return LOOP_END;
    };
    if (C_NPCISDOWN(OTHER)) {
        NPC_CLEARAIQUEUE(SELF);
        return LOOP_END;
    };
    NPC_GETTARGET(SELF);
    AI_FLEE(SELF);
    return LOOP_CONTINUE;
}

func void ZS_FLEE_END() {
    MDL_REMOVEOVERLAYMDS(SELF, HUMANSFLEEMDS);
    MDL_REMOVEOVERLAYMDS(SELF, "HumanS_Broken_Flee.MDS");
    AI_STANDUP(SELF);
    AI_STARTSTATE(SELF, 61579, 1, "");
}

