instance DIA_FIGARO_EXIT(C_INFO) {
    NPC = 52105;
    NR = 999;
    CONDITION = DIA_FIGARO_EXIT_CONDITION;
    INFORMATION = DIA_FIGARO_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_FIGARO_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_FIGARO_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_FIGARO_DOCTOR(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_DOCTOR_CONDITION;
    INFORMATION = DIA_FIGARO_DOCTOR_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Are you some kind of doctor?";
}

func int DIA_FIGARO_DOCTOR_CONDITION() {
    return TRUE;
}

func void DIA_FIGARO_DOCTOR_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_Doctor_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Doctor_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_Doctor_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Doctor_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Doctor_03_05");
    TRADER_LOGENTRY_FIGARO();
}

instance DIA_FIGARO_BADDAY(C_INFO) {
    NPC = 52105;
    NR = 10;
    CONDITION = DIA_FIGARO_BADDAY_CONDITION;
    INFORMATION = DIA_FIGARO_BADDAY_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Bad day?";
}

func int DIA_FIGARO_BADDAY_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 75736)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_BADDAY_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_BadDay_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_BadDay_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_05");
    AI_TURNAWAY(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_08");
    AI_TURNTONPC(SELF, OTHER);
    AI_PLAYANI(SELF, R_SCRATCHHEAD);
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_BadDay_03_09");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_BadDay_15_10");
}

instance DIA_FIGARO_TRADE(C_INFO) {
    NPC = 52105;
    NR = 950;
    CONDITION = DIA_FIGARO_TRADE_CONDITION;
    INFORMATION = DIA_FIGARO_TRADE_INFO;
    PERMANENT = TRUE;
    TRADE = TRUE;
    DESCRIPTION = "Show me what you have for sale.";
}

func int DIA_FIGARO_TRADE_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 75736)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_TRADE_INFO() {
    NPC_INITAMBIENTS(SELF, 2);
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_TRADE_15_01");
    if ((NPC_GETLASTAMBIENT(SELF)) == (1)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Figaro_TRADE_03_02");
    };
    if ((NPC_GETLASTAMBIENT(SELF)) == (2)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Figaro_TRADE_03_03");
    };
    B_GIVETRADEINV(SELF);
}

instance DIA_FIGARO_CQ006(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_CQ006_CONDITION;
    INFORMATION = DIA_FIGARO_CQ006_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "How much do you charge for a shoulder adjustment?";
}

func int DIA_FIGARO_CQ006_CONDITION() {
    if ((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_CQ006_GOHARBOUR() {
    CQ006_FIGAROWENTTOHARBOUR = TRUE;
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Gold_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Gold_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Gold_03_04");
    NPC_EXCHANGEROUTINE(SELF, "GUIDE");
    SELF.AIVAR[15] = TRUE;
    CQ006_FIGARO_RTNCHECK = 1;
    CQ006_PREPARERUUD();
    INFO_CLEARCHOICES(75745);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_FIGAROGOTGOLD);
}

func void DIA_FIGARO_CQ006_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_03_02");
    INFO_CLEARCHOICES(75745);
    if ((NPC_HASITEMS(OTHER, 34203)) >= (CQ006_FIGAROCOST)) {
        INFO_ADDCHOICE(75745, DIALOG_GIVE70G, 75749);
    };
    INFO_ADDCHOICE(75745, "Couldn't you come down on the price a bit?", 75750);
    INFO_ADDCHOICE(75745, "I don't have that much.", 75751);
}

func void DIA_FIGARO_CQ006_GOLD() {
    CQ006_ALCHEMISTWAY = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Gold_15_01");
    B_GIVEINVITEMS(OTHER, SELF, 34203, CQ006_FIGAROCOST);
    DIA_FIGARO_CQ006_GOHARBOUR();
}

func void DIA_FIGARO_CQ006_LOWER() {
    CQ006_RIVERMIRT = TRUE;
    CQ006_ALCHEMISTWANTGOLD = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Lower_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Lower_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Lower_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Lower_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Lower_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Lower_03_06");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Lower_15_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_Lower_03_08");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Lower_15_09");
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_FIGAROLOWER);
    INFO_CLEARCHOICES(75745);
}

func void DIA_FIGARO_CQ006_NOGOLD() {
    CQ006_ALCHEMISTWANTGOLD = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_NoGold_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_CQ006_NoGold_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_NoGold_15_03");
    INFO_CLEARCHOICES(75745);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_FIGAROWANTSGOLD);
}

instance DIA_FIGARO_ALCHEMISTGOLD(C_INFO) {
    NPC = 52105;
    NR = 2;
    CONDITION = DIA_FIGARO_ALCHEMISTGOLD_CONDITION;
    INFORMATION = DIA_FIGARO_ALCHEMISTGOLD_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Here, gold for you. (70 GP)";
}

func int DIA_FIGARO_ALCHEMISTGOLD_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) && ((CQ006_ALCHEMISTWANTGOLD) == (TRUE))) && ((NPC_HASITEMS(OTHER, 34203)) >= (CQ006_FIGAROCOST))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_ALCHEMISTGOLD_INFO() {
    CQ006_ALCHEMISTWANTGOLD = FALSE;
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_CQ006_Gold_15_01");
    B_GIVEINVITEMS(OTHER, SELF, 34203, CQ006_FIGAROCOST);
    CQ006_ALCHEMISTWAY = 1;
    if ((CQ006_RIVERMIRT) == (TRUE)) {
        CQ006_RIVERMIRT = FALSE;
    };
    DIA_FIGARO_CQ006_GOHARBOUR();
}

instance DIA_FIGARO_RIVERMIRT(C_INFO) {
    NPC = 52105;
    NR = 3;
    CONDITION = DIA_FIGARO_RIVERMIRT_CONDITION;
    INFORMATION = DIA_FIGARO_RIVERMIRT_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I have a myrtle for you.";
}

func int DIA_FIGARO_RIVERMIRT_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) && ((CQ006_RIVERMIRT) == (TRUE))) && ((NPC_HASITEMS(OTHER, 37647)) >= (5))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_RIVERMIRT_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_RiverMirt_15_01");
    B_GIVEINVITEMS(OTHER, SELF, 37647, 5);
    CQ006_ALCHEMISTWAY = 2;
    if ((CQ006_ALCHEMISTWANTGOLD) == (TRUE)) {
        CQ006_ALCHEMISTWANTGOLD = FALSE;
    };
    DIA_FIGARO_CQ006_GOHARBOUR();
}

instance DIA_FIGARO_QA202_FINALLY(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_QA202_FINALLY_CONDITION;
    INFORMATION = DIA_FIGARO_QA202_FINALLY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_FIGARO_QA202_FINALLY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_QA202)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 76359))) {
        if (((NPC_GETDISTTOWP(VLK_6407_RAMHA, "PART7_AQ202_RAMHA")) <= (300)) && ((NPC_GETDISTTOWP(VLK_6284_FIGARO, "PART7_AQ202_FIGARO")) <= (300))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_CHANGERAMHARTN() {
    VLK_6407_RAMHA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(VLK_6407_RAMHA, "QA202_GUIDE");
    NPC_REFRESH(VLK_6407_RAMHA);
    if (HLP_ISVALIDNPC(SNAPPER_QA202_01)) {
        if ((NPC_ISDEAD(SNAPPER_QA202_01)) == (FALSE)) {
            B_REMOVENPC(50908);
        };
    };
    if (HLP_ISVALIDNPC(SNAPPER_QA202_02)) {
        if ((NPC_ISDEAD(SNAPPER_QA202_02)) == (FALSE)) {
            B_REMOVENPC(50909);
        };
    };
}

func void DIA_FIGARO_QA202_FINALLY_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Finally_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Finally_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Finally_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Finally_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Finally_03_06");
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_QA202, LOG_QA202_RAMHA_GOODPLACE);
    AI_FUNCTION(SELF, 75760);
}

instance DIA_FIGARO_QA202_NEEDHELP(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_QA202_NEEDHELP_CONDITION;
    INFORMATION = DIA_FIGARO_QA202_NEEDHELP_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I need your help.";
}

func int DIA_FIGARO_QA202_NEEDHELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_QA202)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 76369))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_QA202_NEEDHELP_INFO() {
    QA202_READYFORCUTSCENE = 3;
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_QA202_NeedHelp_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_NeedHelp_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_QA202_NeedHelp_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_NeedHelp_03_04");
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "QA202_FOLLOW");
    QA202_FIGARO_RTNCHECK = 2;
    AI_LOGENTRY(TOPIC_QA202, LOG_QA202_FIGARO_HELP);
}

instance DIA_FIGARO_QA202_NOTTIME(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_QA202_NOTTIME_CONDITION;
    INFORMATION = DIA_FIGARO_QA202_NOTTIME_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_FIGARO_QA202_NOTTIME_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_QA202)) == (LOG_RUNNING)) && ((NPC_GETDISTTONPC(SELF, VLK_6407_RAMHA)) >= (7500))) && (NPC_KNOWSINFO(OTHER, 75762))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_QA202_NOTTIME_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_NotTime_03_01");
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "QA202_RUNTORAMHA");
    QA202_FIGARO_RTNCHECK = 3;
}

instance DIA_FIGARO_QA202_DONE(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_QA202_DONE_CONDITION;
    INFORMATION = DIA_FIGARO_QA202_DONE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_FIGARO_QA202_DONE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_QA202)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 76375))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_QA202_DONE_INFO() {
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Done_03_01");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_QA202_Done_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_Done_03_03");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_QA202, LOG_QA202_FIGARO_DONE);
    NPC_EXCHANGEROUTINE(SELF, START);
}

instance DIA_FIGARO_QA202_AFTERQUEST(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_QA202_AFTERQUEST_CONDITION;
    INFORMATION = DIA_FIGARO_QA202_AFTERQUEST_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_FIGARO_QA202_AFTERQUEST_CONDITION() {
    if (((LOG_GETSTATUS(MIS_QA202)) == (LOG_SUCCESS)) && ((QA202_RAMHAAFTERPLANT) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_QA202_AFTERQUEST_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_QA202_AfterQuest_03_01");
}

instance DIA_FIGARO_AMBIENT(C_INFO) {
    NPC = 52105;
    NR = 1;
    CONDITION = DIA_FIGARO_AMBIENT_CONDITION;
    INFORMATION = DIA_FIGARO_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How are you doing?";
}

func int DIA_FIGARO_AMBIENT_CONDITION() {
    return TRUE;
}

func void DIA_FIGARO_AMBIENT_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Figaro_Ambient_15_01");
    if ((((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS)) && ((CQ006_ALCHEMISTWAY) > (0))) && ((LOG_GETSTATUS(MIS_QA202)) != (LOG_SUCCESS))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Ambient_03_02");
    };
    if (((LOG_GETSTATUS(MIS_QA202)) == (LOG_SUCCESS)) && ((QA202_RAMHAAFTERPLANT) == (2))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Ambient_03_03");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Figaro_Ambient_03_04");
}

instance DIA_FIGARO_PICKPOCKET(C_INFO) {
    NPC = 52105;
    NR = 900;
    CONDITION = DIA_FIGARO_PICKPOCKET_CONDITION;
    INFORMATION = DIA_FIGARO_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_40;
}

func int DIA_FIGARO_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_FIGARO_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(75777);
    INFO_ADDCHOICE(75777, DIALOG_BACK, 75781);
    INFO_ADDCHOICE(75777, DIALOG_PICKPOCKET, 75780);
}

func void DIA_FIGARO_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) {
        CREATEINVITEMS(SELF, 34274, 1);
        B_GIVEINVITEMS(SELF, OTHER, 34274, 1);
        CREATEINVITEMS(SELF, 34280, 1);
        B_GIVEINVITEMS(SELF, OTHER, 34280, 1);
        CREATEINVITEMS(SELF, 40467, 1);
        B_GIVEINVITEMS(SELF, OTHER, 40467, 1);
        B_PICKPOCKET_AMBIENT_TIER_1();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(75777);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(75777);
}

func void DIA_FIGARO_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(75777);
}

