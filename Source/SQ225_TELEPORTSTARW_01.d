var int SQ225_TELEPORTSTARW_01;
var int SQ225_TELEPORTSTARW_02;
var int SQ225_TELEPORTSTARW_03;
var int SQ225_TELEPORTSTARW_04;
var int SQ225_TELEPORTSTARW_05;
var int SQ225_TELEPORTSTARW_06;
var int SQ225_TELEPORTSTARW_07;
var int SQ225_TELEPORTSTARW_08;
var int SQ225_TELEPORTSTARW_09;
var int SQ225_TELEPORTSTARW_10;
func void SQ225_VOLKERGUARDSBRINGRTN() {
    if ((KAPITEL) < (4)) {
        B_STARTOTHERROUTINE(NONE_6396_VOLKERGUARD, START);
        NPC_REFRESH(NONE_6396_VOLKERGUARD);
        B_STARTOTHERROUTINE(NONE_6397_VOLKERGUARD, START);
        NPC_REFRESH(NONE_6397_VOLKERGUARD);
    };
    B_STARTOTHERROUTINE(NONE_6396_VOLKERGUARD, "Q308");
    NPC_REFRESH(NONE_6396_VOLKERGUARD);
    B_STARTOTHERROUTINE(NONE_6397_VOLKERGUARD, "Q308");
    NPC_REFRESH(NONE_6397_VOLKERGUARD);
}

func void SQ225_ANDERASTAVERN() {
    OLDCITYENTERED = 0;
    SQ225_OLDCITYDISABLED = 0;
    SQ225_OLDCITYUNLOCKED = 0;
    B_STARTOTHERROUTINE(VLK_11181_ANDERAS, "SQ225_TAVERN");
    NPC_REFRESH(VLK_11181_ANDERAS);
    NPC_EXCHANGEROUTINE(MIL_11180_CITYGUARD, START);
}

func void SQ225_TALKWITHFARMERS() {
    SQ225_TALKEDWITHFARMERSCOUNT = (SQ225_TALKEDWITHFARMERSCOUNT) + (1);
    PRINTD(CS2("Liczba przegadanych NPC: ", INTTOSTRING(SQ225_TALKEDWITHFARMERSCOUNT)));
    if ((SQ225_TALKEDWITHFARMERSCOUNT) == (4)) {
        AI_LOGENTRY(TOPIC_SQ225, LOG_SQ225_VINEYARD_OPINIONS);
    };
}

func void SQ225_ANDERAS_PREPARESCENE() {
    FF_APPLYONCEEXTGT(42061, 0, -(1));
    WLD_SENDTRIGGER("MOVER_PART9_CART_01");
    WLD_SENDTRIGGER("MOVER_PART9_CART_02");
    SQ225_QUESTFAILED_MOVER_01 = TRUE;
    B_STARTOTHERROUTINE(BAU_11190_FARMER, START);
    NPC_REFRESH(BAU_11190_FARMER);
}

func void SQ225_ANDERAS_PREPARESCENE_APPLY() {
    var ZCMOVER MOVER2;
    var int MOVPTR2;
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int SQ225_ANDERAS_PREPARESCENE_COLLISION;
    if ((SQ225_ANDERAS_PREPARESCENE_COLLISION) == (0)) {
        PRINTD("Rozpoczynam - SQ225_Anderas_PrepareScene_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("MOVER_SQ225_CART_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("MOVER_SQ225_CART_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("SQ225_CART_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CART_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_LANTERN_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_LANTERN_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_03", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_03", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_04", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ225_BARREL_01", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("MOVER_SQ225_CART_01");
        WLD_SENDTRIGGER("MOVER_SQ225_CART_02");
        SQ225_ANDERAS_PREPARESCENE_COLLISION = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ225_Anderas_PrepareScene_Apply");
        CHANGEVOBCOLLISION("SQ225_CART_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CART_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_LANTERN_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_LANTERN_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_CRATEPILE_03", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_03", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_WINEBOTTLE_04", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ225_BARREL_01", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(42061);
        SQ225_ANDERAS_PREPARESCENE_COLLISION = 0;
    };
}

func void SQ225_HIDEEVENTS_ANDERASWAY() {
    if ((SQ225_ANDERASWAY_AGREEDCHECK) == (TRUE)) {
        if ((SQ225_TELEPORTSTARW_01) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_01");
        } else {
            B_REMOVENPC(50952);
        };
        if ((SQ225_TELEPORTSTARW_02) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_02");
        } else {
            B_REMOVENPC(50953);
        };
        if ((SQ225_TELEPORTSTARW_03) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_03");
        } else {
            B_REMOVENPC(50954);
        };
        if ((SQ225_TELEPORTSTARW_04) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_04");
        } else {
            B_REMOVENPC(50955);
        };
        if ((SQ225_TELEPORTSTARW_05) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_05");
        } else {
            B_REMOVENPC(50956);
        };
        if ((SQ225_TELEPORTSTARW_06) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_06");
        } else {
            B_REMOVENPC(50957);
        };
        if ((SQ225_TELEPORTSTARW_07) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_07");
        } else {
            B_REMOVENPC(50958);
        };
        if ((SQ225_TELEPORTSTARW_08) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_08");
        } else {
            B_REMOVENPC(50959);
        };
        if ((SQ225_TELEPORTSTARW_09) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_09");
        } else {
            B_REMOVENPC(50960);
        };
        if ((SQ225_TELEPORTSTARW_10) == (TRUE)) {
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_10");
        } else {
            B_REMOVENPC(50961);
        };
        if (((SQ225_FIRECARTWAIT) != (2)) || ((SQ225_FIRECARTWAIT) == (0))) {
            if ((SQ225_QUESTFAILED_MOVER_01) == (TRUE)) {
                FF_APPLYONCEEXTGT(42061, 0, -(1));
                WLD_SENDTRIGGER("MOVER_PART9_CART_01");
                WLD_SENDTRIGGER("MOVER_PART9_CART_02");
            };
            if ((SQ225_QUESTFAILED_MOVER_02) == (TRUE)) {
                SQ225_QUESTFAILED_MOVER_02 = FALSE;
                WLD_SENDTRIGGER("MOVER_SQ225_CART_FIRE_01");
            };
            if ((SQ225_QUESTFAILED_MOVER_03) == (TRUE)) {
                SQ225_QUESTFAILED_MOVER_03 = FALSE;
                WLD_SENDTRIGGER("MOVER_SQ225_CART_FIRE_02");
            };
        };
    };
}

func void SQ225_HIDEEVENTS_HOLDWIGWAY() {
    if ((SQ225_GERSTAND_TALKWITHRODERICH) == (1)) {
        RESTOREROUTINE_RODERICH();
        B_STARTOTHERROUTINE(NONE_839_GERSTAND, START);
        NPC_REFRESH(NONE_839_GERSTAND);
    };
    if ((SQ225_HOLDWIGWAY_AGREED) == (1)) {
        B_STARTOTHERROUTINE(NONE_839_GERSTAND, START);
        NPC_REFRESH(NONE_839_GERSTAND);
    };
}

func void SQ225_FINISHGERSTANDEVENT() {
    SQ225_HIDEEVENTS_ANDERASWAY();
    SQ225_ANDERASWAY_FAILED = 2;
    B_STARTOTHERROUTINE(VLK_11181_ANDERAS, START);
    NPC_REFRESH(VLK_11181_ANDERAS);
    B_STARTOTHERROUTINE(VLK_11181_ANDERAS, START);
    NPC_REFRESH(VLK_11181_ANDERAS);
    AI_LOGENTRY(TOPIC_SQ225, LOG_SQ225_GERSTAND_AFTERRODERICH);
}

func void SQ225_PREPAREGIANTBUGSCAVE() {
    PRINTD("Resp");
    SQ225_HUNTINGGIANTBUG = 1;
    WLD_INSERTNPC(50436, "PART2_TUNNEL_12");
    WLD_INSERTNPC(50437, "PART2_TUNNEL_11");
    WLD_INSERTNPC(50438, "PART2_TUNNEL_09");
    WLD_INSERTNPC(50439, "PART2_TUNNEL_08");
    WLD_INSERTNPC(50440, "PART2_TUNNEL_06");
    WLD_INSERTNPC(50441, "PART2_TUNNEL_07");
    WLD_INSERTNPC(50442, "PART2_TUNNEL_03");
}

func void SQ225_TELEPORTSTARW() {
    if (NPC_ISDEAD(STARW_SQ225_01)) {
        if ((SQ225_TELEPORTSTARW_01) == (FALSE)) {
            SQ225_TELEPORTSTARW_01 = TRUE;
            TELEPORTNPCTOWP(50952, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_01");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_02)) {
        if ((SQ225_TELEPORTSTARW_02) == (FALSE)) {
            SQ225_TELEPORTSTARW_02 = TRUE;
            TELEPORTNPCTOWP(50953, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_02");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_03)) {
        if ((SQ225_TELEPORTSTARW_03) == (FALSE)) {
            SQ225_TELEPORTSTARW_03 = TRUE;
            TELEPORTNPCTOWP(50954, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_03");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_04)) {
        if ((SQ225_TELEPORTSTARW_04) == (FALSE)) {
            SQ225_TELEPORTSTARW_04 = TRUE;
            TELEPORTNPCTOWP(50955, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_04");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_05)) {
        if ((SQ225_TELEPORTSTARW_05) == (FALSE)) {
            SQ225_TELEPORTSTARW_05 = TRUE;
            TELEPORTNPCTOWP(50956, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_05");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_06)) {
        if ((SQ225_TELEPORTSTARW_06) == (FALSE)) {
            SQ225_TELEPORTSTARW_06 = TRUE;
            TELEPORTNPCTOWP(50957, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_06");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_07)) {
        if ((SQ225_TELEPORTSTARW_07) == (FALSE)) {
            SQ225_TELEPORTSTARW_07 = TRUE;
            TELEPORTNPCTOWP(50958, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_07");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_08)) {
        if ((SQ225_TELEPORTSTARW_08) == (FALSE)) {
            SQ225_TELEPORTSTARW_08 = TRUE;
            TELEPORTNPCTOWP(50959, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_08");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_09)) {
        if ((SQ225_TELEPORTSTARW_09) == (FALSE)) {
            SQ225_TELEPORTSTARW_09 = TRUE;
            TELEPORTNPCTOWP(50960, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_09");
        };
    };
    if (NPC_ISDEAD(STARW_SQ225_10)) {
        if ((SQ225_TELEPORTSTARW_10) == (FALSE)) {
            SQ225_TELEPORTSTARW_10 = TRUE;
            TELEPORTNPCTOWP(50961, TOT);
            WLD_SENDTRIGGER("KM_STRAWDESTROYED_10");
        };
    };
}

func void SQ225_EVENTS_AFTERQUEST() {
    CHANGEVOBCOLLISION("SQ225_WAITINVENZELHOUSE_SCRIPT", FALSE, FALSE, FALSE, FALSE);
    if ((SQ225_FINISHWAY) == (1)) {
        B_STARTOTHERROUTINE(BAU_2245_HOLDWIG, "VINEYARD");
        NPC_REFRESH(BAU_2245_HOLDWIG);
        B_REMOVENPC(53767);
    };
    if ((SQ225_FINISHWAY) == (2)) {
        B_STARTOTHERROUTINE(VLK_11181_ANDERAS, "VINEYARD");
        NPC_REFRESH(VLK_11181_ANDERAS);
        B_REMOVENPC(56995);
        B_REMOVENPC(57007);
        B_REMOVENPC(57019);
        B_REMOVENPC(56883);
        B_REMOVENPC(56889);
        B_REMOVENPC(56895);
        B_REMOVENPC(56883);
        B_REMOVENPC(56889);
        B_REMOVENPC(56895);
        B_REMOVENPC(56901);
        B_REMOVENPC(56907);
        B_REMOVENPC(56913);
        B_REMOVENPC(56919);
        B_REMOVENPC(56925);
        B_REMOVENPC(56950);
        B_REMOVENPC(56956);
        B_REMOVENPC(56962);
        B_REMOVENPC(56968);
        B_REMOVENPC(57040);
    };
    if ((SQ225_FINISHWAY) == (3)) {
        B_STARTOTHERROUTINE(VLK_11181_ANDERAS, "SQ225_FinishWay3_Vineyard");
        NPC_REFRESH(VLK_11181_ANDERAS);
        B_STARTOTHERROUTINE(BAU_2245_HOLDWIG, "SQ225_FinishWay3_Vineyard");
        NPC_REFRESH(BAU_2245_HOLDWIG);
    };
    RESTOREROUTINE_DUSTER();
}

func void SQ225_ANDERASWAY_STARTCUTSCENE_APPLY() {
    var int SQ225_ANDERASWAY_STARTCUTSCENE_COUNT;
    SQ225_ANDERASWAY_STARTCUTSCENE_COUNT = (SQ225_ANDERASWAY_STARTCUTSCENE_COUNT) + (1);
    if ((SQ225_ANDERASWAY_STARTCUTSCENE_COUNT) == (4)) {
        SQ225_ANDERASWAY_STARTCUTSCENE_COUNT = 0;
        CUTSCENE_START(92901);
    };
}

func void SQ225_HOLDWIGWAY_STARTCUTSCENE_APPLY() {
    var int SQ225_HOLDWIGWAY_STARTCUTSCENE_COUNT;
    SQ225_HOLDWIGWAY_STARTCUTSCENE_COUNT = (SQ225_HOLDWIGWAY_STARTCUTSCENE_COUNT) + (1);
    if ((SQ225_HOLDWIGWAY_STARTCUTSCENE_COUNT) == (4)) {
        SQ225_HOLDWIGWAY_STARTCUTSCENE_COUNT = 0;
        CUTSCENE_START(92909);
    };
}

func void SQ225_REMOVEVENZELFRIEND() {
    var int SQ225_REMOVEVENZELFRIEND_COUNT;
    SQ225_REMOVEVENZELFRIEND_COUNT = (SQ225_REMOVEVENZELFRIEND_COUNT) + (1);
    if ((SQ225_REMOVEVENZELFRIEND_COUNT) == (1)) {
        SQ225_ERVALTINPRISON = 1;
        B_STARTOTHERROUTINE(VLK_64260_ERVALT, "PRISON");
        NPC_REFRESH(VLK_64260_ERVALT);
        TELEPORTNPCTOWP(52563, VLK_64260_ERVALT.WP);
        WLD_SENDTRIGGER("SQ225_MOVER_PRISONFRIEND_01");
    };
    if ((SQ225_REMOVEVENZELFRIEND_COUNT) == (2)) {
        WLD_SENDTRIGGER("SQ225_MOVER_PRISONFRIEND_02");
        SQ225_ARTHURINPRISON = 1;
        B_STARTOTHERROUTINE(VLK_64261_ARTHUR, "PRISON");
        NPC_REFRESH(VLK_64261_ARTHUR);
        TELEPORTNPCTOWP(52566, VLK_64261_ARTHUR.WP);
        WLD_INSERTITEM(40440, "FP_VENZEL_PRISONNOTE");
    };
}

