instance DIA_RAMSEY_Q602_EXIT(C_INFO) {
    NPC = 59928;
    NR = 999;
    CONDITION = DIA_RAMSEY_Q602_EXIT_CONDITION;
    INFORMATION = DIA_RAMSEY_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_RAMSEY_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_RAMSEY_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_RAMSEY_Q602_WAIT(C_INFO) {
    NPC = 59928;
    NR = 1;
    CONDITION = DIA_RAMSEY_Q602_WAIT_CONDITION;
    INFORMATION = DIA_RAMSEY_Q602_WAIT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_RAMSEY_Q602_WAIT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_GUILD_V4) == (3))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RAMSEY_Q602_WAIT_INFO() {
    MDL_APPLYOVERLAYMDS(SELF, "HUMANS_WOUNDED.MDS");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ramsey_Q602_WAIT_03_01");
    INFO_CLEARCHOICES(90565);
    INFO_ADDCHOICE(90565, "Go back to Silbach. This is not your battle.", 90569);
    INFO_ADDCHOICE(90565, "You betrayed the city, you deserve to die. I will be your executioner. (Kill)", 90568);
}

func void DIA_RAMSEY_Q602_WAIT_KILL() {
    FINALBOARDS_RAMSEYISDEAD = TRUE;
    SELF.FLAGS = 0;
    SELF.ATTRIBUTE[0] = 1;
    MDL_APPLYOVERLAYMDS(SELF, "HUMANS_SUDDENDEATH.MDS");
    AI_STARTFACEANI(SELF, S_FRIGHTENED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ramsey_Q602_WAIT_Kill_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ramsey_Q602_WAIT_Kill_03_02");
    AI_WAITTILLEND(OTHER, SELF);
    B_MARVIN_ATTACKINDIALOGUE_PREPARE();
    AI_FUNCTION(OTHER, 90570);
    B_MARVIN_ATTACKINDIALOGUE_ATTACK();
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(90565);
    AI_STOPPROCESSINFOS(OTHER);
}

func void DIA_RAMSEY_Q602_WAIT_FLEE() {
    Q602_RAMSEY_STATUS = 2;
    AI_STARTFACEANI(SELF, S_FRIGHTENED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ramsey_Q602_WAIT_Flee_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ramsey_Q602_WAIT_Flee_03_02");
    AI_WAITTILLEND(OTHER, SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Ramsey_Q602_WAIT_Flee_15_03");
    INFO_CLEARCHOICES(90565);
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(OTHER);
    NPC_EXCHANGEROUTINE(SELF, "Q602_FLEE");
}

func void MARVIN_Q602_KILLRAMSEY() {
    AI_PLAYANI(NONE_500_RAMSEY_Q602, T_DEAD);
    SND_PLAY("FIG_SwordFinal");
    SND_PLAY("SVM_70_DEAD");
    B_MAGICHURTNPC(HERO, NONE_500_RAMSEY_Q602, 99999);
    AI_REMOVEWEAPON(HERO);
    HERO.AIVAR[4] = FALSE;
}

