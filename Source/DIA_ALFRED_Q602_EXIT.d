instance DIA_ALFRED_Q602_EXIT(C_INFO) {
    NPC = 60135;
    NR = 999;
    CONDITION = DIA_ALFRED_Q602_EXIT_CONDITION;
    INFORMATION = DIA_ALFRED_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_ALFRED_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_ALFRED_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ALFRED_Q602_STOP(C_INFO) {
    NPC = 60135;
    NR = 1;
    CONDITION = DIA_ALFRED_Q602_STOP_CONDITION;
    INFORMATION = DIA_ALFRED_Q602_STOP_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ALFRED_Q602_STOP_CONDITION() {
    if ((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int ALFRED_Q602_WHERE;
var int ALFRED_Q602_THIEF;
var int ALFRED_Q602_VOLKER;
func void DIA_ALFRED_Q602_STOP_CHOICES() {
    INFO_CLEARCHOICES(90792);
    if ((ALFRED_Q602_THIEF) == (FALSE)) {
        INFO_ADDCHOICE(90792, "Robber? It was Volker and Ulryk who attacked the city!", 90804);
    };
    if ((ALFRED_Q602_VOLKER) == (FALSE)) {
        INFO_ADDCHOICE(90792, "The Usurer is responsible for the deaths of dozens of people.", 90806);
    };
    if ((ALFRED_Q602_WHERE) == (FALSE)) {
        INFO_ADDCHOICE(90792, "Where's the Usurer?", 90801);
    };
    INFO_ADDCHOICE(90792, "Live in your delusion, old man. (Go away)", 90807);
    INFO_ADDCHOICE(90792, "You deserve nothing but death. (Kill)", 90808);
}

func void DIA_ALFRED_Q602_STOP_INFO() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_03_01");
    DIA_ALFRED_Q602_STOP_CHOICES();
}

var int ALFRED_Q602_WHERE_COUNT;
func void DIA_ALFRED_Q602_STOP_WHERE_COUNT() {
    ALFRED_Q602_WHERE_COUNT = (ALFRED_Q602_WHERE_COUNT) + (1);
    if ((ALFRED_Q602_WHERE_COUNT) >= (2)) {
        DIA_ALFRED_Q602_STOP_CHOICES();
    };
}

func void DIA_ALFRED_Q602_STOP_WHERE() {
    ALFRED_Q602_WHERE = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Where_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Where_03_02");
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_ALFREDMEET);
    INFO_CLEARCHOICES(90792);
    INFO_ADDCHOICE(90792, "Tell me where he is and you'll be fine.", 90802);
    INFO_ADDCHOICE(90792, "The Usurer killed my brother, he'll pay for it.", 90803);
}

func void DIA_ALFRED_Q602_STOP_WHERE_TELL() {
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Tell_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Tell_03_02");
    DIA_ALFRED_Q602_STOP_WHERE_COUNT();
}

func void DIA_ALFRED_Q602_STOP_WHERE_JORN() {
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Jorn_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Jorn_03_02");
    DIA_ALFRED_Q602_STOP_WHERE_COUNT();
}

func void DIA_ALFRED_Q602_STOP_THIEF() {
    ALFRED_Q602_THIEF = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Thief_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Thief_03_02");
    INFO_CLEARCHOICES(90792);
    INFO_ADDCHOICE(90792, "Then why did all his men leave?", 90805);
}

func void DIA_ALFRED_Q602_STOP_THIEF_WHY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Why_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Why_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Why_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Why_03_04");
    DIA_ALFRED_Q602_STOP_CHOICES();
}

func void DIA_ALFRED_Q602_STOP_VOLKER() {
    ALFRED_Q602_VOLKER = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Volker_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Volker_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Volker_03_03");
}

func void DIA_ALFRED_Q602_STOP_LEAVE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Leave_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Leave_03_02");
    INFO_CLEARCHOICES(90792);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_ALFRED_LEAVE);
    Q602_SPAWNRIORDIAN();
}

func void DIA_ALFRED_Q602_STOP_KILL() {
    SELF.ATTRIBUTE[0] = 1;
    MDL_APPLYOVERLAYMDS(SELF, "HUMANS_SUDDENDEATH.MDS");
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Alfred_Q602_STOP_Kill_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_PLAYANI(SELF, "T_STAND_2_KILLME");
    AI_OUTPUT(SELF, OTHER, "DIA_Alfred_Q602_STOP_Kill_03_02");
    B_MARVIN_ATTACKINDIALOGUE_PREPARE();
    AI_FUNCTION(OTHER, 90809);
    B_MARVIN_ATTACKINDIALOGUE_ATTACK();
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(90792);
    AI_STOPPROCESSINFOS(OTHER);
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_ALFRED_KILL);
    Q602_SPAWNRIORDIAN();
}

func void MARVIN_Q602_KILLALFRED() {
    AI_PLAYANI(VLK_6400_ALFRED_Q602, T_DEAD);
    SND_PLAY("FIG_SwordFinal");
    SND_PLAY("SVM_22_DEAD");
    B_MAGICHURTNPC(HERO, VLK_6400_ALFRED_Q602, 99999);
    AI_REMOVEWEAPON(HERO);
    HERO.AIVAR[4] = FALSE;
}

