func void QA301_MOVERS() {
    PRINTD("Movery w ruch!");
    if ((LOG_GETSTATUS(MIS_QA301)) == (LOG_RUNNING)) {
        if ((QA301_LEAVEGUILD_MOVER_02) == (FALSE)) {
            QA301_LEAVEGUILD_MOVER_02 = TRUE;
        };
        WLD_SENDTRIGGER("KM_QA301_CHESTS_01");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_02");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_03");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_04");
        WLD_SENDTRIGGER("KM_QA301_BARRELS_01");
    };
    if ((((QA301_BADCUTSCENE) == (5)) || ((QA301_FINALCUTSCENE) == (5))) || ((QA301_GRIZISDEAD) >= (1))) {
        if ((QA301_LEAVEGUILD_MOVER_03) == (FALSE)) {
            QA301_LEAVEGUILD_MOVER_03 = TRUE;
        };
        WLD_SENDTRIGGER("KM_QA301_CHESTS_01_B");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_02_B");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_03_B");
        WLD_SENDTRIGGER("KM_QA301_CHESTS_04_B");
        WLD_SENDTRIGGER("KM_QA301_BARRELS_01_B");
    };
}

func void QA301_SPAWNNPC() {
    PRINTD("NPC gotowe!");
    WLD_INSERTNPC(57305, "PART12_QA301_BAU_01");
    WLD_INSERTNPC(57312, "PART12_QA301_BAU_02");
    WLD_INSERTNPC(57319, "PART12_QA301_BAU_03");
    WLD_INSERTNPC(57379, "PART12_QA301_SLD_01");
    WLD_INSERTNPC(57386, "PART12_QA301_SLD_02");
    WLD_INSERTNPC(57706, "PART12_QA301_SLD_03");
}

func void QA301_SPAWNMONSTERS() {
    PRINTD("Potwory gotowe!");
    WLD_INSERTNPC(50508, "PART12_QA301_GOBBO_01");
    WLD_INSERTNPC(50509, "PART12_QA301_GOBBO_02");
    WLD_INSERTNPC(50510, "PART12_QA301_GOBBO_03");
    WLD_INSERTNPC(50492, "PART12_QA301_GOBBO_04");
    WLD_INSERTNPC(50493, "PART12_QA301_GOBBO_05");
    WLD_INSERTNPC(50174, "PART12_QA301_GOBBO_06");
}

func void QA301_FIREPLACE() {
    FF_APPLYONCEEXTGT(63013, 0, -(1));
}

func void QA301_FIREPLACE_MOVER() {
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int QA301_FIREPLACE_MOVER_COUNT;
    if ((QA301_FIREPLACE_MOVER_COUNT) == (0)) {
        PRINTD("Rozpoczynam - QA301_FirePlace_Mover");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KM_QA301_FIREPLACE");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("KM_QA301_BONFIRE", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KM_QA301_FIREPLACE");
        QA301_FIREPLACE_MOVER_COUNT = 1;
        if ((QA301_LEAVEGUILD_MOVER_04) == (TRUE)) {
            QA301_LEAVEGUILD_MOVER_04 = FALSE;
        };
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - QA301_FirePlace_Mover");
        CHANGEVOBCOLLISION("KM_QA301_BONFIRE", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(63013);
        QA301_FIREPLACE_MOVER_COUNT = 0;
        if ((QA301_LEAVEGUILD_MOVER_04) == (FALSE)) {
            QA301_LEAVEGUILD_MOVER_04 = TRUE;
        };
    };
}

func void QA301_SPAWNSHADOWBEAST() {
    PRINTD("Cieniostwór gotowy!");
    WLD_INSERTNPC(50787, "PART12_FOREST_QA301_SHADOWBEAST");
    WLD_INSERTNPC(50722, "PART12_FOREST_QA301_SCAVENGER");
    B_KILLNPC(50722);
}

func void QA301_BLOOD() {
    PRINTD("Krew");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_01");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_02");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_03");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_04");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_05");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_06");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_07");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_08");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_09");
    WLD_SENDTRIGGER("KM_QA301_BLOOD_10");
}

func void QA301_TRANSPORTEND() {
    FADESCREENTOBLACKF(2, 63021, 1000);
}

func void QA301_LASTMOVER() {
    if ((QA301_BADCUTSCENE) == (5)) {
        QA301_FINISHJOB = 1;
    };
    if (((QA301_FINALCUTSCENE) >= (4)) || ((QA301_GRIZISDEAD) >= (1))) {
        if (NPC_ISDEAD(SLD_11056_GRIZ)) {
            QA301_FINISHJOB = 2;
        } else {
            QA301_FINISHJOB = 3;
        };
    };
    B_LOGENTRY(TOPIC_QA301, LOG_QA301_FINISHBATTLE);
    B_STARTOTHERROUTINE(BAU_11051_FARMER_QA301, "QA301_FINISHJOB");
    B_STARTOTHERROUTINE(BAU_11052_FARMER_QA301, "QA301_FINISHJOB");
    B_STARTOTHERROUTINE(BAU_11053_FARMER_QA301, "QA301_FINISHJOB");
    B_STARTOTHERROUTINE(SLD_11054_ARAXOS_QA301, "QA301_FINISHJOB");
    B_STARTOTHERROUTINE(SLD_11055_ARAXOS_QA301, "QA301_FINISHJOB");
    if ((QA301_FINALCUTSCENE) == (5)) {
        B_STARTOTHERROUTINE(SLD_11056_GRIZ, "QA301_FINISHJOB");
    };
    TELEPORTNPCTOWP(1819, "PART7_PATH_168");
    TELEPORTNPCTOWP(57305, "PART7_QA301_BAU_01");
    TELEPORTNPCTOWP(57312, "PART7_QA301_BAU_02");
    TELEPORTNPCTOWP(57319, "PART7_QA301_BAU_03");
    TELEPORTNPCTOWP(57379, "PART7_QA301_ARX_02");
    TELEPORTNPCTOWP(57386, "PART7_QA301_ARX_01");
    if ((QA301_FINALCUTSCENE) == (5)) {
        TELEPORTNPCTOWP(57706, "PART7_PATH_95");
    };
    B_PASSTIME(2);
    QA301_MOVERS();
    QA301_LEAVEGUILD_MOVER_02 = FALSE;
    QA301_LEAVEGUILD_MOVER_03 = FALSE;
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
}

func void QA301_TRANSPORTEND_FADESCREEN() {
    QA301_LASTMOVER();
}

func void QA301_REMOVEEVENTS() {
    PRINTD("Posprz¹tane");
    QA301_MOVERS();
    QA301_LEAVEGUILD_MOVER_02 = FALSE;
    QA301_LEAVEGUILD_MOVER_03 = FALSE;
    if ((QA301_BADCUTSCENE) == (5)) {
        QA301_BLOOD();
        QA301_LEAVEGUILD_MOVER_01 = FALSE;
    };
    WLD_SENDTRIGGER("KM_QA301_FIREPLACE_LIGHT");
    QA301_LEAVEGUILD_MOVER_05 = FALSE;
    B_REMOVENPC(57305);
    B_REMOVENPC(57312);
    B_REMOVENPC(57319);
    B_REMOVENPC(57379);
    B_REMOVENPC(57386);
    if (!(NPC_ISDEAD(SLD_11056_GRIZ))) {
        B_STARTOTHERROUTINE(SLD_11056_GRIZ, "CITY");
        NPC_REFRESH(SLD_11056_GRIZ);
        NPC_CHANGEARMOR(SLD_11056_GRIZ, 35470);
        NPC_REMOVEINVITEMS(SLD_11056_GRIZ, 35465, 1);
    };
}

