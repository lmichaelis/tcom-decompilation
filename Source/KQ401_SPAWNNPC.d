func void KQ401_SPAWNNPC() {
    PRINTD("Wys³annik królewski przyby³");
    FF_APPLYONCEEXTGT(61753, 0, -(1));
    FF_APPLYONCEEXTGT(61765, 0, -(1));
    if (HLP_ISVALIDNPC(VLK_6104_GUY)) {
        B_STARTOTHERROUTINE(VLK_6104_GUY, "KQ401");
    };
    WLD_INSERTNPC(53744, "PARTM4_MERCHANTGUIDE_04");
    WLD_INSERTNPC(53706, "PARTM5_CITYHALL_GUARD_01");
    WLD_INSERTNPC(53719, "PARTM5_CITYHALL_GUARD_02");
    WLD_INSERTNPC(53887, "HARBOUR_KQ402_GUARDSMAN_01");
    WLD_INSERTNPC(53734, "PARTM5_CITYHALL_GUARD_03");
}

func void KQ401_MOVERS_APPLY() {
    var int MOVPTR5;
    var int MOVPTR4;
    var ZCMOVER MOVER2;
    var ZCMOVER MOVER4;
    var int MOVPTR2;
    var int MOVPTR1;
    var ZCMOVER MOVER5;
    var ZCMOVER MOVER3;
    var int MOVPTR3;
    var ZCMOVER MOVER1;
    var int KQ401_MOVERS_APPLY_COLLISION;
    if ((KQ401_MOVERS_APPLY_COLLISION) == (0)) {
        PRINTD("Rozpoczynam - KQ401_Movers_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KM_KQ402_CHEST_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KM_KQ402_CHEST_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        MOVPTR3 = MEM_SEARCHVOBBYNAME("KM_KQ402_CHEST_03");
        MOVER3 = MEM_PTRTOINST(MOVPTR3);
        MOVPTR4 = MEM_SEARCHVOBBYNAME("KM_KQ402_CHEST_04");
        MOVER4 = MEM_PTRTOINST(MOVPTR4);
        MOVPTR5 = MEM_SEARCHVOBBYNAME("KM_KQ402_CHEST_05");
        MOVER5 = MEM_PTRTOINST(MOVPTR5);
        CHANGEVOBCOLLISION("KQ402_CHEST_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_03", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_04", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_05", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_05", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KM_KQ402_CHEST_01");
        WLD_SENDTRIGGER("KM_KQ402_CHEST_02");
        WLD_SENDTRIGGER("KM_KQ402_CHEST_03");
        WLD_SENDTRIGGER("KM_KQ402_CHEST_04");
        WLD_SENDTRIGGER("KM_KQ402_CHEST_05");
        KQ401_MOVERS_APPLY_COLLISION = 1;
    };
    if (((((((((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER5.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER5.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - KQ401_Movers_Apply");
        CHANGEVOBCOLLISION("KQ402_CHEST_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_03", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_04", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ402_CHEST_05", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(61753);
        KQ401_MOVERS_APPLY_COLLISION = 0;
    };
}

func void KQ401_OPENDOOR_APPLY() {
    var int MOVPTR1;
    var ZCMOVER MOVER1;
    var int KQ401_OPENDOOR_APPLY_COLLISION;
    if ((KQ401_OPENDOOR_APPLY_COLLISION) == (0)) {
        PRINTD("Rozpoczynam - KQ401_OpenDoor_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ401_MOVER_DOOR");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("KQ401_DOOR", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ401_MOVER_DOOR");
        KQ401_OPENDOOR_APPLY_COLLISION = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - KQ401_OpenDoor_Apply");
        CHANGEVOBCOLLISION("KQ401_DOOR", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(61765);
        KQ401_OPENDOOR_APPLY_COLLISION = 0;
    };
}

func void KQ401_TELEPORTTOGRAYSON() {
    FADESCREENTOBLACKF(1, 61770, 1000);
}

func void KQ401_TELEPORTTOGRAYSON_FADESCREEN() {
    HERO.AIVAR[4] = FALSE;
    TELEPORTNPCTOWP(1819, "PARTM5_CITYHALL_35");
    AI_TURNTONPC(HERO, NONE_11068_GRAYSON);
    FADESCREENFROMBLACK(1);
}

