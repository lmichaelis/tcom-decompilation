instance DIA_KETH_EXIT(C_INFO) {
    NPC = 55113;
    NR = 999;
    CONDITION = DIA_KETH_EXIT_CONDITION;
    INFORMATION = DIA_KETH_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_KETH_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_KETH_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_KETH_HELLO(C_INFO) {
    NPC = 55113;
    NR = 1;
    CONDITION = DIA_KETH_HELLO_CONDITION;
    INFORMATION = DIA_KETH_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KETH_HELLO_CONDITION() {
    if (NPC_ISINSTATE(SELF, 61599)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_HELLO_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_Hello_03_01");
}

instance DIA_KETH_CQ004_START(C_INFO) {
    NPC = 55113;
    NR = 2;
    CONDITION = DIA_KETH_CQ004_START_CONDITION;
    INFORMATION = DIA_KETH_CQ004_START_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Maybe I can help. What is it?";
}

func int DIA_KETH_CQ004_START_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 75268)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_CQ004_START_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Start_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Start_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Start_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Start_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Start_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Start_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Start_03_07");
    CQ004_KETHGUIDESTATUS = 1;
    LOG_CREATETOPIC(TOPIC_CQ004, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_CQ004), TOPIC_CQ004, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_START);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 62670);
}

instance DIA_KETH_CQ004_FREE(C_INFO) {
    NPC = 55113;
    NR = 2;
    CONDITION = DIA_KETH_CQ004_FREE_CONDITION;
    INFORMATION = DIA_KETH_CQ004_FREE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KETH_CQ004_FREE_CONDITION() {
    if ((((NPC_KNOWSINFO(OTHER, 75354)) && ((CQ004_KETHCHEAT) == (FALSE))) && ((CQ004_RECONANDVEIGOCHEAT) == (FALSE))) && ((LOG_GETSTATUS(MIS_CQ004)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_CQ004_FREE_INFO() {
    NPC_EXCHANGEROUTINE(SELF, "LEAN");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_06");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_15_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_08");
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_10");
        CQ004_KETHREWARD = 1;
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_03_09");
    CQ004_KETHREWARD = 2;
    INFO_CLEARCHOICES(75274);
    INFO_ADDCHOICE(75274, "I'll see how it goes.", 75279);
    INFO_ADDCHOICE(75274, "Any idea what would be a good 'something'?", 75278);
    INFO_ADDCHOICE(75274, "What if they're innocent?", 75277);
}

func void DIA_KETH_CQ004_FREE_INNOCENT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_Innocent_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Innocent_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Innocent_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_Innocent_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Innocent_03_05");
}

func void DIA_KETH_CQ004_FREE_IDEA() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_Idea_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Idea_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Idea_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Idea_03_04");
}

func void DIA_KETH_CQ004_FREE_SURE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_Sure_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Free_Sure_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Free_Sure_15_03");
    if ((CQ004_KETHREWARD) == (1)) {
        AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_KETH_HELPOFFER_V1);
    };
    if ((CQ004_KETHREWARD) == (2)) {
        AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_KETH_HELPOFFER_V2);
    };
    INFO_CLEARCHOICES(75274);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 75280);
}

func void CQ004_TELEPORTWORKERS() {
    if ((NPC_GETDISTTOWP(VLK_6231_RECON, "PARTM3_RECON")) >= (500)) {
        PRINTD("Teleport Recon");
        B_STARTOTHERROUTINE(VLK_6231_RECON, "CQ004_BARRACKIDLE");
        NPC_REFRESH(VLK_6231_RECON);
        TELEPORTNPCTOWP(55124, VLK_6231_RECON.WP);
        AI_TELEPORTALWAYS(VLK_6231_RECON, VLK_6231_RECON.WP, TRUE);
    };
    if ((NPC_GETDISTTOWP(VLK_6232_VEIGO, "PARTM3_VEIGO")) >= (500)) {
        PRINTD("Teleport Veigo");
        B_STARTOTHERROUTINE(VLK_6232_VEIGO, "CQ004_BARRACKIDLE");
        NPC_REFRESH(VLK_6232_VEIGO);
        TELEPORTNPCTOWP(55134, VLK_6232_VEIGO.WP);
        AI_TELEPORTALWAYS(VLK_6232_VEIGO, VLK_6232_VEIGO.WP, TRUE);
    };
}

instance DIA_KETH_CQ004_JUDGMENT(C_INFO) {
    NPC = 55113;
    NR = 1;
    CONDITION = DIA_KETH_CQ004_JUDGMENT_CONDITION;
    INFORMATION = DIA_KETH_CQ004_JUDGMENT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KETH_CQ004_JUDGMENT_CONDITION() {
    if (((CQ004_KETHCHEAT) == (TRUE)) && ((LOG_GETSTATUS(MIS_CQ004)) == (LOG_RUNNING))) {
        if ((NPC_GETDISTTOWP(HERO, "PARTM3_PATH_163")) <= (300)) {
            if (((((((NPC_GETDISTTOWP(VLK_6232_VEIGO, "PARTM3_BARRACK_VEIGO")) <= (450)) && ((NPC_GETDISTTOWP(VLK_6231_RECON, "PARTM3_BARRACK_RECON")) <= (450))) && ((NPC_GETDISTTOWP(MIL_4044_SALL, "PARTM3_BARRACK_SALL")) <= (450))) && ((NPC_GETDISTTOWP(VLK_6233_ALDER, "PARTM3_BARRACK_ALDER")) <= (450))) && ((NPC_GETDISTTOWP(MIL_4047_PRISONGUARD, "PARTM3_PATH_164")) <= (450))) && ((NPC_GETDISTTOWP(SELF, "PARTM3_BARRACK_KETH")) <= (450))) {
                return TRUE;
            };
        };
    };
    if (((CQ004_RECONANDVEIGOCHEAT) == (TRUE)) && ((LOG_GETSTATUS(MIS_CQ004)) == (LOG_RUNNING))) {
        if ((NPC_GETDISTTOWP(HERO, "PARTM3_PATH_163")) <= (300)) {
            if (((((((NPC_GETDISTTOWP(VLK_6232_VEIGO, "PARTM3_BARRACK_VEIGO")) <= (450)) && ((NPC_GETDISTTOWP(VLK_6231_RECON, "PARTM3_BARRACK_RECON")) <= (450))) && ((NPC_GETDISTTOWP(MIL_4044_SALL, "PARTM3_BARRACK_SALL")) <= (450))) && ((NPC_GETDISTTOWP(VLK_6233_ALDER, "PARTM3_BARRACK_ALDER")) <= (450))) && ((NPC_GETDISTTOWP(MIL_4047_PRISONGUARD, "PARTM3_PATH_164")) <= (450))) && ((NPC_GETDISTTOWP(SELF, "PARTM3_BARRACK_KETH")) <= (450))) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_CQ004_JUDGMENT_INFO() {
    TRIA_INVITE(MIL_4044_SALL);
    TRIA_INVITE(VLK_6233_ALDER);
    TRIA_INVITE(VLK_6231_RECON);
    TRIA_START();
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_15_02");
    AI_FUNCTION(HERO, 75291);
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_LOOKATNPC(HERO, VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_15_05");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_03_06");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_03_07");
    INFO_CLEARCHOICES(75281);
    if (((CQ004_RECONCHESTSTATUS) == (1)) && ((MOB_HASITEMS("RECON_CHEST", 37157)) == (TRUE))) {
        INFO_ADDCHOICE(75281, "As suspected, the sabotage was done by Recon and Veigo.", 75285);
    };
    INFO_ADDCHOICE(75281, "It wasn't Recon and Veigo who sabotaged the crane.", 75284);
}

func void DIA_KETH_CQ004_JUDGMENT_KETHLOST() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethLost_15_01");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethLost_15_03");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6233_ALDER);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethLost_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_06");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_08");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethLost_15_09");
    AI_FUNCTION(HERO, 75286);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_10");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_11");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethLost_03_12");
    TRIA_FINISH();
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_JUDGMENT_RESULT_V1);
    LOG_SETSTATUS(_@(MIS_CQ004), TOPIC_CQ004, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_CQ004_FINISH_KETHLOST);
    INFO_CLEARCHOICES(75281);
    AI_STOPPROCESSINFOS(SELF);
    CQ004_RESULT = 1;
    AI_FUNCTION(SELF, 62674);
}

func void DIA_KETH_CQ004_JUDGMENT_KETHWON() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethWon_15_01");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethWon_03_02");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethWon_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_Judgment_KethWon_15_04");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6230_KETH);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethWon_03_05");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4044_SALL);
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_Judgment_KethWon_03_06");
    TRIA_WAIT();
    TRIA_FINISH();
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_FUNCTION(VLK_6230_KETH, 75287);
    AI_FUNCTION(HERO, 75288);
    AI_WAIT(SELF, 1093664768);
}

func void GIVESALLGEAR() {
    B_GIVEINVITEMS(HERO, MIL_4044_SALL, 37157, 1);
}

func void MILITIAWENTFORGEARNOW() {
    FADESCREENTOBLACKF(9, 75290, 1000);
}

func void FADESCREENWORKERS() {
    NPC_CLEARAIQUEUE(MIL_4047_PRISONGUARD);
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("WORKERHONOR_MILITIA");
    AI_PLAYANI(MIL_4047_PRISONGUARD, T_GREETGRD);
    AI_SETWALKMODE(MIL_4047_PRISONGUARD, NPC_WALK);
    AI_WAIT(MIL_4047_PRISONGUARD, 1045220557);
    AI_TURNAWAY(MIL_4047_PRISONGUARD, HERO);
    AI_FUNCTION(MIL_4047_PRISONGUARD, 75289);
}

func void MILTIAGOFORGEAR() {
    B_STARTOTHERROUTINE(MIL_4047_PRISONGUARD, "GoGear");
    NPC_REFRESH(MIL_4047_PRISONGUARD);
}

func void MILITIAWENTFORGEAR() {
    AI_WAIT(HERO, 1093664768);
    B_PASSTIME(2);
    WLD_SENDTRIGGER("WORKERHONOR_GEAR");
    WLD_SENDUNTRIGGER("WORKERHONOR_MILITIA");
    NPC_SETREFUSETALK(MIL_4044_SALL, 11);
    NPC_CLEARAIQUEUE(MIL_4047_PRISONGUARD);
    AI_TELEPORT(MIL_4047_PRISONGUARD, "PARTM3_PATH_09");
    NPC_EXCHANGEROUTINE(MIL_4047_PRISONGUARD, "ComeBackGear");
    AI_SETWALKMODE(MIL_4047_PRISONGUARD, NPC_WALK);
    AI_GOTOWP(MIL_4047_PRISONGUARD, "PARTM3_PATH_165");
    CQ004_MILITIAFOUNDGEAR = TRUE;
    FADESCREENFROMBLACK(4);
    HERO.AIVAR[4] = FALSE;
    INFO_CLEARCHOICES(75281);
    AI_STOPPROCESSINFOS(HERO);
    AI_STOPPROCESSINFOS(SELF);
}

func void CQ004MILTIABLOCK() {
    NPC_EXCHANGEROUTINE(MIL_4047_PRISONGUARD, "BlockYourPath");
    NPC_REFRESH(MIL_4047_PRISONGUARD);
}

instance DIA_KETH_CQ004_WORKERRESULT(C_INFO) {
    NPC = 55113;
    NR = 1;
    CONDITION = DIA_KETH_CQ004_WORKERRESULT_CONDITION;
    INFORMATION = DIA_KETH_CQ004_WORKERRESULT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KETH_CQ004_WORKERRESULT_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_CQ004)) == (LOG_SUCCESS)) && ((CQ004_RESULT) == (1))) || (((LOG_GETSTATUS(MIS_CQ004)) == (LOG_RUNNING)) && ((CQ004_RESULT) == (2)))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int CQ004_KETH_REFERENCEEXCHANGE;
func void DIA_KETH_CQ004_WORKERRESULT_INFO() {
    if ((CQ004_RESULT) == (1)) {
        B_STARTOTHERROUTINE(MIL_4044_SALL, START);
        NPC_REFRESH(MIL_4044_SALL);
        B_STARTOTHERROUTINE(VLK_6233_ALDER, "CQ004_GOTOPRISON");
        NPC_REFRESH(VLK_6233_ALDER);
        B_STARTOTHERROUTINE(MIL_4047_PRISONGUARD, "GoToPrison");
        NPC_REFRESH(MIL_4047_PRISONGUARD);
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_02");
        INFO_CLEARCHOICES(75292);
        INFO_ADDCHOICE(75292, "I hope I never have to see you again.", 75297);
        INFO_ADDCHOICE(75292, "Is that a threat?", 75298);
    };
    if ((CQ004_RESULT) == (2)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_03");
        AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_15_04");
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_05");
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_06");
        if ((CQ004_KETHREWARD) == (2)) {
            CQ004_KETH_REFERENCEEXCHANGE = 1;
            CREATEINVITEMS(SELF, 34203, CQ004_KETHREWARD_V1_NOQ202);
        } else if ((CQ004_KETHREWARD) == (1)) {
            CREATEINVITEMS(SELF, 34203, CQ004_KETHREWARD_V1);
            B_GIVEINVITEMS(SELF, OTHER, 34203, CQ004_KETHREWARD_V1);
        };
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_03_07");
        INFO_CLEARCHOICES(75292);
        INFO_ADDCHOICE(75292, "Let's just hope they have enough to satisfy you.", 75300);
        INFO_ADDCHOICE(75292, "What if you don't?", 75301);
    };
}

func void DIA_KETH_CQ004_WORKERRESULT_FINISH_BAD() {
    if ((CQ004_KETHREWARD) == (1)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_GetOut_03_05");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_GetOut_15_06");
    INFO_CLEARCHOICES(75292);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, TOT);
}

func void DIA_KETH_CQ004_WORKERRESULT_GETOUT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_GetOut_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_GetOut_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_GetOut_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_GetOut_03_04");
    CQ004_KETHANWSER = 1;
    DIA_KETH_CQ004_WORKERRESULT_FINISH_BAD();
}

func void DIA_KETH_CQ004_WORKERRESULT_THREAT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Threat_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Threat_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Threat_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Threat_03_04");
    CQ004_KETHANWSER = 2;
    DIA_KETH_CQ004_WORKERRESULT_FINISH_BAD();
}

func void DIA_KETH_CQ004_WORKERRESULT_FINISH() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Happy_15_06");
    if ((CQ004_KETHREWARD) == (1)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Happy_15_07");
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Happy_03_08");
        CREATEINVITEMS(SELF, 37158, 1);
        B_GIVEINVITEMS(SELF, OTHER, 37158, 1);
    };
    INFO_CLEARCHOICES(75292);
    AI_STOPPROCESSINFOS(SELF);
    if ((CQ004_KETHREWARD) == (1)) {
        AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_FINISH_V1);
    };
    if ((CQ004_KETHREWARD) == (2)) {
        AI_LOGENTRY(TOPIC_CQ004, LOG_CQ004_FINISH_V2);
    };
    LOG_SETSTATUS(_@(MIS_CQ004), TOPIC_CQ004, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_CQ004_FINISH_KETHWON);
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_SUCCESS)) {
        NPC_EXCHANGEROUTINE(SELF, TOT);
    };
    NPC_EXCHANGEROUTINE(SELF, "MARKET");
    WLD_INSERTNPC(55321, "SLUMS_PATH_187");
}

func void DIA_KETH_CQ004_WORKERRESULT_HAPPY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Happy_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Happy_03_02");
    if ((CQ004_KETHREWARD) == (2)) {
        CQ004_KETH_REFERENCEEXCHANGE = 1;
        CREATEINVITEMS(SELF, 34203, CQ004_KETHREWARD_V2_NOQ202);
    };
    if ((CQ004_KETHREWARD) == (1)) {
        CREATEINVITEMS(SELF, 34203, CQ004_KETHREWARD_V2);
        B_GIVEINVITEMS(SELF, OTHER, 34203, CQ004_KETHREWARD_V2);
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Happy_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Happy_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Happy_03_05");
    DIA_KETH_CQ004_WORKERRESULT_FINISH();
}

func void DIA_KETH_CQ004_WORKERRESULT_COAX() {
    AI_OUTPUT(OTHER, SELF, "DIA_Keth_CQ004_WorkerResult_Coax_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Coax_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Coax_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Keth_CQ004_WorkerResult_Coax_03_04");
    DIA_KETH_CQ004_WORKERRESULT_FINISH();
}

instance DIA_KETH_REFERENCEEXCHANGE(C_INFO) {
    NPC = 55113;
    NR = 1;
    CONDITION = DIA_KETH_REFERENCEEXCHANGE_CONDITION;
    INFORMATION = DIA_KETH_REFERENCEEXCHANGE_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Could I exchange my reward for a reference? (100 GP)";
}

func int DIA_KETH_REFERENCEEXCHANGE_CONDITION() {
    if ((((CQ004_KETH_REFERENCEEXCHANGE) == (1)) && ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING))) && (NPC_KNOWSINFO(OTHER, 73577))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_REFERENCEEXCHANGE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Boris_ReferenceExchange_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= ((CQ004_KETHREWARD_V1_NOQ202) - (CQ004_KETHREWARD_V1))) {
        NPC_REMOVEINVITEMS(SELF, 34203, (CQ004_KETHREWARD_V1_NOQ202) - (CQ004_KETHREWARD_V1));
        AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
        B_GIVEINVITEMS(OTHER, SELF, 34203, (CQ004_KETHREWARD_V1_NOQ202) - (CQ004_KETHREWARD_V1));
        B_SAY(SELF, OTHER, "$SURE_V2");
        AI_RESETFACEANI(SELF);
        CREATEINVITEMS(SELF, 37158, 1);
        B_GIVEINVITEMS(SELF, OTHER, 37158, 1);
        CQ004_KETH_REFERENCEEXCHANGE = 2;
        NPC_EXCHANGEROUTINE(VLK_6230_KETH, TOT);
    };
    B_SAY(SELF, OTHER, "$NOGOLD");
}

instance DIA_KETH_AMBIENT(C_INFO) {
    NPC = 55113;
    NR = 1;
    CONDITION = DIA_KETH_AMBIENT_CONDITION;
    INFORMATION = DIA_KETH_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How are things going?";
}

func int DIA_KETH_AMBIENT_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 75274)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_AMBIENT_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhatNew3");
    if ((LOG_GETSTATUS(MIS_CQ004)) == (LOG_RUNNING)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_Ambient_03_01");
    };
    if (((LOG_GETSTATUS(MIS_CQ004)) == (LOG_SUCCESS)) && ((CQ004_RESULT) == (1))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_Ambient_03_02");
        AI_STOPPROCESSINFOS(SELF);
    };
    if (((LOG_GETSTATUS(MIS_CQ004)) == (LOG_SUCCESS)) && ((CQ004_RESULT) == (2))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Keth_Ambient_03_03");
    };
}

instance DIA_KETH_PICKPOCKET(C_INFO) {
    NPC = 55113;
    NR = 900;
    CONDITION = DIA_KETH_PICKPOCKET_CONDITION;
    INFORMATION = DIA_KETH_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_80_FEMALE;
}

func int DIA_KETH_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KETH_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(75308);
    INFO_ADDCHOICE(75308, DIALOG_BACK, 75312);
    INFO_ADDCHOICE(75308, DIALOG_PICKPOCKET, 75311);
}

func void DIA_KETH_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(75308);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(75308);
}

func void DIA_KETH_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(75308);
}

