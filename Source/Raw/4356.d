instance DIA_ULRYK_Q602_EXIT(C_INFO) {
    NPC = 0xea05;
    NR = 999;
    CONDITION = DIA_ULRYK_Q602_EXIT_CONDITION;
    INFORMATION = DIA_ULRYK_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_ULRYK_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_ULRYK_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ULRYK_Q602_AFTERFIGHT(C_INFO) {
    NPC = 0xea05;
    NR = 1;
    CONDITION = DIA_ULRYK_Q602_AFTERFIGHT_CONDITION;
    INFORMATION = DIA_ULRYK_Q602_AFTERFIGHT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ULRYK_Q602_AFTERFIGHT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_FINALBATTLE_STARTFIGHT) >= (9))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int ULRYK_Q602_AFTERFIGHT_WHERE = 0;
var int ULRYK_Q602_AFTERFIGHT_ICECUBE = 0;
var int ULRYK_Q602_AFTERFIGHT_WHY = 0;
var int ULRYK_Q602_AFTERFIGHT_COUNT = 0;
func void DIA_ULRYK_Q602_AFTERFIGHT_CHOICES() {
    INFO_CLEARCHOICES(0x16153);
    if (((ULRYK_Q602_AFTERFIGHT_WHERE) == (TRUE)) && ((ULRYK_Q602_AFTERFIGHT_ICECUBE) == (TRUE))) {
        INFO_ADDCHOICE(0x16153, "You finish your business, I'm going after the Usurer.", 0x16175);
    };
    if ((ULRYK_Q602_AFTERFIGHT_WHY) == (FALSE)) {
        INFO_ADDCHOICE(0x16153, "Why did you attack the city?", 0x16173);
    };
    if ((ULRYK_Q602_AFTERFIGHT_ICECUBE) == (FALSE)) {
        INFO_ADDCHOICE(0x16153, "What happened here? Why is everyone frozen?", 0x16171);
    };
    if ((ULRYK_Q602_AFTERFIGHT_WHERE) == (FALSE)) {
        INFO_ADDCHOICE(0x16153, "Where's the Usurer?", 0x16170);
    };
}

func void DIA_ULRYK_Q602_AFTERFIGHT_HARBOUR() {
    TRIA_WAIT();
    TRIA_NEXT(MIL_4000_RODERICH_Q602);
    AI_FUNCTION(SELF, 0x1616c);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Harbour_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_FUNCTION(SELF, 0x1616d);
    AI_TURNTONPC(SELF, MIL_4000_RODERICH_Q602);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Harbour_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Harbour_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Harbour_03_04");
    DIA_ULRYK_Q602_AFTERFIGHT_CHOICES();
}

func void DIA_ULRYK_Q602_AFTERFIGHT_COUNT() {
    ULRYK_Q602_AFTERFIGHT_COUNT = (ULRYK_Q602_AFTERFIGHT_COUNT) + (1);
    if ((ULRYK_Q602_AFTERFIGHT_COUNT) == (2)) {
        DIA_ULRYK_Q602_AFTERFIGHT_HARBOUR();
    };
    DIA_ULRYK_Q602_AFTERFIGHT_CHOICES();
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_01() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_02");
    WLD_SENDUNTRIGGER("Q602_AFTERULRYK_01");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_02() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_03");
    WLD_SENDUNTRIGGER("Q602_AFTERULRYK_02");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_03() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_04");
    WLD_SENDUNTRIGGER("Q602_AFTERULRYK_03");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_04() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_05");
    WLD_SENDUNTRIGGER("Q602_AFTERULRYK_04");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_05() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_06");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_06() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_07");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_07() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_08");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_08() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_09");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_09() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_10");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_10() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_11");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_11() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_12");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_12() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_13");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_13() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_14");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_14() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_15");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_15() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_16");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_16() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_17");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_17() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_23");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_CAMERA_18() {
    WLD_SENDTRIGGER("Q602_AFTERULRYK_24");
}

func void DIA_ULRYK_Q602_AFTERFIGHT_INFO() {
    RODERICH = HLP_GETNPC(0xe984);
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q602_AFTERULRYK_01");
    TELEPORTNPCTOWP(0xe984, "PARTE5_RODERICH_02");
    TELEPORTNPCTOWP(0xea05, "PARTE5_ULRYK_03");
    TELEPORTNPCTOWP(0x71b, "PARTE5_HERO_03");
    NPC_REMOVEINVITEMS(NONE_15_ULRYK_Q602, 0x9a2a, NPC_HASITEMS(NONE_15_ULRYK_Q602, 0x9a2a));
    B_STARTOTHERROUTINE(KDW_216_INGOLF_Q602, "AFTERFIGHT3");
    NPC_REMOVEINVITEMS(MIL_4000_RODERICH_Q602, 0x9a2a, NPC_HASITEMS(MIL_4000_RODERICH_Q602, 0x9a2a));
    NPC_REFRESH(KDW_216_INGOLF_Q602);
    TELEPORTNPCTOWP(0xe922, KDW_216_INGOLF_Q602.WP);
    TRIA_INVITE(MIL_4000_RODERICH_Q602);
    if ((NPC_GETDISTTONPC(SELF, KDW_203_RIORDIAN_Q602)) <= (450)) {
        TRIA_INVITE(KDW_203_RIORDIAN_Q602);
    };
    TRIA_START();
    AI_LOOKATNPC(OTHER, SELF);
    AI_TURNTONPC(OTHER, SELF);
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, RODERICH);
    AI_TURNTONPC(RODERICH, SELF);
    AI_LOOKATNPC(RODERICH, SELF);
    AI_FUNCTION(SELF, 0x16177);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_01");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4000_RODERICH_Q602);
    AI_FUNCTION(SELF, 0x1615c);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_03");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_FUNCTION(SELF, 0x1615d);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_05");
    AI_FUNCTION(SELF, 0x1615e);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_07");
    AI_FUNCTION(SELF, 0x1615f);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_03_08");
    DIA_ULRYK_Q602_AFTERFIGHT_CHOICES();
}

instance DIA_ULRYK_Q602_AFTERFIGHT_INFO.RODERICH(C_NPC)
func void DIA_ULRYK_Q602_AFTERFIGHT_WHERE() {
    ULRYK_Q602_AFTERFIGHT_WHERE = TRUE;
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, OTHER);
    AI_FUNCTION(SELF, 0x16160);
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_Where_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Where_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Where_03_03");
    DIA_ULRYK_Q602_AFTERFIGHT_COUNT();
}

func void DIA_ULRYK_Q602_AFTERFIGHT_ICECUBE() {
    AI_FUNCTION(SELF, 0x16161);
    ULRYK_Q602_AFTERFIGHT_ICECUBE = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_IceCube_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, MIL_4000_RODERICH_Q602);
    AI_FUNCTION(SELF, 0x16163);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_IceCube_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_IceCube_03_04");
    INFO_CLEARCHOICES(0x16153);
    INFO_ADDCHOICE(0x16153, "I don't want to worry you, but this sword is not the Peacemaker.", 0x16172);
}

func void DIA_ULRYK_Q602_AFTERFIGHT_ICECUBE_PEACEKEEPER() {
    AI_FUNCTION(SELF, 0x16164);
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_15_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_PeaceKeeper_15_06");
    DIA_ULRYK_Q602_AFTERFIGHT_COUNT();
}

func void DIA_ULRYK_Q602_AFTERFIGHT_WHY() {
    AI_FUNCTION(SELF, 0x16165);
    ULRYK_Q602_AFTERFIGHT_WHY = TRUE;
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_Why_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Why_03_02");
    AI_FUNCTION(SELF, 0x16166);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Why_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Why_03_04");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4000_RODERICH_Q602);
    AI_FUNCTION(SELF, 0x16167);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Why_03_05");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, MIL_4000_RODERICH_Q602);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Why_03_06");
    INFO_CLEARCHOICES(0x16153);
    INFO_ADDCHOICE(0x16153, "What did the Usurer have to do with all this? Why did he help you?", 0x16174);
}

func void DIA_ULRYK_Q602_AFTERFIGHT_WHY_VOLKER() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_Volker_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(SELF, OTHER);
    AI_FUNCTION(SELF, 0x16168);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Volker_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Volker_03_03");
    TRIA_WAIT();
    TRIA_NEXT(MIL_4000_RODERICH_Q602);
    AI_FUNCTION(SELF, 0x16169);
    AI_TURNTONPC(SELF, HERO);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Volker_03_04");
    TRIA_WAIT();
    TRIA_NEXT(NONE_15_ULRYK_Q602);
    AI_FUNCTION(SELF, 0x1616a);
    AI_OUTPUT(SELF, OTHER, "DIA_Ulryk_Q602_AfterFight_Volker_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_Volker_15_06");
    DIA_ULRYK_Q602_AFTERFIGHT_COUNT();
}

func void DIA_ULRYK_Q602_AFTERFIGHT_LEAVE() {
    AI_FUNCTION(SELF, 0x1616b);
    AI_OUTPUT(OTHER, SELF, "DIA_Ulryk_Q602_AfterFight_Leave_15_01");
    AI_STOPLOOKAT(MIL_4000_RODERICH_Q602);
    AI_STOPLOOKAT(NONE_15_ULRYK_Q602);
    AI_STOPLOOKAT(HERO);
    TRIA_FINISH();
    INFO_CLEARCHOICES(0x16153);
    AI_STOPPROCESSINFOS(OTHER);
    AI_FUNCTION(OTHER, 0x16176);
}

func void ULRYK_Q602_STARTCAMERA() {
    Q602_FINALBATTLE_STARTFIGHT = 10;
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q602_ULRYK_01");
    TELEPORTNPCTOWP(0x71b, "PARTE5_HERO");
    TELEPORTNPCTOWP(0xea05, "PARTE5_ULRYK");
    TELEPORTNPCTOWP(0xe984, "PARTE5_RODERICH");
    TELEPORTNPCTOWP(0xe91b, "PARTM5_CITYHALL_07");
    B_STARTOTHERROUTINE(MIL_4000_RODERICH_Q602, "Q602_WAIT");
    NPC_REFRESH(MIL_4000_RODERICH_Q602);
    B_STARTOTHERROUTINE(NONE_15_ULRYK_Q602, "Q602_WAIT");
    NPC_REFRESH(NONE_15_ULRYK_Q602);
    AI_TURNTONPC(HERO, KDW_215_NOTGER_Q602);
    HERO.AIVAR[4] = FALSE;
}

func void ULRYK_Q602_KILLWOLFSONS() {
    Q602_KILLWOLFSONS();
}

