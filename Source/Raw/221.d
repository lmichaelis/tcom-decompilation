func int C_KQ406_WEARWORKERARMOR(var C_NPC NPC) {
    if ((NPC_HASEQUIPPEDARMOR(NPC)) == (TRUE)) {
        ITM = NPC_GETEQUIPPEDARMOR(NPC);
        if ((((((((((((((((((HLP_ISITEM(ITM, 0x8472)) == (TRUE)) || ((HLP_ISITEM(ITM, 0x8473)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8afd)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8af3)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8af4)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8afa)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8afb)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8afc)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a42)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a43)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a44)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a45)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a52)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a53)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a54)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8a55)) == (TRUE))) || ((HLP_ISITEM(ITM, 0x8485)) == (TRUE))) {
            return TRUE;
        };
        return FALSE;
    };
    return FALSE;
}

instance C_KQ406_WEARWORKERARMOR.ITM(C_ITEM)
func void KQ406_PREPARESCENE() {
    FF_APPLYONCEEXTGT(0x87c7, 0, -(1));
}

func void KQ406_PREPARESCENE_APPLY() {
    if ((KQ406_PREPARESCENE_COUNT) == (0)) {
        PRINTD("Rozpoczynam - KQ406_PrepareScene_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        MOVPTR3 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_03");
        MOVER3 = MEM_PTRTOINST(MOVPTR3);
        MOVPTR4 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_04");
        MOVER4 = MEM_PTRTOINST(MOVPTR4);
        CHANGEVOBCOLLISION("KQ406_CRATE_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_03", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_04", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_01");
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_02");
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_03");
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_04");
        KQ406_PREPARESCENE_COUNT = 1;
    };
    if (((((((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - KQ406_PrepareScene_Apply");
        CHANGEVOBCOLLISION("KQ406_CRATE_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_03", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("KQ406_CRATE_04", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x87c7);
        KQ406_PREPARESCENE_COUNT = 0;
    };
}

var int KQ406_PREPARESCENE_APPLY.KQ406_PREPARESCENE_COUNT = 0;
instance KQ406_PREPARESCENE_APPLY.MOVER1(ZCMOVER)
instance KQ406_PREPARESCENE_APPLY.MOVER2(ZCMOVER)
instance KQ406_PREPARESCENE_APPLY.MOVER3(ZCMOVER)
instance KQ406_PREPARESCENE_APPLY.MOVER4(ZCMOVER)
var int KQ406_PREPARESCENE_APPLY.MOVPTR1 = 0;
var int KQ406_PREPARESCENE_APPLY.MOVPTR2 = 0;
var int KQ406_PREPARESCENE_APPLY.MOVPTR3 = 0;
var int KQ406_PREPARESCENE_APPLY.MOVPTR4 = 0;
func void KQ406_PREPARENPC() {
    if (HLP_ISVALIDNPC(VLK_6074_GUY)) {
        if ((NPC_ISDEAD(VLK_6074_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6074_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6101_WORKER)) {
        if ((NPC_ISDEAD(VLK_6101_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6101_WORKER, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6094_GUY)) {
        if ((NPC_ISDEAD(VLK_6094_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6094_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6099_GUY)) {
        if ((NPC_ISDEAD(VLK_6099_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6099_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6084_GUY)) {
        if ((NPC_ISDEAD(VLK_6084_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6084_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6102_WORKER)) {
        if ((NPC_ISDEAD(VLK_6102_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6102_WORKER, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6069_GUY)) {
        if ((NPC_ISDEAD(VLK_6069_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6069_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_13373_GUY)) {
        if ((NPC_ISDEAD(VLK_13373_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_13373_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6070_GUY)) {
        if ((NPC_ISDEAD(VLK_6070_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6070_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6068_GUY)) {
        if ((NPC_ISDEAD(VLK_6068_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6068_GUY, "KQ406_STOP");
        };
    };
    if (HLP_ISVALIDNPC(VLK_6083_WORKER)) {
        if ((NPC_ISDEAD(VLK_6083_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6083_WORKER, "KQ406_STOP");
        };
    };
    if (((Q504_RUUDVOLFZACKE) == (0)) && ((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS))) {
        B_STARTOTHERROUTINE(VLK_6282_RUUD, "KQ406_STOP");
        KQ406_RUUD_RTNCHECK = 1;
        NPC_REFRESH(VLK_6282_RUUD);
        TELEPORTNPCTOWP(0xd529, VLK_6282_RUUD.WP);
    };
    WLD_INSERTNPC(0xd5c9, "HARBOUR_KQ406_WORKER");
}

func void KQ406_COUNTPOINTS() {
    KQ406_POINTS = (KQ406_POINTS) + (1);
    PRINTD(CS2("Liczba wykonanych tasków: ", INTTOSTRING(KQ406_POINTS)));
    if ((KQ406_POINTS) == (3)) {
        B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_TASKSDONE);
        KQ406_WAITFORSABOTEUR = TRUE;
        KQ406_WAITFORSABOTEUR_DAY = WLD_GETDAY();
    };
}

func void KQ406_PREPARERATPOTIONPLACES() {
    KQ406_BOUGHTPOTION = 1;
    WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_01");
    WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_02");
}

func void KQ406_PREPAREANGRYMOB() {
    if ((KQ406_BOUGHTPOTION) == (1)) {
        if ((KQ406_RATPOTION_PLACE_01) == (FALSE)) {
            WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_01");
        };
        if ((KQ406_RATPOTION_PLACE_02) == (FALSE)) {
            WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_02");
        };
    };
    WLD_INSERTNPC(0xc606, "HARBOUR_WRKSHP_REPAIR01");
    if (HLP_ISVALIDNPC(VLK_6074_GUY)) {
        if ((NPC_ISDEAD(VLK_6074_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6074_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6074_GUY);
            TELEPORTNPCTOWP(0xd43d, VLK_6074_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6101_WORKER)) {
        if ((NPC_ISDEAD(VLK_6101_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6101_WORKER, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6101_WORKER);
            TELEPORTNPCTOWP(0xd478, VLK_6101_WORKER.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6094_GUY)) {
        if ((NPC_ISDEAD(VLK_6094_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6094_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6094_GUY);
            TELEPORTNPCTOWP(0xd465, VLK_6094_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6099_GUY)) {
        if ((NPC_ISDEAD(VLK_6099_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6099_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6099_GUY);
            TELEPORTNPCTOWP(0xd471, VLK_6099_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6084_GUY)) {
        if ((NPC_ISDEAD(VLK_6084_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6084_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6084_GUY);
            TELEPORTNPCTOWP(0xd450, VLK_6084_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6102_WORKER)) {
        if ((NPC_ISDEAD(VLK_6102_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6102_WORKER, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6102_WORKER);
            TELEPORTNPCTOWP(0xd47d, VLK_6102_WORKER.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6069_GUY)) {
        if ((NPC_ISDEAD(VLK_6069_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6069_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6069_GUY);
            TELEPORTNPCTOWP(0xd42b, VLK_6069_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_13373_GUY)) {
        if ((NPC_ISDEAD(VLK_13373_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_13373_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_13373_GUY);
            TELEPORTNPCTOWP(0xd3b1, VLK_13373_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6070_GUY)) {
        if ((NPC_ISDEAD(VLK_6070_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6070_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6070_GUY);
            TELEPORTNPCTOWP(0xd42f, VLK_6070_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6068_GUY)) {
        if ((NPC_ISDEAD(VLK_6068_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6068_GUY, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6068_GUY);
            TELEPORTNPCTOWP(0xd426, VLK_6068_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6083_WORKER)) {
        if ((NPC_ISDEAD(VLK_6083_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6083_WORKER, "KQ406_ANGRYMOB");
            NPC_REFRESH(VLK_6083_WORKER);
            TELEPORTNPCTOWP(0xd44b, VLK_6083_WORKER.WP);
        };
    };
    if (((Q504_RUUDVOLFZACKE) == (0)) && ((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS))) {
        B_STARTOTHERROUTINE(VLK_6282_RUUD, "KQ406_ANGRYMOB");
        KQ406_RUUD_RTNCHECK = 2;
        NPC_REFRESH(VLK_6282_RUUD);
        TELEPORTNPCTOWP(0xd529, VLK_6282_RUUD.WP);
    };
    B_STARTOTHERROUTINE(VLK_10036_DACK, "KQ406_ANGRYMOB");
    NPC_REFRESH(VLK_10036_DACK);
    TELEPORTNPCTOWP(0xd4e3, VLK_10036_DACK.WP);
    if (((KQ406_RATPOTION_PLACE_01) == (TRUE)) && ((KQ406_RATPOTION_PLACE_02) == (TRUE))) {
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_01");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_02");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_03");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_04");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_05");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_07");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_08");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_09");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_10");
        WLD_INSERTNPC(0xc5fb, "FP_ROAM_PARTM6_KQ406_RAT_11");
    };
    WLD_INSERTNPC(0xd5cd, "HARBOUR_KQ406_ANGRYMOB_11");
    B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_GOBACK);
}

func void KQ406_TELEPORTKNUT() {
    HERO.AIVAR[4] = FALSE;
    FF_APPLYONCEEXTGT(0x87d6, 0, -(1));
    B_STARTOTHERROUTINE(BAU_2241_KNUT, "KQ406_HARBOUR");
    NPC_REFRESH(BAU_2241_KNUT);
    TELEPORTNPCTOWP(0xdfb0, BAU_2241_KNUT.WP);
    if ((NPC_ISDEAD(BAU_2278_WOODCUTTER)) == (FALSE)) {
        B_STARTOTHERROUTINE(BAU_2278_WOODCUTTER, "KQ406_HARBOUR");
        NPC_REFRESH(BAU_2278_WOODCUTTER);
        TELEPORTNPCTOWP(0xdf99, BAU_2278_WOODCUTTER.WP);
    };
    if ((NPC_ISDEAD(BAU_2276_GLYNN)) == (FALSE)) {
        B_STARTOTHERROUTINE(BAU_2276_GLYNN, "KQ406_HARBOUR");
        NPC_REFRESH(BAU_2276_GLYNN);
        TELEPORTNPCTOWP(0xdfb7, BAU_2276_GLYNN.WP);
    };
    if ((SQ101_NIRKOCOMEBACKTOWORK) == (TRUE)) {
        B_STARTOTHERROUTINE(BAU_2279_NIRKO, "KQ406_WAIT");
        NPC_REFRESH(BAU_2279_NIRKO);
        TELEPORTNPCTOWP(0xdfc0, BAU_2279_NIRKO.WP);
    };
    if ((Q504_LOWELLVOLFZACKE) == (0)) {
        B_STARTOTHERROUTINE(BAU_2277_LOWELL, "KQ406_WAIT");
        NPC_REFRESH(BAU_2277_LOWELL);
        TELEPORTNPCTOWP(0xdfba, BAU_2277_LOWELL.WP);
    };
    if ((NPC_ISDEAD(BAU_9500_WOODCUTTER)) == (FALSE)) {
        B_KILLNPC(0xdf9c);
        WLD_INSERTNPC(0xc484, RESERVED_CONST_STRING_25);
    };
}

func void KQ406_TELEPORTKNUT_APPLY() {
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_01", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_02", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_03", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_04", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_05", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_06", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_07", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_08", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_09", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_10", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_11", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_12", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_13", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_14", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_15", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_16", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_17", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_18", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_19", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_20", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_21", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_22", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_23", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_24", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_25", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_26", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_27", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_28", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_29", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_30", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_31", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_32", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_33", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_34", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_35", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_36", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_37", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_38", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_39", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_40", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_41", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_42", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("WOODCUTTERS_VOB_43", FALSE, FALSE, FALSE, FALSE);
    WLD_SENDTRIGGER("KQ406_MOVER_WOODCUTTER_CAMP");
    FF_REMOVE(0x87d6);
}

func void KQ406_TELEPORTHUXLAY() {
    B_STARTOTHERROUTINE(MIL_13490_RICHARD, "KQ406_SEARCH");
    NPC_REFRESH(MIL_13490_RICHARD);
    TELEPORTNPCTOWP(0xd1e6, MIL_13490_RICHARD.WP);
    B_STARTOTHERROUTINE(MIL_13382_HUXLAY, TOT);
    NPC_REFRESH(MIL_13382_HUXLAY);
    TELEPORTNPCTOWP(0xd1d7, MIL_13382_HUXLAY.WP);
    B_STARTOTHERROUTINE(NONE_11068_GRAYSON, START);
    NPC_REFRESH(NONE_11068_GRAYSON);
    TELEPORTNPCTOWP(0xd1f0, NONE_11068_GRAYSON.WP);
}

func void KQ406_PREPAREANSKAR() {
    B_STARTOTHERROUTINE(MIL_13382_HUXLAY, "KQ406_TIED");
    NPC_REFRESH(MIL_13382_HUXLAY);
    TELEPORTNPCTOWP(0xd1d7, MIL_13382_HUXLAY.WP);
    NPC_CHANGEARMOR(MIL_13382_HUXLAY, 0x8a41);
    NPC_REMOVEINVITEMS(MIL_13382_HUXLAY, 0x8b1f, 1);
    WLD_INSERTNPC(0xd543, "HARBOUR_KQ406_ANSKAR");
}

func void KQ406_ENDANSKERDIALOGUE() {
    FF_APPLYONCEEXT(0x87da, 75, 4);
}

func void KQ406_ENDANSKERDIALOGUE_APPLY() {
    KQ406_ENDANSKERDIALOGUE_COUNT = (KQ406_ENDANSKERDIALOGUE_COUNT) + (1);
    if ((KQ406_ENDANSKERDIALOGUE_COUNT) == (4)) {
        HERO.AIVAR[4] = FALSE;
        DIACAM_ENABLE();
        WLD_SENDUNTRIGGER("KQ406_HUXLAY_SHOW");
        AI_FUNCTION(HERO, 0x1668c);
        KQ406_ENDANSKERDIALOGUE_COUNT = 0;
    };
}

var int KQ406_ENDANSKERDIALOGUE_APPLY.KQ406_ENDANSKERDIALOGUE_COUNT = 0;
func void KQ406_HUXLAYGOWITHANSKAR_FADESCREEN() {
    KQ406_WAITFORFINISHQUEST = 1;
    NPC_REMOVEINVITEMS(MIL_13382_HUXLAY, 0x8a41, 1);
    NPC_EXCHANGEROUTINE(MIL_13382_HUXLAY, START);
    TELEPORTNPCTOWP(0xd1d7, MIL_13382_HUXLAY.WP);
    NPC_CLEARAIQUEUE(MIL_13382_HUXLAY);
    NPC_REFRESH(MIL_13382_HUXLAY);
    B_STARTOTHERROUTINE(MIL_13680_ANSKAR, "KQ406_SMALLTALK");
    NPC_REFRESH(MIL_13680_ANSKAR);
    MDL_APPLYOVERLAYMDSTIMED(MIL_13680_ANSKAR, HUMANSTIREDMDS, 0x493e0);
    B_STARTOTHERROUTINE(NONE_11068_GRAYSON, "KQ406_SMALLTALK");
    NPC_REFRESH(NONE_11068_GRAYSON);
    TELEPORTNPCTOWP(0x71b, "PARTM5_CITYHALL_35");
    AI_TURNTONPC(HERO, NONE_11068_GRAYSON);
    FADESCREENFROMBLACK(1);
}

func void KQ406_HUXLAYGOWITHANSKAR() {
    FADESCREENTOBLACKF(1, 0x87dc, 100);
}

func void KQ406_FINISHCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0x87df, 75, 4);
}

func void KQ406_FINISHCUTSCENE_APPLY() {
    KQ406_FINISHCUTSCENE_COUNT = (KQ406_FINISHCUTSCENE_COUNT) + (1);
    if ((KQ406_FINISHCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(0x168d3);
    };
}

var int KQ406_FINISHCUTSCENE_APPLY.KQ406_FINISHCUTSCENE_COUNT = 0;
func void KQ406_FINISHCUTSCENEEND_APPLY() {
    KQ406_FINISHCUTSCENEEND_COUNT = (KQ406_FINISHCUTSCENEEND_COUNT) + (1);
    if ((KQ406_FINISHCUTSCENEEND_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KQ406_FINISH_01");
        WLD_SENDUNTRIGGER("KQ406_FINISH_02");
        WLD_SENDUNTRIGGER("KQ406_FINISH_03");
        WLD_SENDUNTRIGGER("KQ406_FINISH_04");
        WLD_SENDUNTRIGGER("KQ406_FINISH_05");
        B_STARTOTHERROUTINE(NONE_11068_GRAYSON, START);
        NPC_REFRESH(NONE_11068_GRAYSON);
        B_STARTOTHERROUTINE(MIL_13680_ANSKAR, "TOWNHALL");
        NPC_REFRESH(MIL_13680_ANSKAR);
        MDL_APPLYOVERLAYMDS(MIL_13680_ANSKAR, HUMANSTIREDMDS);
        HERO.AIVAR[4] = FALSE;
    };
}

var int KQ406_FINISHCUTSCENEEND_APPLY.KQ406_FINISHCUTSCENEEND_COUNT = 0;
func void KQ406_REMOVENPC() {
    B_REMOVENPC(0xc606);
    if (HLP_ISVALIDNPC(VLK_6074_GUY)) {
        if ((NPC_ISDEAD(VLK_6074_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6074_GUY, START);
            NPC_REFRESH(VLK_6074_GUY);
            TELEPORTNPCTOWP(0xd43d, VLK_6074_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6101_WORKER)) {
        if ((NPC_ISDEAD(VLK_6101_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6101_WORKER, START);
            NPC_REFRESH(VLK_6101_WORKER);
            TELEPORTNPCTOWP(0xd478, VLK_6101_WORKER.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6094_GUY)) {
        if ((NPC_ISDEAD(VLK_6094_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6094_GUY, START);
            NPC_REFRESH(VLK_6094_GUY);
            TELEPORTNPCTOWP(0xd465, VLK_6094_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6099_GUY)) {
        if ((NPC_ISDEAD(VLK_6099_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6099_GUY, START);
            NPC_REFRESH(VLK_6099_GUY);
            TELEPORTNPCTOWP(0xd471, VLK_6099_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6084_GUY)) {
        if ((NPC_ISDEAD(VLK_6084_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6084_GUY, START);
            NPC_REFRESH(VLK_6084_GUY);
            TELEPORTNPCTOWP(0xd450, VLK_6084_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6102_WORKER)) {
        if ((NPC_ISDEAD(VLK_6102_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6102_WORKER, START);
            NPC_REFRESH(VLK_6102_WORKER);
            TELEPORTNPCTOWP(0xd47d, VLK_6102_WORKER.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6069_GUY)) {
        if ((NPC_ISDEAD(VLK_6069_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6069_GUY, START);
            NPC_REFRESH(VLK_6069_GUY);
            TELEPORTNPCTOWP(0xd42b, VLK_6069_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_13373_GUY)) {
        if ((NPC_ISDEAD(VLK_13373_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_13373_GUY, START);
            NPC_REFRESH(VLK_13373_GUY);
            TELEPORTNPCTOWP(0xd3b1, VLK_13373_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6070_GUY)) {
        if ((NPC_ISDEAD(VLK_6070_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6070_GUY, START);
            NPC_REFRESH(VLK_6070_GUY);
            TELEPORTNPCTOWP(0xd42f, VLK_6070_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6068_GUY)) {
        if ((NPC_ISDEAD(VLK_6068_GUY)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6068_GUY, START);
            NPC_REFRESH(VLK_6068_GUY);
            TELEPORTNPCTOWP(0xd426, VLK_6068_GUY.WP);
        };
    };
    if (HLP_ISVALIDNPC(VLK_6083_WORKER)) {
        if ((NPC_ISDEAD(VLK_6083_WORKER)) == (FALSE)) {
            B_STARTOTHERROUTINE(VLK_6083_WORKER, START);
            NPC_REFRESH(VLK_6083_WORKER);
            TELEPORTNPCTOWP(0xd44b, VLK_6083_WORKER.WP);
        };
    };
    B_STARTOTHERROUTINE(VLK_10036_DACK, START);
    NPC_REFRESH(VLK_10036_DACK);
    TELEPORTNPCTOWP(0xd4e3, VLK_10036_DACK.WP);
    B_REMOVENPC(0xd5cd);
}

func void KQ406_REMOVERATLIQUID() {
    if ((KQ406_BOUGHTPOTION) == (1)) {
        if ((KQ406_RATPOTION_PLACE_01) == (TRUE)) {
            WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_LIQUID_01");
        };
        if ((KQ406_RATPOTION_PLACE_02) == (TRUE)) {
            WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_LIQUID_02");
        };
    };
    DUMMYFUNCWITHSTRINGPARAMETER("KQ406_MOVER_RATPOTION_LIQUID_01");
    DUMMYFUNCWITHSTRINGPARAMETER("KQ406_MOVER_RATPOTION_LIQUID_02");
}

func void KQ406_REMOVEEVENTS_APPLY() {
    if ((KQ406_DESTROYEDCRATE_01) == (FALSE)) {
        CHANGEVOBCOLLISION("KQ406_CRATE_01", FALSE, FALSE, FALSE, TRUE);
    };
    if ((KQ406_DESTROYEDCRATE_02) == (FALSE)) {
        CHANGEVOBCOLLISION("KQ406_CRATE_02", FALSE, FALSE, FALSE, TRUE);
    };
    if ((KQ406_DESTROYEDCRATE_03) == (FALSE)) {
        CHANGEVOBCOLLISION("KQ406_CRATE_03", FALSE, FALSE, FALSE, TRUE);
    };
    if ((KQ406_DESTROYEDCRATE_04) == (FALSE)) {
        CHANGEVOBCOLLISION("KQ406_CRATE_04", FALSE, FALSE, FALSE, TRUE);
    };
    if ((KQ406_DESTROYEDCRATE_01) == (FALSE)) {
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_01");
    };
    WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_01");
    if ((KQ406_DESTROYEDCRATE_02) == (FALSE)) {
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_02");
    };
    WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_02");
    if ((KQ406_DESTROYEDCRATE_03) == (FALSE)) {
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_03");
    };
    WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_03");
    if ((KQ406_DESTROYEDCRATE_04) == (FALSE)) {
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_04");
    };
    WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_04");
    FF_REMOVE(0x87e5);
}

