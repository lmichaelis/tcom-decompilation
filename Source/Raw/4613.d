instance QA401_FINALCUTSCENE(CUTSCENE) {
    ONSTART = FUNCTION(0x16a80);
}

func void QA401_FINALCUTSCENE_WAIT() {
    AI_WAITTILLEND(HERO, SLD_1000_ADELARD);
    AI_WAITTILLEND(HERO, NONE_7002_GETORYX);
    AI_WAITTILLEND(HERO, BDT_13571_SMUGGLER);
    AI_WAITTILLEND(HERO, BDT_13572_SMUGGLER);
    AI_WAITTILLEND(HERO, SLD_5002_SUNDER);
    AI_WAITTILLEND(SLD_1000_ADELARD, HERO);
    AI_WAITTILLEND(SLD_1000_ADELARD, NONE_7002_GETORYX);
    AI_WAITTILLEND(SLD_1000_ADELARD, BDT_13571_SMUGGLER);
    AI_WAITTILLEND(SLD_1000_ADELARD, BDT_13572_SMUGGLER);
    AI_WAITTILLEND(SLD_1000_ADELARD, SLD_5002_SUNDER);
    AI_WAITTILLEND(NONE_7002_GETORYX, HERO);
    AI_WAITTILLEND(NONE_7002_GETORYX, SLD_1000_ADELARD);
    AI_WAITTILLEND(NONE_7002_GETORYX, BDT_13571_SMUGGLER);
    AI_WAITTILLEND(NONE_7002_GETORYX, BDT_13572_SMUGGLER);
    AI_WAITTILLEND(NONE_7002_GETORYX, SLD_5002_SUNDER);
    AI_WAITTILLEND(BDT_13571_SMUGGLER, HERO);
    AI_WAITTILLEND(BDT_13571_SMUGGLER, SLD_1000_ADELARD);
    AI_WAITTILLEND(BDT_13571_SMUGGLER, NONE_7002_GETORYX);
    AI_WAITTILLEND(BDT_13571_SMUGGLER, BDT_13572_SMUGGLER);
    AI_WAITTILLEND(BDT_13571_SMUGGLER, SLD_5002_SUNDER);
    AI_WAITTILLEND(BDT_13572_SMUGGLER, HERO);
    AI_WAITTILLEND(BDT_13572_SMUGGLER, SLD_1000_ADELARD);
    AI_WAITTILLEND(BDT_13572_SMUGGLER, NONE_7002_GETORYX);
    AI_WAITTILLEND(BDT_13572_SMUGGLER, BDT_13571_SMUGGLER);
    AI_WAITTILLEND(BDT_13572_SMUGGLER, SLD_5002_SUNDER);
    AI_WAITTILLEND(SLD_5002_SUNDER, HERO);
    AI_WAITTILLEND(SLD_5002_SUNDER, SLD_1000_ADELARD);
    AI_WAITTILLEND(SLD_5002_SUNDER, NONE_7002_GETORYX);
    AI_WAITTILLEND(SLD_5002_SUNDER, BDT_13571_SMUGGLER);
    AI_WAITTILLEND(SLD_5002_SUNDER, BDT_13572_SMUGGLER);
}

func void QA401_FINALCUTSCENE_START() {
    MUSIC_OVERRIDETRACK(0x55be);
    WLD_SENDTRIGGER("QA401_FINAL_01");
    NONE_7002_GETORYX.AIVAR[52] = TRUE;
    if ((NPC_HASITEMS(SLD_5002_SUNDER, 0x8653)) == (0)) {
        CREATEINVITEMS(SLD_5002_SUNDER, 0x8653, 1);
    };
    CREATEINVITEMS(SLD_5002_SUNDER, 0x864f, 10);
    AI_EQUIPBESTRANGEDWEAPON(SLD_5002_SUNDER);
    SLD_5002_SUNDER.HITCHANCE[3] = 100;
    NPC_CLEARAIQUEUE(SLD_1009_CARAMON);
    QA401_CARAMON_RTNCHECK = 6;
    B_STARTOTHERROUTINE(SLD_1009_CARAMON, "QA401_FIGHT_CUTSCENE_FINAL");
    NONE_7002_GETORYX.FLAGS = 0;
    NONE_7002_GETORYX.ATTRIBUTE[0] = 5;
    NONE_7002_GETORYX.ATTRIBUTE[1] = 5;
    BDT_13571_SMUGGLER.FLAGS = 0;
    BDT_13571_SMUGGLER.ATTRIBUTE[0] = 5;
    BDT_13571_SMUGGLER.ATTRIBUTE[1] = 5;
    BDT_13572_SMUGGLER.FLAGS = 0;
    BDT_13572_SMUGGLER.ATTRIBUTE[0] = 5;
    BDT_13572_SMUGGLER.ATTRIBUTE[1] = 5;
    TELEPORTNPCTOWP(0x71b, "PART1_CAVE_UP_HERO");
    TELEPORTNPCTOWP(0xcb0a, SLD_1000_ADELARD.WP);
    TELEPORTNPCTOWP(0xe176, SLD_5002_SUNDER.WP);
    TELEPORTNPCTOWP(0xcb1c, SLD_1009_CARAMON.WP);
    if ((NPC_ISDEAD(SLD_13548_ARAXOS)) == (FALSE)) {
        TELEPORTNPCTOWP(0xda46, SLD_13548_ARAXOS.WP);
    };
    if ((NPC_ISDEAD(SLD_13549_ARAXOS)) == (FALSE)) {
        TELEPORTNPCTOWP(0xd950, SLD_13549_ARAXOS.WP);
    };
    TELEPORTNPCTOWP(0xd936, NONE_7002_GETORYX.WP);
    TELEPORTNPCTOWP(0xd916, BDT_13571_SMUGGLER.WP);
    TELEPORTNPCTOWP(0xd91b, BDT_13572_SMUGGLER.WP);
    B_TURNTONPC(HERO, NONE_7002_GETORYX);
    B_TURNTONPC(SLD_1000_ADELARD, NONE_7002_GETORYX);
    B_TURNTONPC(SLD_5002_SUNDER, NONE_7002_GETORYX);
    B_TURNTONPC(SLD_1009_CARAMON, NONE_7002_GETORYX);
    if ((NPC_ISDEAD(SLD_13548_ARAXOS)) == (FALSE)) {
        B_TURNTONPC(SLD_13548_ARAXOS, NONE_7002_GETORYX);
    };
    if ((NPC_ISDEAD(SLD_13549_ARAXOS)) == (FALSE)) {
        B_TURNTONPC(SLD_13549_ARAXOS, NONE_7002_GETORYX);
    };
    B_TURNTONPC(NONE_7002_GETORYX, SLD_1000_ADELARD);
    B_TURNTONPC(BDT_13571_SMUGGLER, SLD_1000_ADELARD);
    B_TURNTONPC(BDT_13572_SMUGGLER, SLD_1000_ADELARD);
    SLD_1000_ADELARD.AIVAR[92] = TRUE;
    NONE_7002_GETORYX.AIVAR[92] = TRUE;
    BDT_13571_SMUGGLER.AIVAR[92] = TRUE;
    BDT_13572_SMUGGLER.AIVAR[92] = TRUE;
    AI_STARTFACEANI(NONE_7002_GETORYX, S_FRIGHTENED, 1, -(1));
    AI_STARTFACEANI(BDT_13571_SMUGGLER, S_FRIGHTENED, 1, -(1));
    AI_STARTFACEANI(BDT_13572_SMUGGLER, S_FRIGHTENED, 1, -(1));
    AI_STARTFACEANI(SLD_1000_ADELARD, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(SLD_5002_SUNDER, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(SLD_1009_CARAMON, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(HERO, S_ANGRY, 1, -(1));
    if ((NPC_ISDEAD(SLD_13548_ARAXOS)) == (FALSE)) {
        AI_STARTFACEANI(SLD_13548_ARAXOS, S_ANGRY, 1, -(1));
    };
    if ((NPC_ISDEAD(SLD_13549_ARAXOS)) == (FALSE)) {
        AI_STARTFACEANI(SLD_13549_ARAXOS, S_ANGRY, 1, -(1));
    };
    QA401_FINALCUTSCENE_WAIT();
    AI_OUTPUT(NONE_7002_GETORYX, HERO, "DIA_GETORYX_QA401_FINAL_03_01");
    QA401_FINALCUTSCENE_WAIT();
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a83);
    AI_OUTPUT(NONE_7002_GETORYX, HERO, "DIA_GETORYX_QA401_FINAL_03_02");
    QA401_FINALCUTSCENE_WAIT();
    AI_PLAYANI(SLD_1000_ADELARD, T_YES);
    QA401_FINALCUTSCENE_WAIT();
    AI_READYRANGEDWEAPON(SLD_5002_SUNDER);
    QA401_FINALCUTSCENE_WAIT();
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a84);
    AI_AIMAT(SLD_5002_SUNDER, NONE_7002_GETORYX);
    AI_SHOOTAT(SLD_5002_SUNDER, NONE_7002_GETORYX);
    QA401_FINALCUTSCENE_WAIT();
    AI_PLAYANI(BDT_13571_SMUGGLER, T_STAND_2_SCAREDDIALOGUE);
    AI_PLAYANI(BDT_13572_SMUGGLER, T_STAND_2_SCAREDDIALOGUE);
    AI_FUNCTION(SLD_5002_SUNDER, 0x16a82);
    QA401_FINALCUTSCENE_WAIT();
    AI_WAIT(SLD_1000_ADELARD, 0x3f800000);
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a85);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_04");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a86);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_05");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a87);
    QA401_FINALCUTSCENE_WAIT();
    AI_PLAYANI(BDT_13571_SMUGGLER, "T_REMOVE_SCAREDDIALOGUE");
    AI_OUTPUT(BDT_13571_SMUGGLER, HERO, "DIA_SMUGGLER_01_QA401_FINAL_03_06");
    QA401_FINALCUTSCENE_WAIT();
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a88);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_07");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a89);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_08");
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_09");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8a);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_10");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8b);
    QA401_FINALCUTSCENE_WAIT();
    AI_OUTPUT(BDT_13571_SMUGGLER, HERO, "DIA_SMUGGLER_01_QA401_FINAL_03_11");
    QA401_FINALCUTSCENE_WAIT();
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8c);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_12");
    QA401_FINALCUTSCENE_WAIT();
    AI_TURNAWAY(BDT_13571_SMUGGLER, SLD_1000_ADELARD);
    AI_WAIT(BDT_13571_SMUGGLER, 0x3dcccccd);
    AI_PLAYANI(BDT_13571_SMUGGLER, "T_CUTSCENEJUMP_START");
}

func void QA401_FINALCUTSCENE_PART2() {
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8d);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_13");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8e);
    AI_TURNTONPC(SLD_1000_ADELARD, BDT_13572_SMUGGLER);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_14");
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_15");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a8f);
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_16");
    QA401_FINALCUTSCENE_WAIT();
    AI_OUTPUT(BDT_13572_SMUGGLER, HERO, "DIA_SMUGGLER_02_QA401_FINAL_03_17");
    QA401_FINALCUTSCENE_WAIT();
    AI_PLAYANI(BDT_13572_SMUGGLER, "T_REMOVE_SCAREDDIALOGUE");
    AI_OUTPUT(SLD_1000_ADELARD, HERO, "DIA_ADELARD_QA401_FINAL_03_18");
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a90);
    QA401_FINALCUTSCENE_WAIT();
    AI_FUNCTION(SLD_1000_ADELARD, 0x16a91);
    AI_SETWALKMODE(BDT_13572_SMUGGLER, NPC_RUN);
    AI_GOTOWP(BDT_13572_SMUGGLER, "PART1_CAVE_IN_11");
}

func void QA401_ISGETORYXREALLYDEAD() {
    if (!(NPC_ISDEAD(NONE_7002_GETORYX))) {
        B_MAGICHURTNPC(SLD_5002_SUNDER, NONE_7002_GETORYX, 0x270f);
        PRINTD("Dobij kurwe");
    };
}

func void QA401_FINALCUTSCENE_CAMERA_01() {
    WLD_SENDTRIGGER("QA401_FINAL_02");
    WLD_SENDUNTRIGGER("QA401_FINAL_01");
}

func void QA401_FINALCUTSCENE_CAMERA_02() {
    WLD_SENDTRIGGER("QA401_FINAL_03");
    WLD_SENDUNTRIGGER("QA401_FINAL_02");
}

func void QA401_FINALCUTSCENE_CAMERA_03() {
    WLD_SENDTRIGGER("QA401_FINAL_04");
    WLD_SENDUNTRIGGER("QA401_FINAL_03");
    TELEPORTNPCTOWP(0xd936, "PART1_FISHER_BEACH_CARAMON_03");
}

func void QA401_FINALCUTSCENE_CAMERA_04() {
    WLD_SENDTRIGGER("QA401_FINAL_05");
    WLD_SENDUNTRIGGER("QA401_FINAL_04");
}

func void QA401_FINALCUTSCENE_CAMERA_05() {
    WLD_SENDTRIGGER("QA401_FINAL_06");
    WLD_SENDUNTRIGGER("QA401_FINAL_05");
}

func void QA401_FINALCUTSCENE_CAMERA_06() {
    WLD_SENDTRIGGER("QA401_FINAL_07");
    WLD_SENDUNTRIGGER("QA401_FINAL_06");
}

func void QA401_FINALCUTSCENE_CAMERA_07() {
    WLD_SENDTRIGGER("QA401_FINAL_08");
    WLD_SENDUNTRIGGER("QA401_FINAL_07");
}

func void QA401_FINALCUTSCENE_CAMERA_08() {
    WLD_SENDTRIGGER("QA401_FINAL_09");
    WLD_SENDUNTRIGGER("QA401_FINAL_08");
}

func void QA401_FINALCUTSCENE_CAMERA_09() {
    WLD_SENDTRIGGER("QA401_FINAL_10");
    WLD_SENDUNTRIGGER("QA401_FINAL_09");
}

func void QA401_FINALCUTSCENE_CAMERA_10() {
    WLD_SENDTRIGGER("QA401_FINAL_11");
    WLD_SENDUNTRIGGER("QA401_FINAL_10");
}

func void QA401_FINALCUTSCENE_CAMERA_11() {
    WLD_SENDTRIGGER("QA401_FINAL_12");
    WLD_SENDUNTRIGGER("QA401_FINAL_11");
}

func void QA401_FINALCUTSCENE_CAMERA_12() {
    WLD_SENDTRIGGER("QA401_FINAL_13");
    WLD_SENDUNTRIGGER("QA401_FINAL_12");
}

func void QA401_FINALCUTSCENE_CAMERA_13() {
    WLD_SENDTRIGGER("QA401_FINAL_14");
    WLD_SENDUNTRIGGER("QA401_FINAL_13");
}

func void QA401_FINALCUTSCENE_CAMERA_14() {
    WLD_SENDTRIGGER("QA401_FINAL_15");
    WLD_SENDUNTRIGGER("QA401_FINAL_14");
    MDL_APPLYOVERLAYMDS(BDT_13572_SMUGGLER, HUMANSFLEEMDS);
    TELEPORTNPCTOWP(0xd91b, "PART1_CAVE_UP_04");
}

func void QA401_FINALCUTSCENE_END() {
    FADESCREENTOBLACKF(5, 0x16a92, 1000);
}

func void QA401_FINALCUTSCENE_END_FADESCREEN() {
    FF_APPLYONCEEXT(0x16a93, 75, 4);
}

func void QA401_FINALCUTSCENE_END_APPLY() {
    QA401_FINALCUTSCENE_END_COUNT = (QA401_FINALCUTSCENE_END_COUNT) + (1);
    if ((QA401_FINALCUTSCENE_END_COUNT) == (4)) {
        MUSIC_DISABLEOVERRIDE();
        QA401_FINAL_CUTSCENEENABLE = 4;
        HERO.AIVAR[4] = FALSE;
        SLD_1000_ADELARD.AIVAR[92] = FALSE;
        NONE_7002_GETORYX.AIVAR[92] = FALSE;
        BDT_13571_SMUGGLER.AIVAR[92] = FALSE;
        BDT_13572_SMUGGLER.AIVAR[92] = FALSE;
        WLD_SENDUNTRIGGER("QA401_FINAL_01");
        WLD_SENDUNTRIGGER("QA401_FINAL_02");
        WLD_SENDUNTRIGGER("QA401_FINAL_03");
        WLD_SENDUNTRIGGER("QA401_FINAL_04");
        WLD_SENDUNTRIGGER("QA401_FINAL_05");
        WLD_SENDUNTRIGGER("QA401_FINAL_06");
        WLD_SENDUNTRIGGER("QA401_FINAL_07");
        WLD_SENDUNTRIGGER("QA401_FINAL_08");
        WLD_SENDUNTRIGGER("QA401_FINAL_09");
        WLD_SENDUNTRIGGER("QA401_FINAL_10");
        WLD_SENDUNTRIGGER("QA401_FINAL_11");
        WLD_SENDUNTRIGGER("QA401_FINAL_12");
        WLD_SENDUNTRIGGER("QA401_FINAL_13");
        WLD_SENDUNTRIGGER("QA401_FINAL_14");
        WLD_SENDUNTRIGGER("QA401_FINAL_15");
        FADESCREENFROMBLACK(1);
        QA401_REMOVESMUGGLERS();
        QA401_REFRESHARAXOS();
        B_LOGENTRY(TOPIC_QA401, LOG_QA401_AFTERCUTSCENE);
    };
}

var int QA401_FINALCUTSCENE_END_APPLY.QA401_FINALCUTSCENE_END_COUNT = 0;
