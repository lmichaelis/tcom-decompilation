func void QM401_PREPARENPC() {
    PRINTD("Oktav gotowy");
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_BARRACK");
    QM401_OKTAV_RTNCHECK = 1;
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    WLD_INSERTNPC(0xcde3, "PARTM3_QM401_SPOT_01");
    WLD_INSERTNPC(0xcdf1, "PARTM3_QM401_SPOT_02");
    WLD_INSERTNPC(0xcdff, "PARTM3_QM401_SPOT_03");
    WLD_INSERTNPC(0xce0f, "PARTM3_QM401_SPOT_04");
    if ((TRAP52_SPAWNED) == (1)) {
        if ((NPC_ISDEAD(NONE_13630_RENEGADE)) == (FALSE)) {
            B_REMOVENPC(0xdf04);
        };
        if ((NPC_ISDEAD(NONE_13631_RENEGADE)) == (FALSE)) {
            B_REMOVENPC(0xdf07);
        };
    };
}

func void QM401_OKTAV_RENEGADESATTACK_WAIT() {
    if ((QM401_RENEGADESCAVEATTACK) == (1)) {
        NPC_EXCHANGEROUTINE(MIL_4001_OKTAV, "QM401_CAVEATTACK_BEFORE_V1");
        QM401_OKTAV_RTNCHECK = 2;
    };
    NPC_EXCHANGEROUTINE(MIL_4001_OKTAV, "QM401_CAVEATTACK_BEFORE_V2");
    QM401_OKTAV_RTNCHECK = 3;
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_CAVEATTACK_BEFORE");
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_CAVEATTACK_BEFORE");
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_CAVEATTACK_BEFORE");
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_CAVEATTACK_BEFORE");
    FF_APPLYONCEEXTGT(0xf563, 0, -(1));
    FF_APPLYONCEEXTGT(0xf55d, 0, -(1));
}

func void QM401_INSIDECAVE_APPLY() {
    if ((QM401_INSIDECAVE_COUNT) == (0)) {
        PRINTD("Rozpoczynam - QM401_InsideCave_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("QM401_MOVER_MILITIA_CORPSES");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("QM401_MOVER_BOOKS");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("QM401_MILITIA_CORPSE_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("QM401_MILITIA_CORPSE_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("QM401_BOOKS", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("QM401_MOVER_MILITIA_CORPSES");
        WLD_SENDTRIGGER("QM401_MOVER_BOOKS");
        QM401_INSIDECAVE_COUNT = 1;
        if ((QM401_LEAVEGUILD_MOVER_01) == (TRUE)) {
            QM401_LEAVEGUILD_MOVER_01 = FALSE;
        };
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - QM401_InsideCave_Apply");
        CHANGEVOBCOLLISION("QM401_MILITIA_CORPSE_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("QM401_MILITIA_CORPSE_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("QM401_BOOKS", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf55d);
        QM401_INSIDECAVE_COUNT = 0;
        if ((QM401_LEAVEGUILD_MOVER_01) == (FALSE)) {
            QM401_LEAVEGUILD_MOVER_01 = TRUE;
        };
    };
}

var int QM401_INSIDECAVE_APPLY.QM401_INSIDECAVE_COUNT = 0;
instance QM401_INSIDECAVE_APPLY.MOVER1(ZCMOVER)
instance QM401_INSIDECAVE_APPLY.MOVER2(ZCMOVER)
var int QM401_INSIDECAVE_APPLY.MOVPTR1 = 0;
var int QM401_INSIDECAVE_APPLY.MOVPTR2 = 0;
func void QM401_CHANGERENEGADEDOOR() {
    if ((QM401_CHANGERENEGADEDOOR_COUNT) == (0)) {
        PRINTD("Rozpoczynam - QM401_ChangeRenegadeDoor");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q205_MOVER_TILLDOOR_02");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("Q205_MOVER_DOOR_FRONT_RENEGADE_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        MOVPTR3 = MEM_SEARCHVOBBYNAME("Q205_MOVER_TILLDOOR_03");
        MOVER3 = MEM_PTRTOINST(MOVPTR3);
        MOVPTR4 = MEM_SEARCHVOBBYNAME("Q205_MOVER_DOOR_FRONT_RENEGADE_03");
        MOVER4 = MEM_PTRTOINST(MOVPTR4);
        CHANGEVOBCOLLISION("Q205_DOOR_TILL_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("DOOR_RENEGADE02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("Q205_DOOR_TILL_03", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("DOOR_RENEGADE03", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("Q205_MOVER_TILLDOOR_02");
        WLD_SENDTRIGGER("Q205_MOVER_DOOR_FRONT_RENEGADE_02");
        WLD_SENDTRIGGER("Q205_MOVER_TILLDOOR_03");
        WLD_SENDTRIGGER("Q205_MOVER_DOOR_FRONT_RENEGADE_03");
        QM401_CHANGERENEGADEDOOR_COUNT = 1;
    };
    if (((((((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER4.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - QM401_ChangeRenegadeDoor");
        CHANGEVOBCOLLISION("Q205_DOOR_TILL_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("DOOR_RENEGADE02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q205_DOOR_TILL_03", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("DOOR_RENEGADE03", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf563);
        QM401_CHANGERENEGADEDOOR_COUNT = 0;
    };
}

var int QM401_CHANGERENEGADEDOOR.QM401_CHANGERENEGADEDOOR_COUNT = 0;
instance QM401_CHANGERENEGADEDOOR.MOVER1(ZCMOVER)
instance QM401_CHANGERENEGADEDOOR.MOVER2(ZCMOVER)
instance QM401_CHANGERENEGADEDOOR.MOVER3(ZCMOVER)
instance QM401_CHANGERENEGADEDOOR.MOVER4(ZCMOVER)
var int QM401_CHANGERENEGADEDOOR.MOVPTR1 = 0;
var int QM401_CHANGERENEGADEDOOR.MOVPTR2 = 0;
var int QM401_CHANGERENEGADEDOOR.MOVPTR3 = 0;
var int QM401_CHANGERENEGADEDOOR.MOVPTR4 = 0;
func void QM401_ATTACKRENEGADECAVE() {
    QM401_RENEGADESCAVEATTACK_GO = TRUE;
    MIL_4001_OKTAV.AIVAR[15] = TRUE;
    MIL_13511_MILITIA.AIVAR[15] = TRUE;
    MIL_13512_MILITIA.AIVAR[15] = TRUE;
    MIL_13513_MILITIA.AIVAR[15] = TRUE;
    MIL_13514_MILITIA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_CAVEATTACK");
    QM401_OKTAV_RTNCHECK = 4;
    NPC_REFRESH(MIL_4001_OKTAV);
    if (NPC_ISINSTATE(MIL_13511_MILITIA, 0xf09f)) {
        NPC_EXCHANGEROUTINE(MIL_13511_MILITIA, "QM401_CAVEATTACK");
    };
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_CAVEATTACK");
    NPC_REFRESH(MIL_13511_MILITIA);
    if (NPC_ISINSTATE(MIL_13512_MILITIA, 0xf09f)) {
        NPC_EXCHANGEROUTINE(MIL_13512_MILITIA, "QM401_CAVEATTACK");
    };
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_CAVEATTACK");
    NPC_REFRESH(MIL_13512_MILITIA);
    if (NPC_ISINSTATE(MIL_13513_MILITIA, 0xf09f)) {
        NPC_EXCHANGEROUTINE(MIL_13513_MILITIA, "QM401_CAVEATTACK");
    };
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_CAVEATTACK");
    NPC_REFRESH(MIL_13513_MILITIA);
    if (NPC_ISINSTATE(MIL_13514_MILITIA, 0xf09f)) {
        NPC_EXCHANGEROUTINE(MIL_13514_MILITIA, "QM401_CAVEATTACK");
    };
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_CAVEATTACK");
    NPC_REFRESH(MIL_13514_MILITIA);
    CREATEINVITEMS(MIL_13511_MILITIA, 0x9021, 1);
    CREATEINVITEMS(MIL_13512_MILITIA, 0x9021, 1);
    CREATEINVITEMS(MIL_13513_MILITIA, 0x9021, 1);
    CREATEINVITEMS(MIL_13514_MILITIA, 0x9021, 1);
    CREATEINVITEMS(MIL_4001_OKTAV, 0x9021, 1);
    WLD_INSERTNPC(0xc599, "PART7_CAVE_51");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_47");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_50");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_29");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_22");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_70");
    WLD_INSERTNPC(0xc599, "PART7_CAVE_76");
}

func void QM401_RENEGADECAVE_CHANGERTN() {
    MOB_CHANGEFOCUSNAME("QM401_BOOKS", "MOBNAME_QM401_BOOKS");
    QM401_CANUSEBOOKS = TRUE;
    NPC_EXCHANGEROUTINE(MIL_4001_OKTAV, "QM401_CAVESEARCH");
    QM401_OKTAV_RTNCHECK = 5;
    NPC_EXCHANGEROUTINE(MIL_13511_MILITIA, "QM401_CAVESEARCH");
    NPC_EXCHANGEROUTINE(MIL_13512_MILITIA, "QM401_CAVESEARCH");
    NPC_EXCHANGEROUTINE(MIL_13513_MILITIA, "QM401_CAVESEARCH");
    NPC_EXCHANGEROUTINE(MIL_13514_MILITIA, "QM401_CAVESEARCH");
}

func void QM401_PREPAREBERTO() {
    PRINTD("Prepare Berto");
    NPC_EXCHANGEROUTINE(MIL_13513_MILITIA, "QM401_CAVESEARCH_V2");
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_BUSH");
    TELEPORTNPCTOWP(0xdbd5, MIL_6275_BERTO.WP);
    MIL_6275_BERTO.AIVAR[15] = TRUE;
}

func void QM401_OKTAVLEAVECAVE() {
    MIL_4001_OKTAV.AIVAR[15] = FALSE;
    MIL_13511_MILITIA.AIVAR[15] = FALSE;
    MIL_13512_MILITIA.AIVAR[15] = FALSE;
    MIL_13513_MILITIA.AIVAR[15] = FALSE;
    MIL_13514_MILITIA.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_CAVEATTACK_AFTER");
    QM401_OKTAV_RTNCHECK = 6;
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_CAVEATTACK_AFTER");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_CAVEATTACK_AFTER");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_CAVEATTACK_AFTER");
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_CAVEATTACK_AFTER");
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
    FF_APPLYONCEEXT(0xf571, 250, 2);
    MDL_APPLYOVERLAYMDSTIMED(MIL_6275_BERTO, HUMANSSPRINTMDS, 0x186a0);
}

func void QM401_OKTAVLEAVECAVE_SOUND() {
    QM401_OKTAVLEAVECAVE_COUNT = (QM401_OKTAVLEAVECAVE_COUNT) + (1);
    if ((QM401_OKTAVLEAVECAVE_COUNT) == (1)) {
        SND_PLAY("Run_Earth");
    };
    if ((QM401_OKTAVLEAVECAVE_COUNT) == (2)) {
        SND_PLAY("Run_Earth_A3");
    };
}

var int QM401_OKTAVLEAVECAVE_SOUND.QM401_OKTAVLEAVECAVE_COUNT = 0;
func void QM401_OKTAVCOMEBACK() {
    PRINTD("Okrav wróci³");
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, START);
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, TOT);
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, TOT);
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, TOT);
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, TOT);
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_BUSH_V2");
    NPC_REFRESH(MIL_6275_BERTO);
    TELEPORTNPCTOWP(0xdbd5, MIL_6275_BERTO.WP);
    FF_APPLYONCEEXTGT(0xf55d, 0, -(1));
}

func void QM401_PREPAREBRODDY() {
    PRINTD("Broddy");
    B_STARTOTHERROUTINE(MIL_6268_BRODDY, "QM401_FOLLOW");
    NPC_REFRESH(MIL_6268_BRODDY);
    TELEPORTNPCTOWP(0xdbca, MIL_6268_BRODDY.WP);
}

func void QM401_PREPAREVINEYARD() {
    PRINTD("Winnica gotowa");
    MIL_4001_OKTAV.AIVAR[15] = TRUE;
    MIL_4044_SALL.AIVAR[15] = TRUE;
    MIL_924_WINSTAN.AIVAR[15] = TRUE;
    MIL_13511_MILITIA.AIVAR[15] = TRUE;
    MIL_13512_MILITIA.AIVAR[15] = TRUE;
    MIL_13513_MILITIA.AIVAR[15] = TRUE;
    MIL_13514_MILITIA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(BAU_1007_LIAM, "QM401_VIENYARD");
    NPC_REFRESH(BAU_1007_LIAM);
    TELEPORTNPCTOWP(0xdec4, BAU_1007_LIAM.WP);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VIENYARD");
    QM401_WINSTAN_RTNCHECK = 1;
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VIENYARD");
    QM401_OKTAV_RTNCHECK = 7;
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    B_STARTOTHERROUTINE(MIL_4044_SALL, "QM401_VIENYARD");
    QM401_SALL_RTNCHECK = 1;
    NPC_REFRESH(MIL_4044_SALL);
    TELEPORTNPCTOWP(0xcee7, MIL_4044_SALL.WP);
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VIENYARD");
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VIENYARD");
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
}

func void QM401_CHANGESALLRTN() {
    QM401_SALLGUIDE = 1;
    B_STARTOTHERROUTINE(MIL_4044_SALL, "QM401_VIENYARD_GUIDE");
    QM401_SALL_RTNCHECK = 2;
    NPC_REFRESH(MIL_4044_SALL);
    WLD_INSERTNPC(0xc48c, "PART9_QM401_SALL_SEARCH");
}

func void QM401_MILITIASCYTHE() {
    NPC_EXCHANGEROUTINE(MIL_4044_SALL, "QM401_VIENYARD_FIREPLACE");
    QM401_SALL_RTNCHECK = 4;
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD_SCYTHE");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD_SCYTHE");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VIENYARD_SCYTHE");
    QM401_WINSTAN_RTNCHECK = 2;
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
}

func void QM401_CHANGEFARNNAME() {
    MOB_CHANGEFOCUSNAME("QM401_FARN_03", "MOBNAME_QM401_FARN");
}

func void QM401_PREPAREDUSTER() {
    B_STARTOTHERROUTINE(MIL_6371_DUSTER, "QM401_VINEYARD_CART");
    QM401_DUSTER_RTNCHECK = 1;
    NPC_REFRESH(MIL_6371_DUSTER);
    TELEPORTNPCTOWP(0xd499, MIL_6371_DUSTER.WP);
    MIL_6371_DUSTER.AIVAR[15] = TRUE;
    CHANGEVOBCOLLISION("QM401_DUSTER_CART", TRUE, FALSE, TRUE, TRUE);
    WLD_INSERTITEM(0x91c8, "FP_PART2_QM401_BARREL_01");
    WLD_INSERTITEM(0x91c7, "FP_PART2_QM401_BARREL_02");
    WLD_INSERTITEM(0x91c7, "FP_PART2_QM401_BARREL_03");
    WLD_INSERTITEM(0x91c7, "FP_PART2_QM401_BARREL_04");
    WLD_INSERTITEM(0x91c7, "FP_PART2_QM401_BARREL_05");
    WLD_SENDTRIGGER("QM401_MOVER_FARNPLUNDER_01");
    WLD_SENDTRIGGER("QM401_MOVER_FARNPLUNDER_02");
    WLD_SENDTRIGGER("QM401_MOVER_FARNPLUNDER_03");
}

func void QM401_DUSTERGOTOWINSTAN() {
    NPC_EXCHANGEROUTINE(MIL_6371_DUSTER, "QM401_VINEYARD_SMALLTALK");
    QM401_DUSTER_RTNCHECK = 2;
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD_STONES");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD_STONES");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VIENYARD_STONES");
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VIENYARD_STONES");
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VIENYARD_STONES");
    QM401_OKTAV_RTNCHECK = 9;
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VINEYARD_SMALLTALK");
    QM401_WINSTAN_RTNCHECK = 3;
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    WLD_SENDTRIGGER("QM401_MOVER_FARN_04");
    WLD_SENDTRIGGER("QM401_MOVER_FARN_05");
    WLD_SENDTRIGGER("QM401_MOVER_FARN_06");
}

func void QM401_MILITIAPREPARE() {
    WLD_SENDTRIGGER("QM401_MOVER_PREPAREBARREL");
    QM401_LEAVEGUILD_MOVER_02 = TRUE;
    NPC_EXCHANGEROUTINE(MIL_6371_DUSTER, "QM401_VINEYARD_PREPAREATTACK");
    QM401_DUSTER_RTNCHECK = 3;
    NPC_EXCHANGEROUTINE(MIL_924_WINSTAN, "QM401_VINEYARD_PREPAREATTACK");
    QM401_WINSTAN_RTNCHECK = 4;
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VINEYARD_PREPAREATTACK");
    NPC_REFRESH(MIL_13511_MILITIA);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VINEYARD_PREPAREATTACK");
    NPC_REFRESH(MIL_13512_MILITIA);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VINEYARD_PREPAREATTACK");
    NPC_REFRESH(MIL_13513_MILITIA);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VINEYARD_PREPAREATTACK");
    NPC_REFRESH(MIL_13514_MILITIA);
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VINEYARD_PREPAREATTACK");
    QM401_OKTAV_RTNCHECK = 10;
    NPC_REFRESH(MIL_4001_OKTAV);
}

func void QM401_PREPAREBARREL_PREPARECUTSCENE() {
    FF_APPLYONCEEXT(0xf57d, 75, 4);
    HERO.AIVAR[4] = TRUE;
}

func void QM401_PREPAREBARREL_PREPARECUTSCENE_APPLY() {
    QM401_PREPAREBARREL_PREPARECUTSCENE_COUNT = (QM401_PREPAREBARREL_PREPARECUTSCENE_COUNT) + (1);
    if ((QM401_PREPAREBARREL_PREPARECUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(0x16aa7);
    };
}

var int QM401_PREPAREBARREL_PREPARECUTSCENE_APPLY.QM401_PREPAREBARREL_PREPARECUTSCENE_COUNT = 0;
func void QM401_REMOVEROCKS() {
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_01", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_02", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_03", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_04", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_05", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_06", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_07", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_08", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_09", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_10", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_11", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_12", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_13", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_14", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_15", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_16", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_17", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_18", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_19", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_20", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_21", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_22", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_23", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_24", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_25", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_26", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_27", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_28", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_29", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_30", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_31", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_32", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_33", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_34", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_35", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_OBJECT_36", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_01", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_02", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_03", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_04", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_05", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_06", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_07", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_08", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_09", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_00", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_11", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_12", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_13", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_14", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_15", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_16", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_17", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_18", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_19", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_20", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_21", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_22", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_23", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_24", TRUE, TRUE, TRUE, TRUE);
    CHANGEVOBCOLLISION("QM401_EXPLOSION_AFTER_OBJECT_25", TRUE, TRUE, TRUE, TRUE);
}

func void QM401_SPAWNSMUGGLER() {
    PRINTD("Spawn");
    WLD_INSERTNPC(0xe420, "PART2_QM401_RENEGADE_WALK_02");
    WLD_INSERTNPC(0xe430, "PART2_QM401_RENEGADE_WALK_02");
    WLD_INSERTNPC(0xe43a, "PART2_QM401_RENEGADE_WALK_02");
    WLD_INSERTNPC(0xe443, "PART2_QM401_RENEGADE_WALK_02");
    WLD_INSERTNPC(0xe44c, "PART2_QM401_RENEGADE_WALK_02");
    WLD_INSERTNPC(0xe460, "PART2_QM401_RENEGADE_WALK_02");
    DUMMYFUNCWITHSTRINGPARAMETER("");
    WLD_INSERTNPC(0xc3b0, "PART9_QM401_FIGHTSPOT_11");
}

func void QM401_FINALBATTLE_PREPARENPC() {
    PRINTD("Teleport");
    B_STARTOTHERROUTINE(BAU_1007_LIAM, START);
    NPC_REFRESH(BAU_1007_LIAM);
    TELEPORTNPCTOWP(0xdec4, BAU_1007_LIAM.WP);
    B_STARTOTHERROUTINE(MIL_6371_DUSTER, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_6371_DUSTER);
    TELEPORTNPCTOWP(0xd499, MIL_6371_DUSTER.WP);
    MDL_APPLYOVERLAYMDS(MIL_6371_DUSTER, HUMANSMARVINSNEAKMDS);
    QM401_DUSTER_RTNCHECK = 4;
    B_STARTOTHERROUTINE(MIL_4044_SALL, "QM401_VIENYARD_WAIT");
    QM401_SALL_RTNCHECK = 5;
    NPC_REFRESH(MIL_4044_SALL);
    TELEPORTNPCTOWP(0xcee7, MIL_4044_SALL.WP);
    MDL_APPLYOVERLAYMDS(MIL_4044_SALL, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    MDL_APPLYOVERLAYMDS(MIL_13511_MILITIA, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    MDL_APPLYOVERLAYMDS(MIL_13512_MILITIA, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    MDL_APPLYOVERLAYMDS(MIL_13513_MILITIA, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
    MDL_APPLYOVERLAYMDS(MIL_13514_MILITIA, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VIENYARD_WAIT");
    QM401_OKTAV_RTNCHECK = 11;
    NPC_REFRESH(MIL_4001_OKTAV);
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    MDL_APPLYOVERLAYMDS(MIL_4001_OKTAV, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_6264_RENEGADE, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_6264_RENEGADE);
    TELEPORTNPCTOWP(0xdba0, MIL_6264_RENEGADE.WP);
    MDL_REMOVEOVERLAYMDS(MIL_6264_RENEGADE, HUMANSARROGANCEMDS);
    B_STARTOTHERROUTINE(MIL_6267_SALVI, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_6267_SALVI);
    TELEPORTNPCTOWP(0xdbc0, MIL_6267_SALVI.WP);
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_6275_BERTO);
    TELEPORTNPCTOWP(0xdbd5, MIL_6275_BERTO.WP);
    B_STARTOTHERROUTINE(MIL_6277_RENEGADE, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(MIL_6277_RENEGADE);
    TELEPORTNPCTOWP(0xdbad, MIL_6277_RENEGADE.WP);
    MDL_REMOVEOVERLAYMDS(MIL_6277_RENEGADE, HUMANSMILITIAMDS);
    if ((Q205_TRYTOSAVEDANIEL) == (2)) {
        B_REMOVENPC(0xdbf3);
        WLD_INSERTNPC(0xeb40, "PART2_PATH_11");
        B_STARTOTHERROUTINE(NONE_13517_DANIEL, "QM401_VIENYARD_WAIT");
        TELEPORTNPCTOWP(0xeb40, NONE_13517_DANIEL.WP);
    };
    B_STARTOTHERROUTINE(NONE_6336_BODYGUARD, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6336_BODYGUARD);
    TELEPORTNPCTOWP(0xe420, NONE_6336_BODYGUARD.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6336_BODYGUARD, HUMANSMILITIAMDS);
    B_STARTOTHERROUTINE(NONE_6337_BODYGUARD, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6337_BODYGUARD);
    TELEPORTNPCTOWP(0xe430, NONE_6337_BODYGUARD.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6337_BODYGUARD, HUMANSMILITIAMDS);
    B_STARTOTHERROUTINE(NONE_6338_BODYGUARD, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6338_BODYGUARD);
    TELEPORTNPCTOWP(0xe43a, NONE_6338_BODYGUARD.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6338_BODYGUARD, HUMANSMILITIAMDS);
    B_STARTOTHERROUTINE(NONE_6339_BODYGUARD, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6339_BODYGUARD);
    TELEPORTNPCTOWP(0xe443, NONE_6339_BODYGUARD.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6339_BODYGUARD, HUMANSMILITIAMDS);
    B_STARTOTHERROUTINE(NONE_6340_SMUGGLER, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6340_SMUGGLER);
    TELEPORTNPCTOWP(0xe44c, NONE_6340_SMUGGLER.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6340_SMUGGLER, HUMANSMILITIAMDS);
    B_STARTOTHERROUTINE(NONE_6341_BODYGUARD, "QM401_VIENYARD_WAIT");
    NPC_REFRESH(NONE_6341_BODYGUARD);
    TELEPORTNPCTOWP(0xe460, NONE_6341_BODYGUARD.WP);
    MDL_REMOVEOVERLAYMDS(NONE_6341_BODYGUARD, HUMANSMILITIAMDS);
}

func void QM401_TELEPORTHERO() {
    if (TORCH_HEROHOLDINGTORCH()) {
        TORCH_UNEQUIP();
    };
    PRINTD("Teleport");
    TELEPORTNPCTOWP(0x71b, "PART2_QM401_HIDE_HERO");
    MDL_APPLYOVERLAYMDS(HERO, HUMANSMARVINSNEAKMDS);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VIENYARD_WAIT");
    QM401_WINSTAN_RTNCHECK = 5;
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    MDL_APPLYOVERLAYMDS(MIL_924_WINSTAN, HUMANSMARVINSNEAKMDS);
}

func void QM401_RENEGADESWALK() {
    B_STARTOTHERROUTINE(MIL_6264_RENEGADE, "QM401_VIENYARD_WALK");
    NPC_REFRESH(MIL_6264_RENEGADE);
    B_STARTOTHERROUTINE(MIL_6267_SALVI, "QM401_VIENYARD_WALK");
    NPC_REFRESH(MIL_6267_SALVI);
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_VIENYARD_WALK");
    NPC_REFRESH(MIL_6275_BERTO);
    B_STARTOTHERROUTINE(MIL_6277_RENEGADE, "QM401_VIENYARD_WALK");
    NPC_REFRESH(MIL_6277_RENEGADE);
    if ((Q205_TRYTOSAVEDANIEL) == (2)) {
        B_STARTOTHERROUTINE(NONE_13517_DANIEL, "QM401_VIENYARD_WALK");
        NPC_REFRESH(NONE_13517_DANIEL);
    };
    B_STARTOTHERROUTINE(NONE_6336_BODYGUARD, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6336_BODYGUARD);
    B_STARTOTHERROUTINE(NONE_6337_BODYGUARD, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6337_BODYGUARD);
    B_STARTOTHERROUTINE(NONE_6338_BODYGUARD, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6338_BODYGUARD);
    B_STARTOTHERROUTINE(NONE_6339_BODYGUARD, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6339_BODYGUARD);
    B_STARTOTHERROUTINE(NONE_6340_SMUGGLER, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6340_SMUGGLER);
    B_STARTOTHERROUTINE(NONE_6341_BODYGUARD, "QM401_VIENYARD_WALK");
    NPC_REFRESH(NONE_6341_BODYGUARD);
}

func void QM401_FIGHTWITHRENEGADES() {
    B_STARTOTHERROUTINE(MIL_6264_RENEGADE, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_6264_RENEGADE);
    TELEPORTNPCTOWP(0xdba0, MIL_6264_RENEGADE.WP);
    NPC_SETTRUEGUILD(MIL_6264_RENEGADE, GIL_BDT);
    MIL_6264_RENEGADE.GUILD = GIL_BDT;
    MIL_6264_RENEGADE.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(MIL_6264_RENEGADE, 4);
    B_STARTOTHERROUTINE(MIL_6267_SALVI, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_6267_SALVI);
    TELEPORTNPCTOWP(0xdbc0, MIL_6267_SALVI.WP);
    NPC_SETTRUEGUILD(MIL_6267_SALVI, GIL_BDT);
    MIL_6267_SALVI.GUILD = GIL_BDT;
    MIL_6267_SALVI.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(MIL_6267_SALVI, 6);
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_6275_BERTO);
    TELEPORTNPCTOWP(0xdbd5, MIL_6275_BERTO.WP);
    NPC_SETTRUEGUILD(MIL_6275_BERTO, GIL_MIL);
    MIL_6275_BERTO.GUILD = GIL_MIL;
    MIL_6275_BERTO.FLAGS = NPC_FLAG_IMPORTANT;
    MIL_6275_BERTO.AIVAR[15] = TRUE;
    B_SETATTRIBUTESTOCHAPTER(MIL_6275_BERTO, 5);
    B_STARTOTHERROUTINE(MIL_6277_RENEGADE, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_6277_RENEGADE);
    TELEPORTNPCTOWP(0xdbad, MIL_6277_RENEGADE.WP);
    NPC_SETTRUEGUILD(MIL_6277_RENEGADE, GIL_BDT);
    MIL_6277_RENEGADE.GUILD = GIL_BDT;
    MIL_6277_RENEGADE.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(MIL_6277_RENEGADE, 4);
    if ((Q205_TRYTOSAVEDANIEL) == (2)) {
        B_STARTOTHERROUTINE(NONE_13517_DANIEL, "QM401_VIENYARD_FIGHT");
        NPC_REFRESH(NONE_13517_DANIEL);
        TELEPORTNPCTOWP(0xeb40, NONE_13517_DANIEL.WP);
        NPC_SETTRUEGUILD(NONE_13517_DANIEL, GIL_MIL);
        NONE_13517_DANIEL.GUILD = GIL_MIL;
        NONE_13517_DANIEL.FLAGS = 0;
        NONE_13517_DANIEL.AIVAR[15] = TRUE;
        B_SETATTRIBUTESTOCHAPTER(NONE_13517_DANIEL, 6);
    };
    B_STARTOTHERROUTINE(NONE_6336_BODYGUARD, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6336_BODYGUARD);
    TELEPORTNPCTOWP(0xe420, NONE_6336_BODYGUARD.WP);
    NPC_SETTRUEGUILD(NONE_6336_BODYGUARD, GIL_BDT);
    NONE_6336_BODYGUARD.GUILD = GIL_BDT;
    NONE_6336_BODYGUARD.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6336_BODYGUARD, 4);
    B_STARTOTHERROUTINE(NONE_6337_BODYGUARD, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6337_BODYGUARD);
    TELEPORTNPCTOWP(0xe430, NONE_6337_BODYGUARD.WP);
    NPC_SETTRUEGUILD(NONE_6337_BODYGUARD, GIL_BDT);
    NONE_6337_BODYGUARD.GUILD = GIL_BDT;
    NONE_6337_BODYGUARD.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6337_BODYGUARD, 4);
    B_STARTOTHERROUTINE(NONE_6338_BODYGUARD, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6338_BODYGUARD);
    TELEPORTNPCTOWP(0xe43a, NONE_6338_BODYGUARD.WP);
    NPC_SETTRUEGUILD(NONE_6338_BODYGUARD, GIL_BDT);
    NONE_6338_BODYGUARD.GUILD = GIL_BDT;
    NONE_6338_BODYGUARD.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6338_BODYGUARD, 4);
    B_KILLNPC(0xe43a);
    B_STARTOTHERROUTINE(NONE_6339_BODYGUARD, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6339_BODYGUARD);
    TELEPORTNPCTOWP(0xe443, NONE_6339_BODYGUARD.WP);
    NPC_SETTRUEGUILD(NONE_6339_BODYGUARD, GIL_BDT);
    NONE_6339_BODYGUARD.GUILD = GIL_BDT;
    NONE_6339_BODYGUARD.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6339_BODYGUARD, 4);
    B_KILLNPC(0xe443);
    B_STARTOTHERROUTINE(NONE_6340_SMUGGLER, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6340_SMUGGLER);
    TELEPORTNPCTOWP(0xe44c, NONE_6340_SMUGGLER.WP);
    NPC_SETTRUEGUILD(NONE_6340_SMUGGLER, GIL_BDT);
    NONE_6340_SMUGGLER.GUILD = GIL_BDT;
    NONE_6340_SMUGGLER.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6340_SMUGGLER, 5);
    B_STARTOTHERROUTINE(NONE_6341_BODYGUARD, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(NONE_6341_BODYGUARD);
    TELEPORTNPCTOWP(0xe460, NONE_6341_BODYGUARD.WP);
    NPC_SETTRUEGUILD(NONE_6341_BODYGUARD, GIL_BDT);
    NONE_6341_BODYGUARD.GUILD = GIL_BDT;
    NONE_6341_BODYGUARD.FLAGS = 0;
    B_SETATTRIBUTESTOCHAPTER(NONE_6341_BODYGUARD, 4);
    B_STARTOTHERROUTINE(MIL_6371_DUSTER, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_6371_DUSTER);
    TELEPORTNPCTOWP(0xd499, MIL_6371_DUSTER.WP);
    QM401_DUSTER_RTNCHECK = 5;
    B_STARTOTHERROUTINE(MIL_4044_SALL, "QM401_VIENYARD_FIGHT");
    QM401_SALL_RTNCHECK = 6;
    NPC_REFRESH(MIL_4044_SALL);
    TELEPORTNPCTOWP(0xcee7, MIL_4044_SALL.WP);
    B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_13511_MILITIA);
    TELEPORTNPCTOWP(0xcde3, MIL_13511_MILITIA.WP);
    MIL_13511_MILITIA.FLAGS = 0;
    B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_13512_MILITIA);
    TELEPORTNPCTOWP(0xcdf1, MIL_13512_MILITIA.WP);
    MIL_13512_MILITIA.FLAGS = 0;
    B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_13513_MILITIA);
    TELEPORTNPCTOWP(0xcdff, MIL_13513_MILITIA.WP);
    MIL_13513_MILITIA.FLAGS = 0;
    B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_13514_MILITIA);
    TELEPORTNPCTOWP(0xce0f, MIL_13514_MILITIA.WP);
    MIL_13514_MILITIA.FLAGS = 0;
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VIENYARD_FIGHT");
    NPC_REFRESH(MIL_4001_OKTAV);
    QM401_OKTAV_RTNCHECK = 12;
    TELEPORTNPCTOWP(0xce55, MIL_4001_OKTAV.WP);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VIENYARD_FIGHT");
    QM401_WINSTAN_RTNCHECK = 6;
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
}

func void QM401_FINALBATTLE_REMOVECUTSCENE() {
    QM401_FINALBATTLE_REMOVECUTSCENE_COUNT = (QM401_FINALBATTLE_REMOVECUTSCENE_COUNT) + (1);
    if ((QM401_FINALBATTLE_REMOVECUTSCENE_COUNT) == (4)) {
        QM401_FIGHTWITHRENEGADESCHECK = 1;
        HERO.AIVAR[4] = FALSE;
        WLD_SENDUNTRIGGER("QM401_FINALBATTLE_01");
        WLD_SENDUNTRIGGER("QM401_FINALBATTLE_02");
        WLD_SENDUNTRIGGER("QM401_FINALBATTLE_03");
        WLD_SENDUNTRIGGER("QM401_FINALBATTLE_04");
        WLD_SENDUNTRIGGER("QM401_FINALBATTLE_05");
        MDL_REMOVEOVERLAYMDS(HERO, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_924_WINSTAN, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_4044_SALL, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_4001_OKTAV, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_6371_DUSTER, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_13511_MILITIA, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_13512_MILITIA, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_13513_MILITIA, HUMANSMARVINSNEAKMDS);
        MDL_REMOVEOVERLAYMDS(MIL_13514_MILITIA, HUMANSMARVINSNEAKMDS);
        WLD_INSERTNPC(0xeaf1, "PART9_QM401_FIGHTSPOT_20");
        WLD_INSERTNPC(0xeaf3, "PART9_QM401_FIGHTSPOT_21");
        AI_STOPLOOKAT(HERO);
        AI_RESETFACEANI(HERO);
        QM401_FIGHTWITHRENEGADES();
        MUSIC_OVERRIDETRACK(0x55bd);
    };
}

var int QM401_FINALBATTLE_REMOVECUTSCENE.QM401_FINALBATTLE_REMOVECUTSCENE_COUNT = 0;
func int QM401_RENEGADESAREDEAD() {
    if (((((((((((NPC_ISDEAD(MIL_6264_RENEGADE)) && (NPC_ISDEAD(MIL_6267_SALVI))) && (NPC_ISDEAD(MIL_6277_RENEGADE))) && (NPC_ISDEAD(BDT_13515_RENEGADE))) && (NPC_ISDEAD(BDT_13516_RENEGADE))) && (NPC_ISDEAD(NONE_6336_BODYGUARD))) && (NPC_ISDEAD(NONE_6337_BODYGUARD))) && (NPC_ISDEAD(NONE_6338_BODYGUARD))) && (NPC_ISDEAD(NONE_6339_BODYGUARD))) && (NPC_ISDEAD(NONE_6340_SMUGGLER))) && (NPC_ISDEAD(NONE_6341_BODYGUARD))) {
        return TRUE;
    };
    return FALSE;
}

func int QM401_SOMEONEDIED() {
    if ((((NPC_ISDEAD(MIL_13511_MILITIA)) || (NPC_ISDEAD(MIL_13512_MILITIA))) || (NPC_ISDEAD(MIL_13513_MILITIA))) || (NPC_ISDEAD(MIL_13514_MILITIA))) {
        if ((Q205_TRYTOSAVEDANIEL) == (2)) {
            if (NPC_ISDEAD(NONE_13517_DANIEL)) {
                return TRUE;
            };
            return FALSE;
        };
        return TRUE;
    };
    return FALSE;
}

func void QM401_TIREDMILITIA() {
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "QM401_VIENYARD_TIRED");
    NPC_REFRESH(MIL_6275_BERTO);
    if (((Q205_TRYTOSAVEDANIEL) == (2)) && ((NPC_ISDEAD(NONE_13517_DANIEL)) == (FALSE))) {
        B_STARTOTHERROUTINE(NONE_13517_DANIEL, "QM401_VIENYARD_TIRED");
        NPC_REFRESH(NONE_13517_DANIEL);
    };
    B_STARTOTHERROUTINE(MIL_6371_DUSTER, "QM401_VIENYARD_TIRED");
    NPC_REFRESH(MIL_6371_DUSTER);
    QM401_DUSTER_RTNCHECK = 6;
    B_STARTOTHERROUTINE(MIL_4044_SALL, "QM401_VIENYARD_TIRED");
    QM401_SALL_RTNCHECK = 7;
    NPC_REFRESH(MIL_4044_SALL);
    if ((NPC_ISDEAD(MIL_13511_MILITIA)) == (FALSE)) {
        B_STARTOTHERROUTINE(MIL_13511_MILITIA, "QM401_VIENYARD_TIRED");
        NPC_REFRESH(MIL_13511_MILITIA);
    };
    if ((NPC_ISDEAD(MIL_13512_MILITIA)) == (FALSE)) {
        B_STARTOTHERROUTINE(MIL_13512_MILITIA, "QM401_VIENYARD_TIRED");
        NPC_REFRESH(MIL_13512_MILITIA);
    };
    if ((NPC_ISDEAD(MIL_13513_MILITIA)) == (FALSE)) {
        B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_VIENYARD_TIRED");
        NPC_REFRESH(MIL_13513_MILITIA);
    };
    if ((NPC_ISDEAD(MIL_13514_MILITIA)) == (FALSE)) {
        B_STARTOTHERROUTINE(MIL_13514_MILITIA, "QM401_VIENYARD_TIRED");
        NPC_REFRESH(MIL_13514_MILITIA);
    };
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, "QM401_VIENYARD_TIRED");
    NPC_REFRESH(MIL_4001_OKTAV);
    QM401_OKTAV_RTNCHECK = 13;
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "QM401_VIENYARD_TIRED");
    QM401_WINSTAN_RTNCHECK = 7;
    NPC_REFRESH(MIL_924_WINSTAN);
}

func void QM401_MILITIACOMEBACK() {
    B_STARTOTHERROUTINE(MIL_6275_BERTO, "CITY");
    NPC_REFRESH(MIL_6275_BERTO);
    MIL_6275_BERTO.AIVAR[15] = FALSE;
    NPC_CHANGEARMOR(MIL_6275_BERTO, 0x8aad);
    if (((Q205_TRYTOSAVEDANIEL) == (2)) && ((NPC_ISDEAD(NONE_13517_DANIEL)) == (FALSE))) {
        B_STARTOTHERROUTINE(NONE_13517_DANIEL, "CITY");
        NPC_REFRESH(NONE_13517_DANIEL);
        NONE_13517_DANIEL.AIVAR[15] = FALSE;
        NPC_CHANGEARMOR(NONE_13517_DANIEL, 0x8ada);
        NPC_REMOVEINVITEMS(NONE_13517_DANIEL, 0x8ab6, 1);
        CREATEINVITEMS(NONE_13517_DANIEL, 0x9a44, 1);
    };
    NPC_REMOVEINVITEMS(MIL_6275_BERTO, 0x8ab5, 1);
    B_STARTOTHERROUTINE(MIL_6371_DUSTER, START);
    NPC_REFRESH(MIL_6371_DUSTER);
    MIL_6371_DUSTER.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(MIL_4044_SALL, START);
    NPC_REFRESH(MIL_4044_SALL);
    MIL_4044_SALL.AIVAR[15] = FALSE;
    if ((NPC_ISDEAD(MIL_13511_MILITIA)) == (FALSE)) {
        B_REMOVENPC(0xcde3);
        MIL_13511_MILITIA.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(MIL_13512_MILITIA)) == (FALSE)) {
        B_REMOVENPC(0xcdf1);
        MIL_13512_MILITIA.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(MIL_13513_MILITIA)) == (FALSE)) {
        B_REMOVENPC(0xcdff);
        MIL_13513_MILITIA.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(MIL_13514_MILITIA)) == (FALSE)) {
        B_REMOVENPC(0xce0f);
        MIL_13514_MILITIA.AIVAR[15] = FALSE;
    };
    B_STARTOTHERROUTINE(MIL_4001_OKTAV, START);
    NPC_REFRESH(MIL_4001_OKTAV);
    MIL_4001_OKTAV.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, START);
    NPC_REFRESH(MIL_924_WINSTAN);
    MIL_924_WINSTAN.AIVAR[15] = FALSE;
}

func void QM401_TELEPORTTOBERTO() {
    FADESCREENTOBLACKF(1, 0xf58c, 1000);
}

func void QM401_TELEPORTTOBERTO_FADESCREEN() {
    WLD_SETTIME(22, 0);
    HERO.AIVAR[4] = FALSE;
    TELEPORTNPCTOWP(0x71b, "PART7_PATH_61");
    AI_TURNTONPC(HERO, MIL_6275_BERTO);
    FADESCREENFROMBLACK(1);
}

