instance DIA_AMB_USURER_EXIT(C_INFO) {
    NR = 999;
    CONDITION = DIA_AMB_USURER_EXIT_CONDITION;
    INFORMATION = DIA_AMB_USURER_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_AMB_USURER_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_AMB_USURER_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_AMB_USURER_ABOUTCITY(C_INFO) {
    NR = 2;
    CONDITION = DIA_AMB_USURER_ABOUTCITY_CONDITION;
    INFORMATION = DIA_AMB_USURER_ABOUTCITY_INFO;
    PERMANENT = TRUE;
    IMPORTANT = FALSE;
    DESCRIPTION = "What should I know about the city?";
}

func int DIA_AMB_USURER_ABOUTCITY_CONDITION() {
    return TRUE;
}

func void DIA_AMB_USURER_ABOUTCITY_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    B_SAY(OTHER, SELF, "$MARVIN_TellMeAboutCity");
    if ((((SELF.VOICE) == (37)) || ((SELF.VOICE) == (72))) || ((SELF.VOICE) == (49))) {
        B_SAY(SELF, OTHER, "$AMB_USURER_WHATSHOULDIKNOWABOUTCITY_V1");
    };
    if ((((SELF.VOICE) == (25)) || ((SELF.VOICE) == (67))) || ((SELF.VOICE) == (59))) {
        AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
        B_SAY(SELF, OTHER, "$AMB_USURER_WHATSHOULDIKNOWABOUTCITY_V2");
    };
    if (((SELF.VOICE) == (28)) || ((SELF.VOICE) == (61))) {
        B_SAY(SELF, OTHER, "$AMB_USURER_WHATSHOULDIKNOWABOUTCITY_V3");
    };
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
}

instance DIA_AMB_USURER_VOLKER(C_INFO) {
    NR = 3;
    CONDITION = DIA_AMB_USURER_VOLKER_CONDITION;
    INFORMATION = DIA_AMB_USURER_VOLKER_INFO;
    PERMANENT = TRUE;
    IMPORTANT = FALSE;
    DESCRIPTION = "Tell me about Volker.";
}

func int DIA_AMB_USURER_VOLKER_CONDITION() {
    return TRUE;
}

func void DIA_AMB_USURER_VOLKER_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    B_SAY(OTHER, SELF, "$MARVIN_OpinionAboutVolker");
    if ((((SELF.VOICE) == (37)) || ((SELF.VOICE) == (49))) || ((SELF.VOICE) == (72))) {
        B_SAY(SELF, OTHER, "$AMB_USURER_ABOUTVOLKER_V1");
    };
    if ((((SELF.VOICE) == (25)) || ((SELF.VOICE) == (67))) || ((SELF.VOICE) == (59))) {
        AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
        B_SAY(SELF, OTHER, "$AMB_USURER_ABOUTVOLKER_V2");
    };
    if (((SELF.VOICE) == (28)) || ((SELF.VOICE) == (61))) {
        B_SAY(SELF, OTHER, "$AMB_USURER_ABOUTVOLKER_V3");
    };
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
}

instance DIA_AMB_USURER_WHATSSUP(C_INFO) {
    NR = 4;
    CONDITION = DIA_AMB_USURER_WHATSSUP_CONDITION;
    INFORMATION = DIA_AMB_USURER_WHATSSUP_INFO;
    PERMANENT = TRUE;
    IMPORTANT = FALSE;
    DESCRIPTION = "How are you doing?";
}

func int DIA_AMB_USURER_WHATSSUP_CONDITION() {
    return TRUE;
}

func void DIA_AMB_USURER_WHATSSUP_INFO() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    B_SAY(OTHER, SELF, "$MARVIN_WhatNew2");
    if ((((SELF.VOICE) == (37)) || ((SELF.VOICE) == (49))) || ((SELF.VOICE) == (72))) {
        if (((LOG_GETSTATUS(MIS_Q308)) == (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_Q312)) == (LOG_RUNNING))) {
            AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_WHITEDAY_V1");
        } else {
            AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_V1");
        } else {
            /* set_instance(0) */;
        };
    };
    if ((((SELF.VOICE) == (25)) || ((SELF.VOICE) == (67))) || ((SELF.VOICE) == (59))) {
        if (((LOG_GETSTATUS(MIS_Q308)) == (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_Q312)) == (LOG_RUNNING))) {
            AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_WHITEDAY_V2");
        } else {
            AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_V2");
        } else {
            /* set_instance(0) */;
        };
    };
    if (((SELF.VOICE) == (28)) || ((SELF.VOICE) == (61))) {
        if (((LOG_GETSTATUS(MIS_Q308)) == (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_Q312)) == (LOG_RUNNING))) {
            AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_WHITEDAY_V3");
        } else {
            AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
            B_SAY(SELF, OTHER, "$AMB_USURER_WHATSNEW_V3");
        };
    };
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
}

instance DIA_AMB_USURER_PISSOFF(C_INFO) {
    NR = 4;
    CONDITION = DIA_AMB_USURER_PISSOFF_CONDITION;
    INFORMATION = DIA_AMB_USURER_PISSOFF_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_AMB_USURER_PISSOFF_CONDITION() {
    if (((KAPITEL) == (5)) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_AMB_USURER_PISSOFF_INFO() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    B_STANDUP();
    AI_STOPLOOKAT(SELF);
    RNGANWSER = HLP_RANDOM(2);
    if ((RNGANWSER) == (0)) {
        AI_PLAYANI(SELF, "T_THREAT_DEATH");
    };
    if ((RNGANWSER) == (1)) {
        B_SAY(SELF, OTHER, "$GoddamnBug");
        AI_PLAYANI(SELF, "T_PISSOFF");
    };
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    AI_STOPPROCESSINFOS(SELF);
}

var int DIA_AMB_USURER_PISSOFF_INFO.RNGANWSER = 0;
func void B_ASSIGNAMBIENTINFOS_AMB_USURER(var C_NPC SLF) {
    DIA_AMB_USURER_EXIT.NPC = HLP_GETINSTANCEID(SLF);
    DIA_AMB_USURER_ABOUTCITY.NPC = HLP_GETINSTANCEID(SLF);
    DIA_AMB_USURER_VOLKER.NPC = HLP_GETINSTANCEID(SLF);
    DIA_AMB_USURER_WHATSSUP.NPC = HLP_GETINSTANCEID(SLF);
    DIA_AMB_USURER_PISSOFF.NPC = HLP_GETINSTANCEID(SLF);
}

