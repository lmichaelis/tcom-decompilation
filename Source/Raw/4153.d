var int TRADER_NOTAFREDRIK_COUNTER = 0;
instance DIA_NOTAFREDRIK_EXIT(C_INFO) {
    NPC = 0xe618;
    NR = 999;
    CONDITION = DIA_NOTAFREDRIK_EXIT_CONDITION;
    INFORMATION = DIA_NOTAFREDRIK_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_NOTAFREDRIK_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_NOTAFREDRIK_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NOTAFREDRIK_TRADEWITHME(C_INFO) {
    NPC = 0xe618;
    NR = 2;
    CONDITION = DIA_NOTAFREDRIK_TRADEWITHME_CONDITION;
    INFORMATION = DIA_NOTAFREDRIK_TRADEWITHME_INFO;
    PERMANENT = TRUE;
    TRADE = TRUE;
    DESCRIPTION = "Let's trade!";
}

func int DIA_NOTAFREDRIK_TRADEWITHME_CONDITION() {
    return TRUE;
}

func void DIA_NOTAFREDRIK_TRADEWITHME_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_NotAFredrik_TradeWithMe_15_01");
    if ((TRADER_NOTAFREDRIK_COUNTER) >= (RNG_TRADERCOUNT_MAX)) {
        NPC_EXCHANGEROUTINE(NONE_13681_NOTAFREDRIK, TOT);
        PRINTD("To ja sobie ju¿ pójdê.");
    };
    TRADER_NOTAFREDRIK_COUNTER = (TRADER_NOTAFREDRIK_COUNTER) + (1);
    B_GIVETRADEINV_NOTAFREDRIK(SELF);
}

instance DIA_NOTAFREDRIK_YOUAREFREDRIK(C_INFO) {
    NPC = 0xe618;
    NR = 1;
    CONDITION = DIA_NOTAFREDRIK_YOUAREFREDRIK_CONDITION;
    INFORMATION = DIA_NOTAFREDRIK_YOUAREFREDRIK_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Hey, I know you!";
}

func int DIA_NOTAFREDRIK_YOUAREFREDRIK_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ202)) == (LOG_SUCCESS)) || ((LOG_GETSTATUS(MIS_SQ202)) == (LOG_FAILED))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NOTAFREDRIK_ITWASYOU_COMMENT() {
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_NotAFredrik_YouAreFredrik_15_06");
    AI_WAITTILLEND(SELF, OTHER);
    if ((NPC_HASITEMS(OTHER, 0x9bec)) >= (1)) {
        NPC_REMOVEINVITEM(SELF, 0x9bec);
        B_STANDUP();
        B_GIVEINVITEMS(OTHER, SELF, 0x9bec, 1);
        B_USEFAKESCROLL();
    };
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, FLEE);
    SELF.AIVAR[52] = TRUE;
    NONE_13681_NOTAFREDRIK.FLAGS = 0;
}

func void DIA_NOTAFREDRIK_YOUAREFREDRIK_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_NotAFredrik_YouAreFredrik_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_NotAFredrik_YouAreFredrik_15_02");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_NotAFredrik_YouAreFredrik_03_03");
    if ((PETRAKILLLETTER_READ) == (TRUE)) {
        DIA_NOTAFREDRIK_ITWASYOU_COMMENT();
        B_GIVEPLAYERXP(XP_FOUNDPETRA);
    };
    AI_OUTPUT(OTHER, SELF, "DIA_NotAFredrik_YouAreFredrik_15_04");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_NotAFredrik_YouAreFredrik_03_05");
    B_GIVEPLAYERXP((XP_FOUNDPETRA) / (2));
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_NOTAFREDRIK_ITWASYOU(C_INFO) {
    NPC = 0xe618;
    NR = 1;
    CONDITION = DIA_NOTAFREDRIK_ITWASYOU_CONDITION;
    INFORMATION = DIA_NOTAFREDRIK_ITWASYOU_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_NOTAFREDRIK_ITWASYOU_CONDITION() {
    if ((((PETRAKILLLETTER_READ) == (TRUE)) && (NPC_KNOWSINFO(OTHER, 0x143ee))) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NOTAFREDRIK_ITWASYOU_INFO() {
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    DIA_NOTAFREDRIK_ITWASYOU_COMMENT();
    B_GIVEPLAYERXP((XP_FOUNDPETRA) / (2));
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

