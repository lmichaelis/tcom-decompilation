instance Q306_ENDTHIRDROUND(CUTSCENE) {
    ONSTART = FUNCTION(0x16950);
}

func void Q306_ENDTHIRDROUND_WAIT() {
    AI_WAITTILLEND(PIR_1307_PROXIMO, HERO);
    AI_WAITTILLEND(HERO, PIR_1307_PROXIMO);
}

func void Q306_ENDTHIRDROUND_START() {
    MUSIC_OVERRIDETRACK(0x55be);
    Q306_LOSTWEAPONINTOURNAMENT = 0;
    HERO.AIVAR[95] = FALSE;
    HERO.AIVAR[94] = FALSE;
    SEASNAKE.AIVAR[94] = FALSE;
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_04");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    NPC_CLEARAIQUEUE(PIR_1307_PROXIMO);
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_INSIDE_08");
    PIR_1307_PROXIMO.AIVAR[92] = TRUE;
    AI_TURNTONPC(PIR_1307_PROXIMO, PIR_1306_RODRIGO);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_Round3Ending_13_01");
    AI_REMOVEWEAPON(HERO);
    Q306_ENDTHIRDROUND_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16951);
    AI_TURNAWAY(HERO, PIR_1307_PROXIMO);
    AI_PLAYANI(HERO, "T_MARVIN_FLEX");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_Round3Ending_13_02");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_Round3Ending_13_03");
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16952);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_Round3Ending_13_04");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_Round3Ending_13_05");
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16953);
}

func void Q306_ENDTHIRDROUND_CAMERACHANGE_01() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_4_06");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_04");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_40");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_PLAYER_03");
}

func void Q306_ENDTHIRDROUND_CAMERACHANGE_02() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_03");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_4_06");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_18");
}

func void Q306_ENDTHIRDROUND_END() {
    FADESCREENTOBLACKF(1, 0x16954, 1000);
}

func void Q306_TELEPORTPLAYERTOLOCKER_ROUND3() {
    PRINTD("Koniec Rundy 3");
    WLD_SENDUNTRIGGER("Q306_ARENACROWD");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_03");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    Q306_STATE = 23;
    Q306_READYFORFIGHT = 0;
    Q306_THIRDROUNDFINISH = 1;
    NPC_CLEARAIQUEUE(PIR_1307_PROXIMO);
    NPC_CLEARAIQUEUE(HERO);
    PIR_1307_PROXIMO.AIVAR[92] = FALSE;
    AI_TELEPORT(HERO, "P17_HAVEN_ARENA_INSIDE_06");
    B_STARTOTHERROUTINE(PIR_13050_OTIS_ARENA, START);
    NPC_REFRESH(PIR_13050_OTIS_ARENA);
    TELEPORTNPCTOWP(0xe52f, PIR_13050_OTIS_ARENA.WP);
    B_STARTOTHERROUTINE(PIR_1330_ALVAREZ, "BeforeFinal");
    NPC_REFRESH(PIR_1330_ALVAREZ);
    TELEPORTNPCTOWP(0xe5cc, "P17_HAVEN_ARENA_INSIDE_08");
    if ((Q306_FIGHTWITHJAVED) > (0)) {
        JAVAD = HLP_GETNPC(0xe4c6);
        B_STARTOTHERROUTINE(JAVAD, "BeforeFinal");
        NPC_REFRESH(JAVAD);
        TELEPORTNPCTOWP(0x16955, "P17_HAVEN_ARENA_INSIDE_08");
    };
    WLD_INSERTNPC(0xe47c, "P17_HAVEN_ARENA_INSIDE_06");
    NPC_REFRESH(SEASNAKE);
    SEASNAKE.WP = TOT;
    SEASNAKE.SPAWNPOINT = TOT;
    TELEPORTNPCTOWP(0xc652, SEASNAKE.WP);
    NPC_REFRESH(NONE_1331_ORCSLAVE);
    NONE_1331_ORCSLAVE.WP = TOT;
    NONE_1331_ORCSLAVE.SPAWNPOINT = TOT;
    TELEPORTNPCTOWP(0xeb9c, TOT);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
}

instance Q306_TELEPORTPLAYERTOLOCKER_ROUND3.JAVAD(C_NPC)
