func void SQ419_SMITHING_S1() {
    HER = HLP_GETNPC(0xc3ab);
    if (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HER))) && ((SQ419_SMITHINGTIME) == (TRUE))) {
        SELF.AIVAR[4] = TRUE;
        PLAYER_MOBSI_PRODUCTION = MOBSI_SQ419_SMITHING;
        AI_PROCESSINFOS(HER);
    };
}

instance SQ419_SMITHING_S1.HER(C_NPC)
instance PC_SQ419_SMITHING_END(C_INFO) {
    NPC = 0xc3ab;
    NR = 999;
    CONDITION = PC_SQ419_SMITHING_CONDITION;
    INFORMATION = PC_SQ419_SMITHING_END_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int PC_SQ419_SMITHING_CONDITION() {
    if ((PLAYER_MOBSI_PRODUCTION) == (MOBSI_SQ419_SMITHING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_SQ419_SMITHING_END_INFO() {
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[4] = FALSE;
    PLAYER_MOBSI_PRODUCTION = MOBSI_NONE;
    CREATEINVITEMS(HERO, 0x8587, 1);
}

instance PC_SQ419_SMITHING_LEFT_FIRST(C_INFO) {
    NPC = 0xc3ab;
    NR = 1;
    CONDITION = PC_SQ419_SMITHING_LEFT_FIRST_CONDITION;
    INFORMATION = PC_SQ419_SMITHING_LEFT_FIRST_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_SQ419_SMITHING_LEFT_FIRST;
}

var int SQ419_SMITHING_COUNT = 0;
var int SQ419_SMITHING_STATUS = 0;
func int PC_SQ419_SMITHING_LEFT_FIRST_CONDITION() {
    if (((((PLAYER_MOBSI_PRODUCTION) == (MOBSI_SQ419_SMITHING)) && ((SQ419_SMITHING_STATUS) == (0))) && ((SQ419_SMITHING_COUNT) != (4))) && ((NPC_HASITEMS(OTHER, 0x8587)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_SQ419_SMITHING_LEFT_FIRST_INFO() {
    SQ419_SMITHING_STATUS = 1;
    AI_WAIT(HERO, 0x3f800000);
}

instance PC_SQ419_SMITHING_RIGHT_FIRST(C_INFO) {
    NPC = 0xc3ab;
    NR = 1;
    CONDITION = PC_SQ419_SMITHING_RIGHT_FIRST_CONDITION;
    INFORMATION = PC_SQ419_SMITHING_RIGHT_FIRST_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_SQ419_SMITHING_RIGHT_FIRST;
}

func int PC_SQ419_SMITHING_RIGHT_FIRST_CONDITION() {
    if (((((PLAYER_MOBSI_PRODUCTION) == (MOBSI_SQ419_SMITHING)) && ((SQ419_SMITHING_STATUS) == (1))) && ((SQ419_SMITHING_COUNT) != (4))) && ((NPC_HASITEMS(OTHER, 0x8587)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_SQ419_SMITHING_RIGHT_FIRST_INFO() {
    SQ419_SMITHING_STATUS = 2;
    AI_WAIT(HERO, 0x3f800000);
}

instance PC_SQ419_SMITHING_LEFT_SECOND(C_INFO) {
    NPC = 0xc3ab;
    NR = 1;
    CONDITION = PC_SQ419_SMITHING_LEFT_SECOND_CONDITION;
    INFORMATION = PC_SQ419_SMITHING_LEFT_SECOND_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_SQ419_SMITHING_LEFT_SECOND;
}

func int PC_SQ419_SMITHING_LEFT_SECOND_CONDITION() {
    if (((((PLAYER_MOBSI_PRODUCTION) == (MOBSI_SQ419_SMITHING)) && ((SQ419_SMITHING_STATUS) == (2))) && ((SQ419_SMITHING_COUNT) != (4))) && ((NPC_HASITEMS(OTHER, 0x8587)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_SQ419_SMITHING_LEFT_SECOND_INFO() {
    SQ419_SMITHING_STATUS = 3;
    AI_WAIT(HERO, 0x3f800000);
}

instance PC_SQ419_SMITHING_RIGHT_SECOND(C_INFO) {
    NPC = 0xc3ab;
    NR = 1;
    CONDITION = PC_SQ419_SMITHING_RIGHT_SECOND_CONDITION;
    INFORMATION = PC_SQ419_SMITHING_RIGHT_SECOND_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_SQ419_SMITHING_RIGHT_SECOND;
}

func int PC_SQ419_SMITHING_RIGHT_SECOND_CONDITION() {
    if (((((PLAYER_MOBSI_PRODUCTION) == (MOBSI_SQ419_SMITHING)) && ((SQ419_SMITHING_STATUS) == (3))) && ((SQ419_SMITHING_COUNT) != (4))) && ((NPC_HASITEMS(OTHER, 0x8587)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void SQ419_SMITHING_REMOVEITEM_APPLY() {
    SQ419_SMITHING_REMOVEITEM_COUNT = (SQ419_SMITHING_REMOVEITEM_COUNT) + (1);
    if ((SQ419_SMITHING_REMOVEITEM_COUNT) == (5)) {
        SQ419_SMITHING_REMOVEITEM_COUNT = 0;
        NPC_REMOVEINVITEMS(HERO, 0x8587, 1);
        PRINTD("Usuwam rozgrzane ostrze");
    };
    if ((SQ419_SMITHING_COUNT) == (4)) {
        SQ419_SMITHINGTIME = FALSE;
    };
}

var int SQ419_SMITHING_REMOVEITEM_APPLY.SQ419_SMITHING_REMOVEITEM_COUNT = 0;
func void SQ419_SMITHING_REMOVEITEM_PREPARE() {
    FF_APPLYONCEEXT(0xf9e5, 30, 5);
    HERO.AIVAR[4] = FALSE;
    PLAYER_MOBSI_PRODUCTION = MOBSI_NONE;
    AI_STOPPROCESSINFOS(HERO);
}

func void PC_SQ419_SMITHING_RIGHT_SECOND_INFO() {
    SQ419_SMITHING_COUNT = (SQ419_SMITHING_COUNT) + (1);
    SQ419_SMITHING_STATUS = 0;
    CREATEINVITEMS(HERO, 0x9226, 1);
    PRINTS_EXT(PRINT_SQ419_SMIITH_SUCCESS, RGBA(50, 255, 50, 255));
    AI_WAIT(HERO, 0x3f800000);
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    AI_FUNCTION(HERO, 0xf9e7);
}

