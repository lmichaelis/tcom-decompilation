instance DIA_BALNI_EXIT(C_INFO) {
    NPC = 0xda5d;
    NR = 999;
    CONDITION = DIA_BALNI_EXIT_CONDITION;
    INFORMATION = DIA_BALNI_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_BALNI_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_BALNI_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_BALNI_NET(C_INFO) {
    NPC = 0xda5d;
    NR = 1;
    CONDITION = DIA_BALNI_NET_CONDITION;
    INFORMATION = DIA_BALNI_NET_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I hear you can fix nets.";
}

func int DIA_BALNI_NET_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x12f9b)) && ((NPC_HASITEMS(OTHER, 0x9139)) >= (1))) && ((LOG_GETSTATUS(MIS_FAQ004)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_BALNI_NET_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_03_06");
    INFO_CLEARCHOICES(0x12fb1);
    INFO_ADDCHOICE(0x12fb1, "I hear you like stories.", 0x12fb4);
    INFO_ADDCHOICE(0x12fb1, "And for a few gold pieces you'll do it now?", 0x12fb5);
    if ((NPC_HASITEMS(OTHER, 0x84b4)) >= (1)) {
        INFO_ADDCHOICE(0x12fb1, "How many fish do you usually catch when fishing?", 0x12fb6);
    };
}

func void DIA_BALNI_NET_STORY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Story_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Story_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Story_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Story_03_04");
    INFO_CLEARCHOICES(0x12fb1);
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_BALNISTORY);
    FAQ004_TELLBALNISTORY = TRUE;
}

func void DIA_BALNI_NET_GOLD() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Gold_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Gold_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Gold_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Gold_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Gold_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Gold_03_06");
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_BALNIANGRY);
    INFO_CLEARCHOICES(0x12fb1);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_BALNI_NET_FISH() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Fish_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Fish_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Fish_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Fish_03_04");
    INFO_CLEARCHOICES(0x12fb1);
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_BALNIFISH);
    FAQ004_BRINGBALNIFISHES = TRUE;
}

func void DIA_BALNI_NET_LATER() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Net_Later_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Net_Later_03_02");
    INFO_CLEARCHOICES(0x12fb1);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_BALNI_STORYTIME(C_INFO) {
    NPC = 0xda5d;
    NR = 2;
    CONDITION = DIA_BALNI_STORYTIME_CONDITION;
    INFORMATION = DIA_BALNI_STORYTIME_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Ready for a story?";
}

func int DIA_BALNI_STORYTIME_CONDITION() {
    if ((((FAQ004_TELLBALNISTORY) == (TRUE)) && ((NPC_HASITEMS(OTHER, 0x9139)) >= (1))) && ((LOG_GETSTATUS(MIS_FAQ004)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void BALNIREPAIRNETSTORYDONE() {
    B_GIVEINVITEMS(NONE_6260_BALNI, HERO, 0x913a, 1);
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_GOTOLIMAN);
    FAQ004_FISHINGNETDONEBYBALNI = TRUE;
}

func void BALNIDIDNTREPAIRNET() {
    B_GIVEINVITEMS(NONE_6260_BALNI, HERO, 0x9139, 1);
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_BALNINOTPLEASED);
}

func void DIA_BALNI_STORYTIME_PICNIC_VETERAN_DEAD_RESULT() {
    if ((FAQ004_BALNISTORYGOODPOINTSCOUNT) == (3)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Result_03_01");
        AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Result_15_02");
        AI_FUNCTION(SELF, 0x12fba);
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Result_03_03");
    AI_FUNCTION(SELF, 0x12fbb);
    INFO_CLEARCHOICES(0x12fb8);
    AI_STOPPROCESSINFOS(SELF);
}

func void STARTCAMERAREPAIRNET() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_NETREPAIR_03");
}

func void GOSITONCHAIR() {
    AI_SETWALKMODE(NONE_6260_BALNI, NPC_WALK);
    AI_GOTOWP(NONE_6260_BALNI, "PART4_FISHERMAN_CAVE_CHAIR");
    AI_GOTOWP(HERO, "PART4_FISHERMAN_CAVE_15");
    AI_USEMOB(NONE_6260_BALNI, "NETREPAIR", 1);
    AI_WAITTILLEND(NONE_6260_BALNI, HERO);
    AI_WAITTILLEND(HERO, NONE_6260_BALNI);
    AI_TURNTONPC(HERO, NONE_6260_BALNI);
}

func void DIA_BALNI_STORYTIME_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_03_04");
    B_GIVEINVITEMS(OTHER, SELF, 0x9139, 1);
    AI_FUNCTION(HERO, 0x12fbd);
    AI_FUNCTION(SELF, 0x12fbe);
    INFO_CLEARCHOICES(0x12fb8);
    INFO_ADDCHOICE(0x12fb8, "One time I went to a festival.", 0x12fc0);
    INFO_ADDCHOICE(0x12fb8, "I once went to a cartographer with my brother.", 0x12fc1);
    INFO_ADDCHOICE(0x12fb8, "I saw a dragon once.", 0x12fc2);
}

func void DIA_BALNI_STORYTIME_PICNIC() {
    WLD_SENDTRIGGER("KM_NETREPAIR_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Picnic_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Picnic_15_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Picnic_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Picnic_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Picnic_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Picnic_03_06");
    FAQ004_BALNISTORYGOODPOINTSCOUNT = (FAQ004_BALNISTORYGOODPOINTSCOUNT) + (1);
    INFO_CLEARCHOICES(0x12fb8);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was a tamed orc.", 0x12fc3);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was an old war veteran.", 0x12fc4);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was a paladin.", 0x12fc5);
}

func void DIA_BALNI_STORYTIME_CARTOGRAPHER() {
    WLD_SENDTRIGGER("KM_NETREPAIR_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Cartographer_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Cartographer_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Cartographer_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Cartographer_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Cartographer_03_05");
    INFO_CLEARCHOICES(0x12fb8);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was a tamed orc.", 0x12fc3);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was an old war veteran.", 0x12fc4);
    INFO_ADDCHOICE(0x12fb8, "Besides us, there was a paladin.", 0x12fc5);
}

func void DIA_BALNI_STORYTIME_DRAGON() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_03");
    DIACAM_ENABLE();
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Dragon_15_01");
    B_STANDUP();
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Dragon_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Dragon_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Dragon_03_04");
    AI_FUNCTION(SELF, 0x12fbb);
    INFO_CLEARCHOICES(0x12fb8);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_BALNI_STORYTIME_PICNIC_ORC() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_01");
    DIACAM_ENABLE();
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Orc_15_01");
    B_STANDUP();
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Orc_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_OrcAttack_03_04");
    AI_FUNCTION(SELF, 0x12fbb);
    INFO_CLEARCHOICES(0x12fb8);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_BALNI_STORYTIME_PICNIC_VETERAN() {
    WLD_SENDTRIGGER("KM_NETREPAIR_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Veteran_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Veteran_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Veteran_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Veteran_15_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Veteran_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Veteran_03_06");
    FAQ004_BALNISTORYGOODPOINTSCOUNT = (FAQ004_BALNISTORYGOODPOINTSCOUNT) + (1);
    INFO_CLEARCHOICES(0x12fb8);
    INFO_ADDCHOICE(0x12fb8, "It wasn't long before we got a decent sword from him.", 0x12fc6);
    INFO_ADDCHOICE(0x12fb8, "He died a short time later.", 0x12fc7);
    INFO_ADDCHOICE(0x12fb8, "Soon after, the village was invaded by orcs.", 0x12fc8);
}

func void DIA_BALNI_STORYTIME_PICNIC_PALADIN() {
    WLD_SENDTRIGGER("KM_NETREPAIR_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Paladin_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Paladin_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Paladin_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Paladin_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Paladin_15_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Paladin_15_06");
    INFO_CLEARCHOICES(0x12fb8);
    INFO_ADDCHOICE(0x12fb8, "It wasn't long before we got a decent sword from him.", 0x12fc6);
    INFO_ADDCHOICE(0x12fb8, "He died a short time later.", 0x12fc7);
    INFO_ADDCHOICE(0x12fb8, "Soon after, the village was invaded by orcs.", 0x12fc8);
}

func void DIA_BALNI_STORYTIME_PICNIC_VETERAN_SWORD() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_02");
    DIACAM_ENABLE();
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Sword_15_01");
    B_STANDUP();
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Sword_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Sword_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Sword_03_05");
    AI_FUNCTION(SELF, 0x12fbb);
    INFO_CLEARCHOICES(0x12fb8);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_BALNI_STORYTIME_PICNIC_VETERAN_DEAD() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_02");
    DIACAM_ENABLE();
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Dead_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Dead_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_Dead_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_Dead_03_04");
    B_STANDUP();
    AI_FUNCTION(SELF, 0xb618);
    FAQ004_BALNISTORYGOODPOINTSCOUNT = (FAQ004_BALNISTORYGOODPOINTSCOUNT) + (1);
    INFO_CLEARCHOICES(0x12fb8);
    DIA_BALNI_STORYTIME_PICNIC_VETERAN_DEAD_RESULT();
}

func void DIA_BALNI_STORYTIME_PICNIC_VETERAN_ORCATTACK() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_02");
    DIACAM_ENABLE();
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_OrcAttack_15_01");
    B_STANDUP();
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_OrcAttack_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_StoryTime_OrcAttack_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_StoryTime_OrcAttack_03_04");
    AI_FUNCTION(SELF, 0x12fbb);
    INFO_CLEARCHOICES(0x12fb8);
    AI_STOPPROCESSINFOS(SELF);
}

var int FAQ004_BALNIGOTFISHES = 0;
instance DIA_BALNI_FISH(C_INFO) {
    NPC = 0xda5d;
    NR = 1;
    CONDITION = DIA_BALNI_FISH_CONDITION;
    INFORMATION = DIA_BALNI_FISH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Here, fish for you.";
}

func int DIA_BALNI_FISH_CONDITION() {
    if ((((FAQ004_BRINGBALNIFISHES) == (TRUE)) && ((NPC_HASITEMS(OTHER, 0x84b4)) >= (20))) && ((LOG_GETSTATUS(MIS_FAQ004)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_BALNI_FISH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Fish_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Balni_Fish_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Balni_Fish_15_03");
    NPC_REMOVEINVITEMS(SELF, 0x84b4, 20);
    AI_FUNCTION(SELF, 0x12fcd);
    B_GIVEINVITEMS(OTHER, SELF, 0x84b4, 20);
    AI_FUNCTION(OTHER, 0x12fce);
    B_GIVEINVITEMS(OTHER, SELF, 0x9139, 1);
}

func void BALNIREPAIRNET() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_NETREPAIR_03");
    B_STANDUP();
    AI_SETWALKMODE(NONE_6260_BALNI, NPC_WALK);
    AI_GOTOWP(NONE_6260_BALNI, "PART4_FISHERMAN_CAVE_CHAIR");
    AI_USEMOB(NONE_6260_BALNI, "NETREPAIR", 1);
    AI_WAITTILLEND(NONE_6260_BALNI, HERO);
    AI_WAITTILLEND(HERO, NONE_6260_BALNI);
    AI_TURNTONPC(HERO, NONE_6260_BALNI);
    AI_WAIT(NONE_6260_BALNI, 0x40e00000);
}

func void BALNIREPAIRNETFADE() {
    FADESCREENTOBLACKF(10, 0x12fcf, 1000);
}

func void BALNIREPAIRNETFADESCREEN() {
    WLD_SENDTRIGGER("KM_NETREPAIR_01");
    AI_TURNTONPC(HERO, NONE_6260_BALNI);
    AI_WAIT(NONE_6260_BALNI, 0x40800000);
    B_STANDUP();
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
    AI_OUTPUT(NONE_6260_BALNI, HERO, "DIA_Balni_FishNetDone_03_01");
    AI_OUTPUT(HERO, NONE_6260_BALNI, "DIA_Balni_FishNetDone_15_02");
    AI_FUNCTION(NONE_6260_BALNI, 0x12fd0);
    AI_STOPPROCESSINFOS(NONE_6260_BALNI);
}

func void BALNIREPAIRNETDONE() {
    WLD_SENDUNTRIGGER("KM_NETREPAIR_01");
    DIACAM_ENABLE();
    AI_LOGENTRY(TOPIC_FAQ004, LOG_FAQ004_BALNIDONEFORFISH);
    CREATEINVITEMS(NONE_6260_BALNI, 0x913a, 1);
    B_GIVEINVITEMS(NONE_6260_BALNI, HERO, 0x913a, 1);
    FAQ004_FISHINGNETDONEBYBALNI = TRUE;
    FAQ004_BALNIGOTFISHES = TRUE;
}

instance DIA_BALNI_Q208_YANNICK(C_INFO) {
    NPC = 0xda5d;
    NR = 1;
    CONDITION = DIA_PART4_FISHERMAN_Q208_YANNICK_CONDITION;
    INFORMATION = DIA_BALNI_Q208_YANNICK_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Do you know where I can find Yannick?";
}

func void DIA_BALNI_Q208_YANNICK_INFO() {
    DIA_PART4_FISHERMAN_Q208_YANNICK_INFO();
}

instance DIA_BALNI_AMBIENT(C_INFO) {
    NPC = 0xda5d;
    NR = 998;
    CONDITION = DIA_BALNI_AMBIENT_CONDITION;
    INFORMATION = DIA_BALNI_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "What's new?";
}

func int DIA_BALNI_AMBIENT_CONDITION() {
    return TRUE;
}

func void DIA_BALNI_AMBIENT_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhatNew");
    B_SAY(SELF, OTHER, "$IMBUSY_CALM");
    AI_RESETFACEANI(SELF);
}

instance DIA_BALNI_PICKPOCKET(C_INFO) {
    NPC = 0xda5d;
    NR = 900;
    CONDITION = DIA_BALNI_PICKPOCKET_CONDITION;
    INFORMATION = DIA_BALNI_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_40;
}

func int DIA_BALNI_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_BALNI_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x12fd6);
    INFO_ADDCHOICE(0x12fd6, DIALOG_BACK, 0x12fda);
    INFO_ADDCHOICE(0x12fd6, DIALOG_PICKPOCKET, 0x12fd9);
}

func void DIA_BALNI_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) {
        B_PICKPOCKET_AMBIENT_TIER_1();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x12fd6);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x12fd6);
}

func void DIA_BALNI_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x12fd6);
}

