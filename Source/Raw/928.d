func void BARREL_KAJMA_S1() {
    HER = HLP_GETNPC(0xc3ab);
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HER))) {
        SELF.AIVAR[4] = TRUE;
        PLAYER_MOBSI_PRODUCTION = MOBSI_BARRELKAJMA;
        AI_PROCESSINFOS(HER);
    };
}

instance BARREL_KAJMA_S1.HER(C_NPC)
func int PC_BARREL_KAJMA_CONDITION() {
    if ((KAPITEL) != (5)) {
        if ((PLAYER_MOBSI_PRODUCTION) == (MOBSI_BARRELKAJMA)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

instance PC_BARREL_KAJMA_END(C_INFO) {
    NPC = 0xc3ab;
    NR = 999;
    CONDITION = PC_BARREL_KAJMA_CONDITION;
    INFORMATION = PC_BARREL_KAJMA_END_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func void PC_BARREL_KAJMA_END_INFO() {
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[4] = FALSE;
    PLAYER_MOBSI_PRODUCTION = MOBSI_NONE;
}

instance PC_BARREL_KAJMA(C_INFO) {
    NPC = 0xc3ab;
    CONDITION = PC_BARREL_KAJMA_CONDITION;
    INFORMATION = PC_BARREL_KAJMA_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = DIALOG_DRAWCHALLENGE;
}

func void PC_BARREL_KAJMA_INFO() {
    MOB_CHANGEFOCUSNAME("KAJMA_BARREL", "MOBNAME_NOTHING");
    NS72_BARRELOFFORTUNECANYOU = 1;
    AI_FUNCTION(SELF, 0xbf8c);
    AI_PLAYANI(SELF, "R_BARRELCONTAINER_KAJMA");
    AI_OUTPUT(HERO, HERO, "DIA_MARVIN_KAJMA_15_01");
    PC_BARREL_KAJMA_END_INFO();
    AI_FUNCTION(SELF, 0xbf8d);
}

func void KAJMABARREL_APPLYMDS() {
    MDL_APPLYOVERLAYMDS(HERO, "HumanS_BarrelKajma.MDS");
    HERO.AIVAR[4] = FALSE;
}

func void KAJMABARREL_REMOVEMDS() {
    MDL_REMOVEOVERLAYMDS(HERO, "HumanS_BarrelKajma.MDS");
    HERO.AIVAR[4] = FALSE;
}

