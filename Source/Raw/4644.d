instance SQ503_FINALHAVENFIGHT(CUTSCENE) {
    ONSTART = FUNCTION(0x16b54);
}

func void SQ503_FINALHAVENFIGHT_START() {
    MUSIC_OVERRIDETRACK(0x55bb);
    WLD_SENDTRIGGER("SQ503_FINALFIGHT_01");
    TELEPORTNPCTOWP(0xe535, PIR_1306_RODRIGO.WP);
    TELEPORTNPCTOWP(0xe54f, PIR_1308_SIMON.WP);
    TELEPORTNPCTOWP(0xe577, PIR_1311_THIAGO.WP);
    TELEPORTNPCTOWP(0xe590, PIR_1313_GETTER.WP);
    TELEPORTNPCTOWP(0xe521, PIR_1304_IVAN.WP);
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_SQ503_HERO");
    PIR_1306_RODRIGO.FLAGS = 2;
    PIR_1308_SIMON.FLAGS = 2;
    PIR_1311_THIAGO.FLAGS = 2;
    PIR_1313_GETTER.FLAGS = 2;
    PIR_1304_IVAN.FLAGS = 2;
    B_TURNTONPC(PIR_1306_RODRIGO, HERO);
    B_TURNTONPC(PIR_1308_SIMON, HERO);
    B_TURNTONPC(PIR_1311_THIAGO, HERO);
    B_TURNTONPC(PIR_1313_GETTER, HERO);
    B_TURNTONPC(PIR_1304_IVAN, HERO);
    AI_WAIT(PIR_1306_RODRIGO, 0x3dcccccd);
    AI_WAIT(PIR_1308_SIMON, 0x3e4ccccd);
    AI_WAIT(PIR_1311_THIAGO, 0x3e99999a);
    AI_WAIT(PIR_1313_GETTER, 0x3e4ccccd);
    AI_WAIT(PIR_1304_IVAN, 0x3e99999a);
    FF_APPLYONCEEXT(0x16b55, 1000, 10);
}

func void SQ503_FINALHAVENFIGHT_START_APPLY() {
    SQ503_FINALHAVENFIGHT_START_COUNT = (SQ503_FINALHAVENFIGHT_START_COUNT) + (1);
    if ((SQ503_FINALHAVENFIGHT_START_COUNT) == (1)) {
        AI_DRAWWEAPON(PIR_1306_RODRIGO);
        AI_DRAWWEAPON(PIR_1308_SIMON);
        AI_DRAWWEAPON(PIR_1311_THIAGO);
        AI_DRAWWEAPON(PIR_1313_GETTER);
        AI_DRAWWEAPON(PIR_1304_IVAN);
        AI_WAIT(PIR_1306_RODRIGO, 0x3dcccccd);
        AI_WAIT(PIR_1308_SIMON, 0x3e4ccccd);
        AI_WAIT(PIR_1311_THIAGO, 0x3e99999a);
        AI_WAIT(PIR_1313_GETTER, 0x3e4ccccd);
        AI_WAIT(PIR_1304_IVAN, 0x3e99999a);
        AI_PLAYANI(PIR_1306_RODRIGO, "T_CUTSCENEJUMP_START");
        AI_PLAYANI(PIR_1308_SIMON, "T_CUTSCENEJUMP_START");
        AI_PLAYANI(PIR_1311_THIAGO, "T_CUTSCENEJUMP_START");
        AI_PLAYANI(PIR_1313_GETTER, "T_CUTSCENEJUMP_START");
        AI_PLAYANI(PIR_1304_IVAN, "T_CUTSCENEJUMP_START");
    };
    if ((SQ503_FINALHAVENFIGHT_START_COUNT) == (3)) {
        WLD_SENDTRIGGER("SQ503_FINALFIGHT_02");
        WLD_SENDUNTRIGGER("SQ503_FINALFIGHT_01");
        AI_WAIT(HERO, 0x3f19999a);
        AI_FUNCTION(HERO, 0x16b57);
    };
}

var int SQ503_FINALHAVENFIGHT_START_APPLY.SQ503_FINALHAVENFIGHT_START_COUNT = 0;
func void SQ503_FINALHAVENFIGHT_END() {
    FF_APPLYONCEEXT(0xf9a8, 75, 4);
}

