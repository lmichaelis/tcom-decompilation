instance SQ313_HUUGENDING(CUTSCENE) {
    ONSTART = FUNCTION(0x16b13);
}

func void SQ313_HUUGENDING_WAIT() {
    AI_WAITTILLEND(HERO, KDF_6404_TRIMEGISTO);
    AI_WAITTILLEND(HERO, NONE_1004_HUUG);
    AI_WAITTILLEND(HERO, PAL_101_SILVESTR);
    AI_WAITTILLEND(KDF_6404_TRIMEGISTO, HERO);
    AI_WAITTILLEND(KDF_6404_TRIMEGISTO, NONE_1004_HUUG);
    AI_WAITTILLEND(KDF_6404_TRIMEGISTO, PAL_101_SILVESTR);
    AI_WAITTILLEND(NONE_1004_HUUG, HERO);
    AI_WAITTILLEND(NONE_1004_HUUG, PAL_101_SILVESTR);
    AI_WAITTILLEND(NONE_1004_HUUG, KDF_6404_TRIMEGISTO);
    AI_WAITTILLEND(PAL_101_SILVESTR, HERO);
    AI_WAITTILLEND(PAL_101_SILVESTR, KDF_6404_TRIMEGISTO);
    AI_WAITTILLEND(PAL_101_SILVESTR, NONE_1004_HUUG);
}

func void SQ313_HUUGENDING_START() {
    MUSIC_OVERRIDETRACK(0x55be);
    WLD_SENDTRIGGER("SQ313_JUDGE_01");
    TELEPORTNPCTOWP(0x71b, "PARTM1_SQ313_VICTIM_02");
    TELEPORTNPCTOWP(0xcae7, KDF_6404_TRIMEGISTO.WP);
    TELEPORTNPCTOWP(0xd87e, KDF_9004_TENGRAL.WP);
    TELEPORTNPCTOWP(0xca55, KDF_11261_FIREMAGE.WP);
    TELEPORTNPCTOWP(0xd88b, PAL_101_SILVESTR.WP);
    TELEPORTNPCTOWP(0xd701, NONE_1004_HUUG.WP);
    NPC_CLEARAIQUEUE(KDF_6404_TRIMEGISTO);
    NPC_CLEARAIQUEUE(NONE_1004_HUUG);
    NPC_CLEARAIQUEUE(PAL_101_SILVESTR);
    KDF_6404_TRIMEGISTO.AIVAR[92] = TRUE;
    NONE_1004_HUUG.AIVAR[92] = TRUE;
    B_TURNTONPC(KDF_6404_TRIMEGISTO, NONE_1004_HUUG);
    B_TURNTONPC(KDF_9004_TENGRAL, NONE_1004_HUUG);
    B_TURNTONPC(KDF_11261_FIREMAGE, NONE_1004_HUUG);
    B_TURNTONPC(NONE_1004_HUUG, KDF_6404_TRIMEGISTO);
    B_TURNTONPC(PAL_101_SILVESTR, KDF_6404_TRIMEGISTO);
    B_TURNTONPC(HERO, KDF_6404_TRIMEGISTO);
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_01");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b16);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_02");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(NONE_1004_HUUG, HERO, "DIA_Huug_SQ313_Cutscene_03_03");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_04");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b17);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_05");
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_06");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b18);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_07");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_08");
    AI_WAIT(PAL_101_SILVESTR, 0x3ecccccd);
    AI_SETWALKMODE(PAL_101_SILVESTR, NPC_RUN);
    AI_PLAYANI(PAL_101_SILVESTR, T_YES);
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b19);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_09");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(NONE_1004_HUUG, HERO, "DIA_Huug_SQ313_Cutscene_03_10");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_11");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(NONE_1004_HUUG, HERO, "DIA_Huug_SQ313_Cutscene_03_12");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b1a);
    AI_OUTPUT(NONE_1004_HUUG, HERO, "DIA_Huug_SQ313_Cutscene_03_13");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_14");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(NONE_1004_HUUG, HERO, "DIA_Huug_SQ313_Cutscene_03_15");
    SQ313_HUUGENDING_WAIT();
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_16");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b1b);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_17");
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_18");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(KDF_6404_TRIMEGISTO, 0x16b1c);
    AI_TURNTONPC(KDF_6404_TRIMEGISTO, HERO);
    AI_TURNTONPC(HERO, KDF_6404_TRIMEGISTO);
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_19");
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_20");
    AI_OUTPUT(KDF_6404_TRIMEGISTO, HERO, "DIA_Trimegisto_SQ313_Cutscene_03_21");
    SQ313_HUUGENDING_WAIT();
    AI_FUNCTION(HERO, 0x16b1d);
    AI_OUTPUT(HERO, HERO, "DIA_Marvin_SQ313_Cutscene_15_22");
    AI_FUNCTION(HERO, 0x16b14);
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_PLAYANI(SELF, "T_GREETNOV");
    };
}

func void SQ313_HUUGENDING_FADESCREEN() {
    FADESCREENTOBLACKF(1, 0x16b15, 1000);
}

func void SQ313_HUUGENDING_END() {
    MUSIC_DISABLEOVERRIDE();
    WLD_SENDUNTRIGGER("SQ313_JUDGE_01");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_02");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_03");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_04");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_05");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_06");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_07");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_08");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_09");
    B_LOGENTRY(TOPIC_SQ313, LOG_SQ313_HUUG_ENDING_V1);
    SQ313_FINISHQUEST();
    B_STARTOTHERROUTINE(KDF_6404_TRIMEGISTO, START);
    NPC_REFRESH(KDF_6404_TRIMEGISTO);
    if (((SQ309_CHAIRWORKINNOS_DONE) == (5)) && ((LOG_GETSTATUS(MIS_SQ309)) == (LOG_RUNNING))) {
        B_STARTOTHERROUTINE(KDF_9004_TENGRAL, "SQ309");
    };
    B_STARTOTHERROUTINE(KDF_9004_TENGRAL, START);
    NPC_REFRESH(KDF_9004_TENGRAL);
    B_STARTOTHERROUTINE(KDF_11261_FIREMAGE, START);
    NPC_REFRESH(KDF_11261_FIREMAGE);
    B_STARTOTHERROUTINE(PAL_101_SILVESTR, START);
    NPC_REFRESH(PAL_101_SILVESTR);
    B_STARTOTHERROUTINE(NONE_1004_HUUG, "PRISON");
    NPC_REFRESH(NONE_1004_HUUG);
    KDF_6404_TRIMEGISTO.AIVAR[92] = FALSE;
    NONE_1004_HUUG.AIVAR[92] = FALSE;
    B_PASSTIME(2);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(1);
}

func void SQ313_HUUGENDING_CAMERA_01() {
    WLD_SENDTRIGGER("SQ313_JUDGE_02");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_01");
}

func void SQ313_HUUGENDING_CAMERA_02() {
    WLD_SENDTRIGGER("SQ313_JUDGE_03");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_02");
}

func void SQ313_HUUGENDING_CAMERA_03() {
    WLD_SENDTRIGGER("SQ313_JUDGE_04");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_03");
}

func void SQ313_HUUGENDING_CAMERA_04() {
    WLD_SENDTRIGGER("SQ313_JUDGE_05");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_04");
}

func void SQ313_HUUGENDING_CAMERA_05() {
    WLD_SENDTRIGGER("SQ313_JUDGE_06");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_05");
}

func void SQ313_HUUGENDING_CAMERA_06() {
    WLD_SENDTRIGGER("SQ313_JUDGE_07");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_06");
}

func void SQ313_HUUGENDING_CAMERA_07() {
    WLD_SENDTRIGGER("SQ313_JUDGE_08");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_07");
}

func void SQ313_HUUGENDING_CAMERA_08() {
    WLD_SENDTRIGGER("SQ313_JUDGE_09");
    WLD_SENDUNTRIGGER("SQ313_JUDGE_08");
}

