instance Q308_FINALEXECUTION(CUTSCENE) {
    ONSTART = FUNCTION(0x1697a);
}

func void Q308_FINALEXECUTION_WAIT() {
    AI_WAITTILLEND(HERO, VLK_6457_ANGRYMOB);
    AI_WAITTILLEND(HERO, VLK_6388_MORRIS);
    AI_WAITTILLEND(HERO, VLK_6504_EXECUTIONER);
    AI_WAITTILLEND(VLK_6388_MORRIS, HERO);
    AI_WAITTILLEND(VLK_6388_MORRIS, VLK_6457_ANGRYMOB);
    AI_WAITTILLEND(VLK_6388_MORRIS, VLK_6504_EXECUTIONER);
    AI_WAITTILLEND(VLK_6457_ANGRYMOB, HERO);
    AI_WAITTILLEND(VLK_6457_ANGRYMOB, VLK_6388_MORRIS);
    AI_WAITTILLEND(VLK_6457_ANGRYMOB, VLK_6504_EXECUTIONER);
    AI_WAITTILLEND(VLK_6504_EXECUTIONER, HERO);
    AI_WAITTILLEND(VLK_6504_EXECUTIONER, VLK_6388_MORRIS);
    AI_WAITTILLEND(VLK_6504_EXECUTIONER, VLK_6457_ANGRYMOB);
}

func void Q308_FINALEXECUTION_START() {
    MUSIC_OVERRIDETRACK(0x55be);
    WLD_SENDTRIGGER("KM_EXECUTION_01");
    TELEPORTNPCTOWP(0x71b, "PARTM5_ANGRYMOB_HERO");
    TELEPORTNPCTOWP(0xe4af, "PARTM5_ANGRYMOB_IVY");
    TELEPORTNPCTOWP(0xd22c, "PARTM5_ANGRYMOB_MORRIS");
    TELEPORTNPCTOWP(0xd138, "PARTM5_ANGRYMOB_EXECUTIONER");
    TELEPORTNPCTOWP(0xd23d, VLK_6454_DANIS.WP);
    NPC_CLEARAIQUEUE(VLK_6454_DANIS);
    AI_TURNTONPC(VLK_6454_DANIS, NONE_16_IVY);
    TELEPORTNPCTOWP(0xce47, MIL_4000_RODERICH.WP);
    NPC_CLEARAIQUEUE(MIL_4000_RODERICH);
    AI_TURNTONPC(MIL_4000_RODERICH, NONE_16_IVY);
    TELEPORTNPCTOWP(0xcb64, SLD_5000_LORENZO.WP);
    NPC_CLEARAIQUEUE(SLD_5000_LORENZO);
    AI_TURNTONPC(SLD_5000_LORENZO, NONE_16_IVY);
    VLK_6388_MORRIS.AIVAR[92] = TRUE;
    B_TURNTONPC(VLK_6388_MORRIS, NONE_16_IVY);
    B_TURNTONPC(NONE_16_IVY, VLK_6504_EXECUTIONER);
    B_TURNTONPC(HERO, VLK_6388_MORRIS);
    if ((Q308_WHOWILLDIE) == (1)) {
        AI_TURNTONPC(OUT_6403_ARS, HERO);
    };
    if ((Q308_WHOWILLDIE) == (2)) {
        AI_TURNTONPC(STRF_6405_OSIP, HERO);
    };
    if ((Q308_WHOWILLDIE) == (3)) {
        AI_TURNTONPC(VLK_6424_LUDLOF, HERO);
        AI_USEMOB(VLK_6424_LUDLOF, "EXECUTIONKNEEL", 1);
    };
    Q308_FINALEXECUTION_WAIT();
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_01");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_02");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x1697c);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_03");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_04");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_05");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x1697d);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_06");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x1697e);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_07");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x1697f);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_08");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_09");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_10");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16980);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_11");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16981);
    AI_TURNTONPC(VLK_6388_MORRIS, VLK_6504_EXECUTIONER);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_12");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_13");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16982);
    AI_WAIT(HERO, 0x40600000);
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16983);
    AI_WAIT(HERO, 0x40600000);
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16984);
    if ((Q308_WHOWILLDIE) == (1)) {
        AI_TURNTONPC(VLK_6504_EXECUTIONER, OUT_6403_ARS);
    };
    if ((Q308_WHOWILLDIE) == (2)) {
        AI_TURNTONPC(VLK_6504_EXECUTIONER, STRF_6405_OSIP);
    };
    if ((Q308_WHOWILLDIE) == (3)) {
        AI_TURNTONPC(VLK_6504_EXECUTIONER, VLK_6424_LUDLOF);
    };
    AI_USEMOB(VLK_6504_EXECUTIONER, "EXECUTION", 1);
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16985);
    AI_WAIT(HERO, 0x40800000);
    AI_TURNTONPC(VLK_6388_MORRIS, NONE_16_IVY);
    if ((Q308_WHOWILLDIE) == (1)) {
        AI_USEITEMTOSTATE(VLK_6457_ANGRYMOB, 0x8caf, 1);
    };
    if ((Q308_WHOWILLDIE) == (2)) {
        AI_USEITEMTOSTATE(VLK_6457_ANGRYMOB, 0x8cb0, 1);
    };
    if ((Q308_WHOWILLDIE) == (3)) {
        AI_USEITEMTOSTATE(VLK_6457_ANGRYMOB, 0x8cb1, 1);
    };
    AI_USEMOB(VLK_6504_EXECUTIONER, "EXECUTION", -(1));
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16986);
    AI_WAIT(HERO, 0x3f000000);
    Q308_EXECUTIONCUTSCENE_MOBTURN();
    Q308_FINALEXECUTION_WAIT();
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_14");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_15");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16987);
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_16");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_17");
    AI_OUTPUT(VLK_6388_MORRIS, HERO, "DIA_MORRIS_EXECUTION_03_18");
    Q308_FINALEXECUTION_WAIT();
    AI_FUNCTION(HERO, 0x16988);
}

func void Q308_REMOVECITIZENS() {
    Q308_CIVILIANRETURNRTN();
}

func void Q308_EXECUTIONCUTSCENE_01() {
    WLD_SENDTRIGGER("KM_EXECUTION_02");
    WLD_SENDUNTRIGGER("KM_EXECUTION_01");
}

func void Q308_EXECUTIONCUTSCENE_02() {
    TELEPORTNPCTOWP(0xd243, "PARTM5_ANGRYMOB_GOLAR");
    TELEPORTNPCTOWP(0xce47, "PARTM5_ANGRYMOB_RODERICH");
    TELEPORTNPCTOWP(0xcb64, "PARTM5_ANGRYMOB_LORENZO");
    TELEPORTNPCTOWP(0xd23d, "PARTM5_ANGRYMOB_DANIS");
    WLD_SENDTRIGGER("KM_EXECUTION_04");
    WLD_SENDUNTRIGGER("KM_EXECUTION_02");
}

func void Q308_EXECUTIONCUTSCENE_03() {
    WLD_SENDTRIGGER("KM_EXECUTION_05");
    WLD_SENDUNTRIGGER("KM_EXECUTION_04");
}

func void Q308_EXECUTIONCUTSCENE_04() {
    WLD_SENDTRIGGER("KM_EXECUTION_06");
    WLD_SENDUNTRIGGER("KM_EXECUTION_05");
}

func void Q308_EXECUTIONCUTSCENE_05() {
    WLD_SENDTRIGGER("KM_EXECUTION_03");
    WLD_SENDUNTRIGGER("KM_EXECUTION_06");
}

func void Q308_EXECUTIONCUTSCENE_06() {
    WLD_SENDTRIGGER("KM_EXECUTION_07");
    WLD_SENDUNTRIGGER("KM_EXECUTION_03");
}

func void Q308_EXECUTIONCUTSCENE_07() {
    WLD_SENDTRIGGER("KM_EXECUTION_08");
    WLD_SENDUNTRIGGER("KM_EXECUTION_07");
}

func void Q308_EXECUTIONCUTSCENE_08() {
    WLD_SENDTRIGGER("KM_EXECUTION_09");
    WLD_SENDUNTRIGGER("KM_EXECUTION_08");
}

func void Q308_EXECUTIONCUTSCENE_09() {
    WLD_SENDTRIGGER("KM_EXECUTION_10");
    WLD_SENDUNTRIGGER("KM_EXECUTION_09");
}

func void Q308_EXECUTIONCUTSCENE_10() {
    WLD_SENDTRIGGER("KM_EXECUTION_11");
    WLD_SENDUNTRIGGER("KM_EXECUTION_10");
    Q308_ANGRYMOBCHANGERTN();
    if ((Q308_WHOWILLDIE) == (1)) {
        NPC_CLEARAIQUEUE(OUT_6403_ARS);
        AI_USEMOB(OUT_6403_ARS, "EXECUTION", -(1));
        B_REMOVENPC(0xcf1b);
        TELEPORTNPCTOWP(0xcf1b, TOT);
        PRINTD("Ars polecia³ w kosmos");
    };
    if ((Q308_WHOWILLDIE) == (2)) {
        NPC_CLEARAIQUEUE(STRF_6405_OSIP);
        AI_USEMOB(STRF_6405_OSIP, "EXECUTION", -(1));
        B_REMOVENPC(0xcf1f);
        TELEPORTNPCTOWP(0xcf1f, TOT);
        PRINTD("Osip polecia³ w kosmos");
    };
    if ((Q308_WHOWILLDIE) == (3)) {
        NPC_CLEARAIQUEUE(VLK_6424_LUDLOF);
        AI_USEMOB(VLK_6424_LUDLOF, "EXECUTION", -(1));
        B_REMOVENPC(0xd537);
        TELEPORTNPCTOWP(0xd537, TOT);
        PRINTD("Ludlof polecia³ w kosmos");
    };
}

func void Q308_EXECUTIONCUTSCENE_11() {
    WLD_SENDTRIGGER("KM_EXECUTION_12");
    WLD_SENDUNTRIGGER("KM_EXECUTION_11");
}

func void Q308_EXECUTIONCUTSCENE_12() {
    WLD_SENDTRIGGER("KM_EXECUTION_13");
    WLD_SENDUNTRIGGER("KM_EXECUTION_12");
}

func void Q308_EXECUTIONCUTSCENE_END() {
    FADESCREENTOBLACKF(1, 0x1698b, 1000);
}

func void Q308_EXECUTIONCUTSCENE_APPLY() {
    Q308_EXECUTIONCUTSCENE_COUNT = (Q308_EXECUTIONCUTSCENE_COUNT) + (1);
    if ((Q308_EXECUTIONCUTSCENE_COUNT) == (1)) {
        Q308_BRINGBACKCITIZENSOLDCITY();
    };
    if ((Q308_EXECUTIONCUTSCENE_COUNT) == (3)) {
        Q308_REMOVEEVENTS();
    };
    if ((Q308_EXECUTIONCUTSCENE_COUNT) == (5)) {
        Q308_REMOVEANGRYMOB();
    };
}

var int Q308_EXECUTIONCUTSCENE_APPLY.Q308_EXECUTIONCUTSCENE_COUNT = 0;
func void Q308_EXECUTIONCUTSCENE_END_FADESCREEN() {
    MUSIC_DISABLEOVERRIDE();
    FF_APPLYONCEEXT(0x16989, 1000, 5);
    WLD_SENDTRIGGER("KM_EXECUTION_14");
    WLD_SENDUNTRIGGER("KM_EXECUTION_13");
    WLD_SENDTRIGGER("KM_EXECUTIONKNEEL_MOVER");
    VLK_6388_MORRIS.AIVAR[92] = FALSE;
    TELEPORTNPCTOWP(0x71b, "PARTM5_ANGRYMOB_HERO_02");
    TELEPORTNPCTOWP(0xe4af, "PARTM5_ANGRYMOB_IVY_02");
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_SETWALKMODE(NONE_16_IVY, NPC_WALK);
    AI_TURNTONPC(HERO, NONE_16_IVY);
    AI_TURNAWAY(NONE_16_IVY, HERO);
    AI_GOTOWP(HERO, "PARTM5_PATH_46");
    AI_GOTOWP(NONE_16_IVY, "PARTM5_PATH_08");
    AI_TURNTONPC(NONE_16_IVY, HERO);
    AI_FUNCTION(NONE_16_IVY, 0x1698c);
    AI_STARTSTATE(NONE_16_IVY, 0xf09f, 1, "");
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(2);
}

func void Q308_EXECUTIONCUTSCENE_END_UNLOCKHERO() {
    DIACAM_DISABLE();
    Q308_FINALCUTSCENE = 3;
    HERO.AIVAR[4] = FALSE;
}

