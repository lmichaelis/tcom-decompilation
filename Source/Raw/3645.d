instance DIA_HUXLAY_EXIT(C_INFO) {
    NPC = 0xd1d7;
    NR = 999;
    CONDITION = DIA_HUXLAY_EXIT_CONDITION;
    INFORMATION = DIA_HUXLAY_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_HUXLAY_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_HUXLAY_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_HUXLAY_KQ404_GRAYSON(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_GRAYSON_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_GRAYSON_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Grayson said you were the man for difficult cases.";
}

func int DIA_HUXLAY_KQ404_GRAYSON_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x10b9c))) && (NPC_KNOWSINFO(OTHER, 0x100f7))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_GRAYSON_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Grayson_15_01");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Grayson_03_02");
    if ((KQ404_INEXTREMO_BAITED) == (FALSE)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Grayson_03_03");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Grayson_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Grayson_03_05");
}

instance DIA_HUXLAY_KQ404_HELP(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_HELP_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_HELP_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Apparently you have your own ways of getting what Grayson wants. You know the case?";
}

func int DIA_HUXLAY_KQ404_HELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x100c0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_HELP_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Help_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Help_03_02");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Help_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Help_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Help_03_05");
}

instance DIA_HUXLAY_KQ404_WHATDO(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_WHATDO_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_WHATDO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "If you put it that way... What do I do?";
}

func int DIA_HUXLAY_KQ404_WHATDO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x100c3))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_WHATDO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_15_01");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_03_02");
    AI_STARTFACEANI(OTHER, S_SURPRISE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_03_04");
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(0x100c6);
    INFO_ADDCHOICE(0x100c6, "I don't think he'll be happy.", 0x100ca);
    INFO_ADDCHOICE(0x100c6, "You're in charge.", 0x100cb);
}

func void DIA_HUXLAY_KQ404_WHATDO_NEXT() {
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_Next_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_Next_15_02");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_Next_03_03");
    INFO_CLEARCHOICES(0x100c6);
    AI_LOGENTRY(TOPIC_KQ404, LOG_KQ404_HUXLAY_NEXTMOVE);
    NPC_EXCHANGEROUTINE(SELF, "KQ404_WAIT");
}

func void DIA_HUXLAY_KQ404_WHATDO_NO() {
    AI_STARTFACEANI(OTHER, S_DOUBT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_No_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_No_03_02");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_No_15_03");
    DIA_HUXLAY_KQ404_WHATDO_NEXT();
}

func void DIA_HUXLAY_KQ404_WHATDO_YES() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_WhatDo_Yes_15_01");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_WhatDo_Yes_03_02");
    AI_RESETFACEANI(OTHER);
    DIA_HUXLAY_KQ404_WHATDO_NEXT();
}

instance DIA_HUXLAY_KQ404_FINALLY(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_FINALLY_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_FINALLY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_FINALLY_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x11103))) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_FINALLY_INFO() {
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Finally_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_03_03");
    INFO_CLEARCHOICES(0x100cc);
    INFO_ADDCHOICE(0x100cc, "Who are we having fun with?", 0x100cf);
}

func void DIA_HUXLAY_KQ404_FINALLY_WHO() {
    AI_STOPLOOKAT(SELF);
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Finally_Who_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_Who_03_02");
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_Who_03_03");
    AI_WAIT(SELF, 0x3f4ccccd);
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_Who_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finally_Who_03_05");
    CREATEINVITEMS(SELF, 0x84be, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x84be, 1);
    INFO_CLEARCHOICES(0x100cc);
    AI_STOPPROCESSINFOS(SELF);
    NONE_1396_INEXTREMO_FLEX_SACK.AIVAR[4] = FALSE;
}

instance DIA_HUXLAY_KQ404_WHAT(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_WHAT_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_WHAT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_WHAT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x10bf1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_WHAT_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_What_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_What_03_02");
    AI_STOPPROCESSINFOS(SELF);
    AI_WAITTILLEND(OTHER, SELF);
    AI_FUNCTION(OTHER, 0x100d3);
}

func void DIA_HUXLAY_KQ404_STARTCUTSCENE() {
    HERO.AIVAR[4] = FALSE;
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KQ404_HUXLAYCUTSCENE_01");
    TELEPORTNPCTOWP(0x71b, "HARBOUR_DARKSECRETS_45");
    TELEPORTNPCTOWP(0xd1d7, MIL_13382_HUXLAY.WP);
    TELEPORTNPCTOWP(0xd4c8, NONE_1396_INEXTREMO_FLEX_SACK.WP);
}

instance DIA_HUXLAY_KQ404_BEATHIM(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_BEATHIM_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_BEATHIM_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_BEATHIM_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x100d0))) {
        if (((NPC_GETDISTTOWP(MIL_13382_HUXLAY, "HARBOUR_DARKSECRETS_HUXLAY")) <= (500)) && ((NPC_GETDISTTOWP(NONE_1396_INEXTREMO_FLEX_SACK, "HARBOUR_DARKSECRETS_FLEX")) <= (500))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_BEATHIM_INFO() {
    TRIA_INVITE(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_STARTEXT(FALSE);
    AI_REMOVEWEAPON(OTHER);
    AI_LOOKATNPC(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    B_TURNTONPC(MIL_13382_HUXLAY, NONE_1396_INEXTREMO_FLEX_SACK);
    B_TURNTONPC(HERO, NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_TURNTONPC(SELF, OTHER);
    AI_FUNCTION(SELF, 0xf198);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_03_02");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_03_03");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_FUNCTION(SELF, 0xf199);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_03_04");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_03_05");
    INFO_CLEARCHOICES(0x100d4);
    INFO_ADDCHOICE(0x100d4, "With pleasure!", 0x100d8);
    INFO_ADDCHOICE(0x100d4, "It's enough that I have to look at it", 0x100d7);
}

func void DIA_HUXLAY_KQ404_BEATHIM_NO() {
    AI_STARTFACEANI(OTHER, S_DISGUST, 0, 1);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_BeatHim_No_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_No_03_02");
    AI_TURNTONPC(OTHER, SELF);
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_BeatHim_No_15_03");
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_WAIT(OTHER, 0x3ecccccd);
    AI_TURNTONPC(OTHER, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_BeatHim_No_03_04");
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100d4);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf194);
    KQ404_TORTURE_FLEXSTATS();
}

func void DIA_HUXLAY_KQ404_BEATHIM_YES() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_BeatHim_Yes_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100d4);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf195);
    KQ404_TORTURE_FLEXSTATS();
}

instance DIA_HUXLAY_KQ404_AFTERBEATUP(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_AFTERBEATUP_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_AFTERBEATUP_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_AFTERBEATUP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && ((KQ404_FLEXATTACK) == (2))) {
        if ((NPC_ISINSTATE(NONE_1396_INEXTREMO_FLEX_SACK, 0xf0a3)) == (FALSE)) {
            if (((NPC_GETDISTTOWP(MIL_13382_HUXLAY, "HARBOUR_DARKSECRETS_HUXLAY")) <= (500)) && ((NPC_GETDISTTOWP(NONE_1396_INEXTREMO_FLEX_SACK, "HARBOUR_DARKSECRETS_FLEX")) <= (500))) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_AFTERBEATUP_INFO() {
    NONE_1396_INEXTREMO_FLEX.AIVAR[15] = TRUE;
    TRIA_INVITE(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_STARTEXT(FALSE);
    AI_REMOVEWEAPON(OTHER);
    AI_LOOKATNPC(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    B_TURNTONPC(MIL_13382_HUXLAY, NONE_1396_INEXTREMO_FLEX_SACK);
    B_TURNTONPC(NONE_1396_INEXTREMO_FLEX_SACK, HERO);
    B_TURNTONPC(HERO, NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_TURNTONPC(NONE_1396_INEXTREMO_FLEX_SACK, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_FUNCTION(SELF, 0xf19a);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_02");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_04");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_FUNCTION(SELF, 0xf19b);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_05");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_06");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_07");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf19c);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_08");
    AI_WAITTILLEND(OTHER, SELF);
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_03_09");
    INFO_CLEARCHOICES(0x100d9);
    INFO_ADDCHOICE(0x100d9, "If I have to...", 0x100dd);
    INFO_ADDCHOICE(0x100d9, DIALOG_DONOTTALK, 0x100dc);
}

func void DIA_HUXLAY_KQ404_AFTERBEATUP_NO() {
    AI_WAIT(SELF, 0x3f4ccccd);
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_AfterBeatUp_No_03_01");
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100d9);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf194);
    KQ404_TORTURE_FLEXSTATS();
}

func void DIA_HUXLAY_KQ404_AFTERBEATUP_YES() {
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_AfterBeatUp_Yes_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100d9);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf195);
    KQ404_TORTURE_FLEXSTATS();
}

instance DIA_HUXLAY_KQ404_HAVEMERCY(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_HAVEMERCY_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_HAVEMERCY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_HAVEMERCY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && ((KQ404_FLEXATTACK) == (2))) {
        if (NPC_KNOWSINFO(OTHER, 0x100d9)) {
            if ((NPC_ISINSTATE(NONE_1396_INEXTREMO_FLEX_SACK, 0xf0a3)) == (FALSE)) {
                if (((NPC_GETDISTTOWP(MIL_13382_HUXLAY, "HARBOUR_DARKSECRETS_HUXLAY")) <= (500)) && ((NPC_GETDISTTOWP(NONE_1396_INEXTREMO_FLEX_SACK, "HARBOUR_DARKSECRETS_FLEX")) <= (500))) {
                    return TRUE;
                };
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_HAVEMERCY_INFO() {
    TRIA_INVITE(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_STARTEXT(FALSE);
    AI_REMOVEWEAPON(OTHER);
    AI_LOOKATNPC(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    B_TURNTONPC(MIL_13382_HUXLAY, NONE_1396_INEXTREMO_FLEX_SACK);
    B_TURNTONPC(NONE_1396_INEXTREMO_FLEX_SACK, HERO);
    B_TURNTONPC(HERO, NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_01");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf19d);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_03");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_04");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf19e);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_05");
    AI_SETWALKMODE(SELF, NPC_WALK);
    AI_GOTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    B_USEFAKECHECKSWD_STEEL();
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_06");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_07");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf19f);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_03_08");
    INFO_CLEARCHOICES(0x100de);
    INFO_ADDCHOICE(0x100de, DIALOG_INTERVENE, 0x100e1);
    INFO_ADDCHOICE(0x100de, DIALOG_DONOTTALK, 0x100e3);
}

func void DIA_HUXLAY_KQ404_HAVEMERCY_ACTION() {
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_HaveMercy_Action_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_TURNTONPC(SELF, OTHER);
    AI_FUNCTION(SELF, 0xf1a0);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Action_03_02");
    AI_FUNCTION(SELF, 0xf1a1);
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_HaveMercy_Action_15_03");
    AI_WAITTILLEND(SELF, OTHER);
    AI_FUNCTION(SELF, 0xf1a2);
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Action_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Action_03_05");
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100de);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf195);
    KQ404_TORTURE_FLEXSTATS_BLOCK();
}

func void DIA_HUXLAY_KQ404_FINISH() {
    MIL_13382_HUXLAY.AIVAR[15] = FALSE;
    KQ404_FINISHWAY = 2;
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf1a3);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_02");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf1a4);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_03");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_04");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_FUNCTION(SELF, 0xf1a5);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_05");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_06");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_TURNTONPC(SELF, OTHER);
    AI_TURNTONPC(OTHER, SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Finish_03_08");
    TRIA_FINISH();
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x100de);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0xf195);
    AI_LOGENTRY(TOPIC_KQ404, LOG_KQ404_HUXLAY_FINISH);
}

func void DIA_HUXLAY_KQ404_HAVEMERCY_NOTHING() {
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Nothing_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Nothing_03_02");
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_HaveMercy_Nothing_03_03");
    AI_SETWALKMODE(SELF, NPC_WALK);
    AI_GOTOWP(SELF, "HARBOUR_DARKSECRETS_HUXLAY");
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    DIA_HUXLAY_KQ404_FINISH();
}

instance DIA_HUXLAY_KQ404_RESULT(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ404_RESULT_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ404_RESULT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ404_RESULT_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_KQ404)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x10bf4))) && ((KQ404_FINISHWAY) == (0))) {
        if (((NPC_GETDISTTOWP(MIL_13382_HUXLAY, "HARBOUR_DARKSECRETS_HUXLAY")) <= (500)) && ((NPC_GETDISTTOWP(NONE_1396_INEXTREMO_FLEX_SACK, "HARBOUR_DARKSECRETS_FLEX")) <= (500))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ404_RESULT_INFO() {
    TRIA_INVITE(NONE_1396_INEXTREMO_FLEX_SACK);
    TRIA_STARTEXT(FALSE);
    AI_REMOVEWEAPON(OTHER);
    AI_LOOKATNPC(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    B_TURNTONPC(MIL_13382_HUXLAY, HERO);
    B_TURNTONPC(NONE_1396_INEXTREMO_FLEX_SACK, HERO);
    B_TURNTONPC(HERO, MIL_13382_HUXLAY);
    TRIA_WAIT();
    TRIA_NEXT(MIL_13382_HUXLAY);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Result_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ404_Result_15_02");
    AI_TURNTONPC(SELF, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_TURNTONPC(NONE_1396_INEXTREMO_FLEX_SACK, SELF);
    AI_TURNTONPC(OTHER, NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Result_03_03");
    TRIA_WAIT();
    TRIA_NEXT(NONE_1396_INEXTREMO_FLEX_SACK);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ404_Result_03_04");
    TRIA_NEXT(MIL_13382_HUXLAY);
    DIA_HUXLAY_KQ404_FINISH();
}

instance DIA_HUXLAY_KQ406_HELLO(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ406_HELLO_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ406_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ406_HELLO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ406)) == (LOG_RUNNING)) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ406_HELLO_INFO() {
    if ((KQ404_FINISHWAY) == (2)) {
        AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
        AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Hello_15_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_03_02");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Hello_15_03");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_03_04");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_03_05");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_03_07");
    INFO_CLEARCHOICES(0x100e7);
    INFO_ADDCHOICE(0x100e7, "What makes you so sure?", 0x100ea);
}

func void DIA_HUXLAY_KQ406_HELLO_WHY() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Hello_Why_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_Why_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_Why_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_Why_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Hello_Why_15_05");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Hello_Why_03_06");
    AI_RESETFACEANI(SELF);
}

instance DIA_HUXLAY_KQ406_WHAT(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ406_WHAT_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ406_WHAT_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "So what do we do?";
}

func int DIA_HUXLAY_KQ406_WHAT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ406)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x100e7))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ406_WHAT_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_What_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_03");
    CREATEINVITEMS(SELF, 0x8af3, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x8af3, 1);
    AI_WAITTILLEND(OTHER, SELF);
    AI_EQUIPARMOR(OTHER, 0x8af3);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_06");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_What_15_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_What_03_09");
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_KQ406, LOG_KQ406_HUXLAY_PLAN);
    NPC_EXCHANGEROUTINE(SELF, TOT);
    CREATEINVITEMS(SELF, 0x923d, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x923d, 1);
}

instance DIA_HUXLAY_KQ406_HARBOUR(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ406_HARBOUR_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ406_HARBOUR_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Let's talk about the shipyard...";
}

func int DIA_HUXLAY_KQ406_HARBOUR_CONDITION() {
    if ((LOG_GETSTATUS(MIS_KQ406)) == (LOG_RUNNING)) {
        if ((NPC_KNOWSINFO(OTHER, 0x11e14)) || ((KQ406_FIGHTWITHWORKER) == (2))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ406_HARBOUR_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_03");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_06");
    AI_STARTFACEANI(SELF, S_NOPE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_07");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_08");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_09");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_10");
    AI_RESETFACEANI(SELF);
    if (NPC_KNOWSINFO(OTHER, 0x14d0f)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_11");
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_12");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_13");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_14");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Harbour_15_15");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_16");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Harbour_03_17");
    AI_LOGENTRY(TOPIC_KQ406, LOG_KQ406_HUXLAY_NEXTPLAN);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "KQ406_SMALLTALK");
    B_STARTOTHERROUTINE(NONE_11068_GRAYSON, "KQ407_SMALLTALK");
}

instance DIA_HUXLAY_KQ406_OKAY(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ406_OKAY_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ406_OKAY_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Are you all right?";
}

func int DIA_HUXLAY_KQ406_OKAY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_KQ406)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x10192))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ406_OKAY_INFO() {
    MIL_13382_HUXLAY.AIVAR[57] = FALSE;
    MIL_13382_HUXLAY.AIVAR[25] = FALSE;
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Okay_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Okay_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Okay_03_03");
    B_STANDUP();
    AI_PLAYANI(SELF, T_PLUNDER);
    CREATEINVITEMS(SELF, 0x8b1f, 1);
    AI_EQUIPARMOR(SELF, 0x8b1f);
    AI_PLAYANI(SELF, "T_LEGSHAKE");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Okay_03_04");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ406_Okay_15_05");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ406_Okay_03_06");
    KQ406_BLOCKHUXLAYDIALOGUES = FALSE;
    AI_LOGENTRY(TOPIC_KQ406, LOG_KQ406_HUXLAY_GRAYSON);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x87dd);
}

instance DIA_HUXLAY_KQ407_WAIT(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_KQ407_WAIT_CONDITION;
    INFORMATION = DIA_HUXLAY_KQ407_WAIT_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_HUXLAY_KQ407_WAIT_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_KQ407)) == (LOG_RUNNING)) && ((KQ407_FARMERSATMEDIC) == (TRUE))) && ((NPC_GETDISTTOWP(SELF, "HARBOUR_HOUSE01_KQ407_HUXLAY_WAIT")) <= (350))) && ((KQ407_GRAYSONPLANCUTSCENE) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_KQ407_WAIT_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ407_Wait_03_01");
    if ((KQ407_AFTERORCCUTSCENE) == (FALSE)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ407_Wait_15_02");
        AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ407_Wait_03_03");
        AI_RESETFACEANI(SELF);
        AI_TURNAWAY(OTHER, SELF);
        AI_SETWALKMODE(OTHER, NPC_RUN);
        AI_GOTOWP(OTHER, "HARBOUR_PATH_313");
    };
    KQ407_GRAYSONPLANCUTSCENE = 1;
    WLD_SENDTRIGGER("KQ407_MOVER_GRAYSONCUTSCENE");
    AI_OUTPUT(OTHER, SELF, "DIA_Huxlay_KQ407_Wait_15_04");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_KQ407_Wait_03_05");
    AI_RESETFACEANI(SELF);
    AI_LOGENTRY(TOPIC_KQ407, LOG_KQ407_HUXLAY_READY);
    NPC_EXCHANGEROUTINE(SELF, "KQ407_KALEB");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_HUXLAY_HELLO(C_INFO) {
    NPC = 0xd1d7;
    NR = 1;
    CONDITION = DIA_HUXLAY_HELLO_CONDITION;
    INFORMATION = DIA_HUXLAY_HELLO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What do you do?";
}

func int DIA_HUXLAY_HELLO_CONDITION() {
    if ((KQ406_BLOCKHUXLAYDIALOGUES) == (FALSE)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_HELLO_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhatIsYourJob");
    AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_Hello_03_01");
}

instance DIA_HUXLAY_AMBIENT(C_INFO) {
    NPC = 0xd1d7;
    NR = 998;
    CONDITION = DIA_HUXLAY_AMBIENT_CONDITION;
    INFORMATION = DIA_HUXLAY_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How are you doing?";
}

func int DIA_HUXLAY_AMBIENT_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x100f7)) && ((KQ406_BLOCKHUXLAYDIALOGUES) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_AMBIENT_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhatNew2");
    if ((LOG_GETSTATUS(MIS_KQ404)) != (LOG_SUCCESS)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_Ambient_03_01");
    };
    if (((LOG_GETSTATUS(MIS_KQ404)) == (LOG_SUCCESS)) && ((LOG_GETSTATUS(MIS_KQ407)) != (LOG_SUCCESS))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_Ambient_03_02");
    };
    if ((LOG_GETSTATUS(MIS_KQ407)) == (LOG_SUCCESS)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Huxlay_Ambient_03_03");
    };
}

instance DIA_HUXLAY_PICKPOCKET(C_INFO) {
    NPC = 0xd1d7;
    NR = 900;
    CONDITION = DIA_HUXLAY_PICKPOCKET_CONDITION;
    INFORMATION = DIA_HUXLAY_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_120;
}

func int DIA_HUXLAY_PICKPOCKET_CONDITION() {
    if ((((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) && ((KQ406_BLOCKHUXLAYDIALOGUES) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_HUXLAY_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x100fd);
    INFO_ADDCHOICE(0x100fd, DIALOG_BACK, 0x10101);
    INFO_ADDCHOICE(0x100fd, DIALOG_PICKPOCKET, 0x10100);
}

func void DIA_HUXLAY_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (3)) {
        B_PICKPOCKET_AMBIENT_TIER_3();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x100fd);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x100fd);
}

func void DIA_HUXLAY_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x100fd);
}

