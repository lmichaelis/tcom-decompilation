instance SQ213_SONGCUTSCENE(CUTSCENE) {
    ONSTART = FUNCTION(0x16adf);
}

func void SQ213_SONGCUTSCENE_START() {
    TELEPORTNPCTOWP(0xccc4, "PART9_CUTSCENE_LUTZ_01");
    TELEPORTNPCTOWP(0xe0c6, "PART9_CUTSCENE_MARTHA_01");
    if ((SQ213_KARINWILLSING) == (TRUE)) {
        TELEPORTNPCTOWP(0xda5f, NONE_6319_KARIN.WP);
    };
    TELEPORTNPCTOWP(0x71b, "PART9_CUTSCENE_HERO");
    FF_APPLYONCEEXT(0x16ae0, 1000, 72);
}

func void MIST_CUTSCENE_WITHOUTKARIN() {
    SQ213_CUTSCENECOUNT = (SQ213_CUTSCENECOUNT) + (1);
    PRINTD(INTTOSTRING(SQ213_CUTSCENECOUNT));
    if ((SQ213_CUTSCENECOUNT) == (1)) {
        FADESCREENFROMBLACK(3);
        WLD_SENDTRIGGER("KM_ORCHARD_01");
        AI_TURNTONPC(HERO, MIL_6318_LUTZ);
        NPC_CLEARAIQUEUE(MIL_6318_LUTZ);
        NPC_CLEARAIQUEUE(BAU_703_MARTHA);
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            NPC_CLEARAIQUEUE(NONE_6319_KARIN);
        };
        AI_TURNTONPC(MIL_6318_LUTZ, BAU_703_MARTHA);
        AI_GOTOWP(BAU_703_MARTHA, "PART9_CUTSCENE_MARTHA_01");
        AI_TURNTONPC(BAU_703_MARTHA, MIL_6318_LUTZ);
        MUSIC_OVERRIDETRACK(0x55b7);
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            AI_TURNTONPC(NONE_6319_KARIN, MIL_6318_LUTZ);
        };
        if ((SQ213_BASKETFOODRESULT) == (1)) {
            FF_APPLYONCEEXTGT(0xf452, 0, -(1));
        };
    };
    if ((SQ213_CUTSCENECOUNT) == (7)) {
        WLD_SENDTRIGGER("KM_ORCHARD_02");
        AI_PLAYANI(MIL_6318_LUTZ, "T_DIALOGGESTURE_03");
        AI_WAIT(BAU_703_MARTHA, 0x3fc00000);
        AI_PLAYANI(BAU_703_MARTHA, "T_FACEPALM");
        AI_WAIT(MIL_6318_LUTZ, 0x3ff33333);
        AI_PLAYANI(MIL_6318_LUTZ, "T_DIALOGGESTURE_01");
        CREATEINVITEMS(HERO, 0x858e, 1);
        AI_USEITEMTOSTATE(HERO, 0x858e, 1);
        AI_WAIT(HERO, 0x42880000);
        AI_USEITEMTOSTATE(HERO, 0x858e, -(1));
        MDL_STARTFACEANI(HERO, S_SMUG, 0x3f800000, -1082130432);
        AI_STARTFACEANI(NONE_6319_KARIN, "VISEME", 1, -(1));
        CHANGEVOBCOLLISION("KM_SQ213_BASKET", FALSE, FALSE, FALSE, TRUE);
    };
    if ((SQ213_CUTSCENECOUNT) == (14)) {
        WLD_SENDTRIGGER("KM_ORCHARD_03");
        AI_TURNAWAY(BAU_703_MARTHA, MIL_6318_LUTZ);
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            AI_PLAYANI(NONE_6319_KARIN, "T_DIALOGGESTURE_04");
        };
    };
    if ((SQ213_CUTSCENECOUNT) == (17)) {
        WLD_SENDTRIGGER("KM_ORCHARD_10");
        AI_PLAYANI(NONE_6319_KARIN, "T_DIALOGGESTURE_07");
    };
    if ((SQ213_CUTSCENECOUNT) == (18)) {
        TELEPORTNPCTOWP(0xe0c6, "PART9_ORCHARD_13");
    };
    if ((SQ213_CUTSCENECOUNT) == (19)) {
        NPC_CLEARAIQUEUE(BAU_703_MARTHA);
        TELEPORTNPCTOWP(0xe0c6, "PART9_CUTSCENE_LUTZ_02");
        AI_WAIT(BAU_703_MARTHA, 0x3f800000);
        CREATEINVITEMS(BAU_703_MARTHA, 0x8cdd, 1);
        AI_USEITEMTOSTATE(BAU_703_MARTHA, 0x8cdd, 1);
    };
    if ((SQ213_CUTSCENECOUNT) == (19)) {
        NPC_CLEARAIQUEUE(MIL_6318_LUTZ);
        TELEPORTNPCTOWP(0xccc4, "PART9_CUTSCENE_MARTHA_02");
        AI_WAIT(MIL_6318_LUTZ, 0x3f800000);
        CREATEINVITEMS(MIL_6318_LUTZ, 0x8cdd, 1);
        AI_USEITEMTOSTATE(MIL_6318_LUTZ, 0x8cdd, 1);
    };
    if ((SQ213_CUTSCENECOUNT) == (22)) {
        WLD_SENDTRIGGER("KM_ORCHARD_04");
        WLD_SENDUNTRIGGER("KM_ORCHARD_10");
    };
    if ((SQ213_CUTSCENECOUNT) == (23)) {
        AI_PLAYANI(BAU_703_MARTHA, "R_RANDOM_MARTHA_02");
        AI_PLAYANI(BAU_703_MARTHA, "R_RANDOM_LUTZ_01");
    };
    if ((SQ213_CUTSCENECOUNT) == (29)) {
        WLD_SENDTRIGGER("KM_ORCHARD_05");
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            AI_PLAYANI(NONE_6319_KARIN, "T_DIALOGGESTURE_08");
        };
        AI_WAIT(MIL_6318_LUTZ, 0x40000000);
        AI_PLAYANI(MIL_6318_LUTZ, "R_RANDOM_LUTZ_01");
    };
    if ((SQ213_CUTSCENECOUNT) == (36)) {
        WLD_SENDTRIGGER("KM_ORCHARD_08");
        AI_PLAYANI(MIL_6318_LUTZ, "R_RANDOM_LUTZ_02");
    };
    if ((SQ213_CUTSCENECOUNT) == (39)) {
        AI_PLAYANI(BAU_703_MARTHA, "R_RANDOM_MARTHA_01");
    };
    if ((SQ213_CUTSCENECOUNT) == (45)) {
        WLD_SENDUNTRIGGER("KM_ORCHARD_08");
        WLD_SENDTRIGGER("KM_ORCHARD_09");
        AI_PLAYANI(MIL_6318_LUTZ, "R_RANDOM_LUTZ_03");
    };
    if ((SQ213_CUTSCENECOUNT) == (52)) {
        WLD_SENDTRIGGER("KM_ORCHARD_06");
    };
    if ((SQ213_CUTSCENECOUNT) == (56)) {
        AI_PLAYANI(MIL_6318_LUTZ, "R_RANDOM_LUTZ_01");
    };
    if ((SQ213_CUTSCENECOUNT) == (57)) {
        WLD_SENDTRIGGER("KM_ORCHARD_07");
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            AI_PLAYANI(NONE_6319_KARIN, "T_DIALOGGESTURE_02");
        };
    };
    if ((SQ213_CUTSCENECOUNT) == (60)) {
        WLD_SENDTRIGGER("KM_ORCHARD_10");
        AI_PLAYANI(NONE_6319_KARIN, "T_DIALOGGESTURE_19");
    };
    if ((SQ213_CUTSCENECOUNT) == (66)) {
        AI_WAIT(MIL_6318_LUTZ, 0x40000000);
        AI_PLAYANI(MIL_6318_LUTZ, "R_RANDOM_LUTZ_01");
        AI_PLAYANI(BAU_703_MARTHA, "R_RANDOM_LUTZ_03");
        WLD_SENDTRIGGER("KM_ORCHARD_12");
    };
    if ((SQ213_CUTSCENECOUNT) == (71)) {
        AI_STARTFACEANI(NONE_6319_KARIN, "STOP", 1, -(1));
        AI_RESETFACEANI(NONE_6319_KARIN);
        AI_PLAYANI(NONE_6319_KARIN, T_STAND_2_LGUARD);
        WLD_SENDTRIGGER("KM_ORCHARD_15");
    };
    if ((SQ213_CUTSCENECOUNT) == (68)) {
        AI_FUNCTION(HERO, 0x16ae1);
    };
}

func void MIST_FINISHSONG() {
    FADESCREENTOBLACKF(1, 0x16ae2, 1000);
}

func void MIST_FINISHSONG_FADESCREEN() {
    FF_APPLYONCEEXT(0x16ae3, 75, 4);
}

func void MIST_FINISHSONG_FADESCREEN_APPLY() {
    MIST_FINISHSONG_FADESCREEN_COUNT = (MIST_FINISHSONG_FADESCREEN_COUNT) + (1);
    if ((MIST_FINISHSONG_FADESCREEN_COUNT) == (4)) {
        MIST_FINISHSONG_FADESCREEN_COUNT = 0;
        WLD_SENDUNTRIGGER("KM_ORCHARD_01");
        WLD_SENDUNTRIGGER("KM_ORCHARD_02");
        WLD_SENDUNTRIGGER("KM_ORCHARD_03");
        WLD_SENDUNTRIGGER("KM_ORCHARD_04");
        WLD_SENDUNTRIGGER("KM_ORCHARD_05");
        WLD_SENDUNTRIGGER("KM_ORCHARD_06");
        WLD_SENDUNTRIGGER("KM_ORCHARD_07");
        WLD_SENDUNTRIGGER("KM_ORCHARD_08");
        WLD_SENDUNTRIGGER("KM_ORCHARD_09");
        WLD_SENDUNTRIGGER("KM_ORCHARD_10");
        WLD_SENDUNTRIGGER("KM_ORCHARD_11");
        WLD_SENDUNTRIGGER("KM_ORCHARD_12");
        WLD_SENDUNTRIGGER("KM_ORCHARD_13");
        WLD_SENDUNTRIGGER("KM_ORCHARD_14");
        WLD_SENDUNTRIGGER("KM_ORCHARD_15");
        WLD_SETTIME(22, 0);
        MUSIC_DISABLEOVERRIDE();
        if ((SQ213_KARINWILLSING) == (TRUE)) {
            SQ213_EVERYTHINGREADY = 6;
            B_STARTOTHERROUTINE(NONE_6319_KARIN, "AFTERCUTSCENE");
            NPC_REFRESH(NONE_6319_KARIN);
            TELEPORTNPCTOWP(0xda5f, NONE_6319_KARIN.WP);
        } else {
            SQ213_EVERYTHINGREADY = 7;
        } else {
            B_STARTOTHERROUTINE(MIL_6318_LUTZ, "AFTERCUTSCENE");
        } else {
            NPC_REFRESH(MIL_6318_LUTZ);
        } else {
            TELEPORTNPCTOWP(0xccc4, MIL_6318_LUTZ.WP);
        } else {
            B_STARTOTHERROUTINE(BAU_703_MARTHA, "AFTERCUTSCENE");
        } else {
            NPC_REFRESH(BAU_703_MARTHA);
        } else {
            TELEPORTNPCTOWP(0xe0c6, BAU_703_MARTHA.WP);
        } else {
            HERO.AIVAR[4] = FALSE;
        } else {
            FADESCREENFROMBLACK(1);
        } else {
            CHANGEVOBCOLLISION("KM_SQ213_BASKET", TRUE, TRUE, TRUE, TRUE);
        };
    };
}

var int MIST_FINISHSONG_FADESCREEN_APPLY.MIST_FINISHSONG_FADESCREEN_COUNT = 0;
