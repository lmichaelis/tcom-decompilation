instance PC_BARRELPOISON_END(C_INFO) {
    NPC = 0xc3ab;
    NR = 999;
    CONDITION = PC_BARRELPOISON_END_CONDITION;
    INFORMATION = PC_BARRELPOISON_END_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int PC_BARRELPOISON_END_CONDITION() {
    if ((PLAYER_MOBSI_PRODUCTION) == (MOBSI_BARRELPOISON)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_BARRELPOISON_END_INFO() {
    CREATEINVITEMS(HERO, 0x9056, 1);
    B_ENDPRODUCTIONDIALOG();
}

instance PC_USEBARRELPOISON(C_INFO) {
    NPC = 0xc3ab;
    CONDITION = PC_USEBARRELPOISON_CONDITION;
    INFORMATION = PC_USEBARRELPOISON_INFO;
    PERMANENT = FALSE;
}

func int PC_USEBARRELPOISON_CONDITION() {
    if ((PLAYER_MOBSI_PRODUCTION) == (MOBSI_BARRELPOISON)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void PC_USEBARRELPOISON_INFO() {
    AI_PLAYANI(HERO, "T_BARRELPOISON_USE");
    B_LOGENTRY(TOPIC_Q307, LOG_Q307_AFTERPOISON);
    Q307_POISONWAY = 1;
    Q307_WAITPOISONBENCH_HOUR = WLD_GETHOUR();
    Q307_WAITPOISONBENCH_DAY = WLD_GETDAY();
    B_ENDPRODUCTIONDIALOG();
    HERO.AIVAR[4] = FALSE;
}

func void BARRELPOISON_S1() {
    HER = HLP_GETNPC(0xc3ab);
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HER))) {
        SELF.AIVAR[4] = TRUE;
        PLAYER_MOBSI_PRODUCTION = MOBSI_BARRELPOISON;
        AI_PROCESSINFOS(HER);
    };
    PC_USEBARRELPOISON.DESCRIPTION = DIALOG_BARRELPOISON;
}

instance BARRELPOISON_S1.HER(C_NPC)
