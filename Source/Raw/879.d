var int BARRLEJORN_CAMERA = 0;
func void BARRELJORN_STARTCUTSCENE() {
    WLD_SENDTRIGGER("KM_JORNDOOR_01");
    FF_APPLYONCEEXT(0xb952, 1000, 13);
}

func void BARRELJORN_S1() {
    HER = HLP_GETNPC(0xc3ab);
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HER))) {
        if (HLP_STRCMP(NPC_GETNEARESTWP(HERO), "SLUMS_HOUSE17_BARREL_01")) {
            if ((Q405_CLOSEDDOORLOGENTRY) == (TRUE)) {
                BARRELJORN_STARTCUTSCENE();
                BARRLEJORN_CAMERA = 1;
            };
        };
        if (HLP_STRCMP(NPC_GETNEARESTWP(HERO), "SLUMS_HOUSE17_BARREL_02")) {
            if ((Q405_CLOSEDDOORLOGENTRY) == (TRUE)) {
                BARRELJORN_STARTCUTSCENE();
                BARRLEJORN_CAMERA = 2;
            };
        };
    };
}

instance BARRELJORN_S1.HER(C_NPC)
func void Q405_JORNDOORCAMERA() {
    JORNDOORCAMERACOUNT = (JORNDOORCAMERACOUNT) + (1);
    if ((JORNDOORCAMERACOUNT) == (1)) {
        Q405_CLOSEDDOORLOGENTRY = 4;
        MOB_CHANGEFOCUSNAME("JORNHOUSE_BARREL_02", "MOBNAME_NOTHING");
        B_STARTOTHERROUTINE(NONE_6396_VOLKERGUARD, "JORNHOUSE");
        MOB_CHANGEFOCUSNAME("JORNHOUSE_BARREL_01", "MOBNAME_NOTHING");
        NPC_REFRESH(NONE_6396_VOLKERGUARD);
        TELEPORTNPCTOWP(0xcfb0, "SLUMS_HOUSE17_VOLKERGUARD_01");
        CREATEINVITEM(NONE_6396_VOLKERGUARD, 0x9018);
        B_STARTOTHERROUTINE(NONE_6397_VOLKERGUARD, "JORNHOUSE");
        NPC_REFRESH(NONE_6397_VOLKERGUARD);
        TELEPORTNPCTOWP(0xcfb9, "SLUMS_HOUSE17_VOLKERGUARD_02");
    };
    if ((JORNDOORCAMERACOUNT) == (6)) {
        WLD_SENDTRIGGER("KM_JORNDOOR_02");
    };
    if ((JORNDOORCAMERACOUNT) == (7)) {
        WLD_SENDUNTRIGGER("KM_JORNDOOR_01");
    };
    if ((JORNDOORCAMERACOUNT) == (11)) {
        Q405_CLOSEDDOORLOGENTRY = 2;
        if ((BARRLEJORN_CAMERA) == (1)) {
            WLD_SENDTRIGGER("KM_JORNDOOR_03_A");
        } else if ((BARRLEJORN_CAMERA) == (2)) {
            WLD_SENDTRIGGER("KM_JORNDOOR_03_B");
        };
        AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    };
    if ((JORNDOORCAMERACOUNT) == (12)) {
        WLD_SENDUNTRIGGER("KM_JORNDOOR_02");
    };
    if ((JORNDOORCAMERACOUNT) == (13)) {
        if ((BARRLEJORN_CAMERA) == (1)) {
            WLD_SENDUNTRIGGER("KM_JORNDOOR_03_A");
        } else if ((BARRLEJORN_CAMERA) == (2)) {
            WLD_SENDUNTRIGGER("KM_JORNDOOR_03_B");
        };
        JORNDOORCAMERACOUNT = 0;
        HERO.AIVAR[4] = FALSE;
        B_LOGENTRY(TOPIC_Q405, LOG_Q405_BARREL);
    };
}

var int Q405_JORNDOORCAMERA.JORNDOORCAMERACOUNT = 0;
