instance Q406_CROSSBOW_FIRST(CUTSCENE) {
    ONSTART = FUNCTION(0x169e0);
}

func void Q406_CROSSBOW_FIRST_START() {
    WLD_SENDTRIGGER("KM_CROSSBOW_01");
    TELEPORTNPCTOWP(0xde01, NONE_6443_VOLKERGUARD.WP);
    TELEPORTNPCTOWP(0xde04, NONE_6444_VOLKERGUARD.WP);
    TELEPORTNPCTOWP(0xde10, NONE_6448_VOLKERGUARD_CROSSBOW.WP);
    TELEPORTNPCTOWP(0xde15, NONE_6449_VOLKERGUARD_CROSSBOW.WP);
    TELEPORTNPCTOWP(0x71b, "PART9_PATH_109");
    TELEPORTNPCTOWP(0xdd70, "PART9_PATH_110");
    NPC_CLEARAIQUEUE(NONE_6443_VOLKERGUARD);
    NPC_CLEARAIQUEUE(NONE_6444_VOLKERGUARD);
    NPC_CLEARAIQUEUE(NONE_6448_VOLKERGUARD_CROSSBOW);
    NPC_CLEARAIQUEUE(NONE_6449_VOLKERGUARD_CROSSBOW);
    AI_TURNTONPC(NONE_6434_VOLKERGUARD, HERO);
    AI_TURNTONPC(NONE_6444_VOLKERGUARD, HERO);
    AI_TURNTONPC(NONE_6448_VOLKERGUARD_CROSSBOW, HERO);
    AI_TURNTONPC(NONE_6449_VOLKERGUARD_CROSSBOW, HERO);
    AI_WAITTILLEND(HERO, NONE_6434_VOLKERGUARD);
    AI_WAITTILLEND(HERO, NONE_6444_VOLKERGUARD);
    AI_WAITTILLEND(HERO, NONE_6448_VOLKERGUARD_CROSSBOW);
    AI_WAITTILLEND(HERO, NONE_6449_VOLKERGUARD_CROSSBOW);
    AI_FUNCTION(HERO, 0x169e1);
}

func void Q406_CROSSBOW_FIRST_END() {
    FF_APPLYONCEEXT(0x169e2, 1000, 4);
}

func void Q406_CROSSBOW_FIRST_APPLY() {
    Q406_CROSSBOW_FIRST_COUNT = (Q406_CROSSBOW_FIRST_COUNT) + (1);
    if ((Q406_CROSSBOW_FIRST_COUNT) == (1)) {
        NPC_CLEARAIQUEUE(NONE_202_KESSEL);
        B_SAY(NONE_202_KESSEL, HERO, "$Q406_KESSEL_RUNAWAY_V1");
        B_STARTOTHERROUTINE(NONE_6448_VOLKERGUARD_CROSSBOW, "AIM");
        NPC_REFRESH(NONE_6448_VOLKERGUARD_CROSSBOW);
        B_STARTOTHERROUTINE(NONE_6449_VOLKERGUARD_CROSSBOW, "AIM");
        NPC_REFRESH(NONE_6449_VOLKERGUARD_CROSSBOW);
    };
    if ((Q406_CROSSBOW_FIRST_COUNT) == (2)) {
        B_STARTOTHERROUTINE(NONE_6443_VOLKERGUARD, "AIM");
        NPC_REFRESH(NONE_6443_VOLKERGUARD);
        B_STARTOTHERROUTINE(NONE_6444_VOLKERGUARD, "AIM");
        NPC_REFRESH(NONE_6444_VOLKERGUARD);
    };
    if ((Q406_CROSSBOW_FIRST_COUNT) == (3)) {
        AI_PLAYANI(NONE_6448_VOLKERGUARD_CROSSBOW, "T_CROSSBOW_SHOOT");
    };
    if ((Q406_CROSSBOW_FIRST_COUNT) == (4)) {
        AI_PLAYANI(NONE_6449_VOLKERGUARD_CROSSBOW, "T_CROSSBOW_SHOOT");
        WLD_SENDUNTRIGGER("KM_CROSSBOW_01");
        HERO.AIVAR[4] = FALSE;
        B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q406_HOUSEFLEE2");
        Q406_KESSEL_RTNCHECK = 5;
        NPC_REFRESH(NONE_202_KESSEL);
        Q406_VOLKERGUARDS_SPAWNMOREGUARDS_V2();
    };
}

var int Q406_CROSSBOW_FIRST_APPLY.Q406_CROSSBOW_FIRST_COUNT = 0;
