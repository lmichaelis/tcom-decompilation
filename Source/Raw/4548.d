instance KQ402_RODERICH(CUTSCENE) {
    ONSTART = FUNCTION(0x168af);
}

func void KQ402_RODERICH_WAIT() {
    AI_WAITTILLEND(HERO, MIL_4017_ARWID);
    AI_WAITTILLEND(HERO, MIL_4000_RODERICH);
    AI_WAITTILLEND(MIL_4017_ARWID, HERO);
    AI_WAITTILLEND(MIL_4017_ARWID, MIL_4000_RODERICH);
    AI_WAITTILLEND(MIL_4000_RODERICH, HERO);
    AI_WAITTILLEND(MIL_4000_RODERICH, MIL_4017_ARWID);
}

func void KQ402_RODERICH_START() {
    WLD_SENDTRIGGER("KMQ402_RODERICHFINAL");
    TELEPORTNPCTOWP(0x71b, "PARTM3_PATH_162");
    TELEPORTNPCTOWP(0xcca0, MIL_4017_ARWID.WP);
    TELEPORTNPCTOWP(0xce47, MIL_4000_RODERICH.WP);
    NPC_CLEARAIQUEUE(MIL_4017_ARWID);
    NPC_CLEARAIQUEUE(MIL_4000_RODERICH);
    MIL_4017_ARWID.AIVAR[92] = TRUE;
    MIL_4000_RODERICH.AIVAR[92] = TRUE;
    B_TURNTONPC(MIL_4017_ARWID, MIL_4000_RODERICH);
    B_TURNTONPC(MIL_4000_RODERICH, MIL_4000_RODERICH);
    B_TURNTONPC(HERO, MIL_4017_ARWID);
    AI_LOOKATNPC(HERO, MIL_4000_RODERICH);
    KQ402_RODERICH_WAIT();
    AI_STARTFACEANI(MIL_4000_RODERICH, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(MIL_4017_ARWID, S_ANGRY, 1, -(1));
    AI_OUTPUT(MIL_4000_RODERICH, HERO, "DIA_Roderich_Cutscene_03_01");
    KQ402_RODERICH_WAIT();
    AI_OUTPUT(MIL_4017_ARWID, HERO, "DIA_Roderich_Cutscene_03_02");
    AI_OUTPUT(MIL_4017_ARWID, HERO, "DIA_Roderich_Cutscene_03_03");
    KQ402_RODERICH_WAIT();
    AI_TURNTONPC(MIL_4000_RODERICH, HERO);
    AI_RESETFACEANI(MIL_4017_ARWID);
    AI_RESETFACEANI(MIL_4000_RODERICH);
    AI_OUTPUT(MIL_4000_RODERICH, HERO, "DIA_Roderich_Cutscene_03_04");
    AI_TURNTONPC(MIL_4000_RODERICH, MIL_4017_ARWID);
    AI_OUTPUT(MIL_4000_RODERICH, HERO, "DIA_Roderich_Cutscene_03_05");
    KQ402_RODERICH_WAIT();
    AI_OUTPUT(MIL_4017_ARWID, HERO, "DIA_Roderich_Cutscene_03_06");
    AI_PLAYANI(MIL_4017_ARWID, T_GREETGRD);
    KQ402_RODERICH_WAIT();
    AI_FUNCTION(MIL_4017_ARWID, 0x168b0);
}

func void KQ402_RODERICH_END() {
    WLD_SENDUNTRIGGER("KMQ402_RODERICHFINAL");
    KQ402_RAPORTABOUTARMORS = 5;
    MIL_4017_ARWID.AIVAR[92] = FALSE;
    MIL_4000_RODERICH.AIVAR[92] = FALSE;
    AI_STOPLOOKAT(HERO);
    B_STARTOTHERROUTINE(MIL_4017_ARWID, START);
    NPC_REFRESH(MIL_4017_ARWID);
    B_STARTOTHERROUTINE(MIL_4000_RODERICH, START);
    NPC_REFRESH(MIL_4000_RODERICH);
    HERO.AIVAR[4] = FALSE;
}

