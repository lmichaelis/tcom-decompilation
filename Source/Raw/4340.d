instance DIA_YEZEGAN_Q602_EXIT(C_INFO) {
    NPC = 0xe85c;
    NR = 999;
    CONDITION = DIA_YEZEGAN_Q602_EXIT_CONDITION;
    INFORMATION = DIA_YEZEGAN_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_YEZEGAN_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_YEZEGAN_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_YEZEGAN_Q602_HELLO(C_INFO) {
    NPC = 0xe85c;
    NR = 1;
    CONDITION = DIA_YEZEGAN_Q602_HELLO_CONDITION;
    INFORMATION = DIA_YEZEGAN_Q602_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_YEZEGAN_Q602_HELLO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_YEZEGANFIGHTSTATE) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void YEZEGAN_Q602_KILLMARVIN() {
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_03");
    if ((HLP_ISVALIDNPC(DJG_10089_WOLFSON_Q602)) || (HLP_ISVALIDNPC(DJG_10091_WOLFSON_Q602))) {
        if ((!(NPC_ISDEAD(DJG_10089_WOLFSON_Q602))) || (!(NPC_ISDEAD(DJG_10091_WOLFSON_Q602)))) {
            TRIA_FINISH();
        };
    };
    INFO_CLEARCHOICES(0x16010);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x16013);
}

func void YEZEGAN_Q602_ATTACKMARVIN() {
    Q602_FIGHTWITHYEZEGAN();
}

func void DIA_YEZEGAN_Q602_CHOICES() {
    INFO_CLEARCHOICES(0x16010);
    INFO_ADDCHOICE(0x16010, "It's not my fight. All I care about is getting the Usurer.", 0x1601c);
    INFO_ADDCHOICE(0x16010, "Where's Ulryk?", 0x1601a);
    INFO_ADDCHOICE(0x16010, "Why did you attack the city?", 0x16019);
}

func void DIA_YEZEGAN_Q602_HELLO_INFO() {
    if (HLP_ISVALIDNPC(DJG_10089_WOLFSON_Q602)) {
        if (!(NPC_ISDEAD(DJG_10089_WOLFSON_Q602))) {
            TRIA_INVITE(DJG_10089_WOLFSON_Q602);
        };
    };
    if (HLP_ISVALIDNPC(DJG_10091_WOLFSON_Q602)) {
        if (!(NPC_ISDEAD(DJG_10091_WOLFSON_Q602))) {
            TRIA_INVITE(DJG_10091_WOLFSON_Q602);
        };
    };
    if ((HLP_ISVALIDNPC(DJG_10089_WOLFSON_Q602)) || (HLP_ISVALIDNPC(DJG_10091_WOLFSON_Q602))) {
        if ((!(NPC_ISDEAD(DJG_10089_WOLFSON_Q602))) || (!(NPC_ISDEAD(DJG_10091_WOLFSON_Q602)))) {
            TRIA_START();
        };
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_01");
    if (((Q401_DUSTERBIZZAREADVENTURE) >= (4)) || ((LOG_GETSTATUS(MIS_SQ406)) == (LOG_SUCCESS))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_04");
        if ((LOG_GETSTATUS(MIS_SQ406)) == (LOG_SUCCESS)) {
            AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_05");
        };
        if ((Q401_DUSTERBIZZAREADVENTURE) >= (4)) {
            AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_06");
            AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_07");
            AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_08");
        };
        DIA_YEZEGAN_Q602_CHOICES();
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_03_02");
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_YEZEGAN_EXPLOSION);
    YEZEGAN_Q602_KILLMARVIN();
}

var int YEZEGAN_Q602_TIRED_COUNT = 0;
func void DIA_YEZEGAN_Q602_HELLO_TIRED() {
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Fight_03_01");
    YEZEGAN_Q602_KILLMARVIN();
}

func void YEZEGAN_Q602_TIRED() {
    YEZEGAN_Q602_TIRED_COUNT = (YEZEGAN_Q602_TIRED_COUNT) + (1);
    if ((YEZEGAN_Q602_TIRED_COUNT) >= (3)) {
        DIA_YEZEGAN_Q602_HELLO_TIRED();
    };
}

func void DIA_YEZEGAN_Q602_HELLO_WHY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_HELLO_Why_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Why_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Why_03_03");
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_YEZEGAN_ISLAND);
    INFO_ADDCHOICE(0x16010, "The island and the kingdom are threatened by orcs, and you fight among yourselves?", 0x1601b);
    YEZEGAN_Q602_TIRED();
}

func void DIA_YEZEGAN_Q602_HELLO_WHERE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_HELLO_Where_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Where_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Where_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Where_03_04");
    YEZEGAN_Q602_TIRED();
}

func void DIA_YEZEGAN_Q602_HELLO_WHY_STUPID() {
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_HELLO_Stupid_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Stupid_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Stupid_03_03");
    YEZEGAN_Q602_TIRED();
}

func void DIA_YEZEGAN_Q602_HELLO_LEAVE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_HELLO_Leave_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Yezegan_Q602_HELLO_Leave_03_02");
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_YEZEGAN_VOLKER);
    DIA_YEZEGAN_Q602_HELLO_TIRED();
}

instance DIA_YEZEGAN_Q602_WHATDO(C_INFO) {
    NPC = 0xe85c;
    NR = 1;
    CONDITION = DIA_YEZEGAN_Q602_WHATDO_CONDITION;
    INFORMATION = DIA_YEZEGAN_Q602_WHATDO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_YEZEGAN_Q602_WHATDO_CONDITION() {
    if ((Q602_YEZEGANFIGHTSTATE) == (2)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_YEZEGAN_Q602_WHATDO_INFO() {
    INFO_CLEARCHOICES(0x1601d);
    INFO_ADDCHOICE(0x1601d, "Get out of here, you mangy bug! (Spare his life)", 0x16021);
    INFO_ADDCHOICE(0x1601d, "You're dead, scum! (Kill)", 0x16020);
}

func void DIA_YEZEGAN_Q602_WHATDO_KILL() {
    DJG_10002_YEZEGAN_Q602.ATTRIBUTE[0] = 1;
    DJG_10002_YEZEGAN_Q602.FLAGS = 0;
    MDL_APPLYOVERLAYMDS(SELF, "HUMANS_SUDDENDEATH.MDS");
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_WhatDo_Kill_15_01");
    B_MARVIN_ATTACKINDIALOGUE_PREPARE();
    AI_FUNCTION(OTHER, 0x16022);
    B_MARVIN_ATTACKINDIALOGUE_ATTACK();
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_YEZEGAN_FATE_V1);
    INFO_CLEARCHOICES(0x1601d);
    AI_STOPPROCESSINFOS(OTHER);
    AI_RESETFACEANI(OTHER);
}

func void DIA_YEZEGAN_Q602_WHATDO_LEAVE() {
    Q602_YEZEGANFIGHTSTATE = 3;
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Yezegan_Q602_WhatDo_Leave_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    NPC_EXCHANGEROUTINE(SELF, FLEE);
    INFO_CLEARCHOICES(0x1601d);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_YEZEGAN_FATE_V2);
    AI_RESETFACEANI(OTHER);
}

func void MARVIN_Q602_KILLYEZEGAN() {
    AI_PLAYANI(DJG_10002_YEZEGAN_Q602, T_DEAD);
    SND_PLAY("FIG_SwordFinal");
    SND_PLAY("SVM_24_DEAD");
    B_MAGICHURTNPC(HERO, DJG_10002_YEZEGAN_Q602, 0x1869f);
    AI_REMOVEWEAPON(HERO);
    HERO.AIVAR[4] = FALSE;
}

