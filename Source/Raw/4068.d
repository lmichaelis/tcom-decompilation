instance DIA_KESSEL_EXIT(C_INFO) {
    NPC = 0xdd70;
    NR = 999;
    CONDITION = DIA_KESSEL_EXIT_CONDITION;
    INFORMATION = DIA_KESSEL_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_KESSEL_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_KESSEL_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_KESSEL_Q405_HELLO(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q405_HELLO_CONDITION;
    INFORMATION = DIA_KESSEL_Q405_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q405_HELLO_CONDITION() {
    if ((LOG_GETSTATUS(MIS_Q405)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int KESSEL_Q405_HELLO_WHY = 0;
var int KESSEL_Q405_HELLO_BROTHER = 0;
func void DIA_KESSEL_Q405_HELLO_BROTHER_NEXT() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Next_03_01");
    INFO_CLEARCHOICES(0x138c8);
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "Q405_JornHOUSE_GUIDE");
    Q405_KESSEL_RTNCHECK = 3;
    AI_LOGENTRY(TOPIC_Q405, LOG_Q405_KESSEL_PLAN);
}

func void DIA_KESSEL_Q405_HELLO_CHOICES() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(0x138c8);
    if (((KESSEL_Q405_HELLO_BROTHER) == (FALSE)) || ((KESSEL_Q405_HELLO_WHY) == (FALSE))) {
        if ((KESSEL_Q405_HELLO_WHY) == (FALSE)) {
            INFO_ADDCHOICE(0x138c8, "Is that why you tried to kill him?", 0x138cf);
        };
        if ((KESSEL_Q405_HELLO_BROTHER) == (FALSE)) {
            INFO_ADDCHOICE(0x138c8, "It's because of your failed assassination attempt that my brother is dead...", 0x138d0);
        };
    };
    DIA_KESSEL_Q405_HELLO_BROTHER_NEXT();
}

func void DIA_KESSEL_Q405_HELLO_INFO() {
    WLD_SENDTRIGGER("KM_JORNHOUSE_SECRET");
    B_REMOVENPC(0xdd92);
    B_REMOVENPC(0xdd95);
    B_REMOVENPC(0xdd98);
    B_REMOVENPC(0xdd9b);
    B_REMOVENPC(0xdd9e);
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_HELLO_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_HELLO_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_03_04");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_03_05");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_HELLO_15_06");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_03_08");
    DIA_KESSEL_Q405_HELLO_CHOICES();
    WLD_REMOVEITEM(ITFS_FAKECROSSBOW_LONG);
}

func void DIA_KESSEL_Q405_HELLO_WHY() {
    KESSEL_Q405_HELLO_WHY = TRUE;
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_HELLO_Why_15_01");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Why_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Why_03_03");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Why_03_04");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Why_03_05");
    DIA_KESSEL_Q405_HELLO_CHOICES();
}

func void DIA_KESSEL_Q405_HELLO_BROTHER() {
    KESSEL_Q405_HELLO_BROTHER = TRUE;
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_HELLO_Brother_15_01");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Brother_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Brother_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_HELLO_Brother_03_04");
    DIA_KESSEL_Q405_HELLO_CHOICES();
}

instance DIA_KESSEL_Q405_SACHSBOOKS(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q405_SACHSBOOKS_CONDITION;
    INFORMATION = DIA_KESSEL_Q405_SACHSBOOKS_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q405_SACHSBOOKS_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x138c8)) && ((NPC_GETDISTTOWP(SELF, "SLUMS_HOUSE17_58")) <= (400))) && ((LOG_GETSTATUS(MIS_Q405)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q405_SACHSBOOKS_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_SachsBooks_03_01");
    AI_TURNAWAY(SELF, OTHER);
    AI_SETWALKMODE(SELF, NPC_RUN);
    AI_GOTOWP(SELF, "SLUMS_HOUSE17_BOOKS");
    AI_PLAYANI(SELF, T_PLUNDER);
    AI_TURNTONPC(SELF, OTHER);
    AI_GOTONPC(NONE_202_KESSEL, HERO);
    AI_WAITTILLEND(OTHER, SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_SachsBooks_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_SachsBooks_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_SachsBooks_03_04");
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "Q405_JornHOUSE_GUIDE2");
    Q405_KESSEL_RTNCHECK = 4;
}

instance DIA_KESSEL_Q405_FOUNDBOAT(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q405_FOUNDBOAT_CONDITION;
    INFORMATION = DIA_KESSEL_Q405_FOUNDBOAT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q405_FOUNDBOAT_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x138d1)) && ((NPC_GETDISTTOWP(SELF, "SLUMS_HOUSE17_55")) <= (450))) && ((LOG_GETSTATUS(MIS_Q405)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q405_FOUNDBOAT_INFO() {
    MOB_CHANGEFOCUSNAME("Q405_LEVER", "MOBNAME_Q405_USELEVER");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_FoundBoat_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_FoundBoat_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_FoundBoat_03_03");
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q405, LOG_Q405_FINDWAYOUT);
    SELF.AIVAR[15] = FALSE;
    NPC_EXCHANGEROUTINE(SELF, "Q405_JornHOUSE_SEARCH");
    Q405_KESSEL_RTNCHECK = 5;
}

instance DIA_KESSEL_Q405_CANESACPE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q405_CANESACPE_CONDITION;
    INFORMATION = DIA_KESSEL_Q405_CANESACPE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q405_CANESACPE_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x138d4)) && ((Q405_LEVER) == (1))) && ((LOG_GETSTATUS(MIS_Q405)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q405_CANESACPE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_CanEsacpe_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_CanEsacpe_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_CanEsacpe_03_03");
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x138da);
}

func void KESSEL_STARTESCAPECUTSCENE() {
    WLD_SENDTRIGGER("KM_JORNHOUSE_ESCAPE");
    FADESCREENTOBLACKF(3, 0x138db, 1000);
}

func void KESSEL_STARTESCAPECUTSCENE_FADESCREEN() {
    WLD_SENDUNTRIGGER("KM_JORNHOUSE_ESCAPE");
    WLD_SENDTRIGGER("KM_KESSEL_BOAT_01");
    WLD_SENDTRIGGER("KM_KESSEL_BOAT_02");
    B_LOGENTRY(TOPIC_Q405, LOG_Q405_FINISH);
    LOG_SETSTATUS(_@(MIS_Q405), TOPIC_Q405, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q405_FINISH);
    TELEPORTNPCTOWP(0x71b, "PART_13_ANA_DEAD");
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q405_JornHOUSE_ESCAPED");
    Q405_KESSEL_RTNCHECK = 6;
    NPC_REFRESH(NONE_202_KESSEL);
    TELEPORTNPCTOWP(0xdd70, "PART_13_JORN_01");
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
    MUSIC_DISABLEOVERRIDE();
}

instance DIA_KESSEL_Q405_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q405_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_Q405_FINISH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q405_FINISH_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x138d7)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int KESSEL_AFTERJORN_VOLKER = 0;
var int KESSEL_AFTERJORN_ORGANIZATION = 0;
var int KESSEL_AFTERJORN_EXPLAIN = 0;
var int KESSEL_AFTERJORN_SACHS = 0;
var int KESSEL_AFTERJORN_LONG = 0;
var int KESSEL_AFTERJORN_HOW = 0;
var int KESSEL_AFTERJORN_SURE = 0;
var int KESSEL_AFTERJORN_TELL = 0;
var int KESSEL_AFTERJORN_GETVOLKER = 0;
func void DIA_KESSEL_Q405_FINISH_CHOICES() {
    INFO_CLEARCHOICES(0x138dc);
    if ((KESSEL_AFTERJORN_GETVOLKER) == (FALSE)) {
        if (((((((((KESSEL_AFTERJORN_VOLKER) == (TRUE)) && ((KESSEL_AFTERJORN_ORGANIZATION) == (TRUE))) && ((KESSEL_AFTERJORN_EXPLAIN) == (TRUE))) && ((KESSEL_AFTERJORN_SACHS) == (TRUE))) && ((KESSEL_AFTERJORN_LONG) == (TRUE))) && ((KESSEL_AFTERJORN_HOW) == (TRUE))) && ((KESSEL_AFTERJORN_SURE) == (TRUE))) && ((KESSEL_AFTERJORN_TELL) == (TRUE))) {
            INFO_ADDCHOICE(0x138dc, "I have to find a way to get the Usurer.", 0x138f8);
        };
    };
    if (((KESSEL_AFTERJORN_TELL) == (FALSE)) && ((KESSEL_AFTERJORN_EXPLAIN) == (TRUE))) {
        INFO_ADDCHOICE(0x138dc, "We need to tell someone about this!", 0x138f7);
    };
    if (((KESSEL_AFTERJORN_SURE) == (FALSE)) && ((KESSEL_AFTERJORN_EXPLAIN) == (TRUE))) {
        INFO_ADDCHOICE(0x138dc, "How do I know you're not the one lying to me?", 0x138f6);
    };
    if (((KESSEL_AFTERJORN_HOW) == (FALSE)) && ((KESSEL_AFTERJORN_LONG) == (TRUE))) {
        INFO_ADDCHOICE(0x138dc, "How did you find me there?", 0x138f5);
    };
    if ((KESSEL_AFTERJORN_LONG) == (FALSE)) {
        INFO_ADDCHOICE(0x138dc, "Have you been watching this place long?", 0x138f4);
    };
    if ((KESSEL_AFTERJORN_SACHS) == (FALSE)) {
        INFO_ADDCHOICE(0x138dc, "Did you find anything interesting in Sachs' documents?", 0x138f3);
    };
    if ((KESSEL_AFTERJORN_EXPLAIN) == (FALSE)) {
        INFO_ADDCHOICE(0x138dc, "Could you explain to me what this is all about?", 0x138ed);
    };
    if ((KESSEL_AFTERJORN_ORGANIZATION) == (FALSE)) {
        INFO_ADDCHOICE(0x138dc, "What exactly is your organization?", 0x138eb);
    };
    if ((KESSEL_AFTERJORN_VOLKER) == (FALSE)) {
        INFO_ADDCHOICE(0x138dc, "How do you know I worked for the Usurer?", 0x138e9);
    };
}

func void DIA_KESSEL_Q405_FINISH_INFO() {
    SELF.AIVAR[15] = FALSE;
    B_REMOVENPC(0xe0a6);
    PRINTD("Kurt pop³yna³ do krainy Aslana. F.");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_03_02");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_VOLKER() {
    KESSEL_AFTERJORN_VOLKER = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Volker_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Volker_03_02");
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Volker_03_03");
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Volker_03_04");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Volker_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Volker_03_06");
    INFO_CLEARCHOICES(0x138dc);
    INFO_ADDCHOICE(0x138dc, "Jon is dead. The rest is irrelevant.", 0x138ea);
}

func void DIA_KESSEL_Q405_FINISH_VOLKER_JON() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Jon_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Jon_03_02");
    if ((Q404_JONSTATUS) == (1)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Jon_15_03");
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Jon_15_04");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Jon_15_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Jon_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Jon_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Jon_03_08");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_ORGANIZATION() {
    KESSEL_AFTERJORN_ORGANIZATION = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Organization_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Organization_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Organization_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Organization_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Organization_03_05");
    INFO_CLEARCHOICES(0x138dc);
    INFO_ADDCHOICE(0x138dc, "Are you working with the mages of the monastery?", 0x138ec);
}

func void DIA_KESSEL_Q405_FINISH_ORGANIZATION_MAGES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Mages_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Mages_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Mages_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Mages_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Mages_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Mages_03_06");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_EXPLAIN() {
    KESSEL_AFTERJORN_EXPLAIN = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Explain_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Explain_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_09");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_10");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_11");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Explain_03_12");
    INFO_CLEARCHOICES(0x138dc);
    INFO_ADDCHOICE(0x138dc, "How does my brother fit into all this?", 0x138ef);
}

var int KESSEL_KNOWABOUTRING = 0;
func void DIA_KESSEL_Q405_FINISH_EXPLAIN_BROTHER() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_02");
    if ((NPC_HASITEMS(OTHER, 0x911a)) >= (1)) {
        KESSEL_KNOWABOUTRING = TRUE;
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_03");
        B_GIVEINVITEMS(OTHER, SELF, 0x911a, 1);
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_04");
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_05");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_06");
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_07");
        if ((Q406_TALKEDABOUTJORN) == (TRUE)) {
            AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_08");
            AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_09");
        };
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_10");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_11");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_12");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_13");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_14");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_15");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Brother_15_16");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Brother_03_17");
    INFO_CLEARCHOICES(0x138dc);
    INFO_ADDCHOICE(0x138dc, "The pirates we sailed with here did not look friendly.", 0x138f0);
    INFO_ADDCHOICE(0x138dc, "Fabio seemed to have a conflict with my brother.", 0x138f1);
    INFO_ADDCHOICE(0x138dc, "I don't think anyone else would want to harm Jorn.", 0x138f2);
}

func void DIA_KESSEL_Q405_FINISH_EXPLAIN_BROTHER_PIRATES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Pirates_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Pirates_03_02");
    if (NPC_ISDEAD(PIR_6330_CAPTAIN_ARCHOLOS)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Pirates_15_03");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Pirates_03_04");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Pirates_03_05");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Pirates_15_06");
}

func void DIA_KESSEL_Q405_FINISH_EXPLAIN_BROTHER_FABIO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Fabio_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Fabio_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Fabio_15_03");
}

func void DIA_KESSEL_Q405_FINISH_EXPLAIN_BROTHER_NOONE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_NoOne_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_NoOne_03_02");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_SACHS() {
    KESSEL_AFTERJORN_SACHS = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Sachs_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKESCROLL();
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Sachs_03_02");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_LONG() {
    KESSEL_AFTERJORN_LONG = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Long_15_01");
    if (((Q405_CORPSELOGENTRY) == (TRUE)) && ((LOG_GETSTATUS(MIS_QA304)) == (LOG_SUCCESS))) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Long_15_02");
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Long_15_03");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Long_03_04");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Long_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Long_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Long_03_07");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_HOW() {
    KESSEL_AFTERJORN_HOW = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_How_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_How_03_07");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_SURE() {
    KESSEL_AFTERJORN_SURE = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Sure_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Sure_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Sure_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Sure_03_04");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_TELL() {
    KESSEL_AFTERJORN_TELL = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Tell_15_01");
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Tell_15_02");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_03");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_04");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_05");
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Tell_15_06");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_07");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_08");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_09");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_10");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_11");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_12");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_13");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_14");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Tell_03_15");
    DIA_KESSEL_Q405_FINISH_CHOICES();
}

func void DIA_KESSEL_Q405_FINISH_GETVOLKER() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_GetVolker_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_GetVolker_03_07");
    INFO_CLEARCHOICES(0x138dc);
    INFO_ADDCHOICE(0x138dc, "Meet me there.", 0x138f9);
}

func void DIA_KESSEL_Q405_FINISH_GETVOLKER_BYE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Bye_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Bye_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Bye_03_03");
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Bye_03_04");
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Bye_03_06");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Bye_03_07");
    LOG_CREATETOPIC(TOPIC_Q406, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q406), TOPIC_Q406, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q406, LOG_Q406_START);
    INFO_CLEARCHOICES(0x138dc);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q406_VINEYARD");
    Q406_KESSEL_RTNCHECK = 1;
    WLD_SENDTRIGGER("Q406_MOVER_ALPHA");
    DUMMYFUNCWITHSTRINGPARAMETER("");
    WLD_SENDTRIGGER("Q406_MOVER_VOLKER_ROCKS");
    CHANGEVOBCOLLISION("KM_JORNHOUSE_SECRET", FALSE, FALSE, FALSE, FALSE);
    FF_APPLYONCEEXTGT(0xf96a, 0, -(1));
    Q406_SPAWNFIRSTMANHUNTERS();
}

instance DIA_KESSEL_VINEYARD(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_VINEYARD_CONDITION;
    INFORMATION = DIA_KESSEL_VINEYARD_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_VINEYARD_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q406)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x138dc))) && ((NPC_GETDISTTOWP(SELF, "PART9_PATH_84")) <= (700))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int KESSEL_VINEYARD_WAIT = 0;
func void DIA_KESSEL_VINEYARD_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_03");
    if (((Q406_MANHUNTERSSILBACH) == (3)) || (NPC_KNOWSINFO(OTHER, 0x15f58))) {
        AI_OUTPUT(OTHER, SELF, "DIA_Kessel_VINEYARD_15_04");
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_05");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_VINEYARD_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_03_08");
    INFO_CLEARCHOICES(0x138fa);
    INFO_ADDCHOICE(0x138fa, "Not yet. I'll be back soon.", 0x13900);
    INFO_ADDCHOICE(0x138fa, "Let's go.", 0x138ff);
}

func void DIA_KESSEL_VINEYARD_GOTOHOUSE() {
    KESSEL_VINEYARD_WAIT = FALSE;
    Q406_KESSEL_GOHOUSE = TRUE;
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q406_HOUSE");
    Q406_KESSEL_RTNCHECK = 2;
    AI_LOGENTRY(TOPIC_Q406, LOG_Q406_KESSELGOHOUSE);
    SELF.AIVAR[15] = TRUE;
}

func void DIA_KESSEL_VINEYARD_GO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_VINEYARD_Go_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARD_Go_03_02");
    INFO_CLEARCHOICES(0x138fa);
    DIA_KESSEL_VINEYARD_GOTOHOUSE();
}

func void DIA_KESSEL_VINEYARD_WAIT() {
    KESSEL_VINEYARD_WAIT = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_VINEYARD_Wait_15_01");
    INFO_CLEARCHOICES(0x138fa);
}

instance DIA_KESSEL_VINEYARDREADY(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_VINEYARDREADY_CONDITION;
    INFORMATION = DIA_KESSEL_VINEYARDREADY_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "We can go.";
}

func int DIA_KESSEL_VINEYARDREADY_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_Q406)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, "PART9_WAIT_KESSEL")) <= (1000))) && (NPC_KNOWSINFO(OTHER, 0x138fa))) && ((KESSEL_VINEYARD_WAIT) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_VINEYARDREADY_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_VINEYARDREADY_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_VINEYARDREADY_03_02");
    DIA_KESSEL_VINEYARD_GOTOHOUSE();
}

instance DIA_KESSEL_HOUSERUNAWAY(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_HOUSERUNAWAY_CONDITION;
    INFORMATION = DIA_KESSEL_HOUSERUNAWAY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_HOUSERUNAWAY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q406)) == (LOG_RUNNING)) && ((Q406_KESSEL_GOHOUSE) == (9))) {
        if ((NPC_ISDEAD(NONE_6441_VOLKERGUARD)) && (NPC_ISDEAD(NONE_6442_VOLKERGUARD))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_HOUSERUNAWAY_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_HOUSERUNAWAY_03_01");
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q406_HOUSEFLEE");
    Q406_KESSEL_RTNCHECK = 4;
    AI_FUNCTION(SELF, 0x13907);
    AI_LOGENTRY(TOPIC_Q406, LOG_Q406_WATERCIRCLEDEATH);
}

func void KESSEL_SPAWNVOLKERGUARDS_V1() {
    MUSIC_OVERRIDETRACK(0x559a);
    Q406_VOLKERGUARDS_SPAWNMOREGUARDS_V1();
}

instance DIA_KESSEL_Q502_HELLO(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q502_HELLO_CONDITION;
    INFORMATION = DIA_KESSEL_Q502_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q502_HELLO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q502)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13a3e))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q502_HELLO_INFO() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_03_02");
    INFO_CLEARCHOICES(0x13908);
    INFO_ADDCHOICE(0x13908, "I owed it to you, after all, you saved me twice.", 0x1390e);
    INFO_ADDCHOICE(0x13908, "Actually, it was Riordian's idea.", 0x1390d);
}

func void Q502_CHANGERIORDIANRTN() {
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q502_AFTERMAGES");
    NPC_REFRESH(KDW_203_RIORDIAN);
}

func void DIA_KESSEL_Q502_HELLO_FEEL() {
    AI_FUNCTION(SELF, 0x1390b);
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Hello_Feel_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_Feel_03_02");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_Feel_03_03");
    INFO_CLEARCHOICES(0x13908);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_KESSEL_Q502_HELLO_RIORDIAN() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Hello_Riordian_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_Riordian_03_02");
    DIA_KESSEL_Q502_HELLO_FEEL();
}

func void DIA_KESSEL_Q502_HELLO_HELP() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Hello_Help_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Hello_Help_03_02");
    DIA_KESSEL_Q502_HELLO_FEEL();
}

instance DIA_KESSEL_Q502_MONASTERY(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q502_MONASTERY_CONDITION;
    INFORMATION = DIA_KESSEL_Q502_MONASTERY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q502_MONASTERY_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q502)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, "PART8_MONASTERY_82")) <= (500))) && (NPC_KNOWSINFO(OTHER, 0x1372e))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q502_MONASTERY_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Monastery_03_01");
    AI_WAITTILLEND(OTHER, SELF);
    AI_PLAYANI(OTHER, T_YES);
    AI_WAITTILLEND(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Monastery_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Monastery_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Monastery_03_04");
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q502_MAGES");
    AI_FUNCTION(SELF, 0x13912);
}

func void KESSEL_MONASTERYCUTSCENE() {
    Q502_STARTTRIALOG = 1;
}

instance DIA_KESSEL_Q502_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q502_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_Q502_FINISH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q502_FINISH_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x136b4)) && ((LOG_GETSTATUS(MIS_Q502)) == (LOG_RUNNING))) {
        if (((NPC_GETDISTTOWP(NONE_202_KESSEL, "PART8_MONASTERY_KESSELWAIT2")) <= (400)) && ((NPC_GETDISTTOWP(KDW_203_RIORDIAN, "PART8_MONASTERY_RIORDIANWAIT")) <= (400))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q502_FINISH_INFO() {
    TRIA_INVITE(KDW_203_RIORDIAN);
    TRIA_START();
    AI_SETWALKMODE(KDW_203_RIORDIAN, NPC_RUN);
    AI_LOOKATNPC(SELF, OTHER);
    AI_LOOKATNPC(OTHER, SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Finish_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_03_06");
    INFO_CLEARCHOICES(0x13913);
    INFO_ADDCHOICE(0x13913, "Probably didn't help them too much.", 0x13916);
}

func void DIA_KESSEL_Q502_FINISH_DEFENDERS() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Finish_Defenders_15_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Defenders_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Defenders_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Defenders_03_04");
    INFO_CLEARCHOICES(0x13913);
    INFO_ADDCHOICE(0x13913, "What if getting the blade doesn't affect the mages' decision?", 0x1391a);
    INFO_ADDCHOICE(0x13913, "Riordian, do you also think the mages should intervene?", 0x13919);
}

func void DIA_KESSEL_Q502_FINISH_LASTQUESTION() {
    INFO_CLEARCHOICES(0x13913);
    INFO_ADDCHOICE(0x13913, "Where should we start then?", 0x1391b);
}

var int KESSEL_Q502_COUNT = 0;
func void DIA_KESSEL_Q502_FINISH_DEFENDERS_MAGES() {
    KESSEL_Q502_COUNT = (KESSEL_Q502_COUNT) + (1);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Finish_Mages_15_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Mages_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Mages_03_03");
    if ((KESSEL_Q502_COUNT) >= (2)) {
        DIA_KESSEL_Q502_FINISH_LASTQUESTION();
    };
}

func void DIA_KESSEL_Q502_FINISH_DEFENDERS_SWORD() {
    KESSEL_Q502_COUNT = (KESSEL_Q502_COUNT) + (1);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Finish_Sword_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Sword_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Sword_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Sword_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_Sword_03_05");
    if ((KESSEL_Q502_COUNT) >= (2)) {
        DIA_KESSEL_Q502_FINISH_LASTQUESTION();
    };
}

func void DIA_KESSEL_Q502_FINISH_DEFENDERS_SWORD_WHAT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q502_Finish_What_15_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_What_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_What_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_What_03_03");
    CREATEINVITEMS(KDW_203_RIORDIAN, 0x9bb4, 1);
    B_GIVEINVITEMS(KDW_203_RIORDIAN, HERO, 0x9bb4, 1);
    AI_LOGENTRY(TOPIC_Q502, LOG_Q502_VARDHALBOOK);
    TRIA_FINISH();
    INFO_CLEARCHOICES(0x13913);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_FUNCTION(SELF, 0xb7b8);
    AI_FUNCTION(SELF, 0x1391c);
    AI_STOPPROCESSINFOS(SELF);
}

func void Q502_CHANGERTN() {
    NPC_EXCHANGEROUTINE(NONE_202_KESSEL, "Q502_FOLLOW");
    NPC_EXCHANGEROUTINE(KDW_203_RIORDIAN, "Q502_READ");
}

instance DIA_KESSEL_ABOUTMAGES(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_ABOUTMAGES_CONDITION;
    INFORMATION = DIA_KESSEL_ABOUTMAGES_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_ABOUTMAGES_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x13913)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_ABOUTMAGES_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_03_03");
    INFO_CLEARCHOICES(0x1391d);
    INFO_ADDCHOICE(0x1391d, "The mages don't mind?", 0x13920);
}

func void DIA_KESSEL_ABOUTMAGES_PROBLEM() {
    AI_OUTPUT(OTHER, SELF, "DIA_Mailor_SQ309_FireMages_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_Problem_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_Problem_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_Problem_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_AboutMages_Problem_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_What_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q502_Finish_What_03_05");
    INFO_CLEARCHOICES(0x1391d);
    AI_LOGENTRY(TOPIC_Q502, LOG_Q502_SEEYA);
    NPC_EXCHANGEROUTINE(SELF, "Q502_READ");
}

instance DIA_KESSEL_WATERCIRCLE(C_INFO) {
    NPC = 0xdd70;
    NR = 699;
    CONDITION = DIA_KESSEL_WATERCIRCLE_CONDITION;
    INFORMATION = DIA_KESSEL_WATERCIRCLE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What can you tell me about the Ring of Water?";
}

func int DIA_KESSEL_WATERCIRCLE_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x1391d)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_WATERCIRCLE_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_TellMeAboutWaterCircle");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WaterCircle_03_07");
}

instance DIA_KESSEL_SACHSDOCS(C_INFO) {
    NPC = 0xdd70;
    NR = 700;
    CONDITION = DIA_KESSEL_SACHSDOCS_CONDITION;
    INFORMATION = DIA_KESSEL_SACHSDOCS_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Did you find anything interesting in Sachs' documents?";
}

var int KESSEL_SACHSDOCS_DONE = 0;
func int DIA_KESSEL_SACHSDOCS_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x138dc)) && ((KESSEL_SACHSDOCS_DONE) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SACHSDOCS_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q405_Finish_Sachs_15_01");
    if ((LOG_GETSTATUS(MIS_Q501)) == (LOG_SUCCESS)) {
        KESSEL_SACHSDOCS_DONE = TRUE;
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SachsDocs_03_01");
        CREATEINVITEMS(SELF, 0x9e8b, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x9e8b, 1);
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SachsDocs_03_02");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q405_Finish_Sachs_03_02");
}

instance DIA_KESSEL_WHYVOLKER(C_INFO) {
    NPC = 0xdd70;
    NR = 698;
    CONDITION = DIA_KESSEL_WHYVOLKER_CONDITION;
    INFORMATION = DIA_KESSEL_WHYVOLKER_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Why did you want Volker dead?";
}

func int DIA_KESSEL_WHYVOLKER_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x1391d)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_WHYVOLKER_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ars_HELLO_Why_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WhyVolker_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_WhyVolker_03_02");
}

instance DIA_KESSEL_CANYOUTEACH(C_INFO) {
    NPC = 0xdd70;
    NR = 600;
    CONDITION = DIA_KESSEL_CANYOUTEACH_CONDITION;
    INFORMATION = DIA_KESSEL_CANYOUTEACH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Can you teach me something?";
}

func int DIA_KESSEL_CANYOUTEACH_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x1391d)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_CANYOUTEACH_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    B_SAY(OTHER, SELF, "$MARVIN_CanYouTeachMe");
    if ((HERO.GUILD) == (GIL_VLK)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_CanYouTeach_03_01");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_CanYouTeach_03_02");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    LOG_CREATETOPIC(TOPIC_TEACHER, LOG_NOTE);
    AI_LOGENTRY(TOPIC_TEACHER, LOG_OTHER_KESSEL);
}

var int KESSEL_ARCHOLOS_CANTTEACH = 0;
var int KESSEL_ARCHOLOS_CURRENT1HLEVEL = 0;
var int KESSEL_ARCHOLOS_CURRENTCBLEVEL = 0;
instance DIA_KESSEL_ARCHOLOS_TEACH(C_INFO) {
    NPC = 0xdd70;
    NR = 998;
    CONDITION = DIA_KESSEL_ARCHOLOS_TEACH_CONDITION;
    INFORMATION = DIA_KESSEL_ARCHOLOS_TEACH_INFO;
    PERMANENT = 1;
    DESCRIPTION = "Teach me.";
}

func int DIA_KESSEL_ARCHOLOS_TEACH_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x1392b)) && ((KESSEL_ARCHOLOS_CANTTEACH) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_ARCHOLOS_TEACH_CHOICES() {
    KESSEL_GOLDCOST = 0;
    KESSEL_ARCHOLOS_CURRENT1HLEVEL = OTHER.AIVAR[84];
    KESSEL_ARCHOLOS_CURRENTCBLEVEL = OTHER.AIVAR[87];
    INFO_CLEARCHOICES(0x13931);
    INFO_ADDCHOICE(0x13931, DIALOG_BACK, 0x13936);
    if ((OTHER.AIVAR[84]) < (75)) {
        INFO_ADDCHOICE(0x13931, B_BUILDLEARNSTRING2(PRINT_LEARN1H1, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_1H, 1), KESSEL_GOLDCOST), 0x13937);
        INFO_ADDCHOICE(0x13931, B_BUILDLEARNSTRING2(PRINT_LEARN1H5, (B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_1H, 1)) * (5), (KESSEL_GOLDCOST) * (5)), 0x13938);
    };
    if ((OTHER.AIVAR[87]) < (75)) {
        INFO_ADDCHOICE(0x13931, B_BUILDLEARNSTRING2(PRINT_LEARNCROSSBOW1, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_CROSSBOW, 1), KESSEL_GOLDCOST), 0x13939);
        INFO_ADDCHOICE(0x13931, B_BUILDLEARNSTRING2(PRINT_LEARNCROSSBOW5, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_CROSSBOW, 5), (KESSEL_GOLDCOST) * (5)), 0x1393a);
    };
}

var int DIA_KESSEL_ARCHOLOS_TEACH_CHOICES.KESSEL_GOLDCOST = 0;
func void DIA_KESSEL_ARCHOLOS_TEACH_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_TeachMe");
    DIA_KESSEL_ARCHOLOS_TEACH_CHOICES();
}

func void DIA_KESSEL_ARCHOLOS_TEACH_BACK() {
    if (((OTHER.AIVAR[84]) >= (75)) && ((OTHER.AIVAR[87]) >= (75))) {
        B_SAY(SELF, OTHER, "$NoLearnYoureBetter");
        KESSEL_ARCHOLOS_CANTTEACH = TRUE;
    };
    INFO_CLEARCHOICES(0x13931);
}

func void DIA_KESSEL_ARCHOLOS_TEACH_1H_1() {
    if ((KESSEL_ARCHOLOS_CURRENT1HLEVEL) < (OTHER.AIVAR[84])) {
        B_SAY(SELF, OTHER, "$YouLearnedSomething");
    };
    B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_1H, 1, 75);
    DIA_KESSEL_ARCHOLOS_TEACH_CHOICES();
}

func void DIA_KESSEL_ARCHOLOS_TEACH_1H_5() {
    if ((KESSEL_ARCHOLOS_CURRENT1HLEVEL) < (OTHER.AIVAR[84])) {
        B_SAY(SELF, OTHER, "$YouLearnedSomething");
    };
    B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_1H, 5, 75);
    DIA_KESSEL_ARCHOLOS_TEACH_CHOICES();
}

func void DIA_KESSEL_ARCHOLOS_TEACH_CROSSBOW1() {
    if ((KESSEL_ARCHOLOS_CURRENTCBLEVEL) < (OTHER.AIVAR[87])) {
        B_SAY(SELF, OTHER, "$YouLearnedSomething");
    };
    B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_CROSSBOW, 1, 75);
    DIA_KESSEL_ARCHOLOS_TEACH_CHOICES();
}

func void DIA_KESSEL_ARCHOLOS_TEACH_CROSSBOW5() {
    if ((KESSEL_ARCHOLOS_CURRENTCBLEVEL) < (OTHER.AIVAR[87])) {
        B_SAY(SELF, OTHER, "$YouLearnedSomething");
    };
    B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_CROSSBOW, 5, 75);
    DIA_KESSEL_ARCHOLOS_TEACH_CHOICES();
}

instance TRIA_KESSEL_Q503_START(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = TRIA_KESSEL_Q503_START_CONDITION;
    INFORMATION = TRIA_KESSEL_Q503_START_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int TRIA_KESSEL_Q503_START_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q502)) == (LOG_RUNNING)) && ((Q502_PREPAREKESSEL) == (1))) {
        if (((NPC_GETDISTTOWP(NONE_202_KESSEL, "PART5_KESSEL_WAIT")) <= (500)) && ((NPC_GETDISTTOWP(KDW_203_RIORDIAN, "PART5_RIORDIAN_WAIT")) <= (500))) {
            if (((NPC_ISDEAD(BDT_13769_MANHUNTER)) && (NPC_ISDEAD(BDT_13767_MANHUNTER))) && (NPC_ISDEAD(BDT_13768_MANHUNTER))) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void TRIA_KESSEL_Q503_START_INFO() {
    TRIA_INVITE(KDW_203_RIORDIAN);
    TRIA_START();
    AI_SETWALKMODE(KDW_203_RIORDIAN, NPC_RUN);
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_NEARCASTLE_01");
    TELEPORTNPCTOWP(0x71b, "PART5_PATH_21");
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    TELEPORTNPCTOWP(0xdd70, NONE_202_KESSEL.WP);
    AI_STOPLOOKAT(SELF);
    AI_LOOKATNPC(OTHER, SELF);
    AI_TURNTONPC(SELF, OTHER);
    AI_TURNTONPC(OTHER, SELF);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_03_01");
    INFO_CLEARCHOICES(0x1393b);
    INFO_ADDCHOICE(0x1393b, "I haven't seen Usurer's men anywhere.", 0x1393f);
    INFO_ADDCHOICE(0x1393b, "I came across one or two Volker patrols.", 0x13940);
}

func void TRIA_KESSEL_Q503_START_NEXT() {
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_03_02");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_03_03");
    INFO_CLEARCHOICES(0x1393b);
    INFO_ADDCHOICE(0x1393b, "Let's not waste time.", 0x13942);
    INFO_ADDCHOICE(0x1393b, "Will this man ever give us even a moment's peace?", 0x13943);
}

func void TRIA_KESSEL_Q503_START_NO() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_No_15_01");
    TRIA_KESSEL_Q503_START_NEXT();
}

func void TRIA_KESSEL_Q503_START_YES() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_Yes_15_01");
    TRIA_KESSEL_Q503_START_NEXT();
}

func void TRIA_KESSEL_Q503_START_NEXT2() {
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Next_03_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_Next_03_02");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Next_03_03");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Next_03_04");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Next_03_05");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_FUNCTION(SELF, 0x13947);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_Next_03_06");
    INFO_CLEARCHOICES(0x1393b);
    INFO_ADDCHOICE(0x1393b, "Look around, don't touch anything and listen carefully, I understand.", 0x13944);
    INFO_ADDCHOICE(0x1393b, "Is there anything else I should know before we head out there?", 0x13945);
}

func void TRIA_KESSEL_Q503_START_GO() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_Go_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_FUNCTION(SELF, 0x13946);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_Go_03_02");
    TRIA_KESSEL_Q503_START_NEXT2();
}

func void TRIA_KESSEL_Q503_START_VOLKER() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_Volker_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_FUNCTION(SELF, 0x13946);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_Volker_03_02");
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_Start_Volker_03_03");
    TRIA_KESSEL_Q503_START_NEXT2();
}

func void TRIA_KESSEL_Q503_START_VOLKER_NEXT_LETSGO() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_LetsGo_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    TRIA_FINISH();
    INFO_CLEARCHOICES(0x1393b);
    AI_STOPPROCESSINFOS(SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    B_GIVEPLAYERXP(XP_Q502_FINISH);
    LOG_SETSTATUS(_@(MIS_Q502), TOPIC_Q502, LOG_SUCCESS);
    AI_LOGENTRY(TOPIC_Q502, LOG_Q502_FINISH);
    LOG_CREATETOPIC(TOPIC_Q503, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q503), TOPIC_Q503, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q503, LOG_Q503_START);
    AI_FUNCTION(SELF, 0x1394b);
    AI_FUNCTION(SELF, 0x13948);
}

func void TRIA_KESSEL_Q503_START_VOLKER_NEXT_KNOW() {
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_Start_Know_15_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Know_03_02");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Know_03_03");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_Start_Know_03_04");
}

func void KESSEL_Q503_NEARCASTLE_CAMERA_01() {
    WLD_SENDTRIGGER("KM_NEARCASTLE_02");
    WLD_SENDUNTRIGGER("KM_NEARCASTLE_01");
}

func void KESSEL_Q503_NEARCASTLE_CAMERA_02() {
    WLD_SENDTRIGGER("KM_NEARCASTLE_03");
    WLD_SENDUNTRIGGER("KM_NEARCASTLE_02");
}

func void KESSEL_Q503_FINISHCAMERA() {
    FF_APPLYONCEEXT(0x13949, 75, 4);
}

func void KESSEL_Q503_FINISHCAMERA_APPLY() {
    KESSEL_Q503_FINISHCAMERA_COUNT = (KESSEL_Q503_FINISHCAMERA_COUNT) + (1);
    if ((KESSEL_Q503_FINISHCAMERA_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KM_NEARCASTLE_01");
        WLD_SENDUNTRIGGER("KM_NEARCASTLE_02");
        WLD_SENDUNTRIGGER("KM_NEARCASTLE_03");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
    };
}

var int KESSEL_Q503_FINISHCAMERA_APPLY.KESSEL_Q503_FINISHCAMERA_COUNT = 0;
func void KESSEL_Q503_CHANGERTN() {
    Q503_GOTOVOLFZACKE = 1;
    NONE_202_KESSEL.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(NONE_202_KESSEL, "Q503_GUIDE");
    Q503_KESSEL_RTNCHECK = 4;
    KDW_203_RIORDIAN.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(KDW_203_RIORDIAN, "Q503_GUIDE");
}

instance TRIA_KESSEL_Q503_NEXTWAVE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = TRIA_KESSEL_Q503_NEXTWAVE_CONDITION;
    INFORMATION = TRIA_KESSEL_Q503_NEXTWAVE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int TRIA_KESSEL_Q503_NEXTWAVE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && ((Q503_GOTOVOLFZACKE) == (2))) {
        if (((NPC_GETDISTTOWP(KDW_203_RIORDIAN, "PART5_VOLFZACK_RIORDIAN")) <= (500)) && ((NPC_GETDISTTOWP(NONE_202_KESSEL, "PART5_VOLFZACK_KESSEL")) <= (500))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void TRIA_KESSEL_Q503_NEXTWAVE_INFO() {
    TRIA_INVITE(KDW_203_RIORDIAN);
    TRIA_START();
    AI_SETWALKMODE(KDW_203_RIORDIAN, NPC_RUN);
    AI_STOPLOOKAT(SELF);
    AI_LOOKATNPC(OTHER, SELF);
    AI_TURNTONPC(SELF, HERO);
    AI_TURNTONPC(KDW_203_RIORDIAN, HERO);
    AI_TURNTONPC(HERO, SELF);
    AI_FUNCTION(SELF, 0x1394f);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_NEXTWAVE_03_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_FUNCTION(SELF, 0x13950);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_NEXTWAVE_03_02");
    AI_FUNCTION(SELF, 0x13951);
    TRIA_FINISH();
    AI_STOPPROCESSINFOS(SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
}

func void Q503_VOLFZACKE_NEXTWAVE_01() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_VOLFZACKE_NEXTWAVE_01");
    TELEPORTNPCTOWP(0x71b, "PART_VOLFZACKE_16");
    TELEPORTNPCTOWP(0xdd70, "PART5_VOLFZACK_KESSEL");
    TELEPORTNPCTOWP(0xdd28, "PART5_VOLFZACK_RIORDIAN");
}

func void Q503_VOLFZACKE_NEXTWAVE_02() {
    WLD_SENDTRIGGER("KM_VOLFZACKE_NEXTWAVE_02");
    WLD_SENDUNTRIGGER("KM_VOLFZACKE_NEXTWAVE_01");
    FF_APPLYONCEEXT(0xf7ca, 0x4b0, 8);
}

func void Q503_VOLFZACKE_NEXTWAVE_END() {
    FF_APPLYONCEEXT(0x13952, 75, 4);
    Q503_GOTOVOLFZACKE = 3;
    NPC_EXCHANGEROUTINE(NONE_202_KESSEL, "Q503FIGHT");
    Q503_KESSEL_RTNCHECK = 5;
    NPC_EXCHANGEROUTINE(KDW_203_RIORDIAN, "Q503FIGHT");
}

func void Q503_VOLFZACKE_NEXTWAVE_END_APPLY() {
    Q503_VOLFZACKE_NEXTWAVE_END_COUNT = (Q503_VOLFZACKE_NEXTWAVE_END_COUNT) + (1);
    if ((Q503_VOLFZACKE_NEXTWAVE_END_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_NEXTWAVE_01");
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_NEXTWAVE_02");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q503_VOLFZACKE_NEXTWAVE_END_APPLY.Q503_VOLFZACKE_NEXTWAVE_END_COUNT = 0;
instance TRIA_KESSEL_Q503_LASTWAVE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = TRIA_KESSEL_Q503_LASTWAVE_CONDITION;
    INFORMATION = TRIA_KESSEL_Q503_LASTWAVE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int TRIA_KESSEL_Q503_LASTWAVE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && ((Q503_GOTOVOLFZACKE) == (3))) {
        if (((NPC_GETDISTTOWP(KDW_203_RIORDIAN, "PART5_VOLFZACK_RIORDIAN_FIGHT")) <= (500)) && ((NPC_GETDISTTOWP(NONE_202_KESSEL, "PART5_VOLFZACK_KESSEL_FIGHT")) <= (500))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void TRIA_KESSEL_Q503_LASTWAVE_INFO() {
    TRIA_INVITE(KDW_203_RIORDIAN);
    TRIA_START();
    AI_FUNCTION(SELF, 0x13958);
    AI_SETWALKMODE(KDW_203_RIORDIAN, NPC_RUN);
    AI_STOPLOOKAT(SELF);
    AI_LOOKATNPC(OTHER, SELF);
    AI_TURNTONPC(SELF, HERO);
    AI_TURNTONPC(KDW_203_RIORDIAN, HERO);
    AI_TURNTONPC(HERO, SELF);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_LASTWAVE_03_01");
    AI_FUNCTION(SELF, 0x13957);
    AI_WAITTILLEND(KDW_203_RIORDIAN, SELF);
    AI_WAITTILLEND(HERO, SELF);
    AI_WAIT(KDW_203_RIORDIAN, 0x3f800000);
    AI_PLAYANI(KDW_203_RIORDIAN, T_SEARCH);
    AI_PLAYANI(SELF, T_SEARCH);
    AI_TURNTONPC(SELF, SKELETON_WS_H_IMMORTAL_01);
    AI_TURNTONPC(KDW_203_RIORDIAN, SKELETON_WS_H_IMMORTAL_01);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_LASTWAVE_03_02");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_FUNCTION(SELF, 0x13959);
    AI_TURNTONPC(SELF, HERO);
    AI_TURNTONPC(KDW_203_RIORDIAN, HERO);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_LASTWAVE_03_03");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_LASTWAVE_03_04");
    AI_FUNCTION(SELF, 0x1395a);
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_LASTWAVE_15_05");
    AI_FUNCTION(SELF, 0x1395b);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_LASTWAVE_03_06");
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_LASTWAVE_03_07");
    AI_FUNCTION(SELF, 0x1395c);
    TRIA_FINISH();
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q503, LOG_Q503_LASTWAVE);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
}

func void Q503_VOLFZACKE_LASTWAVE_SPAWNZOMBIES() {
    WLD_INSERTNPC(0xc3c7, "FP_PART5_SPAWNPOINT_23");
    WLD_PLAYEFFECT("spellFX_INCOVATION_VIOLET", SKELETON_WS_H_IMMORTAL_01, SKELETON_WS_H_IMMORTAL_01, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("FX_EarthQuake", SKELETON_WS_H_IMMORTAL_01, SKELETON_WS_H_IMMORTAL_01, 0, 0, 0, FALSE);
}

func void Q503_VOLFZACKE_LASTWAVE_01() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_VOLFZACKE_LASTWAVE_01");
    TELEPORTNPCTOWP(0x71b, "PART_VOLFZACKE_12");
    TELEPORTNPCTOWP(0xdd70, "PART5_VOLFZACK_KESSEL_FIGHT");
    TELEPORTNPCTOWP(0xdd28, "PART5_VOLFZACK_RIORDIAN_FIGHT");
}

func void Q503_VOLFZACKE_LASTWAVE_02() {
    WLD_SENDTRIGGER("KM_VOLFZACKE_LASTWAVE_02");
    WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_01");
    WLD_INSERTNPC(0xc6b8, "PART5_VOLFZACKE_MAGE");
    WLD_INSERTNPC(0xc819, "FP_SPAWNPOINT_MAGEBOSS_02");
    WLD_INSERTNPC(0xc81a, "FP_SPAWNPOINT_MAGEBOSS_03");
    WLD_PLAYEFFECT("spellFX_INCOVATION_VIOLET_NOLIGHT", VOLFZACKEMAGE_BOSS, VOLFZACKEMAGE_BOSS, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("FX_EarthQuake", VOLFZACKEMAGE_BOSS, VOLFZACKEMAGE_BOSS, 0, 0, 0, FALSE);
}

func void Q503_VOLFZACKE_LASTWAVE_03() {
    WLD_SENDTRIGGER("KM_VOLFZACKE_LASTWAVE_03");
    WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_02");
}

func void Q503_VOLFZACKE_LASTWAVE_04() {
    WLD_SENDTRIGGER("KM_VOLFZACKE_LASTWAVE_04");
    WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_03");
}

func void Q503_VOLFZACKE_LASTWAVE_END() {
    Q503_GOTOVOLFZACKE = 4;
    Q503_CANUSETELEPORT = 1;
    FF_APPLYONCEEXT(0x1395d, 75, 4);
}

func void Q503_VOLFZACKE_LASTWAVE_END_APPLY() {
    Q503_VOLFZACKE_LASTWAVE_END_COUNT = (Q503_VOLFZACKE_LASTWAVE_END_COUNT) + (1);
    if ((Q503_VOLFZACKE_LASTWAVE_END_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_01");
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_02");
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_03");
        WLD_SENDUNTRIGGER("KM_VOLFZACKE_LASTWAVE_04");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
        FF_APPLYONCEEXT(0xf7cb, 0x4b0, 8);
    };
}

var int Q503_VOLFZACKE_LASTWAVE_END_APPLY.Q503_VOLFZACKE_LASTWAVE_END_COUNT = 0;
instance TRIA_KESSEL_Q503_AFTERFIGHT(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = TRIA_KESSEL_Q503_AFTERFIGHT_CONDITION;
    INFORMATION = TRIA_KESSEL_Q503_AFTERFIGHT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int TRIA_KESSEL_Q503_AFTERFIGHT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && ((Q503_GOTOVOLFZACKE) == (5))) {
        if (((NPC_GETDISTTOWP(KDW_203_RIORDIAN, "PART5_VOLFZACKE_RIORDIAN_TIRED")) <= (500)) && ((NPC_GETDISTTOWP(NONE_202_KESSEL, "PART5_VOLFZACKE_KESSEL_TIRED")) <= (500))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void TRIA_KESSEL_Q503_AFTERFIGHT_INFO() {
    TRIA_INVITE(KDW_203_RIORDIAN);
    TRIA_START();
    AI_SETWALKMODE(KDW_203_RIORDIAN, NPC_RUN);
    AI_LOOKATNPC(SELF, OTHER);
    AI_STOPLOOKAT(SELF);
    B_STANDUP();
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_AfterFight_15_01");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_AfterFight_03_02");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_AfterFight_03_03");
    INFO_CLEARCHOICES(0x1395f);
    INFO_ADDCHOICE(0x1395f, "I managed to open a passage deep into the fortress.", 0x13962);
}

func void TRIA_KESSEL_Q503_AFTERFIGHT_NEXT() {
    Q503_GOTOVOLFZACKE = 6;
    AI_OUTPUT(OTHER, SELF, "TRIA_Kessel_Q503_AfterFight_Next_15_01");
    TRIA_WAIT();
    TRIA_NEXT(KDW_203_RIORDIAN);
    AI_OUTPUT(SELF, OTHER, "TRIA_Riordian_Q503_AfterFight_Next_03_02");
    TRIA_WAIT();
    TRIA_NEXT(NONE_202_KESSEL);
    AI_OUTPUT(SELF, OTHER, "TRIA_Kessel_Q503_AfterFight_Next_03_03");
    TRIA_FINISH();
    INFO_CLEARCHOICES(0x1395f);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q503, LOG_Q503_AFTERFIGHT);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_FUNCTION(SELF, 0x13963);
}

func void KESSEL_Q503_CHANGERTN_V2() {
    NPC_EXCHANGEROUTINE(NONE_202_KESSEL, "Q503_GATESEARCH");
    Q503_KESSEL_RTNCHECK = 7;
    NPC_EXCHANGEROUTINE(KDW_203_RIORDIAN, "Q503_GATESEARCH");
}

instance DIA_KESSEL_Q503_TELEPORT(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q503_TELEPORT_CONDITION;
    INFORMATION = DIA_KESSEL_Q503_TELEPORT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q503_TELEPORT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && ((Q503_GOTOVOLFZACKE) == (7))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int Q504_WECANSTART = 0;
func void DIA_KESSEL_Q503_TELEPORT_INFO() {
    Q504_WECANSTART = TRUE;
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q503_Teleport_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q503_Teleport_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q503_Teleport_03_03");
    AI_RESETFACEANI(SELF);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_KESSEL_Q505_START(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q505_START_CONDITION;
    INFORMATION = DIA_KESSEL_Q505_START_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q505_START_CONDITION() {
    if ((LOG_GETSTATUS(MIS_Q505)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q505_START_INFO() {
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_03_01");
    INFO_CLEARCHOICES(0x13968);
    INFO_ADDCHOICE(0x13968, "Yes, Riordian is in the process of putting them together.", 0x1396b);
}

func void DIA_KESSEL_Q505_START_YES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_Start_Yes_15_01");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Yes_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Yes_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Yes_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Yes_03_05");
    INFO_CLEARCHOICES(0x13968);
    INFO_ADDCHOICE(0x13968, "I have to get something else done first...", 0x13970);
    INFO_ADDCHOICE(0x13968, "Let's start preparing.", 0x1396d);
}

var int KESSEL_Q505_PREPARETIME = 0;
func void DIA_KESSEL_Q505_START_YES_GO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_Start_Go_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Go_03_02");
    NPC_EXCHANGEROUTINE(NONE_202_KESSEL, "Q505_WAITCAMP");
    INFO_CLEARCHOICES(0x13968);
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(SELF);
    AI_FUNCTION(SELF, 0x1396e);
}

func void KESSEL_Q505_PREPARETIME_FADE() {
    FADESCREENTOBLACKF(1, 0x1396f, 1000);
}

func void KESSEL_Q505_PREPARETIME_FADESCREEN() {
    KESSEL_Q505_PREPARETIME = 2;
    FADESCREENFROMBLACK(1);
    WLD_SETTIME(19, 0);
    SETHOLDTIME(TRUE);
    TELEPORTNPCTOWP(0xdd70, NONE_202_KESSEL.WP);
    TELEPORTNPCTOWP(0x71b, "PART5_Q505_HERO");
    Q506_PREPARESCENE();
    Q505_PREPARESCENE();
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q505_WAITCAMP");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
}

func void DIA_KESSEL_Q505_START_YES_WAIT() {
    KESSEL_Q505_PREPARETIME = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_Start_Wait_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Start_Wait_03_02");
    INFO_CLEARCHOICES(0x13968);
    AI_RESETFACEANI(SELF);
}

instance DIA_KESSEL_Q505_PREPARE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q505_PREPARE_CONDITION;
    INFORMATION = DIA_KESSEL_Q505_PREPARE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Let's start preparing.";
}

func int DIA_KESSEL_Q505_PREPARE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q505)) == (LOG_RUNNING)) && ((KESSEL_Q505_PREPARETIME) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q505_PREPARE_INFO() {
    DIA_KESSEL_Q505_START_YES_GO();
}

instance DIA_KESSEL_Q505_WHATDO(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q505_WHATDO_CONDITION;
    INFORMATION = DIA_KESSEL_Q505_WHATDO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q505_WHATDO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q505)) == (LOG_RUNNING)) && ((KESSEL_Q505_PREPARETIME) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q505_WHATDO_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_03_04");
    INFO_CLEARCHOICES(0x13974);
    INFO_ADDCHOICE(0x13974, "Maybe I could get something too?", 0x13978);
    INFO_ADDCHOICE(0x13974, DIALOG_BESILENT, 0x13979);
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_FoodNext_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_FoodNext_03_02");
    INFO_CLEARCHOICES(0x13974);
    INFO_ADDCHOICE(0x13974, "Do you think these supplies will be enough for us?", 0x1397c);
    INFO_ADDCHOICE(0x13974, DIALOG_BESILENT, 0x1397d);
}

func void DIA_KESSEL_Q505_WHATDO_HELP() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Help_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Help_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Help_03_03");
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT();
}

func void DIA_KESSEL_Q505_WHATDO_SILENCE() {
    AI_WAIT(OTHER, 0x3f000000);
    AI_WAITTILLEND(SELF, OTHER);
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT();
}

var int KESSEL_Q505_WHATDO_NOWORKERS = 0;
func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_WorkersNext_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_WorkersNext_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_WorkersNext_03_03");
    INFO_CLEARCHOICES(0x13974);
    if (Q504_CANTAKEANYONE()) {
        INFO_ADDCHOICE(0x13974, "I've met a few of these people in my travels.", 0x1397f);
    };
    INFO_ADDCHOICE(0x13974, "No one comes to mind.", 0x13981);
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK() {
    AI_STARTFACEANI(OTHER, S_THINK, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Think_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Think_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Think_03_03");
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_SILENCE2() {
    AI_WAIT(OTHER, 0x3f000000);
    AI_WAITTILLEND(SELF, OTHER);
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER() {
    LOG_CREATETOPIC(TOPIC_Q504, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q504), TOPIC_Q504, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q504, LOG_Q504_START);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q504_START);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Leader_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Leader_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Leader_03_03");
    INFO_CLEARCHOICES(0x13974);
    INFO_ADDCHOICE(0x13974, "How can you be sure they are the right candidates?", 0x13982);
    INFO_ADDCHOICE(0x13974, "Okay, I'll take care of it.", 0x13984);
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_FEW() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Few_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Few_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Few_03_03");
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_DIALOGUE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Nope_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Nope_03_02");
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE() {
    KESSEL_Q505_WHATDO_NOWORKERS = TRUE;
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_DIALOGUE();
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_WHY() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Why_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Why_03_02");
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS() {
    LOG_CREATETOPIC(TOPIC_Q506, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q506), TOPIC_Q506, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q506, LOG_Q506_START);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q506_START);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Warriors_03_06");
    INFO_CLEARCHOICES(0x13974);
    INFO_ADDCHOICE(0x13974, "Do you know where I can find such warriors?", 0x13985);
    INFO_ADDCHOICE(0x13974, "I will find those warriors.", 0x1398a);
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Okay_15_01");
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_WHERE() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Where_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Where_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Where_03_03");
}

var int KESSEL_Q505_WHATDO_QUESTIONS_NEED = 0;
var int KESSEL_Q505_WHATDO_QUESTIONS_VOLKER = 0;
var int KESSEL_Q505_WHATDO_QUESTIONS_TELL = 0;
func void DIA_KESSEL_Q505_WHATDO_QUESTIONS() {
    INFO_CLEARCHOICES(0x13974);
    INFO_ADDCHOICE(0x13974, "All clear, I'll get to work.", 0x1398e);
    if ((KESSEL_Q505_WHATDO_QUESTIONS_NEED) == (FALSE)) {
        INFO_ADDCHOICE(0x13974, "Do we really need all this?", 0x1398b);
    };
    if ((KESSEL_Q505_WHATDO_QUESTIONS_VOLKER) == (FALSE)) {
        INFO_ADDCHOICE(0x13974, "Wouldn't it be easier to just attack the Usurer?", 0x1398c);
    };
    if ((KESSEL_Q505_WHATDO_QUESTIONS_TELL) == (FALSE)) {
        INFO_ADDCHOICE(0x13974, "What should I tell the warriors?", 0x1398d);
    };
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_FIND() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Find_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Find_03_02");
    LOG_CREATETOPIC(TOPIC_Q509, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q509), TOPIC_Q509, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q509, LOG_Q509_START);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q509_START);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Questions_03_01");
    DIA_KESSEL_Q505_WHATDO_QUESTIONS();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_FIND_QUESTIONS_NEED() {
    KESSEL_Q505_WHATDO_QUESTIONS_NEED = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Need_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Need_03_02");
    DIA_KESSEL_Q505_WHATDO_QUESTIONS();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_FIND_QUESTIONS_VOLKER() {
    KESSEL_Q505_WHATDO_QUESTIONS_VOLKER = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Volker_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Volker_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Volker_03_03");
    DIA_KESSEL_Q505_WHATDO_QUESTIONS();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_FIND_QUESTIONS_TELL() {
    KESSEL_Q505_WHATDO_QUESTIONS_TELL = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_Tell_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Tell_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_Tell_03_03");
    DIA_KESSEL_Q505_WHATDO_QUESTIONS();
}

func void DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_LEADER_OKAY_WARRIORS_FIND_QUESTIONS_LETSGO() {
    SETHOLDTIME(FALSE);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_WhatDo_LetsGo_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_LetsGo_03_02");
    if ((KESSEL_Q505_WHATDO_NOWORKERS) == (TRUE)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_LetsGo_03_03");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_WhatDo_LetsGo_03_04");
    INFO_CLEARCHOICES(0x13974);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q505_EXTRASTUFF);
}

instance DIA_KESSEL_Q504_WORKERS(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q504_WORKERS_CONDITION;
    INFORMATION = DIA_KESSEL_Q504_WORKERS_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "As for the workers...";
}

func int DIA_KESSEL_Q504_WORKERS_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x13974)) && ((LOG_GETSTATUS(MIS_Q505)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q504_WORKERS_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_15_01");
    INFO_CLEARCHOICES(0x1398f);
    if (Q504_CANTAKEANYONE()) {
        INFO_ADDCHOICE(0x1398f, "I have some ideas...", 0x13993);
    };
    INFO_ADDCHOICE(0x1398f, "No one comes to mind.", 0x13997);
}

func void DIA_KESSEL_Q504_WORKERS_CHOICES() {
    INFO_CLEARCHOICES(0x1398f);
    if (((Q504_CARPENTERSCOUNT) >= (1)) || ((Q504_MINERSCOUNT) >= (1))) {
        INFO_ADDCHOICE(0x1398f, "I don't think I know any more people who can help us.", 0x1399f);
    };
    if ((Q504_MINERSCOUNT) != (1)) {
        if ((((LOG_GETSTATUS(MIS_QA306)) == (LOG_SUCCESS)) && ((QA306_LOAFSJUDGMENT_RESULT) != (1))) && ((Q504_LOAFSVOLFZACKE) == (0))) {
            INFO_ADDCHOICE(0x1398f, "I had the opportunity to work with Loafs and his people.", 0x1399e);
        };
        if (((LOG_GETSTATUS(MIS_SQ301)) == (LOG_SUCCESS)) && ((Q504_NIVELMIROHVOLFZACKE) == (0))) {
            if (((NPC_ISDEAD(VLK_6357_NIVEL)) == (FALSE)) && ((NPC_ISDEAD(VLK_6358_MIROH)) == (FALSE))) {
                INFO_ADDCHOICE(0x1398f, "Nivel, Miroh and I have been through a bit...", 0x1399d);
            };
        };
        if (((LOG_GETSTATUS(MIS_SQ311)) == (LOG_SUCCESS)) && ((Q504_REFIRNERALVOLFZACKE) == (0))) {
            INFO_ADDCHOICE(0x1398f, "At the Royal Mine, I helped Refir and Neral.", 0x1399c);
        };
    };
    if ((Q504_CARPENTERSCOUNT) != (2)) {
        if (((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS)) && ((Q504_RUUDVOLFZACKE) == (0))) {
            INFO_ADDCHOICE(0x1398f, "I recently helped a shipyard worker, Ruud.", 0x1399b);
        };
        if (((CQ004_RESULT) == (1)) && ((Q504_VEIGOVOLFZACKE) == (0))) {
            INFO_ADDCHOICE(0x1398f, "In the city, I met a man named Veigo...", 0x1399a);
        };
        if ((((SQ221_UWE_WORK) >= (4)) && ((Q504_UWEVOLFZACKE) == (0))) && ((LOG_GETSTATUS(MIS_SQ221)) == (LOG_SUCCESS))) {
            INFO_ADDCHOICE(0x1398f, "Near Silbach I repaired a bridge together with Uwe.", 0x13999);
        };
        if (((Q401_ESTICUTTERS) == (2)) && ((Q504_LOWELLVOLFZACKE) == (0))) {
            INFO_ADDCHOICE(0x1398f, "I know an experienced woodcutter, his name is Lowell.", 0x13998);
        };
    };
}

func void DIA_KESSEL_Q504_WORKERS_IDEA() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Idea_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Idea_03_02");
    DIA_KESSEL_Q504_WORKERS_CHOICES();
}

func void DIA_KESSEL_Q504_WORKERS_FINISH() {
    Q504_TAKEWORKERS = 1;
    Q504_TAKEWORKERS_DAY = WLD_GETDAY();
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Finish_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Finish_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Finish_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Finish_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Finish_03_05");
    AI_LOGENTRY(TOPIC_Q504, LOG_Q504_WORKERSDONE);
    INFO_CLEARCHOICES(0x1398f);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_NEXT() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Next_03_01");
    DIA_KESSEL_Q504_WORKERS_FINISH();
}

func void DIA_KESSEL_Q504_WORKERS_COUNT() {
    if (((Q504_CARPENTERSCOUNT) == (2)) && ((Q504_MINERSCOUNT) == (1))) {
        DIA_KESSEL_Q504_WORKERS_IDEA_NEXT();
    };
    DIA_KESSEL_Q504_WORKERS_CHOICES();
}

func void DIA_KESSEL_Q504_WORKERS_NOONE() {
    DIA_KESSEL_Q505_WHATDO_HELP_FOODNEXT_THINK_WORKERSNEXT_NOPE_DIALOGUE();
    Q504_KESSELTAKEWORKERS();
    DIA_KESSEL_Q504_WORKERS_FINISH();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_LOWELL() {
    Q504_CARPENTERSCOUNT = (Q504_CARPENTERSCOUNT) + (1);
    Q504_LOWELLVOLFZACKE = TRUE;
    B_GIVEPLAYERXP(XP_VARHDAL_RECRUIT);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Lowell_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Lowell_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Lowell_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_UWE() {
    Q504_CARPENTERSCOUNT = (Q504_CARPENTERSCOUNT) + (1);
    Q504_UWEVOLFZACKE = TRUE;
    B_GIVEPLAYERXP(XP_VARHDAL_RECRUIT);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Uwe_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Uwe_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Uwe_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_VEIGO() {
    Q504_CARPENTERSCOUNT = (Q504_CARPENTERSCOUNT) + (1);
    Q504_VEIGOVOLFZACKE = TRUE;
    B_GIVEPLAYERXP(XP_VARHDAL_RECRUIT);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Veigo_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Veigo_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Veigo_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_RUUD() {
    Q504_CARPENTERSCOUNT = (Q504_CARPENTERSCOUNT) + (1);
    Q504_RUUDVOLFZACKE = TRUE;
    B_GIVEPLAYERXP(XP_VARHDAL_RECRUIT);
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Ruud_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Ruud_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Ruud_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_REFIRNERAL() {
    Q504_MINERSCOUNT = (Q504_MINERSCOUNT) + (1);
    Q504_REFIRNERALVOLFZACKE = TRUE;
    B_GIVEPLAYERXP((XP_VARHDAL_RECRUIT) * (2));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_RefirNeral_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_RefirNeral_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_RefirNeral_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_NIVELMIROH() {
    Q504_MINERSCOUNT = (Q504_MINERSCOUNT) + (1);
    Q504_NIVELMIROHVOLFZACKE = TRUE;
    B_GIVEPLAYERXP((XP_VARHDAL_RECRUIT) * (2));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_NivelMiroh_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_NivelMiroh_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_NivelMiroh_03_03");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_LOAFS() {
    Q504_MINERSCOUNT = (Q504_MINERSCOUNT) + (1);
    Q504_LOAFSVOLFZACKE = TRUE;
    B_GIVEPLAYERXP((XP_VARHDAL_RECRUIT) * (2));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Loafs_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_Loafs_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Loafs_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_Loafs_03_04");
    DIA_KESSEL_Q504_WORKERS_COUNT();
}

func void DIA_KESSEL_Q504_WORKERS_IDEA_THATSALL() {
    Q504_KESSELTAKEWORKERS();
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q504_Workers_ThatsAll_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q504_Workers_ThatsAll_03_02");
    DIA_KESSEL_Q504_WORKERS_FINISH();
}

instance DIA_KESSEL_Q505_GOTWORKERS(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q505_GOTWORKERS_CONDITION;
    INFORMATION = DIA_KESSEL_Q505_GOTWORKERS_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_Q505_GOTWORKERS_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q505)) == (LOG_RUNNING)) && ((Q504_TAKEWORKERS) == (2))) && ((NPC_GETDISTTOWP(SELF, "PART5_Q505_KESSEL")) <= (0x1388))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int KESSEL_Q514_CANSTARTQUEST = 0;
func void DIA_KESSEL_Q505_CHECKIFREADY() {
    if ((((LOG_GETSTATUS(MIS_Q504)) == (LOG_SUCCESS)) && ((LOG_GETSTATUS(MIS_Q506)) == (LOG_SUCCESS))) && ((LOG_GETSTATUS(MIS_Q509)) == (LOG_SUCCESS))) {
        KESSEL_Q514_CANSTARTQUEST = TRUE;
        AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_Ready_03_01");
    };
}

func void DIA_KESSEL_Q505_GOTWORKERS_INFO() {
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_GotWorkers_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_GotWorkers_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_GotWorkers_03_03");
    INFO_CLEARCHOICES(0x139a0);
    INFO_ADDCHOICE(0x139a0, "Good to know we won't have to worry about equipment.", 0x139a7);
    INFO_ADDCHOICE(0x139a0, "I've already had the opportunity to meet them.", 0x139a6);
}

func void DIA_KESSEL_Q505_GOTWORKERS_FINISH() {
    INFO_CLEARCHOICES(0x139a0);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_LOGENTRY(TOPIC_Q504, LOG_Q504_KESSELBACK);
    LOG_SETSTATUS(_@(MIS_Q504), TOPIC_Q504, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q504_FINISH);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q504_KESSELBACK);
    DIA_KESSEL_Q505_CHECKIFREADY();
}

func void DIA_KESSEL_Q505_GOTWORKERS_KNOW() {
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_GotWorkers_Know_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q505_GotWorkers_Know_03_02");
    DIA_KESSEL_Q505_GOTWORKERS_FINISH();
}

func void DIA_KESSEL_Q505_GOTWORKERS_GOOD() {
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q505_GotWorkers_Good_15_01");
    DIA_KESSEL_Q505_GOTWORKERS_FINISH();
}

instance DIA_KESSEL_Q506_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q506_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_Q506_FINISH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Viran and Duster agreed to help us.";
}

func int DIA_KESSEL_Q506_FINISH_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q506)) == (LOG_RUNNING)) && ((Q506_VIRANVOLFZACKE) == (TRUE))) && ((Q506_DUSTERVOLFZACKE) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q506_FINISH_INFO() {
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q506_Finish_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q506_Finish_03_02");
    AI_RESETFACEANI(SELF);
    AI_LOGENTRY(TOPIC_Q506, LOG_Q506_FINISH);
    LOG_SETSTATUS(_@(MIS_Q506), TOPIC_Q506, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q506_FINISH);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q506_FINISH);
    DIA_KESSEL_Q505_CHECKIFREADY();
}

instance DIA_KESSEL_Q509_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q509_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_Q509_FINISH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I recruited warriors to defend the expedition.";
}

func int DIA_KESSEL_Q509_FINISH_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q509)) == (LOG_RUNNING)) && ((Q509_COUNTWARRIORS) == (4))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q509_FINISH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q509_Finish_15_01");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q509_Finish_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q509_Finish_03_03");
    AI_RESETFACEANI(SELF);
    AI_LOGENTRY(TOPIC_Q509, LOG_Q509_FINISH);
    LOG_SETSTATUS(_@(MIS_Q509), TOPIC_Q509, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q509_FINISH);
    AI_LOGENTRY(TOPIC_Q505, LOG_Q509_FINISH);
    DIA_KESSEL_Q505_CHECKIFREADY();
}

instance DIA_KESSEL_Q514_START(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_Q514_START_CONDITION;
    INFORMATION = DIA_KESSEL_Q514_START_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "There's no time to waste. Let's go.";
}

func int DIA_KESSEL_Q514_START_CONDITION() {
    if ((KESSEL_Q514_CANSTARTQUEST) == (TRUE)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_Q514_START_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_Q514_Start_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_Q514_Start_03_02");
    AI_STOPPROCESSINFOS(SELF);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q514_WAIT");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, "PART5_RIORDIAN_WAIT_INSIDE");
    AI_LOGENTRY(TOPIC_Q505, LOG_Q505_FINISH);
    LOG_SETSTATUS(_@(MIS_Q505), TOPIC_Q505, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q505_FINISH);
    LOG_CREATETOPIC(TOPIC_Q514, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_Q514), TOPIC_Q514, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_Q514, LOG_Q514_PRESTART);
}

instance DIA_KESSEL_SQ504_HAPPY(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_HAPPY_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_HAPPY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_SQ504_HAPPY_CONDITION() {
    if ((Q504_WECANSTART) == (TRUE)) {
        if (((HERO.GUILD) == (GIL_MIL)) || ((HERO.GUILD) == (GIL_SLD))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

var int KESSEL_SQ504_CANJOINWATERGUILD = 0;
func void DIA_KESSEL_SQ504_HAPPY_INFO() {
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_03_01");
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_03_02");
    };
    INFO_CLEARCHOICES(0x139b1);
    if ((HERO.GUILD) == (GIL_MIL)) {
        INFO_ADDCHOICE(0x139b1, "Roderich did everything he could to help me...", 0x139b8);
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        INFO_ADDCHOICE(0x139b1, "Lorenzo tried to help me from the very beginning.", 0x139b9);
    };
    INFO_ADDCHOICE(0x139b1, "I've accomplished a lot, but I feel used all the time...", 0x139b7);
}

func void DIA_KESSEL_SQ504_HAPPY_LORENZO_NEXT_BADEND() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_BadEnd_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_BadEnd_03_02");
    AI_RESETFACEANI(SELF);
    INFO_CLEARCHOICES(0x139b1);
}

func void DIA_KESSEL_SQ504_HAPPY_RODERICH_NEXT_GOODEND() {
    KESSEL_SQ504_CANJOINWATERGUILD = TRUE;
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_GoodEnd_03_01");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_GoodEnd_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_GoodEnd_03_03");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Happy_Next_GoodEnd_03_04");
    AI_RESETFACEANI(SELF);
    INFO_CLEARCHOICES(0x139b1);
}

func void DIA_KESSEL_SQ504_HAPPY_NOTHAPPY() {
    AI_STARTFACEANI(OTHER, S_TIRED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_NotHappy_15_01");
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_NotHappy_15_02");
    DIA_KESSEL_SQ504_HAPPY_RODERICH_NEXT_GOODEND();
}

func void DIA_KESSEL_SQ504_HAPPY_RODERICH() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_Roderich_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_Roderich_15_02");
    DIA_KESSEL_SQ504_HAPPY_LORENZO_NEXT_BADEND();
}

func void DIA_KESSEL_SQ504_HAPPY_LORENZO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_Lorenzo_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Happy_Lorenzo_15_02");
    DIA_KESSEL_SQ504_HAPPY_LORENZO_NEXT_BADEND();
}

instance DIA_KESSEL_SQ504_WHATNEXT(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_WHATNEXT_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_WHATNEXT_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What happens to the Ring of Water now?";
}

func int DIA_KESSEL_SQ504_WHATNEXT_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x13913)) && ((LOG_GETSTATUS(MIS_Q503)) != (LOG_SUCCESS))) && ((HERO.GUILD) == (GIL_VLK))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_WHATNEXT_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_WhatNext_15_01");
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_WhatNext_03_02");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_WhatNext_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_WhatNext_03_04");
}

instance DIA_KESSEL_SQ504_START(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_START_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_START_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Could I join the Ring of Water?";
}

func int DIA_KESSEL_SQ504_START_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x139ba)) || ((NPC_KNOWSINFO(OTHER, 0x139b1)) && ((KESSEL_SQ504_CANJOINWATERGUILD) == (TRUE)))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_START_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Start_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_03_03");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_03_04");
    if (((HERO.GUILD) == (GIL_MIL)) || ((HERO.GUILD) == (GIL_SLD))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_03_05");
    };
    INFO_CLEARCHOICES(0x139bd);
    INFO_ADDCHOICE(0x139bd, "What could I hope for as a member of the Ring of Water?", 0x139c0);
}

func void DIA_KESSEL_SQ504_START_WHAT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Start_What_15_01");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_What_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_What_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_What_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_What_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Start_What_03_06");
}

instance DIA_KESSEL_SQ504_JUSTICE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_JUSTICE_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_JUSTICE_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "I want to dedicate my life to justice.";
}

var int KESSEL_SQ504_MARVINHASNOGUILD = 0;
func int DIA_KESSEL_SQ504_JUSTICE_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x139bd)) && ((KESSEL_SQ504_MARVINHASNOGUILD) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_JUSTICE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Justice_15_01");
    if (((HERO.GUILD) == (GIL_MIL)) || ((HERO.GUILD) == (GIL_SLD))) {
        if ((HERO.GUILD) == (GIL_SLD)) {
            AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_05");
            AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_06");
        } else if ((HERO.GUILD) == (GIL_MIL)) {
            AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_07");
            AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_08");
            AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_09");
        };
    };
    KESSEL_SQ504_MARVINHASNOGUILD = TRUE;
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_03_04");
    INFO_CLEARCHOICES(0x139c1);
    INFO_ADDCHOICE(0x139c1, "What exactly am I supposed to do?", 0x139c5);
}

func void DIA_KESSEL_SQ504_JUSTICE_WHAT() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Justice_What_15_01");
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_What_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_What_03_03");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_What_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Justice_What_03_05");
    INFO_CLEARCHOICES(0x139c1);
    LOG_CREATETOPIC(TOPIC_SQ504, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ504), TOPIC_SQ504, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_SQ504, LOG_SQ504_START);
    CREATEINVITEMS(SELF, 0x9252, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x9252, 1);
}

instance DIA_KESSEL_SQ505_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ505_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_SQ505_FINISH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I got rid of the Usurer's shouters.";
}

func int DIA_KESSEL_SQ505_FINISH_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ505)) == (LOG_RUNNING)) && ((SQ505_REMOVEDVOLKERGUARDS_COUNT) >= (3))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ505_FINISH_NEXT() {
    NONE_13637_SLUMSGUARDIAN.FLAGS = 0;
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_Next_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Next_15_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Next_15_03");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Next_15_04");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_Next_03_05");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    AI_LOGENTRY(TOPIC_SQ505, LOG_SQ505_FINISH);
    LOG_SETSTATUS(_@(MIS_SQ505), TOPIC_SQ505, LOG_SUCCESS);
    RESTOREROUTINE_OKTAV();
    B_GIVEPLAYERXP(XP_SQ505_FINISH);
    INFO_CLEARCHOICES(0x139c6);
    SQ505_REMOVEVOLKERMAN_SLUMS();
    SQ505_REMOVEVOLKERMAN_M3();
    SQ505_REMOVEVOLKERMAN_M7();
}

func void DIA_KESSEL_SQ505_FINISH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_15_01");
    B_STANDUP();
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_03_02");
    if (NPC_ISDEAD(NONE_13640_VOLKERGUARD)) {
        INFO_CLEARCHOICES(0x139c6);
        INFO_ADDCHOICE(0x139c6, "But I was forced to kill an innocent kid...", 0x139ca);
    };
    FF_APPLYONCEEXTGT(0x7df3, 0, -(1));
    DIA_KESSEL_SQ505_FINISH_NEXT();
}

func void DIA_KESSEL_SQ505_FINISH_KILL() {
    AI_STARTFACEANI(OTHER, S_TIRED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Kill_15_01");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_Kill_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Kill_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ505_Finish_Kill_15_04");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_Kill_03_05");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ505_Finish_Kill_03_06");
    DIA_KESSEL_SQ505_FINISH_NEXT();
}

instance DIA_KESSEL_SQ504_JOIN(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_JOIN_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_JOIN_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Can I join the Ring of Water now?";
}

func int DIA_KESSEL_SQ504_JOIN_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ505)) == (LOG_SUCCESS)) && ((LOG_GETSTATUS(MIS_SQ504)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_JOIN_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Join_15_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_03_02");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_03_05");
    INFO_CLEARCHOICES(0x139cb);
    INFO_ADDCHOICE(0x139cb, "All right, let's go.", 0x139cf);
    INFO_ADDCHOICE(0x139cb, "Can't we do it here?", 0x139ce);
}

func void DIA_KESSEL_SQ504_JOIN_NOTHERE() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Join_NotHere_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_NotHere_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_NotHere_03_03");
}

func void DIA_KESSEL_SQ504_JOIN_GO() {
    RESERVED_VAR_INT_12 = 1;
    Q203_MILITIAGUILDREPUTATION = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Join_Go_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_Go_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Join_Go_03_03");
    NPC_EXCHANGEROUTINE(SELF, "SQ504_WAITBRIDGE");
    SQ504_KESSEL_RTNCHECK = 1;
    AI_LOGENTRY(TOPIC_SQ504, LOG_SQ504_KESSEL_GO);
    INFO_CLEARCHOICES(0x139cb);
}

instance DIA_KESSEL_SQ504_FINALLY(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_FINALLY_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_FINALLY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_SQ504_FINALLY_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ504)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x139cb))) && ((NPC_GETDISTTOWP(SELF, "PART14_SQ504_KESSEL_WAIT")) <= (800))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_FINALLY_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Finally_03_01");
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "SQ504_GUIDE");
    SQ504_KESSEL_RTNCHECK = 2;
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_SQ504, LOG_SQ504_KESSEL_GUIDE);
}

instance DIA_KESSEL_SQ504_PLACE(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_PLACE_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_PLACE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_SQ504_PLACE_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ504)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, "PART14_SQ504_KESSEL")) <= (600))) && (NPC_KNOWSINFO(OTHER, 0x139d0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_PLACE_INFO() {
    WLD_SENDTRIGGER("SQ504_MOVER_WASHSELF");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_PLAYANI(SELF, T_SEARCH);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Place_03_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Place_03_02");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Place_03_03");
    AI_LOGENTRY(TOPIC_SQ504, LOG_SQ504_KESSEL_WATER);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "SQ504_JOINCIRCLE");
    SQ504_KESSEL_RTNCHECK = 3;
}

instance DIA_KESSEL_SQ504_FINISH(C_INFO) {
    NPC = 0xdd70;
    NR = 1;
    CONDITION = DIA_KESSEL_SQ504_FINISH_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_FINISH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_KESSEL_SQ504_FINISH_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ504)) == (LOG_RUNNING)) && ((SQ504_WASHEDYOURSELF) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_FINISH_INFO() {
    AI_EQUIPARMOR(SELF, 0x8a3c);
    SQ504_JOINEDWATERCIRCLE = TRUE;
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Finish_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Finish_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Finish_03_03");
    AI_WAITTILLEND(OTHER, SELF);
    CREATEINVITEMS(SELF, 0x8a3c, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x8a3c, 1);
    CREATEINVITEMS(SELF, 0x9494, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x9494, 1);
    AI_EQUIPARMOR(HERO, 0x8a3c);
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Finish_03_04");
    AI_LOGENTRY(TOPIC_SQ504, LOG_SQ504_KESSEL_FINISH);
    LOG_SETSTATUS(_@(MIS_SQ504), TOPIC_SQ504, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_SQ504_FINISH);
    SELF.AIVAR[15] = FALSE;
    RESTOREROUTINE_KESSEL();
}

instance DIA_KESSEL_SQ504_RING(C_INFO) {
    NPC = 0xdd70;
    NR = 80;
    CONDITION = DIA_KESSEL_SQ504_RING_CONDITION;
    INFORMATION = DIA_KESSEL_SQ504_RING_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What kind of ring is that? It's the same ring my brother had on him.";
}

func int DIA_KESSEL_SQ504_RING_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ504)) == (LOG_SUCCESS)) && ((NPC_HASITEMS(OTHER, 0x9494)) >= (1))) && ((KESSEL_KNOWABOUTRING) == (FALSE))) {
        if ((NPC_KNOWSINFO(OTHER, 0x15777)) || ((NPC_HASITEMS(OTHER, 0x911a)) >= (1))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_KESSEL_SQ504_RING_INFO() {
    AI_STARTFACEANI(OTHER, S_THINK, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Ring_15_01");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Ring_03_02");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Ring_03_03");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Kessel_SQ504_Ring_15_04");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Ring_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Ring_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Kessel_SQ504_Ring_03_07");
}

