instance QM201_CUTSCENE(CUTSCENE) {
    ONSTART = FUNCTION(0x16a97);
}

func void QM201_CUTSCENE_WAIT() {
    AI_WAITTILLEND(MIL_4016_WEGAR, NONE_13585_THUG);
    AI_WAITTILLEND(MIL_4016_WEGAR, HERO);
    AI_WAITTILLEND(NONE_13585_THUG, MIL_4016_WEGAR);
    AI_WAITTILLEND(NONE_13585_THUG, HERO);
    AI_WAITTILLEND(HERO, MIL_4016_WEGAR);
    AI_WAITTILLEND(HERO, NONE_13585_THUG);
}

func void QM201_CUTSCENE_START() {
    WLD_SENDTRIGGER("QM201_WAIT_01");
    TELEPORTNPCTOWP(0x71b, "HARBOUR_PATH_503");
    TELEPORTNPCTOWP(0xce6f, MIL_4016_WEGAR.WP);
    AI_FUNCTION(MIL_4016_WEGAR, 0x16a98);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_GOTOWP(HERO, "HARBOUR_QM201_HERO");
    AI_TURNAWAY(HERO, MIL_4016_WEGAR);
}

func void QM201_CUTSCENE_FADE() {
    FADESCREENTOBLACKF(3, 0x16a99, 1000);
}

func void QM201_CUTSCENE_FADESCREEN() {
    TELEPORTNPCTOWP(0x71b, "HARBOUR_QM201_HERO");
    TELEPORTNPCTOWP(0xce6f, MIL_4016_WEGAR.WP);
    B_STARTOTHERROUTINE(MIL_13583_MILITIA, START);
    TELEPORTNPCTOWP(0xd282, MIL_13583_MILITIA.WP);
    B_STARTOTHERROUTINE(NONE_13584_PRISONER, START);
    TELEPORTNPCTOWP(0xd2bf, NONE_13584_PRISONER.WP);
    B_STARTOTHERROUTINE(NONE_13585_THUG, START);
    TELEPORTNPCTOWP(0xd2c2, NONE_13585_THUG.WP);
    B_STARTOTHERROUTINE(NONE_13586_THUG, START);
    TELEPORTNPCTOWP(0xd2c5, NONE_13586_THUG.WP);
    B_STARTOTHERROUTINE(NONE_13587_THUG, START);
    TELEPORTNPCTOWP(0xd2c8, NONE_13587_THUG.WP);
    WLD_SETTIME(1, 30);
    FF_APPLYONCEEXT(0x16a9a, 0x5dc, 5);
    NPC_CLEARAIQUEUE(NONE_13585_THUG);
    NPC_CLEARAIQUEUE(NONE_13586_THUG);
    NPC_CLEARAIQUEUE(NONE_13587_THUG);
    AI_TURNTONPC(HERO, NONE_13585_THUG);
    AI_TURNTONPC(MIL_4016_WEGAR, NONE_13585_THUG);
    AI_TURNTONPC(NONE_13584_PRISONER, NONE_13585_THUG);
    AI_TURNTONPC(MIL_13583_MILITIA, NONE_13585_THUG);
    B_TURNTONPC(NONE_13585_THUG, MIL_4016_WEGAR);
    B_TURNTONPC(NONE_13586_THUG, MIL_4016_WEGAR);
    B_TURNTONPC(NONE_13587_THUG, MIL_4016_WEGAR);
    AI_WAIT(NONE_13585_THUG, 0x40e66666);
    AI_WAIT(MIL_4016_WEGAR, 0x40e66666);
    QM201_CUTSCENE_WAIT();
    AI_STARTFACEANI(NONE_13585_THUG, S_ANGRY, 1, -(1));
    AI_OUTPUT(NONE_13585_THUG, HERO, "DIA_THUG_QM201_CUTSCENE_03_01");
    QM201_CUTSCENE_WAIT();
    AI_STARTFACEANI(MIL_4016_WEGAR, S_WHAT, 1, -(1));
    AI_OUTPUT(MIL_4016_WEGAR, HERO, "DIA_WEIGAR_QM201_CUTSCENE_03_02");
    QM201_CUTSCENE_WAIT();
    AI_FUNCTION(MIL_4016_WEGAR, 0x16a9c);
    AI_OUTPUT(NONE_13585_THUG, HERO, "DIA_THUG_QM201_CUTSCENE_03_03");
    QM201_CUTSCENE_WAIT();
    AI_STARTFACEANI(MIL_4016_WEGAR, S_ANGRY, 1, -(1));
    AI_OUTPUT(MIL_4016_WEGAR, HERO, "DIA_WEIGAR_QM201_CUTSCENE_03_04");
    QM201_CUTSCENE_WAIT();
    AI_FUNCTION(MIL_4016_WEGAR, 0x16a9d);
    AI_OUTPUT(NONE_13585_THUG, HERO, "DIA_THUG_QM201_CUTSCENE_03_05");
    AI_OUTPUT(NONE_13585_THUG, HERO, "DIA_THUG_QM201_CUTSCENE_03_06");
    QM201_CUTSCENE_WAIT();
    AI_FUNCTION(MIL_4016_WEGAR, 0x16a9e);
    QM201_CUTSCENE_WAIT();
    AI_OUTPUT(MIL_4016_WEGAR, HERO, "DIA_WEIGAR_QM201_CUTSCENE_03_07");
    QM201_CUTSCENE_WAIT();
    AI_OUTPUT(NONE_13585_THUG, HERO, "DIA_THUG_QM201_CUTSCENE_03_08");
    QM201_CUTSCENE_WAIT();
    AI_RESETFACEANI(MIL_4016_WEGAR);
    AI_RESETFACEANI(NONE_13585_THUG);
    AI_FUNCTION(NONE_13585_THUG, 0x16a9f);
}

func void QM201_CUTSCENE_FADESCREEN_APPLY() {
    QM201_CUTSCENE_FADESCREEN_COUNT = (QM201_CUTSCENE_FADESCREEN_COUNT) + (1);
    if ((QM201_CUTSCENE_FADESCREEN_COUNT) == (1)) {
        WLD_SENDTRIGGER("QM201_WAIT_02");
        WLD_SENDUNTRIGGER("QM201_WAIT_01");
        FADESCREENFROMBLACK(2);
    };
    if ((QM201_CUTSCENE_FADESCREEN_COUNT) == (3)) {
        WLD_SENDTRIGGER("QM201_WAIT_03");
        WLD_SENDUNTRIGGER("QM201_WAIT_02");
    };
    if ((QM201_CUTSCENE_FADESCREEN_COUNT) == (5)) {
        WLD_SENDTRIGGER("QM201_WAIT_04");
        WLD_SENDUNTRIGGER("QM201_WAIT_03");
    };
}

var int QM201_CUTSCENE_FADESCREEN_APPLY.QM201_CUTSCENE_FADESCREEN_COUNT = 0;
func void QM201_CUTSCENE_CAMERA_01() {
    WLD_SENDTRIGGER("QM201_WAIT_05");
    WLD_SENDUNTRIGGER("QM201_WAIT_04");
}

func void QM201_CUTSCENE_CAMERA_02() {
    WLD_SENDTRIGGER("QM201_WAIT_06");
    WLD_SENDUNTRIGGER("QM201_WAIT_05");
}

func void QM201_CUTSCENE_CAMERA_03() {
    WLD_SENDTRIGGER("QM201_WAIT_07");
    WLD_SENDUNTRIGGER("QM201_WAIT_06");
}

func void QM201_CUTSCENE_END() {
    QM201_WAITCUTSCENEEND();
}

