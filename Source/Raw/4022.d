instance DIA_GHOST02_EXIT(C_INFO) {
    NPC = 0xdb6b;
    NR = 999;
    CONDITION = DIA_GHOST02_EXIT_CONDITION;
    INFORMATION = DIA_GHOST02_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_GHOST02_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_GHOST02_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_GHOST02_SQ414_HELLO(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST02_SQ414_HELLO_CONDITION;
    INFORMATION = DIA_GHOST02_SQ414_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_GHOST02_SQ414_HELLO_CONDITION() {
    if ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST02_SQ414_HELLO_INFO() {
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_HELLO_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_HELLO_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_HELLO_03_03");
    B_STARTOTHERROUTINE(DJG_13329_TONAN, "SQ414_OBSERVE");
    NPC_REFRESH(DJG_13329_TONAN);
}

instance DIA_GHOST02_SQ414_WHO(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST02_SQ414_WHO_CONDITION;
    INFORMATION = DIA_GHOST02_SQ414_WHO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Who... what are you?";
}

func int DIA_GHOST02_SQ414_WHO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13203))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST02_SQ414_WHO_INFO() {
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_WHO_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_WHO_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_WHO_03_03");
}

instance DIA_GHOST02_SQ414_HELP(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST02_SQ414_HELP_CONDITION;
    INFORMATION = DIA_GHOST02_SQ414_HELP_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "How can I help you? What have you done?";
}

func int DIA_GHOST02_SQ414_HELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13206))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST02_SQ414_HELP_INFO() {
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_Help_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_Help_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_Help_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_Help_03_04");
}

instance DIA_GHOST02_SQ414_WHERE(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST02_SQ414_WHERE_CONDITION;
    INFORMATION = DIA_GHOST02_SQ414_WHERE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Where do I look for them?";
}

func int DIA_GHOST02_SQ414_WHERE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13209))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST02_SQ414_WHERE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_Where_15_01");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_Where_03_02");
    AI_STARTFACEANI(OTHER, S_SERIOUS, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost02_SQ414_Where_15_03");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_Where_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost02_SQ414_Where_03_05");
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x1320f);
}

func void GHOST_SQ414_CHANGETONANRTN() {
    B_STARTOTHERROUTINE(DJG_13329_TONAN, "SQ414_DIALOGUE");
    NPC_REFRESH(DJG_13329_TONAN);
}

instance DIA_GHOST_SQ414_GOTDOCS(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST_SQ414_GOTDOCS_CONDITION;
    INFORMATION = DIA_GHOST_SQ414_GOTDOCS_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_GHOST_SQ414_GOTDOCS_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x1320c))) && (NPC_ISINSTATE(SELF, 0xf09f))) && ((SQ414_GOTALLDOCS) != (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST_SQ414_GOTDOCS_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_01");
    if ((SQ414_GOTALLDOCS) == (FALSE)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_02");
        AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_03");
        AI_STOPPROCESSINFOS(SELF);
    };
    if (((((((SQ414_GOTALLDOCS) == (TRUE)) && ((NPC_HASITEMS(OTHER, 0x920d)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x9210)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x9214)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x9218)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x921c)) >= (1))) {
        SQ414_GOTALLDOCS = 2;
        B_GIVEINVITEMS(OTHER, SELF, 0x921c, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_04");
        B_GIVEINVITEMS(OTHER, SELF, 0x9218, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_05");
        B_GIVEINVITEMS(OTHER, SELF, 0x9214, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_06");
        B_GIVEINVITEMS(OTHER, SELF, 0x9210, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_07");
        B_GIVEINVITEMS(OTHER, SELF, 0x920d, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_08");
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_09");
        AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GotDocs_15_10");
        AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_11");
        AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_12");
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_13");
        AI_STARTFACEANI(SELF, "S_HOSTILE", 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_14");
        AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GotDocs_03_15");
    };
}

instance DIA_GHOST_SQ414_GOODENDING(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST_SQ414_GOODENDING_CONDITION;
    INFORMATION = DIA_GHOST_SQ414_GOODENDING_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Whatever you did, you more than paid for it. How can we free you?";
}

func int DIA_GHOST_SQ414_GOODENDING_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && ((SQ414_GOTALLDOCS) == (2))) {
        if ((SQ414_FINISHWAY) == (0)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST_SQ414_GOODENDING_INFO() {
    SQ414_FINISHWAY = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GoodEnding_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GoodEnding_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GoodEnding_15_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GoodEnding_03_04");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GoodEnding_03_05");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_GoodEnding_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_GoodEnding_03_07");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_GHOST_HELP);
}

instance DIA_GHOST_SQ414_BADENDING(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST_SQ414_BADENDING_CONDITION;
    INFORMATION = DIA_GHOST_SQ414_BADENDING_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Yes, you deserve it! You sealed your own fate.";
}

func int DIA_GHOST_SQ414_BADENDING_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && ((SQ414_GOTALLDOCS) == (2))) {
        if ((SQ414_FINISHWAY) == (0)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST_SQ414_BADENDING_INFO() {
    SELF.FLAGS = 0;
    SELF.AIVAR[15] = FALSE;
    SQ414_FINISHWAY = 2;
    SELF.FIGHT_TACTIC = FAI_HUMAN_MASTER;
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_BadEnding_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_BadEnding_15_02");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_BadEnding_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_BadEnding_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_BadEnding_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_BadEnding_15_06");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_BadEnding_03_07");
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    B_ATTACK(SELF, OTHER, AR_KILL, 1);
}

instance DIA_GHOST_SQ414_FORGIVENESS(C_INFO) {
    NPC = 0xdb6b;
    NR = 1;
    CONDITION = DIA_GHOST_SQ414_FORGIVENESS_CONDITION;
    INFORMATION = DIA_GHOST_SQ414_FORGIVENESS_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_GHOST_SQ414_FORGIVENESS_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && ((SQ414_FINISHWAY) == (1))) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        if ((SQ414_TRIALOGENABLE) == (2)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_GHOST_SQ414_FORGIVENESS_INFO() {
    TRIA_INVITE(DJG_13329_TONAN);
    TRIA_START();
    TELEPORTNPCTOWP(0xe3d3, DJG_13329_TONAN.WP);
    AI_LOOKATNPC(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Ghost_SQ414_Forgiveness_15_01");
    TRIA_NEXT(NONE_7000_GHOST);
    TRIA_WAIT();
    AI_TURNTONPC(SELF, DJG_13329_TONAN);
    AI_TURNTONPC(DJG_13329_TONAN, SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_02");
    TRIA_NEXT(DJG_13329_TONAN);
    TRIA_WAIT();
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_03");
    TRIA_NEXT(NONE_7000_GHOST);
    TRIA_WAIT();
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_04");
    TRIA_NEXT(DJG_13329_TONAN);
    TRIA_WAIT();
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_06");
    TRIA_NEXT(NONE_7000_GHOST);
    TRIA_WAIT();
    AI_FUNCTION(SELF, 0x1321c);
    AI_PLAYANI(SELF, "T_PSI_VICTIM");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_09");
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_10");
    AI_TURNAWAY(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ghost_SQ414_Forgiveness_03_11");
    TRIA_FINISH();
    AI_STOPLOOKAT(OTHER);
    AI_STOPLOOKAT(SELF);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x1321d);
}

func void GHOST_SQ414_FORGIVENESS() {
    WLD_PLAYEFFECT("FX_EarthQuake", NONE_7000_GHOST, NONE_7000_GHOST, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("spellFX_INCOVATION_WHITE", NONE_7000_GHOST, NONE_7000_GHOST, 0, 0, 0, FALSE);
    HERO.AIVAR[4] = FALSE;
}

func void GHOST_SQ414_TELEPORT() {
    TELEPORTNPCTOWP(0xdb6b, TOT);
    WLD_PLAYEFFECT("FX_EarthQuake", NONE_7000_GHOST, NONE_7000_GHOST, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("spellFX_INCOVATION_WHITE", NONE_7000_GHOST, NONE_7000_GHOST, 0, 0, 0, FALSE);
    WLD_INSERTITEM(0x901e, "FP_PART6_SQ414_SKULL");
    HERO.AIVAR[4] = FALSE;
}

