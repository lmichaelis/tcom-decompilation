instance QA301_ENDING(CUTSCENE) {
    ONSTART = FUNCTION(0x16a68);
}

func void QA301_ENDING_WAIT() {
    AI_WAITTILLEND(BAU_11051_FARMER_QA301_CUTSCENE, SLD_11056_GRIZ);
    AI_WAITTILLEND(BAU_11052_FARMER_QA301_CUTSCENE, SLD_11056_GRIZ);
    AI_WAITTILLEND(BAU_11053_FARMER_QA301_CUTSCENE, SLD_11056_GRIZ);
}

func void QA301_ENDING_START() {
    WLD_SENDTRIGGER("KM_QA301_01");
    HERO.AIVAR[4] = TRUE;
    TELEPORTNPCTOWP(0x71b, "PART12_QA301_FIREPLACE");
    TELEPORTNPCTOWP(0xe16a, "PART12_QA301_GRIZWAIT");
    NPC_CLEARAIQUEUE(SLD_11056_GRIZ);
    AI_TURNTONPC(SLD_11056_GRIZ, HERO);
    AI_PLAYANI(SLD_11056_GRIZ, "T_COMEOVERHERE");
    AI_FUNCTION(SLD_11056_GRIZ, 0x16a69);
    AI_FUNCTION(SLD_11056_GRIZ, 0x16a6c);
}

func void QA301_ENDING_CHANGECAMERA_01() {
    QA301_FINALCUTSCENE = 3;
    WLD_SENDTRIGGER("KM_QA301_02");
    WLD_SENDUNTRIGGER("KM_QA301_01");
}

func void QA301_ENDING_CHANGECAMERA_02() {
    QA301_ENDING_CHANGECAMERA_02_COUNT = (QA301_ENDING_CHANGECAMERA_02_COUNT) + (1);
    if ((QA301_ENDING_CHANGECAMERA_02_COUNT) == (7)) {
        WLD_SENDTRIGGER("KM_QA301_03");
        WLD_SENDUNTRIGGER("KM_QA301_02");
    };
}

var int QA301_ENDING_CHANGECAMERA_02.QA301_ENDING_CHANGECAMERA_02_COUNT = 0;
func void QA301_ENDING_END() {
    FF_APPLYONCEEXT(0x16a6a, 1000, 7);
    FADESCREENTOBLACKF(12, 0x16a6d, 1000);
}

func void QA301_ENDING_END_FADESCREEN() {
    WLD_SENDUNTRIGGER("KM_QA301_03");
    QA301_FINALCUTSCENE = 5;
    B_REMOVENPC(0xdfdd);
    B_REMOVENPC(0xdfe4);
    B_REMOVENPC(0xdfeb);
    QA301_LASTMOVER();
}

