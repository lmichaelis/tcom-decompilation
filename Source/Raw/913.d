func void Q304_DIG_S1() {
    HER = HLP_GETNPC(0xc3ab);
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HER))) {
        FADESCREENTOBLACKF(1, 0xbf07, 1000);
    };
}

instance Q304_DIG_S1.HER(C_NPC)
func void Q304_DIG_FADESCREEN_MOVER() {
    Q304_DIGGING = TRUE;
    B_LOGENTRY(TOPIC_Q304, LOG_Q304_HOLE);
    FF_APPLYONCEEXTGT(0xbf08, 0, -(1));
    WLD_SENDTRIGGER("KM_SWAMPCHEST_DIG");
    TELEPORTNPCTOWP(0x71b, "PART17_PATH_222");
    B_PASSTIME(1);
    B_ENDPRODUCTIONDIALOG();
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(2);
}

func void Q304_DIG_COLLISIONCHANGE() {
    if ((CHANGEGROUNDCOLLISION) == (0)) {
        PRINTD("Rozpoczynam - Q304_Dig_CollisionChange");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KM_SWAMPCAVE_GROUND");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("KM_SWAMPCAVE_GROUND", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KM_SWAMPCAVE_GROUND");
        CHANGEGROUNDCOLLISION = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - Q304_Dig_CollisionChange");
        CHANGEVOBCOLLISION("KM_SWAMPCAVE_GROUND", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xbf08);
        CHANGEGROUNDCOLLISION = 0;
    };
}

var int Q304_DIG_COLLISIONCHANGE.CHANGEGROUNDCOLLISION = 0;
instance Q304_DIG_COLLISIONCHANGE.MOVER1(ZCMOVER)
var int Q304_DIG_COLLISIONCHANGE.MOVPTR1 = 0;
