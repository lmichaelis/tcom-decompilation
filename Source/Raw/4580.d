instance Q308_MORRISINTRODUCE(CUTSCENE) {
    ONSTART = FUNCTION(0x169a0);
}

func void Q308_MORRISINTRODUCE_START() {
    B_STARTOTHERROUTINE(NONE_6386_MADOG, CUTSCENERTN);
    WLD_SENDTRIGGER("KM_Q308_MORRISCUTSCENE_01A");
    TELEPORTNPCTOWP(0xe4af, "PARTM4_VOLKER_IVY");
    TELEPORTNPCTOWP(0x71b, "PARTM4_MORRISCUTSCENE_HERO");
    TELEPORTNPCTOWP(0xd078, "PARTM4_VOLKER");
    NPC_CLEARAIQUEUE(NONE_16_IVY);
    NPC_CLEARAIQUEUE(MIL_6387_MILITIA);
    AI_LOOKATNPC(NONE_16_IVY, VLK_6388_MORRIS);
    AI_LOOKATNPC(HERO, VLK_6388_MORRIS);
    NONE_16_IVY.AIVAR[92] = TRUE;
    MIL_6387_MILITIA.AIVAR[92] = TRUE;
    B_TURNTONPC(HERO, NONE_6386_MADOG);
    B_TURNTONPC(NONE_16_IVY, NONE_6386_MADOG);
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    NPC_CLEARAIQUEUE(MIL_6387_MILITIA);
    AI_SETWALKMODE(MIL_6387_MILITIA, NPC_RUN);
    AI_GOTOWP(MIL_6387_MILITIA, "PARTM4_VOLKER_HOUSE");
    AI_TURNTONPC(MIL_6385_SAMBOR, MIL_6387_MILITIA);
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_WAITTILLEND(MIL_6387_MILITIA, MIL_6385_SAMBOR);
    AI_WAITTILLEND(MIL_6385_SAMBOR, MIL_6387_MILITIA);
    AI_OUTPUT(MIL_6387_MILITIA, HERO, "DIA_Militia_MORRISCUTSCENE_03_01");
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_FUNCTION(NONE_16_IVY, 0x169a1);
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_LOOKATNPC(NONE_16_IVY, MIL_6387_MILITIA);
    AI_OUTPUT(MIL_6387_MILITIA, HERO, "DIA_Militia_MORRISCUTSCENE_03_02");
    AI_FUNCTION(MIL_6387_MILITIA, 0x1697b);
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_TURNTONPC(NONE_16_IVY, MIL_6387_MILITIA);
    AI_OUTPUT(NONE_16_IVY, HERO, "DIA_IVY_MORRISCUTSCENE_03_03");
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_FUNCTION(NONE_16_IVY, 0x169a2);
    AI_WAITTILLEND(NONE_16_IVY, MIL_6387_MILITIA);
    AI_WAITTILLEND(MIL_6387_MILITIA, NONE_16_IVY);
    AI_WAITTILLEND(VLK_6388_MORRIS, MIL_6387_MILITIA);
    AI_WAITTILLEND(VLK_6388_MORRIS, NONE_16_IVY);
    AI_SETWALKMODE(MIL_6387_MILITIA, NPC_WALK);
    AI_SETWALKMODE(VLK_6388_MORRIS, NPC_WALK);
    AI_WAITTILLEND(HERO, NONE_16_IVY);
    AI_WAITTILLEND(NONE_16_IVY, HERO);
    AI_WAIT(HERO, 0x406ccccd);
    AI_TURNTONPC(HERO, MIL_6387_MILITIA);
    AI_GOTOWP(MIL_6387_MILITIA, "PARTM4_PATH_107");
    AI_GOTOWP(VLK_6388_MORRIS, "PARTM4_VOLKERHOUSE_OUTSIDE_SMALLTALK_02");
    AI_WAITTILLEND(HERO, NONE_16_IVY);
    AI_WAITTILLEND(NONE_16_IVY, HERO);
    AI_FUNCTION(NONE_16_IVY, 0x169a3);
    AI_WAIT(HERO, 0x40600000);
    AI_WAITTILLEND(HERO, NONE_16_IVY);
    AI_WAITTILLEND(NONE_16_IVY, HERO);
    AI_FUNCTION(NONE_16_IVY, 0x169a4);
    AI_WAIT(HERO, 0x3fc00000);
    AI_WAITTILLEND(HERO, NONE_16_IVY);
    AI_WAITTILLEND(NONE_16_IVY, HERO);
    AI_TURNTONPC(NONE_16_IVY, HERO);
    AI_OUTPUT(NONE_16_IVY, HERO, "DIA_IVY_MORRISCUTSCENE_03_04");
    AI_WAIT(HERO, 0x3f800000);
    AI_WAITTILLEND(HERO, NONE_16_IVY);
    AI_WAITTILLEND(NONE_16_IVY, HERO);
    AI_STOPLOOKAT(HERO);
    AI_STOPLOOKAT(NONE_16_IVY);
    AI_FUNCTION(NONE_16_IVY, 0x169a5);
}

func void IVY_Q308VOLKERHOUSECUTSCENE_01() {
    WLD_SENDTRIGGER("KM_Q308_MORRISCUTSCENE_04");
    WLD_SENDUNTRIGGER("KM_Q308_MORRISCUTSCENE_01A");
}

func void IVY_Q308VOLKERHOUSECUTSCENE_02() {
    WLD_SENDTRIGGER("KM_Q308_MORRISCUTSCENE_02A");
    WLD_SENDUNTRIGGER("KM_Q308_MORRISCUTSCENE_04");
}

func void IVY_Q308VOLKERHOUSECUTSCENE_03() {
    WLD_SENDTRIGGER("KM_Q308_MORRISCUTSCENE_02B");
    WLD_SENDUNTRIGGER("KM_Q308_MORRISCUTSCENE_02A");
}

func void IVY_Q308VOLKERHOUSECUTSCENE_04() {
    WLD_SENDTRIGGER("KM_Q308_MORRISCUTSCENE_02");
    WLD_SENDUNTRIGGER("KM_Q308_MORRISCUTSCENE_02B");
}

func void IVY_Q308VOLKERHOUSECUTSCENE_END() {
    FF_APPLYONCEEXT(0x169a6, 75, 4);
}

func void IVY_Q308VOLKERHOUSECUTSCENE_END_APPLY() {
    IVY_Q308VOLKERHOUSECUTSCENE_END_COUNT = (IVY_Q308VOLKERHOUSECUTSCENE_END_COUNT) + (1);
    if ((IVY_Q308VOLKERHOUSECUTSCENE_END_COUNT) == (4)) {
        Q308_VOLKERHOUSECUTSCENE = TRUE;
        IVY_Q308VOLKERHOUSECUTSCENE_END_COUNT = 0;
        TELEPORTNPCTOWP(0xd078, "PARTM4_VOLKER_HOUSE_02");
        MIL_6387_MILITIA.AIVAR[92] = FALSE;
        NONE_16_IVY.AIVAR[92] = FALSE;
        B_STARTOTHERROUTINE(VLK_6388_MORRIS, "ATTEMPT_SMALLTALK");
        NPC_REFRESH(VLK_6388_MORRIS);
        B_STARTOTHERROUTINE(MIL_6387_MILITIA, "CUTSCENE2");
        NPC_REFRESH(MIL_6387_MILITIA);
        B_STARTOTHERROUTINE(NONE_16_IVY, "ATTEMPT");
        NPC_REFRESH(NONE_16_IVY);
        B_STARTOTHERROUTINE(NONE_6386_MADOG, START);
        WLD_SENDUNTRIGGER("KM_Q308_MORRISCUTSCENE_02");
        AI_STANDUP(HERO);
        HERO.AIVAR[4] = FALSE;
    };
}

var int IVY_Q308VOLKERHOUSECUTSCENE_END_APPLY.IVY_Q308VOLKERHOUSECUTSCENE_END_COUNT = 0;
