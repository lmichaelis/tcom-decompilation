func void EVT_QM401_BOOKS() {
    if ((QM401_RENEGADECAVE_BOOKS) == (FALSE)) {
        QM401_RENEGADECAVE_BOOKS = TRUE;
        MOB_CHANGEFOCUSNAME("QM401_BOOKS", "MOBNAME_NOTHING");
        B_SAY(HERO, HERO, "$NOTHINGTOGET");
        AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
        B_LOGENTRY(TOPIC_QM401, LOG_QM401_CAVE_BOOKS);
        TELEPORTNPCTOWP(0xcdff, "PART7_CAVE_67");
        NPC_CLEARAIQUEUE(MIL_13513_MILITIA);
        B_STARTOTHERROUTINE(MIL_13513_MILITIA, "QM401_FOLLOW");
    };
}

func void QM401_COUNTFARN() {
    B_PLAYERFINDITEM(0x91c6, 1);
    B_GIVEPLAYERXP(XP_QM401_FARNWORK);
    QM401_FARN_COUNT = (QM401_FARN_COUNT) + (1);
    HERO.AIVAR[4] = FALSE;
}

func void EVT_QM401_FARN_01() {
    AI_WAIT(HERO, 0x40000000);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARN_01");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    QM401_COUNTFARN();
}

func void EVT_QM401_FARN_02() {
    AI_WAIT(HERO, 0x40000000);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARN_02");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    QM401_COUNTFARN();
}

func void EVT_QM401_FARN_03() {
    AI_WAIT(HERO, 0x40000000);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARN_03");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    QM401_COUNTFARN();
}

func void QM401_COUNTREADYFARN() {
    B_GIVEPLAYERXP(XP_QM401_FARNREADY);
    NPC_REMOVEINVITEM(HERO, 0x91c6);
    QM401_FARNREADY_COUNT = (QM401_FARNREADY_COUNT) + (1);
    if ((QM401_FARNREADY_COUNT) == (3)) {
        if (NPC_KNOWSINFO(HERO, 0x106ab)) {
            B_LOGENTRY(TOPIC_QM401, LOG_QM401_FARNREADY_V2);
        } else {
            B_LOGENTRY(TOPIC_QM401, LOG_QM401_FARNREADY_V1);
        };
    };
    HERO.AIVAR[4] = FALSE;
}

func void EVT_QM401_FARNPLUNDER_01() {
    MOB_CHANGEFOCUSNAME("QM401_FARNPLUNDER_01", "MOBNAME_NOTHING");
    AI_WAIT(HERO, 0x3f99999a);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARNPLUNDER_01");
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_READYFARN_01");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    AI_FUNCTION(HERO, 0x1672b);
}

func void EVT_QM401_FARNPLUNDER_02() {
    MOB_CHANGEFOCUSNAME("QM401_FARNPLUNDER_02", "MOBNAME_NOTHING");
    AI_WAIT(HERO, 0x3f99999a);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARNPLUNDER_02");
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_READYFARN_02");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    AI_FUNCTION(HERO, 0x1672b);
}

func void EVT_QM401_FARNPLUNDER_03() {
    MOB_CHANGEFOCUSNAME("QM401_FARNPLUNDER_03", "MOBNAME_NOTHING");
    AI_WAIT(HERO, 0x3f99999a);
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_FARNPLUNDER_03");
    AI_FUNCTION_S(HERO, 777, "QM401_MOVER_READYFARN_03");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    AI_FUNCTION(HERO, 0x1672b);
}

func void EVT_QM401_PREPAREBARREL() {
    MOB_CHANGEFOCUSNAME("QM401_PREPAREBARREL", "MOBNAME_NOTHING");
    CHANGEVOBCOLLISION("QM401_EXPLOSIVE_BARREL", FALSE, FALSE, FALSE, TRUE);
    AI_WAIT(HERO, 0x3f99999a);
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    AI_FUNCTION(HERO, 0xf57c);
}

