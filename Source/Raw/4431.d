func void EVT_KQ406_KICKOBJECT() {
    KQ406_COUNTDESTROYEDOBJECT = (KQ406_COUNTDESTROYEDOBJECT) + (1);
    if ((KQ406_COUNTDESTROYEDOBJECT) == (4)) {
        KQ406_DESTROYEDCRATES_ALL = TRUE;
        B_STARTOTHERROUTINE(VLK_13675_WORKER, "KQ406_FOLLOW");
        NPC_REFRESH(VLK_13675_WORKER);
    };
    B_GIVEPLAYERXP(XP_KQ406_DESTROYEDCRATES);
    SND_PLAY("DESTROY_WOOD");
    SND_PLAY("DOOR_SLAM");
}

var int EVT_KQ406_KICKOBJECT.KQ406_COUNTDESTROYEDOBJECT = 0;
func void EVT_KQ406_CRATE_01() {
    KQ406_DESTROYEDCRATE_01 = TRUE;
    MOB_CHANGEFOCUSNAME("KQ406_CRATE_01", "MOBNAME_NOTHING");
    EVT_KQ406_KICKOBJECT();
    FF_APPLYONCEEXTGT(0x1666b, 0, -(1));
}

func void EVT_KQ406_CRATE_01_KICKED() {
    if ((EVT_KQ406_CRATE_01_KICKED_COUNT) == (0)) {
        PRINTD("Rozpoczynam - EVT_KQ406_CRATE_01_Kicked");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KQ406_CRATE_DESTROYED_01");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("KQ406_CRATE_01", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_01");
        WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_01");
        EVT_KQ406_CRATE_01_KICKED_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - EVT_KQ406_CRATE_01_Kicked");
        CHANGEVOBCOLLISION("KQ406_CRATE_01 ", FALSE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x1666b);
        EVT_KQ406_CRATE_01_KICKED_COUNT = 0;
    };
}

var int EVT_KQ406_CRATE_01_KICKED.EVT_KQ406_CRATE_01_KICKED_COUNT = 0;
instance EVT_KQ406_CRATE_01_KICKED.MOVER1(ZCMOVER)
instance EVT_KQ406_CRATE_01_KICKED.MOVER2(ZCMOVER)
var int EVT_KQ406_CRATE_01_KICKED.MOVPTR1 = 0;
var int EVT_KQ406_CRATE_01_KICKED.MOVPTR2 = 0;
func void EVT_KQ406_CRATE_02() {
    KQ406_DESTROYEDCRATE_02 = TRUE;
    MOB_CHANGEFOCUSNAME("KQ406_CRATE_02", "MOBNAME_NOTHING");
    EVT_KQ406_KICKOBJECT();
    FF_APPLYONCEEXTGT(0x16672, 0, -(1));
}

func void EVT_KQ406_CRATE_02_KICKED() {
    if ((EVT_KQ406_CRATE_02_KICKED_COUNT) == (0)) {
        PRINTD("Rozpoczynam - EVT_KQ406_CRATE_02_Kicked");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_02");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KQ406_CRATE_DESTROYED_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("KQ406_CRATE_02", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_02");
        WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_02");
        EVT_KQ406_CRATE_02_KICKED_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - EVT_KQ406_CRATE_02_Kicked");
        CHANGEVOBCOLLISION("KQ406_CRATE_02 ", FALSE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x16672);
        EVT_KQ406_CRATE_02_KICKED_COUNT = 0;
    };
}

var int EVT_KQ406_CRATE_02_KICKED.EVT_KQ406_CRATE_02_KICKED_COUNT = 0;
instance EVT_KQ406_CRATE_02_KICKED.MOVER1(ZCMOVER)
instance EVT_KQ406_CRATE_02_KICKED.MOVER2(ZCMOVER)
var int EVT_KQ406_CRATE_02_KICKED.MOVPTR1 = 0;
var int EVT_KQ406_CRATE_02_KICKED.MOVPTR2 = 0;
func void EVT_KQ406_CRATE_03() {
    KQ406_DESTROYEDCRATE_03 = TRUE;
    MOB_CHANGEFOCUSNAME("KQ406_CRATE_03", "MOBNAME_NOTHING");
    EVT_KQ406_KICKOBJECT();
    FF_APPLYONCEEXTGT(0x16679, 0, -(1));
}

func void EVT_KQ406_CRATE_03_KICKED() {
    if ((EVT_KQ406_CRATE_03_KICKED_COUNT) == (0)) {
        PRINTD("Rozpoczynam - EVT_KQ406_CRATE_03_Kicked");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_03");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KQ406_CRATE_DESTROYED_03");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("KQ406_CRATE_03", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_03");
        WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_03");
        EVT_KQ406_CRATE_03_KICKED_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - EVT_KQ406_CRATE_03_Kicked");
        CHANGEVOBCOLLISION("KQ406_CRATE_03 ", FALSE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x16679);
        EVT_KQ406_CRATE_03_KICKED_COUNT = 0;
    };
}

var int EVT_KQ406_CRATE_03_KICKED.EVT_KQ406_CRATE_03_KICKED_COUNT = 0;
instance EVT_KQ406_CRATE_03_KICKED.MOVER1(ZCMOVER)
instance EVT_KQ406_CRATE_03_KICKED.MOVER2(ZCMOVER)
var int EVT_KQ406_CRATE_03_KICKED.MOVPTR1 = 0;
var int EVT_KQ406_CRATE_03_KICKED.MOVPTR2 = 0;
func void EVT_KQ406_CRATE_04() {
    KQ406_DESTROYEDCRATE_04 = TRUE;
    MOB_CHANGEFOCUSNAME("KQ406_CRATE_04", "MOBNAME_NOTHING");
    EVT_KQ406_KICKOBJECT();
    FF_APPLYONCEEXTGT(0x16680, 0, -(1));
}

func void EVT_KQ406_CRATE_04_KICKED() {
    if ((EVT_KQ406_CRATE_04_KICKED_COUNT) == (0)) {
        PRINTD("Rozpoczynam - EVT_KQ406_CRATE_04_Kicked");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KQ406_MOVER_CRATE_04");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("KQ406_CRATE_DESTROYED_04");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("KQ406_CRATE_04", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KQ406_MOVER_CRATE_04");
        WLD_SENDTRIGGER("KQ406_CRATE_DESTROYED_04");
        EVT_KQ406_CRATE_04_KICKED_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - EVT_KQ406_CRATE_04_Kicked");
        CHANGEVOBCOLLISION("KQ406_CRATE_04 ", FALSE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x16680);
        EVT_KQ406_CRATE_04_KICKED_COUNT = 0;
    };
}

var int EVT_KQ406_CRATE_04_KICKED.EVT_KQ406_CRATE_04_KICKED_COUNT = 0;
instance EVT_KQ406_CRATE_04_KICKED.MOVER1(ZCMOVER)
instance EVT_KQ406_CRATE_04_KICKED.MOVER2(ZCMOVER)
var int EVT_KQ406_CRATE_04_KICKED.MOVPTR1 = 0;
var int EVT_KQ406_CRATE_04_KICKED.MOVPTR2 = 0;
func void EVT_KQ406_RATPOTION_ANIMATION() {
    KQ406_COUNTRATPOTION = (KQ406_COUNTRATPOTION) + (1);
    if ((KQ406_COUNTRATPOTION) == (1)) {
        if ((KQ406_RATPOTION_PLACE_01) == (TRUE)) {
            B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_RATPOTION_V1);
        } else {
            B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_RATPOTION_V2);
        } else {
            /* set_instance(0) */;
        };
    };
    KQ406_BOUGHTPOTION = 2;
    if ((KQ406_POINTS) != (3)) {
        B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_RATPOTION_DONE_V1);
        KQ406_COUNTPOINTS();
    };
    B_LOGENTRY(TOPIC_KQ406, LOG_KQ406_RATPOTION_DONE_V2);
    AI_PLAYANI(HERO, "T_RANDOM_WATERTORTURE_STARTWATER");
    AI_WAIT(HERO, 0x40400000);
    AI_PLAYANI(HERO, "T_RANDOM_WATERTORTURE_STOPWATER");
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    HERO.AIVAR[4] = FALSE;
}

var int EVT_KQ406_RATPOTION_ANIMATION.KQ406_COUNTRATPOTION = 0;
func void EVT_KQ406_RATPOTION_01() {
    if (WLD_ISTIME(20, 0, 5, 0)) {
        KQ406_RATPOTION_PLACE_01 = TRUE;
        EVT_KQ406_RATPOTION_ANIMATION();
        MOB_CHANGEFOCUSNAME("KQ406_RATPOTION_PLACE_04", "MOBNAME_NOTHING");
        WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_01");
        MOB_CHANGEFOCUSNAME("KQ406_RATPOTION_PLACE_03", "MOBNAME_NOTHING");
        WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_LIQUID_01");
    };
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    B_SAY(HERO, HERO, "$MARVIN_WRONGTIME");
    CREATEINVITEMS(HERO, 0x923b, 1);
    HERO.AIVAR[4] = FALSE;
}

func void EVT_KQ406_RATPOTION_02() {
    if (WLD_ISTIME(20, 0, 5, 0)) {
        KQ406_RATPOTION_PLACE_02 = TRUE;
        EVT_KQ406_RATPOTION_ANIMATION();
        MOB_CHANGEFOCUSNAME("KQ406_RATPOTION_PLACE_08", "MOBNAME_NOTHING");
        WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_02");
        MOB_CHANGEFOCUSNAME("KQ406_RATPOTION_PLACE_07", "MOBNAME_NOTHING");
        WLD_SENDTRIGGER("KQ406_MOVER_RATPOTION_LIQUID_02");
    };
    AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
    B_SAY(HERO, HERO, "$MARVIN_WRONGTIME");
    HERO.AIVAR[4] = FALSE;
}

func void EVT_ANSKERFOLLOW_SCRIPT() {
    if ((LOG_GETSTATUS(MIS_KQ406)) == (LOG_RUNNING)) {
        if (NPC_KNOWSINFO(HERO, 0x10112)) {
            if ((KQ406_ANSKERFOLLOW_CHECK) == (FALSE)) {
                KQ406_ANSKERFOLLOW_CHECK = TRUE;
                B_STARTOTHERROUTINE(MIL_13680_ANSKAR, "KQ406_FOLLOW");
                NPC_REFRESH(MIL_13680_ANSKAR);
            };
        };
    };
}

var int EVT_ANSKERFOLLOW_SCRIPT.KQ406_ANSKERFOLLOW_CHECK = 0;
func void KQ406_RICHARDATTACK() {
    B_IMMEDIATEATTACKPLAYER(MIL_13490_RICHARD, AR_KILL);
    MIL_13490_RICHARD.AIVAR[52] = TRUE;
    MIL_13490_RICHARD.FLAGS = 0;
    MIL_13490_RICHARD.AIVAR[15] = FALSE;
    HERO.AIVAR[4] = FALSE;
    NPC_SETTRUEGUILD(MIL_13490_RICHARD, GIL_NONE);
    MIL_13490_RICHARD.GUILD = GIL_NONE;
    NPC_CLEARAIQUEUE(MIL_13490_RICHARD);
    AI_SETWALKMODE(MIL_13490_RICHARD, NPC_RUN);
    AI_TURNTONPC(MIL_13490_RICHARD, HERO);
    AI_GOTONPC(MIL_13490_RICHARD, HERO);
}

func void KQ406_REMOVEEVENTS() {
    KQ406_REMOVERATLIQUID();
    KQ406_REMOVENPC();
    RESTOREROUTINE_RUUD();
    FF_APPLYONCEEXTGT(0x87e5, 0, -(1));
    HERO.AIVAR[4] = FALSE;
}

