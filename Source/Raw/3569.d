func void Q204_FAILQUESTS() {
    if ((LOG_GETSTATUS(MIS_Q204)) == (LOG_RUNNING)) {
        B_LOGENTRY(TOPIC_Q204, LOG_Q204_JOINEDMILITIA);
        LOG_SETSTATUS(_@(MIS_Q204), TOPIC_Q204, LOG_FAILED);
    };
}

func void Q204_JOINGUILD() {
    B_HATEFROMSLUMS();
    CREATEINVITEMS(SLD_5000_LORENZO, 0x8a7b, 1);
    B_GIVEINVITEMS(SLD_5000_LORENZO, HERO, 0x8a7b, 1);
    AI_EQUIPARMOR(HERO, 0x8a7b);
    NPC_SETTRUEGUILD(HERO, GIL_SLD);
    HERO.GUILD = GIL_SLD;
    SND_PLAY("LEVELUP");
    if (ACH_4_CANJOIN_MILITIA) {
        GAMESERVICES_UNLOCKACHIEVEMENT(ACH_4);
    };
    HERO.AIVAR[4] = FALSE;
}

func void Q204_CHANGEARAXOSRTN() {
    B_STARTOTHERROUTINE(SLD_1000_ADELARD, "Q204_JOIN");
    Q204_ADELARD_RTNCHECK = 1;
    NPC_REFRESH(SLD_1000_ADELARD);
    TELEPORTNPCTOWP(0xcb0a, "PARTM1_JOINARAXOS_BOSS");
    B_STARTOTHERROUTINE(SLD_1011_ARAXOS, "JOIN");
    NPC_REFRESH(SLD_1011_ARAXOS);
    TELEPORTNPCTOWP(0xca79, "PARTM1_JOINARAXOS_SLD_01");
    B_STARTOTHERROUTINE(SLD_1012_ARAXOS, "JOIN");
    NPC_REFRESH(SLD_1012_ARAXOS);
    TELEPORTNPCTOWP(0xca82, "PARTM1_JOINARAXOS_SLD_02");
    B_STARTOTHERROUTINE(SLD_1013_ARAXOS, "JOIN");
    NPC_REFRESH(SLD_1013_ARAXOS);
    TELEPORTNPCTOWP(0xca88, RNG_NS12_FAKEJORN02_WAYPOINT);
    B_STARTOTHERROUTINE(SLD_1014_ARAXOS, "JOIN");
    NPC_REFRESH(SLD_1014_ARAXOS);
    TELEPORTNPCTOWP(0xca8e, "PARTM1_JOINARAXOS_SLD_04");
    B_STARTOTHERROUTINE(SLD_1015_ARAXOS, "JOIN");
    NPC_REFRESH(SLD_1015_ARAXOS);
    TELEPORTNPCTOWP(0xca94, "PARTM1_JOINARAXOS_SLD_05");
    if ((NPC_ISDEAD(SLD_8202_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8202_ARAXOS, TOT);
        NPC_REFRESH(SLD_8202_ARAXOS);
        TELEPORTNPCTOWP(0xcaab, SLD_8202_ARAXOS.WP);
    };
    if ((NPC_ISDEAD(SLD_8201_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8201_ARAXOS, TOT);
        NPC_REFRESH(SLD_8201_ARAXOS);
        TELEPORTNPCTOWP(0xcaa8, SLD_8201_ARAXOS.WP);
    };
    if ((NPC_ISDEAD(SLD_8200_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8200_ARAXOS, TOT);
        NPC_REFRESH(SLD_8200_ARAXOS);
        TELEPORTNPCTOWP(0xcaa5, SLD_8200_ARAXOS.WP);
    };
    PRINTD("Refresh korwa");
    HERO.AIVAR[4] = FALSE;
}

func void Q204_JOINARAXOS_THROW() {
    AI_FUNCTION(HERO, 0xfa1a);
    FF_APPLY(0x111c9);
    WLD_SENDTRIGGER("KM_ARAXOSJOIN_01");
    WLD_SENDUNTRIGGER("KM_ARAXOSJOIN_03");
    AI_WAIT(HERO, 0x3dcccccd);
    AI_PLAYANI(HERO, "T_ARAXOSJOIN_THROW");
    AI_FUNCTION(HERO, 0xfa24);
    AI_WAIT(HERO, 0x3e4ccccd);
    AI_WAITTILLEND(SLD_1000_ADELARD, HERO);
    HERO.AIVAR[4] = FALSE;
    AI_FUNCTION(SLD_1000_ADELARD, 0xfa17);
}

func void Q204_JOINARAXOS_THROW_END() {
    B_STARTOTHERROUTINE(SLD_5001_DIMA, START);
    FF_REMOVE(0x111c9);
    AI_WAIT(HERO, 0x40200000);
    AI_TURNTONPC(HERO, SLD_1000_ADELARD);
    HERO.AIVAR[4] = FALSE;
    WLD_SENDTRIGGER("KM_ARAXOSJOIN_04");
    WLD_SENDUNTRIGGER("KM_ARAXOSJOIN_01");
    AI_WAITTILLEND(SLD_1000_ADELARD, HERO);
    AI_FUNCTION(SLD_1000_ADELARD, 0x111ce);
}

func void Q204_SETARAXOSCAMERA() {
    DIACAM_DISABLE();
    TELEPORTNPCTOWP(0xcb0a, "PARTM1_JOINARAXOS_BOSS");
    TELEPORTNPCTOWP(0x71b, "PARTM1_JOINARAXOS_HERO");
    NPC_REFRESH(SLD_1011_ARAXOS);
    NPC_REFRESH(SLD_1012_ARAXOS);
    NPC_REFRESH(SLD_1013_ARAXOS);
    NPC_REFRESH(SLD_1014_ARAXOS);
    NPC_REFRESH(SLD_1015_ARAXOS);
    TELEPORTNPCTOWP(0xca79, "PARTM1_JOINARAXOS_SLD_01");
    TELEPORTNPCTOWP(0xca82, "PARTM1_JOINARAXOS_SLD_02");
    TELEPORTNPCTOWP(0xca88, RNG_NS12_FAKEJORN02_WAYPOINT);
    TELEPORTNPCTOWP(0xca8e, "PARTM1_JOINARAXOS_SLD_04");
    TELEPORTNPCTOWP(0xca94, "PARTM1_JOINARAXOS_SLD_05");
}

func void Q204_SETARAXOSCAMERA_V2() {
    AI_UNEQUIPARMOR(HERO);
    AI_UNEQUIPWEAPONS(HERO);
    TELEPORTNPCTOWP(0x71b, "HERO_WATER_TEST");
    B_STARTOTHERROUTINE(SLD_5001_DIMA, "JOIN");
    NPC_REFRESH(SLD_5001_DIMA);
    TELEPORTNPCTOWP(0xcb6b, "PARTM1_PATH_59");
    AI_TURNTONPC(HERO, SLD_5001_DIMA);
}

func void Q204_SETARAXOSCAMERA_V3() {
    TELEPORTNPCTOWP(0xcb0a, "PARTM1_JOINARAXOS_BOSS_02");
    B_STARTOTHERROUTINE(SLD_1011_ARAXOS, "JOIN2");
    NPC_REFRESH(SLD_1011_ARAXOS);
    TELEPORTNPCTOWP(0xca79, "PARTM1_JOINARAXOS_SLD_10");
    B_STARTOTHERROUTINE(SLD_1012_ARAXOS, "JOIN2");
    NPC_REFRESH(SLD_1012_ARAXOS);
    TELEPORTNPCTOWP(0xca82, "PARTM1_JOINARAXOS_SLD_09");
    B_STARTOTHERROUTINE(SLD_1013_ARAXOS, "JOIN2");
    NPC_REFRESH(SLD_1013_ARAXOS);
    TELEPORTNPCTOWP(0xca88, "PARTM1_JOINARAXOS_SLD_08");
    B_STARTOTHERROUTINE(SLD_1014_ARAXOS, "JOIN2");
    NPC_REFRESH(SLD_1014_ARAXOS);
    TELEPORTNPCTOWP(0xca8e, "PARTM1_JOINARAXOS_SLD_07");
    B_STARTOTHERROUTINE(SLD_1015_ARAXOS, "JOIN2");
    NPC_REFRESH(SLD_1015_ARAXOS);
    TELEPORTNPCTOWP(0xca94, "PARTM1_JOINARAXOS_SLD_06");
    AI_TURNTONPC(SLD_1000_ADELARD, HERO);
    AI_TURNTONPC(SLD_1011_ARAXOS, HERO);
    AI_TURNTONPC(SLD_1012_ARAXOS, HERO);
    AI_TURNTONPC(SLD_1013_ARAXOS, HERO);
    AI_TURNTONPC(SLD_1014_ARAXOS, HERO);
    AI_TURNTONPC(SLD_1015_ARAXOS, HERO);
}

func void Q204_SETARAXOSCAMERA_V4() {
    WLD_SENDTRIGGER("KM_ARAXOSJOIN_05");
    WLD_SENDUNTRIGGER("KM_ARAXOSJOIN_04");
    TELEPORTNPCTOWP(0x71b, "PARTM1_JOINARAXOS_HERO_02");
    HERO.AIVAR[4] = FALSE;
}

func void Q204_SETARAXOSCAMERA_V5() {
    WLD_SENDUNTRIGGER("KM_ARAXOSJOIN_05");
    DIACAM_ENABLE();
    HERO.AIVAR[4] = FALSE;
}

func void Q204_ARAXOSDRINK() {
    CREATEINVITEMS(SLD_1015_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1014_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1013_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1012_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1011_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1000_ADELARD, 0x8cb7, 1);
    AI_WAIT(SLD_1015_ARAXOS, 0x3dcccccd);
    B_USEITEM(SLD_1015_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1013_ARAXOS, 0x3e4ccccd);
    B_USEITEM(SLD_1013_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1014_ARAXOS, 0x3e99999a);
    B_USEITEM(SLD_1014_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1012_ARAXOS, 0x3dcccccd);
    B_USEITEM(SLD_1012_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1011_ARAXOS, 0x3e19999a);
    B_USEITEM(SLD_1011_ARAXOS, 0x8cb7);
}

func void Q204_ARAXOSWATCHFIGHT() {
    WLD_SENDTRIGGER("Q204_CROWD");
    AI_WAIT(SLD_1015_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1015_ARAXOS, "T_WATCHFIGHT_YEAH_02");
    AI_WAIT(SLD_1014_ARAXOS, 0x3e4ccccd);
    AI_PLAYANI(SLD_1014_ARAXOS, "T_WATCHFIGHT_YEAH_03");
    AI_PLAYANI(SLD_1013_ARAXOS, "T_WATCHFIGHT_YEAH_03");
    AI_WAIT(SLD_1012_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1012_ARAXOS, "T_WATCHFIGHT_YEAH_02");
    AI_WAIT(SLD_1011_ARAXOS, 0x3e19999a);
    AI_PLAYANI(SLD_1011_ARAXOS, "T_WATCHFIGHT_YEAH_03");
}

func void Q204_DISABLESOUND() {
    WLD_SENDUNTRIGGER("Q204_CROWD");
}

func void Q204_VOW() {
    B_STARTOTHERROUTINE(SLD_1011_ARAXOS, "JOIN3");
    NPC_REFRESH(SLD_1011_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1012_ARAXOS, "JOIN3");
    NPC_REFRESH(SLD_1012_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1013_ARAXOS, "JOIN3");
    NPC_REFRESH(SLD_1013_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1014_ARAXOS, "JOIN3");
    NPC_REFRESH(SLD_1014_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1015_ARAXOS, "JOIN3");
    NPC_REFRESH(SLD_1015_ARAXOS);
    AI_WAIT(SLD_1015_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1015_ARAXOS, "T_STAND_2_MILJOIN");
    AI_WAIT(SLD_1014_ARAXOS, 0x3e4ccccd);
    AI_PLAYANI(SLD_1014_ARAXOS, "T_STAND_2_MILJOIN");
    AI_PLAYANI(SLD_1013_ARAXOS, "T_STAND_2_MILJOIN");
    AI_WAIT(SLD_1012_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1012_ARAXOS, "T_STAND_2_MILJOIN");
    AI_WAIT(SLD_1011_ARAXOS, 0x3e19999a);
    AI_PLAYANI(SLD_1011_ARAXOS, "T_STAND_2_MILJOIN");
}

func void Q204_ARAXOSJOINT() {
    CREATEINVITEMS(SLD_1015_ARAXOS, 0x8592, 1);
    CREATEINVITEMS(SLD_1014_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1013_ARAXOS, 0x8592, 1);
    CREATEINVITEMS(SLD_1012_ARAXOS, 0x8cb7, 1);
    CREATEINVITEMS(SLD_1011_ARAXOS, 0x8592, 1);
    AI_WAIT(SLD_1015_ARAXOS, 0x3f800000);
    B_USEITEM(SLD_1015_ARAXOS, 0x8592);
    AI_WAIT(SLD_1013_ARAXOS, 0x40000000);
    B_USEITEM(SLD_1013_ARAXOS, 0x8592);
    AI_WAIT(SLD_1014_ARAXOS, 0x3fc00000);
    B_USEITEM(SLD_1014_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1012_ARAXOS, 0x40066666);
    B_USEITEM(SLD_1012_ARAXOS, 0x8cb7);
    AI_WAIT(SLD_1011_ARAXOS, 0x3fe66666);
    B_USEITEM(SLD_1011_ARAXOS, 0x8592);
}

func void Q204_CLEAREVERYONE_END() {
    Q204_TALKWITHARAXOS = TRUE;
    B_STARTOTHERROUTINE(SLD_1011_ARAXOS, "JOIN4");
    NPC_REFRESH(SLD_1011_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1012_ARAXOS, "JOIN4");
    NPC_REFRESH(SLD_1012_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1013_ARAXOS, "JOIN4");
    NPC_REFRESH(SLD_1013_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1014_ARAXOS, "JOIN4");
    NPC_REFRESH(SLD_1014_ARAXOS);
    B_STARTOTHERROUTINE(SLD_1015_ARAXOS, "JOIN4");
    NPC_REFRESH(SLD_1015_ARAXOS);
    AI_WAIT(SLD_1015_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1015_ARAXOS, "T_MILJOIN_2_STAND");
    AI_WAIT(SLD_1014_ARAXOS, 0x3e4ccccd);
    AI_PLAYANI(SLD_1014_ARAXOS, "T_MILJOIN_2_STAND");
    AI_PLAYANI(SLD_1013_ARAXOS, "T_MILJOIN_2_STAND");
    AI_WAIT(SLD_1012_ARAXOS, 0x3dcccccd);
    AI_PLAYANI(SLD_1012_ARAXOS, "T_MILJOIN_2_STAND");
    AI_WAIT(SLD_1011_ARAXOS, 0x3e19999a);
    AI_PLAYANI(SLD_1011_ARAXOS, "T_MILJOIN_2_STAND");
}

func void Q204_LAUGH() {
    AI_WAIT(SLD_1015_ARAXOS, 0x3fc00000);
    AI_PLAYANI(SLD_1015_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1014_ARAXOS, 0x400ccccd);
    AI_PLAYANI(SLD_1014_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1013_ARAXOS, 0x3fa66666);
    AI_PLAYANI(SLD_1013_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1012_ARAXOS, 0x40500000);
    AI_PLAYANI(SLD_1012_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1011_ARAXOS, 0x3faccccd);
    AI_PLAYANI(SLD_1011_ARAXOS, T_LAUGH);
}

func void Q204_LAUGH_V2() {
    AI_WAIT(SLD_1015_ARAXOS, 0x3f000000);
    AI_PLAYANI(SLD_1015_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1014_ARAXOS, 0x3f99999a);
    AI_PLAYANI(SLD_1014_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1013_ARAXOS, 0x3e99999a);
    AI_PLAYANI(SLD_1013_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1012_ARAXOS, 0x3fb9999a);
    AI_PLAYANI(SLD_1012_ARAXOS, T_LAUGH);
    AI_WAIT(SLD_1011_ARAXOS, 0x3eb33333);
    AI_PLAYANI(SLD_1011_ARAXOS, T_LAUGH);
}

func void Q204_CLEAREVERYONE() {
    PRINTD("Refresh korwa");
    NPC_REFRESH(SLD_1011_ARAXOS);
    NPC_REFRESH(SLD_1012_ARAXOS);
    NPC_REFRESH(SLD_1013_ARAXOS);
    NPC_REFRESH(SLD_1014_ARAXOS);
    NPC_REFRESH(SLD_1015_ARAXOS);
    AI_WAIT(SLD_1015_ARAXOS, 0x40200000);
    AI_PLAYANI(SLD_1015_ARAXOS, T_STAND_2_LGUARD);
    AI_WAIT(SLD_1014_ARAXOS, 0x3f99999a);
    AI_PLAYANI(SLD_1014_ARAXOS, "T_STAND_2_HGUARD");
    AI_WAIT(SLD_1013_ARAXOS, 0x40a9999a);
    AI_PLAYANI(SLD_1013_ARAXOS, T_STAND_2_LGUARD);
    AI_WAIT(SLD_1012_ARAXOS, 0x40ee6666);
    AI_PLAYANI(SLD_1012_ARAXOS, T_STAND_2_LGUARD);
    AI_WAIT(SLD_1011_ARAXOS, 0x40566666);
    AI_PLAYANI(SLD_1011_ARAXOS, "T_STAND_2_HGUARD");
}

func void QA204_MARVINGOTOSLEEP() {
    AI_PLAYANI(HERO, "T_STAND_2_WOUNDEDB");
    FADESCREENTOBLACKF(3, 0xfa27, 1000);
}

func void QA204_MARVINGOTOSLEEP_FADESCREEN() {
    AI_FUNCTION(HERO, 0x111e5);
    AI_PLAYANI(HERO, "T_WOUNDEDB_2_STAND");
    TELEPORTNPCTOWP(0x71b, "PARTM1_GUILDHOUSE02_15");
    B_LOGENTRY(TOPIC_Q204, LOG_Q204_ARAXOSFINISH);
    LOG_SETSTATUS(_@(MIS_Q204), TOPIC_Q204, LOG_SUCCESS);
    B_STARTOTHERROUTINE(SLD_1000_ADELARD, START);
    NPC_REFRESH(SLD_1000_ADELARD);
    TELEPORTNPCTOWP(0xcb0a, SLD_1000_ADELARD.WP);
    B_STARTOTHERROUTINE(SLD_1011_ARAXOS, START);
    NPC_REFRESH(SLD_1011_ARAXOS);
    TELEPORTNPCTOWP(0xca79, SLD_1011_ARAXOS.WP);
    B_STARTOTHERROUTINE(SLD_1012_ARAXOS, START);
    NPC_REFRESH(SLD_1012_ARAXOS);
    TELEPORTNPCTOWP(0xca82, SLD_1012_ARAXOS.WP);
    B_STARTOTHERROUTINE(SLD_1013_ARAXOS, START);
    NPC_REFRESH(SLD_1013_ARAXOS);
    TELEPORTNPCTOWP(0xca88, SLD_1013_ARAXOS.WP);
    B_STARTOTHERROUTINE(SLD_1014_ARAXOS, START);
    NPC_REFRESH(SLD_1014_ARAXOS);
    TELEPORTNPCTOWP(0xca8e, SLD_1014_ARAXOS.WP);
    B_STARTOTHERROUTINE(SLD_1015_ARAXOS, START);
    NPC_REFRESH(SLD_1015_ARAXOS);
    TELEPORTNPCTOWP(0xca94, SLD_1015_ARAXOS.WP);
    if ((NPC_ISDEAD(SLD_8202_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8202_ARAXOS, START);
        NPC_REFRESH(SLD_8202_ARAXOS);
        TELEPORTNPCTOWP(0xcaab, SLD_8202_ARAXOS.WP);
    };
    if ((NPC_ISDEAD(SLD_8201_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8201_ARAXOS, START);
        NPC_REFRESH(SLD_8201_ARAXOS);
        TELEPORTNPCTOWP(0xcaa8, SLD_8201_ARAXOS.WP);
    };
    if ((NPC_ISDEAD(SLD_8200_ARAXOS)) == (FALSE)) {
        B_STARTOTHERROUTINE(SLD_8200_ARAXOS, START);
        NPC_REFRESH(SLD_8200_ARAXOS);
        TELEPORTNPCTOWP(0xcaa5, SLD_8200_ARAXOS.WP);
    };
    B_PASSTIME(5);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
}

