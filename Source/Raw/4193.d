instance DIA_DINKEL_EXIT(C_INFO) {
    NPC = 0xe5ea;
    NR = 999;
    CONDITION = DIA_DINKEL_EXIT_CONDITION;
    INFORMATION = DIA_DINKEL_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_DINKEL_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_DINKEL_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_DINKEL_HELLO(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_HELLO_CONDITION;
    INFORMATION = DIA_DINKEL_HELLO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Who are you?";
}

func int DIA_DINKEL_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_DINKEL_HELLO_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_Hello_15_01");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_Hello_03_02");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_Hello_03_03");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_DINKEL_SQ317_ABOUTHOMER(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_SQ317_ABOUTHOMER_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_ABOUTHOMER_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Why is Homer cleaning your house?";
}

func int DIA_DINKEL_SQ317_ABOUTHOMER_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ317)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x14c12))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_ABOUTHOMER_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_AboutHomer_15_01");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_03_02");
    INFO_CLEARCHOICES(0x14c15);
    INFO_ADDCHOICE(0x14c15, "Is he your slave?", 0x14c18);
}

func void DIA_DINKEL_SQ317_ABOUTHOMER_SLAVE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_AboutHomer_Slave_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_Slave_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_Slave_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_Slave_03_04");
    AI_LOGENTRY(TOPIC_SQ317, LOG_SQ317_DINKEL_HOMERHISTORY);
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(0x14c15);
    INFO_ADDCHOICE(0x14c15, "Let's forget about this case.", 0x14c1b);
    INFO_ADDCHOICE(0x14c15, "I will pay for his life.", 0x14c1a);
    INFO_ADDCHOICE(0x14c15, "You have to let him go.", 0x14c19);
}

func void DIA_DINKEL_SQ317_ABOUTHOMER_SLAVE_FREE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_AboutHomer_Free_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_Free_03_02");
}

func void DIA_DINKEL_SQ317_ABOUTHOMER_SLAVE_PAY() {
    SQ317_DINKELWANTSGOLD = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_AboutHomer_Pay_15_01");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_AboutHomer_Pay_03_02");
    AI_LOGENTRY(TOPIC_SQ317, LOG_SQ317_DINKEL_WANTSGOLD);
}

func void DIA_DINKEL_SQ317_ABOUTHOMER_SLAVE_LEAVE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_AboutHomer_Leave_15_01");
    INFO_CLEARCHOICES(0x14c15);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_DINKEL_SQ317_PAY(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_SQ317_PAY_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_PAY_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Here's your gold. (buy out Homer for 2000 GP)";
}

func int DIA_DINKEL_SQ317_PAY_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ317)) == (LOG_RUNNING)) && ((SQ317_DINKELWANTSGOLD) == (1))) && ((SQ317_FOLLOWSAFTEY) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_PAY_INFO() {
    if ((NPC_HASITEMS(OTHER, 0x859b)) >= (SQ317_GOLDFORHOMER)) {
        SQ317_DINKELWANTSGOLD = 2;
        NPC_REMOVEINVITEMS(SELF, SQ317_GOLDFORHOMER, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_Pay_15_01");
        B_GIVEINVITEMS(OTHER, SELF, 0x859b, SQ317_GOLDFORHOMER);
        AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_Pay_03_02");
        B_USEFAKEBAG();
        AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_Pay_03_03");
        AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_Pay_03_04");
        AI_STOPPROCESSINFOS(SELF);
        NPC_EXCHANGEROUTINE(SELF, "SQ317_INN");
    };
    B_SAY(SELF, OTHER, "$NOGOLD");
}

instance DIA_DINKEL_SQ317_NEEDHOMER(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_SQ317_NEEDHOMER_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_NEEDHOMER_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I need to borrow Homer for a while.";
}

func int DIA_DINKEL_SQ317_NEEDHOMER_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ317)) == (LOG_RUNNING)) && ((SQ317_HOMERSPLAN) == (3))) && ((SQ317_GOTRUNE) == (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_NEEDHOMER_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_NeedHomer_15_01");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_03_02");
    INFO_CLEARCHOICES(0x14c1f);
    INFO_ADDCHOICE(0x14c1f, "Cortez ordered him to repair palisade by his hut.", 0x14c22);
}

func void DIA_DINKEL_SQ317_NEEDHOMER_CORTEZ() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_NeedHomer_Cortez_15_01");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_Cortez_03_02");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_Cortez_03_03");
    INFO_CLEARCHOICES(0x14c1f);
    if (((((NPC_HASITEMS(OTHER, 0x8582)) >= (1)) && ((NPC_HASITEMS(OTHER, 0x8585)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x9058)) >= (1))) && ((NPC_HASITEMS(OTHER, 0x84df)) >= (1))) {
        INFO_ADDCHOICE(0x14c1f, "I have the tools for Homer here.", 0x14c25);
    };
    INFO_ADDCHOICE(0x14c1f, "You can go and ask Cortez yourself, he'll probably be happy...", 0x14c24);
}

func void DIA_DINKEL_SQ317_NEEDHOMER_NEXT() {
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_Next_03_01");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_Next_03_02");
    INFO_CLEARCHOICES(0x14c1f);
    INFO_ADDCHOICE(0x14c1f, "We can handle ourselves.", 0x14c26);
    INFO_ADDCHOICE(0x14c1f, "Let's go! (Bluff)", 0x14c27);
}

func void DIA_DINKEL_SQ317_NEEDHOMER_CORTEZ_ASK() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_NeedHomer_Ask_15_01");
    DIA_DINKEL_SQ317_NEEDHOMER_NEXT();
}

func void DIA_DINKEL_SQ317_NEEDHOMER_CORTEZ_TOOLS() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_NeedHomer_Tools_15_01");
    B_GIVEPLAYERXP(XP_SQ317_DINKELTOOLSBONUS);
    DIA_DINKEL_SQ317_NEEDHOMER_NEXT();
}

func void DIA_DINKEL_SQ317_NEEDHOMER_CORTEZ_TOOLS_NEXT_ALONE() {
    SQ317_FAILEDDINKIELDIALOGUE = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_NeedHomer_Alone_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_Alone_03_02");
    AI_LOGENTRY(TOPIC_SQ317, LOG_SQ317_FAILED_V2);
    LOG_SETSTATUS(_@(MIS_SQ317), TOPIC_SQ317, LOG_FAILED);
    AI_STOPPROCESSINFOS(SELF);
    B_ATTACK(SELF, OTHER, AR_SUDDENENEMYINFERNO, 1);
    SELF.FLAGS = NPC_FLAG_IMPORTANT;
}

func void DIA_DINKEL_SQ317_NEEDHOMER_CORTEZ_TOOLS_NEXT_LETSGO() {
    SQ317_TRYHELP = 1;
    B_SAY(OTHER, SELF, "$MARVIN_LETSGO");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_LetsGo_03_02");
    AI_TURNTONPC(SELF, NONE_13719_HOMER);
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_NeedHomer_LetsGo_03_03");
    AI_TURNTONPC(SELF, OTHER);
    INFO_CLEARCHOICES(0x14c1f);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_SQ317, LOG_SQ317_DINKEL_PLANSUCCESS);
    AI_FUNCTION(SELF, 0xf3f7);
}

instance DIA_DINKEL_SQ317_LEAVEME(C_INFO) {
    NPC = 0xe5ea;
    NR = 2;
    CONDITION = DIA_DINKEL_SQ317_LEAVEME_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_LEAVEME_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_DINKEL_SQ317_LEAVEME_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ317)) == (LOG_FAILED)) && (NPC_ISINSTATE(SELF, 0xf09f))) && ((SQ317_FAILEDDINKIELDIALOGUE) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_LEAVEME_INFO() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    B_SAY(SELF, OTHER, "$RUDE_GOODBYE");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_DINKEL_SQ317_WHEREHOMER(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_SQ317_WHEREHOMER_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_WHEREHOMER_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_DINKEL_SQ317_WHEREHOMER_CONDITION() {
    if ((SQ317_HOMERESCAPED) == (TRUE)) {
        return TRUE;
    };
    if (((KAPITEL) == (3)) && ((LOG_GETSTATUS(MIS_Q306)) == (LOG_SUCCESS))) {
        return FALSE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_WHEREHOMER_INFO() {
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_03_01");
    INFO_CLEARCHOICES(0x14c2b);
    INFO_ADDCHOICE(0x14c2b, "Homer was eaten by swampsharks.", 0x14c2e);
}

func void DIA_DINKEL_SQ317_WHEREHOMER_SWAMPSHARK() {
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_WhereHomer_Swampshark_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_Swampshark_03_02");
    INFO_CLEARCHOICES(0x14c2b);
    INFO_ADDCHOICE(0x14c2b, "Cortez said he would personally compensate you.", 0x14c31);
    if ((NPC_HASITEMS(OTHER, 0x9543)) >= (1)) {
        INFO_ADDCHOICE(0x14c2b, "(Show bloody hand)", 0x14c30);
    };
}

func void DIA_DINKEL_SQ317_WHEREHOMER_NEXT() {
    if ((LOG_GETSTATUS(MIS_SQ317)) == (LOG_RUNNING)) {
        AI_LOGENTRY(TOPIC_SQ317, LOG_SQ317_DINKEL_ANOTHERLIE);
    };
    INFO_CLEARCHOICES(0x14c2b);
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

func void DIA_DINKEL_SQ317_WHEREHOMER_SWAMPSHARK_HAND() {
    NPC_REMOVEINVITEM(SELF, 0x9543);
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_WhereHomer_Hand_15_01");
    B_GIVEINVITEMS(OTHER, SELF, 0x9543, 1);
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_Hand_03_02");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_Hand_03_03");
    DIA_DINKEL_SQ317_WHEREHOMER_NEXT();
}

func void DIA_DINKEL_SQ317_WHEREHOMER_SWAMPSHARK_CORTEZ() {
    SQ317_KILLDINKEL = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Dinkel_SQ317_WhereHomer_Cortez_15_01");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_Cortez_03_02");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_WhereHomer_Cortez_03_03");
    DIA_DINKEL_SQ317_WHEREHOMER_NEXT();
}

instance DIA_DINKEL_SQ317_TAVERN(C_INFO) {
    NPC = 0xe5ea;
    NR = 1;
    CONDITION = DIA_DINKEL_SQ317_TAVERN_CONDITION;
    INFORMATION = DIA_DINKEL_SQ317_TAVERN_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_DINKEL_SQ317_TAVERN_CONDITION() {
    if (((NPC_ISINSTATE(SELF, 0xf09f)) && ((KAPITEL) == (3))) && ((LOG_GETSTATUS(MIS_Q306)) == (LOG_SUCCESS))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_SQ317_TAVERN_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Dinkel_SQ317_Tavern_03_01");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_DINKEL_PICKPOCKET(C_INFO) {
    NPC = 0xe5ea;
    NR = 900;
    CONDITION = DIA_DINKEL_PICKPOCKET_CONDITION;
    INFORMATION = DIA_DINKEL_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_80;
}

func int DIA_DINKEL_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DINKEL_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x14c35);
    INFO_ADDCHOICE(0x14c35, DIALOG_BACK, 0x14c39);
    INFO_ADDCHOICE(0x14c35, DIALOG_PICKPOCKET, 0x14c38);
}

func void DIA_DINKEL_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x14c35);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x14c35);
}

func void DIA_DINKEL_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x14c35);
}

