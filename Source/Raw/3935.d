instance DIA_RUUD_EXIT(C_INFO) {
    NPC = 0xd529;
    NR = 999;
    CONDITION = DIA_RUUD_EXIT_CONDITION;
    INFORMATION = DIA_RUUD_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_RUUD_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_RUUD_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_RUUD_HELLO(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_HELLO_CONDITION;
    INFORMATION = DIA_RUUD_HELLO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Why aren't you working?";
}

func int DIA_RUUD_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_RUUD_HELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_15_01");
    AI_STARTFACEANI(VLK_6282_RUUD, S_ANGRY, 0, 3);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_03_07");
    INFO_CLEARCHOICES(0x1276d);
    INFO_ADDCHOICE(0x1276d, "Why don't you go to the mages? They'll cure you.", 0x12770);
}

func void DIA_RUUD_HELLO_MAGES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_Mages_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_Mages_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_Mages_03_08");
    INFO_CLEARCHOICES(0x1276d);
    INFO_ADDCHOICE(0x1276d, "Tell me what to do.", 0x12771);
}

func void DIA_RUUD_HELLO_MAGES_WHAT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_What_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_What_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_What_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_HELLO_What_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_What_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_HELLO_What_03_06");
    LOG_CREATETOPIC(TOPIC_CQ006, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_CQ006), TOPIC_CQ006, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_START);
    AI_RESETFACEANI(VLK_6282_RUUD);
}

instance DIA_RUUD_BEINARD(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_BEINARD_CONDITION;
    INFORMATION = DIA_RUUD_BEINARD_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I found someone who can help.";
}

func int DIA_RUUD_BEINARD_CONDITION() {
    if (((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) && ((CQ006_BEINARDHELP) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_BEINARD_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_15_02");
    AI_STARTFACEANI(VLK_6282_RUUD, S_SMILE, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_15_04");
    AI_PLAYANI(VLK_6282_RUUD, T_JUMPB);
    AI_STARTFACEANI(VLK_6282_RUUD, T_HURT, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_15_06");
    AI_STARTFACEANI(VLK_6282_RUUD, S_FRIGHTENED, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_03_07");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_15_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_03_09");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_15_10");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_03_11");
    INFO_CLEARCHOICES(0x12772);
    INFO_ADDCHOICE(0x12772, "If not, then no. Forget it.", 0x12777);
    INFO_ADDCHOICE(0x12772, "Don't be a crybaby!", 0x12776);
    INFO_ADDCHOICE(0x12772, "Do you want to go back to work or not?", 0x12775);
}

func void DIA_RUUD_BEINARD_WORK() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Work_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Work_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Work_15_03");
    AI_RESETFACEANI(VLK_6282_RUUD);
    AI_RESETFACEANI(HERO);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Work_03_04");
    CREATEINVITEMS(SELF, 0x9127, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x9127, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Work_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Work_15_06");
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_PAPERFORBEINARD);
    INFO_CLEARCHOICES(0x12772);
    CQ006_BEINARDHELP = 3;
}

func void DIA_RUUD_BEINARD_CRYBABY() {
    AI_STARTFACEANI(HERO, S_ANGRY, 0, 1);
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Crybaby_15_01");
    AI_STARTFACEANI(VLK_6282_RUUD, S_ANGRY, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Crybaby_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Crybaby_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Crybaby_03_05");
}

func void DIA_RUUD_BEINARD_GOODBYE() {
    AI_STARTFACEANI(HERO, S_ANGRY, 0, 1);
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Goodbye_15_01");
    AI_STARTFACEANI(VLK_6282_RUUD, S_ANGRY, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Goodbye_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Goodbye_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Goodbye_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Beinard_Goodbye_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Beinard_Goodbye_03_06");
    AI_RESETFACEANI(VLK_6282_RUUD);
    AI_RESETFACEANI(HERO);
    INFO_CLEARCHOICES(0x12772);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_NOTTHEBEINARD);
    CQ006_BEINARDHELP = 4;
}

var int RUUDAMBIENT_BEINARDWAY = 0;
instance DIA_RUUD_SCARED(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_SCARED_CONDITION;
    INFORMATION = DIA_RUUD_SCARED_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_RUUD_SCARED_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) && ((CQ006_CHANGEBEINARDRTN) == (TRUE))) && ((NPC_GETDISTTOWP(VLK_6282_RUUD, "HARBOUR_PATH_400")) <= (350))) && ((NPC_GETDISTTOWP(VLK_6283_BEINARD, "HARBOUR_PATH_401")) <= (350))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_SCARED_INFO() {
    TRIA_INVITE(VLK_6283_BEINARD);
    TRIA_START();
    AI_LOOKATNPC(HERO, VLK_6282_RUUD);
    AI_STARTFACEANI(VLK_6282_RUUD, S_FRIGHTENED, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_03_07");
    INFO_CLEARCHOICES(0x12779);
    INFO_ADDCHOICE(0x12779, "Just be glad Beinard came without the axe.", 0x1277d);
    INFO_ADDCHOICE(0x12779, "Relax, it'll only take a moment.", 0x1277e);
    INFO_ADDCHOICE(0x12779, "Apparently some mage wants to help you.", 0x1277f);
}

func void DIA_RUUD_RUNAWAY() {
    TRIA_FINISH();
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x12779);
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(VLK_6282_RUUD);
    AI_RESETFACEANI(HERO);
    AI_FUNCTION(SELF, 0xf4ef);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_BEINARDISSCARY);
}

func void DIA_RUUD_SCARED_AXE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Axe_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Axe_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Axe_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Axe_03_04");
    DIA_RUUD_RUNAWAY();
}

func void DIA_RUUD_SCARED_CALMDOWN() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_CalmDown_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_CalmDown_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_CalmDown_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_CalmDown_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_CalmDown_03_05");
    DIA_RUUD_RUNAWAY();
}

func void DIA_RUUD_SCARED_MAGE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_05");
    AI_SETWALKMODE(VLK_6282_RUUD, NPC_WALK);
    AI_SETWALKMODE(VLK_6283_BEINARD, NPC_WALK);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_FUNCTION(SELF, 0x12780);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_WAIT(HERO, 0x3f4ccccd);
    AI_WAIT(VLK_6282_RUUD, 0x3f4ccccd);
    AI_WAIT(VLK_6283_BEINARD, 0x3f4ccccd);
    TRIA_WAIT();
    TRIA_NEXT(VLK_6283_BEINARD);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_06");
    AI_SND_PLAY(HERO, "CQ006_BONEHARD");
    AI_PLAYANI(HERO, "T_BROKENARM_SCARED");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6282_RUUD);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_07");
    CREATEINVITEM(VLK_6282_RUUD, 0x8add);
    AI_EQUIPARMOR(VLK_6282_RUUD, 0x8add);
    TRIA_WAIT();
    TRIA_NEXT(VLK_6283_BEINARD);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_08");
    TRIA_WAIT();
    TRIA_NEXT(VLK_6282_RUUD);
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_09");
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_FUNCTION(HERO, 0x12781);
    AI_GOTONPC(SELF, HERO);
    if (((LOG_GETSTATUS(MIS_Q202)) != (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_Q202)) == (LOG_SUCCESS))) {
        CQ006_RUUD_REFERENCEEXCHANGE = 1;
        AI_FUNCTION(SELF, 0x12782);
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_10");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_11");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_12");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_13");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_14");
        CREATEINVITEMS(SELF, 0x859b, CQ006_REWARD);
    };
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING)) {
        AI_FUNCTION(SELF, 0x12782);
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_15");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_16");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_17");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_18");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_19");
        B_USEFAKESCROLL();
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_20");
        CREATEINVITEMS(SELF, 0x912a, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x912a, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_21");
    };
    CQ006_FINISHQUEST();
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING)) {
        AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_SUCCESSV2);
    };
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_SUCCESSV1);
    CREATEINVITEMS(SELF, 0x84c4, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x84c4, 1);
    TRIA_FINISH();
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x12779);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(VLK_6283_BEINARD, START);
    RUUDAMBIENT_BEINARDWAY = TRUE;
}

func void BROKENARMREPAIR() {
    HERO.AIVAR[4] = FALSE;
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_METHODS_02");
    TELEPORTNPCTOWP(0x71b, "HARBOUR_PATH_400");
    TELEPORTNPCTOWP(0xd529, "HARBOUR_PATH_402");
    TELEPORTNPCTOWP(0xd778, "HARBOUR_PATH_402");
}

func void BROKENARMREPAIR_SECONDCAMERA_BEINARD() {
    WLD_SENDTRIGGER("KM_METHODS_01");
    AI_GOTOWP(VLK_6283_BEINARD, "HARBOUR_PATH_401");
}

func void BROKENARMREPAIR_DISABLECAMERA() {
    FF_APPLYONCEEXT(0x12783, 75, 4);
}

func void BROKENARMREPAIR_DISABLECAMERA_APPLY() {
    BROKENARMREPAIR_DISABLECAMERA_COUNT = (BROKENARMREPAIR_DISABLECAMERA_COUNT) + (1);
    if ((BROKENARMREPAIR_DISABLECAMERA_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KM_METHODS_01");
        WLD_SENDUNTRIGGER("KM_METHODS_02");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
        BROKENARMREPAIR_DISABLECAMERA_COUNT = 0;
        VLK_6284_FIGARO.AIVAR[15] = FALSE;
    };
}

var int BROKENARMREPAIR_DISABLECAMERA_APPLY.BROKENARMREPAIR_DISABLECAMERA_COUNT = 0;
instance DIA_RUUD_WHATNOW(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_WHATNOW_CONDITION;
    INFORMATION = DIA_RUUD_WHATNOW_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "And now what?";
}

func int DIA_RUUD_WHATNOW_CONDITION() {
    if (((CQ006_RUUDRUNAWAY_HARBOUR) == (TRUE)) && ((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_WHATNOW_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_WhatNow_15_01");
    AI_STARTFACEANI(VLK_6282_RUUD, S_ANGRY, 0, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_WhatNow_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_WhatNow_15_03");
    AI_RESETFACEANI(VLK_6282_RUUD);
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_RUUDISANGRY);
}

var int RUUDAMBIENT_FIGAROWAY = 0;
instance DIA_RUUD_ALCHEMIST(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_ALCHEMIST_CONDITION;
    INFORMATION = DIA_RUUD_ALCHEMIST_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_RUUD_ALCHEMIST_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_CQ006)) == (LOG_RUNNING)) && ((CQ006_CHANGEALCHEMISTRTN) == (TRUE))) && ((NPC_GETDISTTOWP(VLK_6282_RUUD, "HARBOUR_PATH_400")) <= (350))) && ((NPC_GETDISTTOWP(VLK_6284_FIGARO, "HARBOUR_PATH_401")) <= (350))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_ALCHEMIST_INFO() {
    TRIA_INVITE(VLK_6284_FIGARO);
    TRIA_START();
    AI_LOOKATNPC(HERO, VLK_6282_RUUD);
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_01");
    AI_STARTFACEANI(VLK_6282_RUUD, S_FRIGHTENED, 0, 1);
    if ((CQ006_RUUDRUNAWAY_HARBOUR) == (TRUE)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_02");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_05");
    if ((CQ006_ALCHEMISTWAY) == (2)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_06");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_07");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_08");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_09");
    };
    if ((CQ006_ALCHEMISTWAY) == (1)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_10");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_11");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_12");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_13");
    };
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_FUNCTION(HERO, 0x1278c);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_WAIT(HERO, 0x3f4ccccd);
    AI_WAIT(VLK_6282_RUUD, 0x3f4ccccd);
    AI_WAIT(VLK_6284_FIGARO, 0x3f4ccccd);
    AI_SND_PLAY(HERO, "CQ006_BONELOW");
    AI_PLAYANI(HERO, R_LEGSHAKE);
    TRIA_WAIT();
    TRIA_NEXT(VLK_6282_RUUD);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_15");
    CREATEINVITEM(VLK_6282_RUUD, 0x8add);
    AI_EQUIPARMOR(VLK_6282_RUUD, 0x8add);
    TRIA_WAIT();
    TRIA_NEXT(VLK_6282_RUUD);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_FUNCTION(HERO, 0x1278d);
    AI_GOTONPC(SELF, HERO);
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_17");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_18");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Alchemist_03_19");
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Alchemist_15_20");
    if (((LOG_GETSTATUS(MIS_Q202)) != (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_Q202)) == (LOG_SUCCESS))) {
        CQ006_RUUD_REFERENCEEXCHANGE = 1;
        AI_FUNCTION(SELF, 0x12782);
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_10");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_11");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_12");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_13");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_14");
        CREATEINVITEMS(SELF, 0x859b, CQ006_REWARD);
    };
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING)) {
        AI_FUNCTION(SELF, 0x12782);
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_15");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_16");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_17");
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_18");
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_19");
        B_USEFAKESCROLL();
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Scared_Mage_03_20");
        CREATEINVITEMS(SELF, 0x912a, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x912a, 1);
        AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Scared_Mage_15_21");
    };
    CQ006_FINISHQUEST();
    if ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING)) {
        AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_SUCCESSV3);
    };
    AI_LOGENTRY(TOPIC_CQ006, LOG_CQ006_SUCCESSV1);
    TRIA_FINISH();
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(0x12779);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(VLK_6284_FIGARO, START);
    RUUDAMBIENT_FIGAROWAY = TRUE;
}

func void BROKENARMREPAIR_ALCHEMIST() {
    HERO.AIVAR[4] = FALSE;
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_METHODS_02");
    TELEPORTNPCTOWP(0x71b, "HARBOUR_PATH_400");
    TELEPORTNPCTOWP(0xd529, "HARBOUR_PATH_402");
    TELEPORTNPCTOWP(0xcb89, "HARBOUR_PATH_402");
}

func void BROKENARMREPAIR_SECONDCAMERA_ALCHEMIST() {
    WLD_SENDTRIGGER("KM_METHODS_01");
    AI_GOTOWP(VLK_6284_FIGARO, "HARBOUR_PATH_401");
}

instance DIA_RUUD_REFERENCEEXCHANGE(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_REFERENCEEXCHANGE_CONDITION;
    INFORMATION = DIA_RUUD_REFERENCEEXCHANGE_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Could I exchange my reward for a reference? (90 GP)";
}

func int DIA_RUUD_REFERENCEEXCHANGE_CONDITION() {
    if ((((CQ006_RUUD_REFERENCEEXCHANGE) == (1)) && ((LOG_GETSTATUS(MIS_Q202)) == (LOG_RUNNING))) && (NPC_KNOWSINFO(OTHER, 0x11f69))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_REFERENCEEXCHANGE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Boris_ReferenceExchange_15_01");
    if ((NPC_HASITEMS(OTHER, 0x859b)) >= (CQ006_REWARD)) {
        NPC_REMOVEINVITEMS(SELF, 0x859b, CQ006_REWARD);
        AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
        B_GIVEINVITEMS(OTHER, SELF, 0x859b, CQ006_REWARD);
        B_SAY(SELF, OTHER, "$SURE_V1");
        AI_RESETFACEANI(SELF);
        CREATEINVITEMS(SELF, 0x912a, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x912a, 1);
        CQ006_RUUD_REFERENCEEXCHANGE = 2;
    };
    B_SAY(SELF, OTHER, "$NOGOLD");
}

instance DIA_RUUD_TEACH(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_TEACH_CONDITION;
    INFORMATION = DIA_RUUD_TEACH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Can you teach me something?";
}

func int DIA_RUUD_TEACH_CONDITION() {
    if ((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_TEACH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_TEACH_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_TEACH_03_02");
    LOG_CREATETOPIC(TOPIC_CITYTEACHER, LOG_NOTE);
    AI_LOGENTRY(TOPIC_CITYTEACHER, LOG_CITYTEACHER_RUUD);
}

instance DIA_RUUD_TRAIN_PICKLOCK(C_INFO) {
    NPC = 0xd529;
    NR = 7;
    CONDITION = DIA_RUUD_TRAIN_PICKLOCK_CONDITION;
    INFORMATION = DIA_RUUD_TRAIN_PICKLOCK_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = B_BUILDLEARNSTRING2(PRINT_LEARN_PICKLOCK2, 0, RUUD_PICKLOCK);
}

func int DIA_RUUD_TRAIN_PICKLOCK_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x12791)) && ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKLOCK)) < (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_TRAIN_PICKLOCK_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_TRAIN_Picklock_15_00");
    if ((NPC_HASITEMS(OTHER, 0x859b)) >= (RUUD_PICKLOCK)) {
        if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKLOCK)) >= (2)) {
            if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_SNEAK)) == (0)) {
                B_TEACHTHIEFTALENT(VLK_6282_RUUD, HERO, NPC_TALENT_SNEAK, 1);
                PRINTSCREEN(PRINT_LEARNSNEAK, -(1), YPOS_LEVELUP, FONT_SCREEN, 2);
            };
            NPC_REMOVEINVITEMS(SELF, 0x859b, RUUD_PICKLOCK);
            AI_OUTPUT(SELF, OTHER, "DIA_Ruud_TRAIN_Picklock_03_01");
            B_GIVEINVITEMS(OTHER, SELF, 0x859b, RUUD_PICKLOCK);
            AI_OUTPUT(SELF, OTHER, "DIA_Ruud_TRAIN_Picklock_03_02");
        };
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_TRAIN_Picklock_03_03");
}

instance DIA_RUUD_Q504_FEEL(C_INFO) {
    NPC = 0xd529;
    NR = 90;
    CONDITION = DIA_RUUD_Q504_FEEL_CONDITION;
    INFORMATION = DIA_RUUD_Q504_FEEL_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How's the morale?";
}

func int DIA_RUUD_Q504_FEEL_CONDITION() {
    if ((((NPC_GETDISTTOWP(SELF, "PART5_WORKERSCAMP_STAND_02")) <= (0x7d0)) && ((Q504_TAKEWORKERS) == (2))) && ((Q504_RUUDVOLFZACKE) == (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_Q504_FEEL_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    B_SAY(OTHER, SELF, "$MARVIN_VolfzackMorale3");
    AI_STARTFACEANI(SELF, S_SERIOUS, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Q504_Feel_03_01");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_RUUD_AMBIENT(C_INFO) {
    NPC = 0xd529;
    NR = 1;
    CONDITION = DIA_RUUD_AMBIENT_CONDITION;
    INFORMATION = DIA_RUUD_AMBIENT_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Are you all right?";
}

func int DIA_RUUD_AMBIENT_CONDITION() {
    if (((NPC_ISINSTATE(SELF, 0xf09f)) && (NPC_KNOWSINFO(OTHER, 0x1276d))) && (((Q504_RUUDVOLFZACKE) == (1)) && ((NPC_GETDISTTOWP(SELF, "PART5_WORKERSCAMP_STAND_02")) <= (0x7d0)))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_AMBIENT_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ruud_Ambient_15_01");
    if ((LOG_GETSTATUS(MIS_CQ006)) != (LOG_SUCCESS)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Ambient_03_02");
    };
    if (((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS)) && ((RUUDAMBIENT_FIGAROWAY) == (TRUE))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Ambient_03_03");
    };
    if (((LOG_GETSTATUS(MIS_CQ006)) == (LOG_SUCCESS)) && ((RUUDAMBIENT_BEINARDWAY) == (TRUE))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Ambient_03_04");
    };
    if (((Q504_RUUDVOLFZACKE) == (1)) && ((NPC_GETDISTTOWP(SELF, "PART5_WORKERSCAMP_STAND_02")) > (0x7d0))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Ruud_Ambient_03_05");
    };
}

instance DIA_RUUD_PICKPOCKET(C_INFO) {
    NPC = 0xd529;
    NR = 900;
    CONDITION = DIA_RUUD_PICKPOCKET_CONDITION;
    INFORMATION = DIA_RUUD_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_40;
}

func int DIA_RUUD_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_RUUD_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x1279d);
    INFO_ADDCHOICE(0x1279d, DIALOG_BACK, 0x127a1);
    INFO_ADDCHOICE(0x1279d, DIALOG_PICKPOCKET, 0x127a0);
}

func void DIA_RUUD_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) {
        CREATEINVITEMS(SELF, 0x84d0, 2);
        B_GIVEINVITEMS(SELF, OTHER, 0x84d0, 2);
        B_PICKPOCKET_AMBIENT_TIER_1();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x1279d);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x1279d);
}

func void DIA_RUUD_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x1279d);
}

