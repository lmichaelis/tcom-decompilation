func void Q501_SLEEPINMONASTERY_V1() {
    Q501_BRINGMARVINMDSBACK = 2;
    Q501_MARVINGOTOSLEEP = 2;
    MDL_REMOVEOVERLAYMDS(HERO, "HumanS_Wounded.mds");
    MDL_APPLYOVERLAYMDS(HERO, HUMANSHURTMDS);
    B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_NEARROOM");
    NPC_REFRESH(NONE_100008_ANA);
    TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
    B_STARTOTHERROUTINE(KDW_303_RIEROL, "Q501_ROOM");
    NPC_REFRESH(KDW_303_RIEROL);
    TELEPORTNPCTOWP(0xdd4a, KDW_303_RIEROL.WP);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, TOT);
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    B_STARTOTHERROUTINE(NOV_13690_NOVIZE, TOT);
    NPC_REFRESH(NOV_13690_NOVIZE);
    TELEPORTNPCTOWP(0xdd0c, NOV_13690_NOVIZE.WP);
    B_LOGENTRY(TOPIC_Q501, LOG_Q501_NEXTDAY);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_HEALROOM");
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_RIEROL");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_05, FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_06, FALSE, FALSE, FALSE, FALSE);
    PC_SLEEP(10);
}

func void Q501_SLEEPINMONASTERY_V2() {
    Q501_MARVINGOTOSLEEP = 4;
    Q501_MAKERIORDIANTIRED = TRUE;
    NPC_CHANGEFACE(KDW_203_RIORDIAN, FACE_P_RIORDIAN_TIRED);
    B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_HEALREFUGEE");
    NPC_REFRESH(NONE_100008_ANA);
    TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
    B_STARTOTHERROUTINE(KDW_303_RIEROL, "Q501_ROOM");
    NPC_REFRESH(KDW_303_RIEROL);
    TELEPORTNPCTOWP(0xdd4a, KDW_303_RIEROL.WP);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q501_AFTERNIGHT");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    B_STARTOTHERROUTINE(PAL_100_CANDAC, "SQ508_DRINK");
    NPC_REFRESH(PAL_100_CANDAC);
    TELEPORTNPCTOWP(0xcafa, PAL_100_CANDAC.WP);
    B_STARTOTHERROUTINE(KDW_216_INGOLF, "NORMALDAY");
    NPC_REFRESH(KDW_216_INGOLF);
    TELEPORTNPCTOWP(0xdd64, KDW_216_INGOLF.WP);
    WLD_INSERTNPC(0xdda1, "PART8_MONASTERY_Q501_PREPARE_01");
    WLD_INSERTNPC(0xddb4, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xddab, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xdcc4, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xdcca, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xdcd6, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xdcd0, "PART8_MONASTERY_Q501_PREPARE_02");
    WLD_INSERTNPC(0xdda8, "PART8_MONASTERY_107");
    WLD_INSERTNPC(0xc607, "PART8_UNDERGROUND_PANTRY_03");
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_01");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_07, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_08, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_MAGEROOM_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_10, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_RIEROL");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_06, TRUE, TRUE, TRUE, TRUE);
    PC_SLEEP(10);
}

func void Q501_SLEEPINMONASTERY_V3() {
    Q501_MARVINGOTOSLEEP = 6;
    Q501_MAKERIORDIANTIRED = FALSE;
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, TOT);
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_CLEANHEALROOM");
    NPC_REFRESH(NONE_100008_ANA);
    TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
    B_STARTOTHERROUTINE(NOV_207_STEFAN, START);
    NPC_REFRESH(NOV_207_STEFAN);
    TELEPORTNPCTOWP(0xddb0, NOV_207_STEFAN.WP);
    B_STARTOTHERROUTINE(NOV_13690_NOVIZE, START);
    NPC_REFRESH(NOV_13690_NOVIZE);
    TELEPORTNPCTOWP(0xdd0c, NOV_13690_NOVIZE.WP);
    WLD_INSERTNPC(0xdca9, "PART8_MONASTERY_GARDEN_STAND");
    WLD_INSERTNPC(0xdd07, "PART8_MONASTERY_PRECINCT_19");
    WLD_INSERTNPC(0xdd13, "PART8_MONASTERY_SMALLTALK_01");
    WLD_INSERTNPC(0xdd19, "PART8_MONASTERY_SMALLTALK_02");
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_HEALROOM");
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_01");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_06, TRUE, TRUE, TRUE, TRUE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_07, TRUE, TRUE, TRUE, TRUE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_MAGEROOM_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_10, TRUE, TRUE, TRUE, TRUE);
    WLD_SENDTRIGGER("Q501_MOVER_DOOR_LAB_TRY");
    PC_SLEEP(10);
}

func void Q501_SLEEP() {
    WLD_SENDTRIGGER("Q501_TIMELAPSE");
    FADESCREENTOBLACKF(4, 0xf78c, 1000);
}

func void Q501_SLEEP_FADESCREEN() {
    WLD_SENDUNTRIGGER("Q501_TIMELAPSE");
    if ((Q501_MARVINGOTOSLEEP) == (1)) {
        Q501_SLEEPINMONASTERY_V1();
    };
    if ((Q501_MARVINGOTOSLEEP) == (3)) {
        Q501_SLEEPINMONASTERY_V2();
    };
    if ((Q501_MARVINGOTOSLEEP) == (5)) {
        CHANGEVOBCOLLISION("MONASTERY_DOOR_HEALROOM", FALSE, FALSE, FALSE, TRUE);
        Q501_SLEEPINMONASTERY_V3();
    };
    FADESCREENFROMBLACK(2);
}

func void Q501_BRINGMARVINSCARONLOAD() {
    if ((Q501_BRINGBACKMARVINSCAR) == (TRUE)) {
        NPC_CHANGEFACE(HERO, FACE_N_MARVIN_SCAR);
    };
    if ((Q501_BRINGMARVINMDSBACK) == (1)) {
        MDL_APPLYOVERLAYMDS(HERO, "HumanS_Wounded.mds");
    };
    if ((Q501_BRINGMARVINMDSBACK) == (2)) {
        MDL_APPLYOVERLAYMDS(HERO, HUMANSHURTMDS);
    };
}

func void Q501_MAKERIORDIANTIREDONLOAD() {
    if ((Q501_MAKERIORDIANTIRED) == (TRUE)) {
        NPC_CHANGEFACE(KDW_203_RIORDIAN, FACE_P_RIORDIAN_TIRED);
    };
}

func void Q501_ANA_RIEROLROOM_CAMERA_APPLY() {
    Q501_ANA_RIEROLROOM_CAMERA_COUNT = (Q501_ANA_RIEROLROOM_CAMERA_COUNT) + (1);
    if ((Q501_ANA_RIEROLROOM_CAMERA_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("Q501_RIEROL_01");
        DIACAM_ENABLE();
    };
}

var int Q501_ANA_RIEROLROOM_CAMERA_APPLY.Q501_ANA_RIEROLROOM_CAMERA_COUNT = 0;
func void Q501_RIEROLSPYCUTSCENE_END_APPLY() {
    Q501_RIEROLSPYCUTSCENE_END_COUNT = (Q501_RIEROLSPYCUTSCENE_END_COUNT) + (1);
    if ((Q501_RIEROLSPYCUTSCENE_END_COUNT) == (4)) {
        Q501_SPYCUTSCENESTATUS = 3;
        MDL_REMOVEOVERLAYMDS(HERO, HUMANSMARVINSNEAKMDS);
        NONE_100008_ANA.AIVAR[92] = FALSE;
        KDW_303_RIEROL.AIVAR[92] = FALSE;
        WLD_SENDUNTRIGGER("Q501_RIEROL_01");
        WLD_SENDUNTRIGGER("Q501_RIEROL_02");
        WLD_SENDUNTRIGGER("Q501_RIEROL_03");
        B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_SMALLTALK");
        NPC_REFRESH(NONE_100008_ANA);
        TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
        B_STARTOTHERROUTINE(KDW_303_RIEROL, "Q501_SMALLTALK");
        NPC_REFRESH(KDW_303_RIEROL);
        TELEPORTNPCTOWP(0xdd4a, KDW_303_RIEROL.WP);
        B_LOGENTRY(TOPIC_Q501, LOG_Q501_CANSEARCHRIEROLROOM);
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q501_RIEROLSPYCUTSCENE_END_APPLY.Q501_RIEROLSPYCUTSCENE_END_COUNT = 0;
func void Q501_GOTDALBERTRECEPIE_PREPARENPC() {
    B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_HEALREFUGEE");
    NPC_REFRESH(NONE_100008_ANA);
    TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
    B_STARTOTHERROUTINE(KDW_303_RIEROL, "Q501_HEALREFUGEE");
    NPC_REFRESH(KDW_303_RIEROL);
    TELEPORTNPCTOWP(0xdd4a, KDW_303_RIEROL.WP);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q501_READ");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    B_LOGENTRY(TOPIC_Q501, LOG_Q501_GOTRECEPIE);
}

func void Q501_COUNTSTUFF() {
    Q501_STUFF = (Q501_STUFF) + (1);
    PRINTD(CS2("Liczba zebranych rzeczy: ", INTTOSTRING(Q501_STUFF)));
    B_GIVEPLAYERXP(XP_Q501_COUNTSTUFF);
    if ((Q501_STUFF) == (5)) {
        B_LOGENTRY(TOPIC_Q501, LOG_Q501_GOTEVERYTHING);
    };
}

func void Q501_BOOKINGOODSHELF() {
    if (((((((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_RELIGION", 0x928d)) == (TRUE)) && ((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_ASTRONOMY", 0x9291)) == (TRUE))) && ((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_HISTORY", 0x929a)) == (TRUE))) && ((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_FAUNA", 0x9290)) == (TRUE))) && ((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_MAGIC", 0x9297)) == (TRUE))) && ((MOB_HASITEMS("KM_BOOKSHELF_MONASTERY_LITERATURE", 0x9294)) == (TRUE))) {
        B_SAY(HERO, HERO, "$MARVIN_Done");
    };
    RND = HLP_RANDOM(3);
    if ((RND) == (0)) {
        B_SAY(HERO, HERO, "$MARVIN_Yes");
    };
    if ((RND) == (1)) {
        B_SAY(HERO, HERO, "$MARVIN_ThinkingEmoji");
    };
    if ((RND) == (2)) {
        B_SAY(HERO, HERO, "$MARVIN_AllClear");
    };
    B_GIVEPLAYERXP(XP_Q501_BOOKSHELF);
}

var int Q501_BOOKINGOODSHELF.RND = 0;
func void Q501_CAULDRON_APPLY() {
    if ((Q501_CAULDRON_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q501_CAULDRON_APPLY");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q501_MOVER_CAULDRON");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("Q501_CAULDRON", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("Q501_MOVER_CAULDRON");
        Q501_CAULDRON_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - Q501_CAULDRON_APPLY");
        CHANGEVOBCOLLISION("Q501_CAULDRON", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf797);
        Q501_CAULDRON_COUNT = 0;
    };
}

var int Q501_CAULDRON_APPLY.Q501_CAULDRON_COUNT = 0;
instance Q501_CAULDRON_APPLY.MOVER1(ZCMOVER)
var int Q501_CAULDRON_APPLY.MOVPTR1 = 0;
func void Q501_CONTESTCUTSCENE_APPLY() {
    Q501_CONTESTCUTSCENE_COUNT = (Q501_CONTESTCUTSCENE_COUNT) + (1);
    if ((Q501_CONTESTCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(0x169e9);
    };
}

var int Q501_CONTESTCUTSCENE_APPLY.Q501_CONTESTCUTSCENE_COUNT = 0;
func void Q501_CONTESTCUTSCENE_END_APPLY() {
    Q501_CONTESTCUTSCENE_END_COUNT = (Q501_CONTESTCUTSCENE_END_COUNT) + (1);
    if ((Q501_CONTESTCUTSCENE_END_COUNT) == (4)) {
        Q501_CONTESTCUTSCENESTATUS = 3;
        NOV_204_NOVIZE.AIVAR[92] = FALSE;
        WLD_SENDUNTRIGGER("Q501_STARTCONTEST");
        B_STARTOTHERROUTINE(NOV_251_CURTIS, "Q501_CONTEST");
        NPC_REFRESH(NOV_251_CURTIS);
        B_STARTOTHERROUTINE(NOV_201_NOVIZE, "Q501_CONTEST");
        NPC_REFRESH(NOV_201_NOVIZE);
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q501_CONTESTCUTSCENE_END_APPLY.Q501_CONTESTCUTSCENE_END_COUNT = 0;
func void Q501_AFTERCONTEST() {
    B_STARTOTHERROUTINE(NOV_251_CURTIS, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_251_CURTIS);
    TELEPORTNPCTOWP(0xddb4, NOV_251_CURTIS.WP);
    B_STARTOTHERROUTINE(NOV_201_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_201_NOVIZE);
    TELEPORTNPCTOWP(0xdda1, NOV_201_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_204_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_204_NOVIZE);
    TELEPORTNPCTOWP(0xddab, NOV_204_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_209_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_209_NOVIZE);
    TELEPORTNPCTOWP(0xdcc4, NOV_209_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_210_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_210_NOVIZE);
    TELEPORTNPCTOWP(0xdcca, NOV_210_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_217_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_217_NOVIZE);
    TELEPORTNPCTOWP(0xdcd6, NOV_217_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_212_NOVIZE, "Q501_AFTERCONTEST");
    NPC_REFRESH(NOV_212_NOVIZE);
    TELEPORTNPCTOWP(0xdcd0, NOV_212_NOVIZE.WP);
}

func void Q501_CHANGEALMEBICDOOR() {
    FF_APPLYONCEEXTGT(0xf7a1, 0, -(1));
    if ((Q501_DOORALMEBIC_HIDDEN) == (FALSE)) {
        Q501_DOORALMEBIC_HIDDEN = TRUE;
        WLD_SENDTRIGGER("Q501_MOVER_DOORALEMBIC_03");
        MOB_CHANGEFOCUSNAME("Q501_DOORALMEBIC_TRY", "MOBNAME_NOTHING");
    };
}

func void Q501_CHANGEALMEBICDOOR_APPLY() {
    if ((Q501_CHANGEALMEBICDOOR_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q501_ChangeAlmebicDoor_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q501_MOVER_DOORALEMBIC_02");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("Q501_DOORALEMBIC_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("Q501_DOORALEMBIC_02", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("Q501_MOVER_DOORALEMBIC_02");
        Q501_CHANGEALMEBICDOOR_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - Q501_ChangeAlmebicDoor_Apply");
        MOB_CHANGEFOCUSNAME("Q501_DOORALEMBIC_01", "MOBNAME_DOOR");
        CHANGEVOBCOLLISION("Q501_DOORALEMBIC_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q501_DOORALEMBIC_02", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf7a1);
        Q501_CHANGEALMEBICDOOR_COUNT = 0;
    };
}

var int Q501_CHANGEALMEBICDOOR_APPLY.Q501_CHANGEALMEBICDOOR_COUNT = 0;
instance Q501_CHANGEALMEBICDOOR_APPLY.MOVER1(ZCMOVER)
var int Q501_CHANGEALMEBICDOOR_APPLY.MOVPTR1 = 0;
func void Q501_CHANGEDOORLABROOM() {
    FF_APPLYONCEEXTGT(0xf7a6, 0, -(1));
}

func void Q501_CHANGEDOORLABROOM_APPLY() {
    if ((Q501_CHANGEDOORLABROOM_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q501_ChangeDoorLabRoom_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q501_MOVER_DOOR_LAB_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("Q501_DOOR_LAB_01", FALSE, FALSE, FALSE, FALSE);
        CHANGEVOBCOLLISION("Q501_DOOR_LAB_02", FALSE, FALSE, FALSE, FALSE);
        WLD_SENDTRIGGER("Q501_MOVER_DOOR_LAB_01");
        Q501_CHANGEDOORLABROOM_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - Q501_ChangeDoorLabRoom_Apply");
        MOB_CHANGEFOCUSNAME("Q501_DOOR_LAB_02", "MOBNAME_DOOR");
        CHANGEVOBCOLLISION("Q501_DOOR_LAB_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q501_DOOR_LAB_02", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf7a6);
        Q501_CHANGEDOORLABROOM_COUNT = 0;
    };
}

var int Q501_CHANGEDOORLABROOM_APPLY.Q501_CHANGEDOORLABROOM_COUNT = 0;
instance Q501_CHANGEDOORLABROOM_APPLY.MOVER1(ZCMOVER)
var int Q501_CHANGEDOORLABROOM_APPLY.MOVPTR1 = 0;
func void Q501_HEALMARVIN() {
    Q501_BRINGMARVINMDSBACK = 0;
    MDL_REMOVEOVERLAYMDS(HERO, HUMANSHURTMDS);
    B_RAISEATTRIBUTE(HERO, ATR_HITPOINTS_MAX, 50);
    MARVINTRANSFORMHP = (MARVINTRANSFORMHP) + (50);
    SND_PLAY("LEVELUP");
    B_GIVEPLAYERXP((XP_Q501_GOODRECEPIECHOICE) * (Q501_MAKINGPOTION_GOODANWSERS));
}

func void Q501_FINISHMAKINGPOTION() {
    FF_APPLYONCEEXT(0xf7ac, 75, 4);
}

func void Q501_FINISHMAKINGPOTION_APPLY() {
    Q501_FINISHMAKINGPOTION_COUNT = (Q501_FINISHMAKINGPOTION_COUNT) + (1);
    if ((Q501_FINISHMAKINGPOTION_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_01");
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_02");
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_03");
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_04");
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_05");
        WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_06");
        WLD_SENDTRIGGER("Q501_MOVER_FALLDOWNSCRIPT");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q501_FINISHMAKINGPOTION_APPLY.Q501_FINISHMAKINGPOTION_COUNT = 0;
func void Q501_FALLDOWNSCRIPT_FADESCREEN() {
    Q501_AFTERLASTFADESCREEN = TRUE;
    FF_APPLYONCEEXTGT(0xf7af, 0, -(1));
    SQ508_CORPSESONGRAVEYARD_PREPARE();
    B_PASSTIME(3);
    TELEPORTNPCTOWP(0x71b, "PART8_MARVIN_CHAPTER5");
    AI_PLAYANI(HERO, "T_FALLDOWN_STANDUP");
    NPC_REMOVEINVITEMS(HERO, 0x92a3, 1);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q501_MAGES");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    B_STARTOTHERROUTINE(NONE_100008_ANA, "Q501_MARVINROOM");
    NPC_REFRESH(NONE_100008_ANA);
    TELEPORTNPCTOWP(0xc978, NONE_100008_ANA.WP);
    B_STARTOTHERROUTINE(NOV_13690_NOVIZE, "Q501_WAITOUTSIDE");
    NPC_REFRESH(NOV_13690_NOVIZE);
    TELEPORTNPCTOWP(0xdd0c, NOV_13690_NOVIZE.WP);
    B_STARTOTHERROUTINE(NOV_228_NOVIZE, "Q501_WAITOUTSIDE");
    NPC_REFRESH(NOV_228_NOVIZE);
    TELEPORTNPCTOWP(0xdcfe, NOV_228_NOVIZE.WP);
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q502_MONASTERY");
    Q502_KESSEL_RTNCHECK = 1;
    NPC_REFRESH(NONE_202_KESSEL);
    TELEPORTNPCTOWP(0xdd70, NONE_202_KESSEL.WP);
    CREATEINVITEMS(NONE_202_KESSEL, 0x8a3c, 1);
    CREATEINVITEMS(NONE_202_KESSEL, 0x9a38, 1);
    CREATEINVITEMS(NONE_202_KESSEL, 0x9b1d, 1);
    NPC_CHANGEARMOR(NONE_202_KESSEL, 0x8a3c);
    NPC_REMOVEINVITEMS(NONE_202_KESSEL, 0x8b08, NPC_HASITEMS(NONE_202_KESSEL, 0x8b08));
    B_STARTOTHERROUTINE(KDW_216_INGOLF, "Q502_CUTSCENE");
    NPC_REFRESH(KDW_216_INGOLF);
    TELEPORTNPCTOWP(0xdd64, KDW_216_INGOLF.WP);
    B_STARTOTHERROUTINE(KDW_301_CUSTO, "Q502_CUTSCENE");
    NPC_REFRESH(KDW_301_CUSTO);
    TELEPORTNPCTOWP(0xdd24, KDW_301_CUSTO.WP);
    B_STARTOTHERROUTINE(KDW_200_PRIOR, "Q502_CUTSCENE");
    NPC_REFRESH(KDW_200_PRIOR);
    TELEPORTNPCTOWP(0xdd1f, KDW_200_PRIOR.WP);
    B_STARTOTHERROUTINE(KDW_215_NOTGER, "Q502_CUTSCENE");
    NPC_REFRESH(KDW_215_NOTGER);
    TELEPORTNPCTOWP(0xdd5d, KDW_215_NOTGER.WP);
    B_STARTOTHERROUTINE(KDW_214_BADULF, "Q502_CUTSCENE");
    NPC_REFRESH(KDW_214_BADULF);
    TELEPORTNPCTOWP(0xdd58, KDW_214_BADULF.WP);
    WLD_SENDTRIGGER("MONASTERY_GATE_01");
    WLD_SENDTRIGGER("MONASTERY_GATE_03");
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_HEALROOM");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_05, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_TOWER");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_13, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_RIEROL");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_06, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_MAGEROOM_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_10, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_MAGEROOM_03");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_11, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_MAGEROOM_04");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_12, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_01");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_07, FALSE, FALSE, FALSE, FALSE);
    DUMMYFUNCWITHSTRINGPARAMETER("MONASTERY_DOOR_DUNGEON_02");
    CHANGEVOBCOLLISION(RESERVED_CONST_STRING_08, FALSE, FALSE, FALSE, FALSE);
    WLD_SENDTRIGGER("Q501_MOVER_FALLDOWNSCRIPT");
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
}

func void Q501_CHANGEDOORMARVINROOM_APPLY() {
    if ((Q501_CHANGEDOORMARVINROOM_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q501_ChangeDoorMarvinRoom_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q501_MOVER_MARVINROOM_DOOR_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("Q501_MOVER_MARVINROOM_DOOR_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("Q501_MARVINROOM_DOOR_01", FALSE, FALSE, FALSE, FALSE);
        CHANGEVOBCOLLISION("Q501_MARVINROOM_DOOR_02", FALSE, FALSE, FALSE, FALSE);
        WLD_SENDTRIGGER("Q501_MOVER_MARVINROOM_DOOR_01");
        WLD_SENDTRIGGER("Q501_MOVER_MARVINROOM_DOOR_02");
        Q501_CHANGEDOORMARVINROOM_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Sko刃zy쓴m - Q501_ChangeDoorMarvinRoom_Apply");
        CHANGEVOBCOLLISION("Q501_MARVINROOM_DOOR_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q501_MARVINROOM_DOOR_02", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf7af);
        Q501_CHANGEDOORMARVINROOM_COUNT = 0;
    };
}

var int Q501_CHANGEDOORMARVINROOM_APPLY.Q501_CHANGEDOORMARVINROOM_COUNT = 0;
instance Q501_CHANGEDOORMARVINROOM_APPLY.MOVER1(ZCMOVER)
instance Q501_CHANGEDOORMARVINROOM_APPLY.MOVER2(ZCMOVER)
var int Q501_CHANGEDOORMARVINROOM_APPLY.MOVPTR1 = 0;
var int Q501_CHANGEDOORMARVINROOM_APPLY.MOVPTR2 = 0;
func void Q501_NOVIZENORMALRTN() {
    B_STARTOTHERROUTINE(NOV_201_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_201_NOVIZE);
    B_STARTOTHERROUTINE(NOV_204_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_204_NOVIZE);
    B_STARTOTHERROUTINE(NOV_209_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_209_NOVIZE);
    B_STARTOTHERROUTINE(NOV_210_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_210_NOVIZE);
    B_STARTOTHERROUTINE(NOV_212_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_212_NOVIZE);
    B_STARTOTHERROUTINE(NOV_217_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_217_NOVIZE);
    B_STARTOTHERROUTINE(NOV_251_CURTIS, "NORMALDAY");
    NPC_REFRESH(NOV_251_CURTIS);
    B_STARTOTHERROUTINE(NOV_207_STEFAN, START);
    NPC_REFRESH(NOV_207_STEFAN);
}

func void Q501_NOVIZENORMALRTN_V2() {
    B_STARTOTHERROUTINE(NOV_201_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_201_NOVIZE);
    B_STARTOTHERROUTINE(NOV_209_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_209_NOVIZE);
    B_STARTOTHERROUTINE(NOV_210_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_210_NOVIZE);
    B_STARTOTHERROUTINE(NOV_212_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_212_NOVIZE);
    B_STARTOTHERROUTINE(NOV_217_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_217_NOVIZE);
    B_STARTOTHERROUTINE(NOV_222_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_222_NOVIZE);
    B_STARTOTHERROUTINE(NOV_223_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_223_NOVIZE);
    B_STARTOTHERROUTINE(NOV_224_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_224_NOVIZE);
    B_STARTOTHERROUTINE(NOV_225_NOVIZE, "NORMALDAY_V2");
    NPC_REFRESH(NOV_225_NOVIZE);
    B_REMOVENPC(0xdd0c);
}

