func void B_SQ503_FAILQUESTS() {
    if ((LOG_GETSTATUS(MIS_SQ408)) == (LOG_RUNNING)) {
        LOG_SETSTATUS(_@(MIS_SQ408), TOPIC_SQ408, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ408, LOG_SQ408_FAILED);
    };
    B_REMOVENPC(0xe4fb);
    if (((SQ408_CANUSECANON) == (2)) || ((SQ408_CANUSECANON) == (3))) {
        FF_APPLYONCEEXTGT(0xfae7, 0, -(1));
        FF_APPLYONCEEXTGT(0xf40a, 0, -(1));
    };
    if (((SQ408_CANUSECANON) == (1)) || ((SQ408_CANUSECANON) == (0))) {
        FF_APPLYONCEEXTGT(0xfae7, 0, -(1));
    };
    if ((LOG_GETSTATUS(MIS_SQ303)) == (LOG_RUNNING)) {
        LOG_SETSTATUS(_@(MIS_SQ303), TOPIC_SQ303, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ303, LOG_SQ303_FAILEDCH5);
    };
    if ((LOG_GETSTATUS(MIS_SQ304)) == (LOG_RUNNING)) {
        LOG_SETSTATUS(_@(MIS_SQ304), TOPIC_SQ304, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ304, LOG_SQ408_FAILED);
    };
    if ((LOG_GETSTATUS(MIS_SQ310)) == (LOG_RUNNING)) {
        LOG_SETSTATUS(_@(MIS_SQ310), TOPIC_SQ310, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ310, LOG_SQ310_FAILED);
    };
    if ((LOG_GETSTATUS(MIS_SQ315)) == (LOG_RUNNING)) {
        LOG_SETSTATUS(_@(MIS_SQ315), TOPIC_SQ315, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ315, LOG_SQ315_OSCARWILLBEDEAD);
    };
    if (((LOG_GETSTATUS(MIS_SQ406)) == (LOG_RUNNING)) && ((SQ406_USEDPOTIONS) < (3))) {
        LOG_SETSTATUS(_@(MIS_SQ406), TOPIC_SQ406, LOG_FAILED);
        B_LOGENTRY(TOPIC_SQ406, LOG_SQ408_FAILED);
    };
}

func void SQ503_PREPARENPC() {
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "SQ503_CITY_SMALLTALK");
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    B_STARTOTHERROUTINE(SLD_1017_GAROS, "SQ503_CITY_SMALLTALK");
    NPC_REFRESH(SLD_1017_GAROS);
    SQ503_GAROS_RTNCHECK = 1;
    TELEPORTNPCTOWP(0xcb49, SLD_1017_GAROS.WP);
    WLD_INSERTNPC(0xeafe, "PART1_SQ503_MILITIA_03");
    WLD_INSERTNPC(0xeb02, "PART1_SQ503_MILITIA_02");
    WLD_INSERTNPC(0xeb06, "PART1_SQ503_MILITIA_01");
    WLD_INSERTNPC(0xeb47, "PART1_SQ503_ARAXOS_01");
    WLD_INSERTNPC(0xeb4b, "PART1_SQ503_ARAXOS_02");
    WLD_INSERTNPC(0xeb4f, "PART1_SQ503_ARAXOS_03");
    if ((Q307_POISONWAY) != (1)) {
        if (NPC_KNOWSINFO(HERO, 0x147c7)) {
            VLK_6126_LENA.NAME[0] = NPCNAME_LENA;
            VLK_6126_LENA.AIVAR[79] = 1;
        } else {
            VLK_6126_LENA.NAME[0] = NAME_SCAREDGIRL;
            VLK_6126_LENA.AIVAR[79] = 2;
        } else {
            B_STARTOTHERROUTINE(VLK_6126_LENA, "SQ507");
        } else {
            NPC_REFRESH(VLK_6126_LENA);
        } else {
            TELEPORTNPCTOWP(0xe5d3, "P17_HAVEN_BAR_OUT_11");
        } else if ((LOG_GETSTATUS(MIS_SQ316)) == (LOG_SUCCESS)) {
            SQ507_STARTINGPOINT = 1;
        } else if ((LOG_GETSTATUS(MIS_SQ316)) == (LOG_RUNNING)) {
            SQ507_STARTINGPOINT = 2;
        } else {
            SQ507_STARTINGPOINT = 3;
        };
    };
}

func void SQ503_STARTQUEST() {
    LOG_CREATETOPIC(TOPIC_SQ503, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ503), TOPIC_SQ503, LOG_RUNNING);
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_LOGENTRY(TOPIC_SQ503, LOG_SQ503_START_V1);
    };
    if ((HERO.GUILD) == (GIL_SLD)) {
        AI_LOGENTRY(TOPIC_SQ503, LOG_SQ503_START_V2);
    };
    SQ503_PREPARENPC();
}

func void SQ503_PREPAREHAVEN() {
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_MAINGATE");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_LOCKER_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    MOB_CHANGEFOCUSNAME("Q306_ARENAFIGHT", "MOBNAME_NOTHING");
    B_STARTOTHERROUTINE(PIR_1303_CORTEZ, "SQ503_TRAINING");
    NPC_REFRESH(PIR_1303_CORTEZ);
    SQ503_CORTEZ_RTNCHECK = 1;
    TELEPORTNPCTOWP(0xe514, PIR_1303_CORTEZ.WP);
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "SQ503_WAIT");
    NPC_REFRESH(PIR_1306_RODRIGO);
    TELEPORTNPCTOWP(0xe535, PIR_1306_RODRIGO.WP);
}

func void SQ503_TELEPORTVIEWRES() {
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "TOURNAMENT");
    NPC_REFRESH(PIR_1306_RODRIGO);
    TELEPORTNPCTOWP(0xe535, PIR_1306_RODRIGO.WP);
    PIR_1306_RODRIGO.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(PIR_1308_SIMON, "TOURNAMENT");
    NPC_REFRESH(PIR_1308_SIMON);
    TELEPORTNPCTOWP(0xe54f, PIR_1308_SIMON.WP);
    PIR_1308_SIMON.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(NOV_200_HIERRO, "TOURNAMENT");
    NPC_REFRESH(NOV_200_HIERRO);
    TELEPORTNPCTOWP(0xe4ef, NOV_200_HIERRO.WP);
    NOV_200_HIERRO.AIVAR[15] = TRUE;
    if ((NPC_ISDEAD(PIR_1300_LEONARDO)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1300_LEONARDO, "TOURNAMENT");
        NPC_REFRESH(PIR_1300_LEONARDO);
        TELEPORTNPCTOWP(0xe502, PIR_1300_LEONARDO.WP);
        PIR_1300_LEONARDO.AIVAR[15] = TRUE;
    };
    if ((NPC_ISDEAD(PIR_1304_IVAN)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1304_IVAN, "TOURNAMENT");
        NPC_REFRESH(PIR_1304_IVAN);
        TELEPORTNPCTOWP(0xe521, PIR_1304_IVAN.WP);
        PIR_1304_IVAN.AIVAR[15] = TRUE;
    };
    if ((Q307_POISONWAY) != (1)) {
        B_STARTOTHERROUTINE(PIR_1309_OSCAR, "TOURNAMENT");
        NPC_REFRESH(PIR_1309_OSCAR);
        TELEPORTNPCTOWP(0xe566, PIR_1309_OSCAR.WP);
        PIR_1309_OSCAR.AIVAR[15] = TRUE;
        B_STARTOTHERROUTINE(PIR_1310_VICENTE, "TOURNAMENT");
        NPC_REFRESH(PIR_1310_VICENTE);
        TELEPORTNPCTOWP(0xe56e, PIR_1310_VICENTE.WP);
        PIR_1310_VICENTE.AIVAR[15] = TRUE;
    };
    if (((Q305_JAVAD_WENTTONEWHOME) == (1)) && ((Q509_JAVADVOLFZACKE) != (1))) {
        B_STARTOTHERROUTINE(NONE_6331_JAVAD, "TOURNAMENT");
        NPC_REFRESH(NONE_6331_JAVAD);
        TELEPORTNPCTOWP(0xe4c6, NONE_6331_JAVAD.WP);
        NONE_6331_JAVAD.AIVAR[15] = TRUE;
    };
    if ((NPC_ISDEAD(PIR_1311_THIAGO)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1311_THIAGO, "TOURNAMENT");
        NPC_REFRESH(PIR_1311_THIAGO);
        TELEPORTNPCTOWP(0xe577, PIR_1311_THIAGO.WP);
        PIR_1311_THIAGO.AIVAR[15] = TRUE;
    };
    if ((NPC_ISDEAD(PIR_1313_GETTER)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1313_GETTER, "TOURNAMENT");
        NPC_REFRESH(PIR_1313_GETTER);
        TELEPORTNPCTOWP(0xe590, PIR_1313_GETTER.WP);
        PIR_1313_GETTER.AIVAR[15] = TRUE;
    };
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        if ((NPC_ISDEAD(PIR_1324_MORITZ)) == (FALSE)) {
            B_STARTOTHERROUTINE(PIR_1324_MORITZ, "TOURNAMENT");
            NPC_REFRESH(PIR_1324_MORITZ);
            TELEPORTNPCTOWP(0xe59e, PIR_1324_MORITZ.WP);
            PIR_1324_MORITZ.AIVAR[15] = TRUE;
        };
    };
    if ((NPC_KNOWSINFO(HERO, 0x14b37)) == (FALSE)) {
        if ((NPC_ISDEAD(PIR_1325_FOX)) == (FALSE)) {
            B_STARTOTHERROUTINE(PIR_1325_FOX, "TOURNAMENT");
            NPC_REFRESH(PIR_1325_FOX);
            TELEPORTNPCTOWP(0xe5a9, PIR_1325_FOX.WP);
            PIR_1325_FOX.AIVAR[15] = TRUE;
        };
    };
    if ((SQ406_DAN_POTION) != (3)) {
        B_STARTOTHERROUTINE(PIR_1326_DAN, "TOURNAMENT");
        NPC_REFRESH(PIR_1326_DAN);
        TELEPORTNPCTOWP(0xe5b0, PIR_1326_DAN.WP);
        PIR_1326_DAN.AIVAR[15] = TRUE;
    };
    if ((NPC_ISDEAD(PIR_1327_LAUTENIST)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1327_LAUTENIST, "TOURNAMENT");
        NPC_REFRESH(PIR_1327_LAUTENIST);
        TELEPORTNPCTOWP(0xe5bb, PIR_1327_LAUTENIST.WP);
        PIR_1327_LAUTENIST.AIVAR[15] = TRUE;
    };
    if ((Q305_BERTELWAY) == (1)) {
        B_STARTOTHERROUTINE(NONE_6332_BERTEL, "TOURNAMENT");
        NPC_REFRESH(NONE_6332_BERTEL);
        TELEPORTNPCTOWP(0xe4d4, NONE_6332_BERTEL.WP);
        NONE_6332_BERTEL.AIVAR[15] = TRUE;
    };
}

func void SQ503_STOPWATCHFIGHT() {
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1306_RODRIGO);
    TELEPORTNPCTOWP(0xe535, PIR_1306_RODRIGO.WP);
    B_STARTOTHERROUTINE(PIR_1308_SIMON, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1308_SIMON);
    TELEPORTNPCTOWP(0xe54f, PIR_1308_SIMON.WP);
    B_STARTOTHERROUTINE(NOV_200_HIERRO, "TOURNAMENTSTOP");
    NPC_REFRESH(NOV_200_HIERRO);
    TELEPORTNPCTOWP(0xe4ef, NOV_200_HIERRO.WP);
    if ((NPC_ISDEAD(PIR_1300_LEONARDO)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1300_LEONARDO, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1300_LEONARDO);
        TELEPORTNPCTOWP(0xe502, PIR_1300_LEONARDO.WP);
    };
    if ((NPC_ISDEAD(PIR_1304_IVAN)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1304_IVAN, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1304_IVAN);
        TELEPORTNPCTOWP(0xe521, PIR_1304_IVAN.WP);
    };
    if (((Q305_JAVAD_WENTTONEWHOME) == (1)) && ((Q509_JAVADVOLFZACKE) != (1))) {
        B_STARTOTHERROUTINE(NONE_6331_JAVAD, "TOURNAMENTSTOP");
        NPC_REFRESH(NONE_6331_JAVAD);
        TELEPORTNPCTOWP(0xe4c6, NONE_6331_JAVAD.WP);
    };
    if ((NPC_ISDEAD(PIR_1311_THIAGO)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1311_THIAGO, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1311_THIAGO);
        TELEPORTNPCTOWP(0xe577, PIR_1311_THIAGO.WP);
    };
    if ((NPC_ISDEAD(PIR_1313_GETTER)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1313_GETTER, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1313_GETTER);
        TELEPORTNPCTOWP(0xe590, PIR_1313_GETTER.WP);
    };
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        if ((NPC_ISDEAD(PIR_1324_MORITZ)) == (FALSE)) {
            B_STARTOTHERROUTINE(PIR_1324_MORITZ, "TOURNAMENTSTOP");
            NPC_REFRESH(PIR_1324_MORITZ);
            TELEPORTNPCTOWP(0xe59e, PIR_1324_MORITZ.WP);
        };
    };
    if ((NPC_KNOWSINFO(HERO, 0x14b37)) == (FALSE)) {
        if ((NPC_ISDEAD(PIR_1325_FOX)) == (FALSE)) {
            B_STARTOTHERROUTINE(PIR_1325_FOX, "TOURNAMENTSTOP");
            NPC_REFRESH(PIR_1325_FOX);
            TELEPORTNPCTOWP(0xe5a9, PIR_1325_FOX.WP);
        };
    };
    if ((SQ406_DAN_POTION) != (3)) {
        B_STARTOTHERROUTINE(PIR_1326_DAN, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1326_DAN);
        TELEPORTNPCTOWP(0xe5b0, PIR_1326_DAN.WP);
    };
    if ((NPC_ISDEAD(PIR_1327_LAUTENIST)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1327_LAUTENIST, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1327_LAUTENIST);
        TELEPORTNPCTOWP(0xe5bb, PIR_1327_LAUTENIST.WP);
    };
    if ((Q305_BERTELWAY) == (1)) {
        B_STARTOTHERROUTINE(NONE_6332_BERTEL, "TOURNAMENTSTOP");
        NPC_REFRESH(NONE_6332_BERTEL);
        TELEPORTNPCTOWP(0xe4d4, NONE_6332_BERTEL.WP);
    };
    if ((Q307_POISONWAY) != (1)) {
        B_STARTOTHERROUTINE(PIR_1309_OSCAR, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1309_OSCAR);
        TELEPORTNPCTOWP(0xe566, PIR_1309_OSCAR.WP);
        B_STARTOTHERROUTINE(PIR_1310_VICENTE, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1310_VICENTE);
        TELEPORTNPCTOWP(0xe56e, PIR_1310_VICENTE.WP);
    };
}

func void SQ503_HAVENSCARED() {
    AI_WAIT(PIR_1306_RODRIGO, 0x3f800000);
    AI_PLAYANI(PIR_1306_RODRIGO, T_SEARCH);
    AI_WAIT(NOV_200_HIERRO, 0x3ecccccd);
    AI_PLAYANI(NOV_200_HIERRO, T_SEARCH);
    if ((NPC_ISDEAD(PIR_1300_LEONARDO)) == (FALSE)) {
        AI_WAIT(PIR_1300_LEONARDO, 0x3fb33333);
        AI_PLAYANI(PIR_1300_LEONARDO, T_SEARCH);
    };
    if ((NPC_ISDEAD(PIR_1304_IVAN)) == (FALSE)) {
        AI_WAIT(PIR_1304_IVAN, 0x3f4ccccd);
        AI_PLAYANI(PIR_1304_IVAN, T_SEARCH);
    };
    if ((Q307_POISONWAY) != (1)) {
        AI_WAIT(PIR_1309_OSCAR, 0x3f000000);
        AI_PLAYANI(PIR_1309_OSCAR, T_SEARCH);
        AI_WAIT(PIR_1310_VICENTE, 0x3e99999a);
        AI_PLAYANI(PIR_1310_VICENTE, T_SEARCH);
    };
    if (((Q305_JAVAD_WENTTONEWHOME) == (1)) && ((Q509_JAVADVOLFZACKE) != (1))) {
        AI_WAIT(NONE_6331_JAVAD, 0x3e4ccccd);
        AI_PLAYANI(NONE_6331_JAVAD, T_SEARCH);
    };
    if ((NPC_ISDEAD(PIR_1311_THIAGO)) == (FALSE)) {
        AI_PLAYANI(PIR_1311_THIAGO, T_SEARCH);
    };
    if ((NPC_ISDEAD(PIR_1313_GETTER)) == (FALSE)) {
        AI_WAIT(PIR_1313_GETTER, 0x3fcccccd);
        AI_PLAYANI(PIR_1313_GETTER, T_SEARCH);
    };
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        if ((NPC_ISDEAD(PIR_1324_MORITZ)) == (FALSE)) {
            AI_WAIT(PIR_1324_MORITZ, 0x3f19999a);
            AI_PLAYANI(PIR_1324_MORITZ, T_SEARCH);
        };
    };
    if ((NPC_KNOWSINFO(HERO, 0x14b37)) == (FALSE)) {
        if ((NPC_ISDEAD(PIR_1325_FOX)) == (FALSE)) {
            AI_WAIT(PIR_1325_FOX, 0x3e99999a);
            AI_PLAYANI(PIR_1325_FOX, T_SEARCH);
        };
    };
    if ((SQ406_DAN_POTION) != (3)) {
        AI_WAIT(PIR_1326_DAN, 0x3f666666);
        AI_PLAYANI(PIR_1326_DAN, T_SEARCH);
    };
    if ((NPC_ISDEAD(PIR_1327_LAUTENIST)) == (FALSE)) {
        AI_WAIT(PIR_1327_LAUTENIST, 0x3dcccccd);
        AI_PLAYANI(PIR_1327_LAUTENIST, T_SEARCH);
    };
    if ((Q305_BERTELWAY) == (1)) {
        AI_WAIT(NONE_6332_BERTEL, 0x3ecccccd);
        AI_PLAYANI(NONE_6332_BERTEL, T_SEARCH);
    };
}

func void SQ503_SIMONDIALOGUE_PREPARE() {
    FF_APPLYONCEEXT(0xf990, 75, 4);
    HERO.AIVAR[4] = FALSE;
}

func void SQ503_SIMONDIALOGUE_APPLY() {
    SQ503_SIMONDIALOGUE_COUNT = (SQ503_SIMONDIALOGUE_COUNT) + (1);
    if ((SQ503_SIMONDIALOGUE_COUNT) == (4)) {
        AI_STARTSTATE(PIR_1308_SIMON, 0xf09f, 1, "");
        AI_STARTSTATE(HERO, 0xf09f, 1, "");
    };
}

var int SQ503_SIMONDIALOGUE_APPLY.SQ503_SIMONDIALOGUE_COUNT = 0;
func void SQ503_SIMON_CHANGECAMERA_01() {
    WLD_SENDTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_01");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_SQ503_HERO");
    TELEPORTNPCTOWP(0xe514, "P17_HAVEN_ARENA_SQ503_CORTEZ");
}

func void SQ503_SIMON_CHANGECAMERA_02() {
    WLD_SENDTRIGGER("SQ503_SIMON_03");
    WLD_SENDUNTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_15");
}

func void SQ503_SIMON_CHANGECAMERA_03() {
    WLD_SENDTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_03");
}

func void SQ503_SIMON_CHANGECAMERA_04() {
    WLD_SENDTRIGGER("SQ503_SIMON_05");
    WLD_SENDUNTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_15");
}

func void SQ503_SIMON_CHANGECAMERA_05() {
    WLD_SENDTRIGGER("SQ503_SIMON_06");
    WLD_SENDUNTRIGGER("SQ503_SIMON_05");
}

func void SQ503_SIMON_CHANGECAMERA_06() {
    WLD_SENDTRIGGER("SQ503_SIMON_07");
    WLD_SENDUNTRIGGER("SQ503_SIMON_06");
}

func void SQ503_SIMON_CHANGECAMERA_07() {
    WLD_SENDTRIGGER("SQ503_SIMON_08");
    WLD_SENDUNTRIGGER("SQ503_SIMON_07");
}

func void SQ503_SIMON_CHANGECAMERA_08() {
    WLD_SENDTRIGGER("SQ503_SIMON_09");
    WLD_SENDUNTRIGGER("SQ503_SIMON_08");
}

func void SQ503_SIMON_CHANGECAMERA_09() {
    WLD_SENDTRIGGER("SQ503_SIMON_10");
    WLD_SENDUNTRIGGER("SQ503_SIMON_09");
}

func void SQ503_SIMON_CHANGECAMERA_10() {
    WLD_SENDTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_10");
}

func void SQ503_SIMON_CHANGECAMERA_11() {
    WLD_SENDTRIGGER("SQ503_SIMON_12");
    WLD_SENDUNTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_15");
}

func void SQ503_SIMON_CHANGECAMERA_12() {
    WLD_SENDTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_12");
}

func void SQ503_SIMON_CHANGECAMERA_13() {
    WLD_SENDTRIGGER("SQ503_SIMON_14");
    WLD_SENDUNTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_15");
}

func void SQ503_SIMON_CHANGECAMERA_14() {
    WLD_SENDTRIGGER("SQ503_SIMON_15");
    WLD_SENDUNTRIGGER("SQ503_SIMON_14");
}

func void SQ503_SIMON_CHANGECAMERA_15() {
    WLD_SENDTRIGGER("SQ503_SIMON_16");
    WLD_SENDUNTRIGGER("SQ503_SIMON_02");
    WLD_SENDUNTRIGGER("SQ503_SIMON_04");
    WLD_SENDUNTRIGGER("SQ503_SIMON_11");
    WLD_SENDUNTRIGGER("SQ503_SIMON_13");
    WLD_SENDUNTRIGGER("SQ503_SIMON_15");
}

func void SQ503_SIMON_CHANGECAMERA_16() {
    WLD_SENDTRIGGER("SQ503_SIMON_17");
    WLD_SENDUNTRIGGER("SQ503_SIMON_16");
}

func void SQ503_SIMON_CHANGECAMERA_17() {
    WLD_SENDTRIGGER("SQ503_SIMON_18");
    WLD_SENDUNTRIGGER("SQ503_SIMON_17");
}

func void SQ503_SIMON_FINISHCAMERA() {
    FF_APPLYONCEEXT(0xf9a5, 75, 4);
}

func void SQ503_PREPAREMILITIAAXAROS() {
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, "SQ503_HAVEN");
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    MIL_924_WINSTAN.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(SLD_1017_GAROS, "SQ503_HAVEN");
    NPC_REFRESH(SLD_1017_GAROS);
    SQ503_GAROS_RTNCHECK = 2;
    TELEPORTNPCTOWP(0xcb49, SLD_1017_GAROS.WP);
    SLD_1017_GAROS.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(MIL_13523_MILITIA, "SQ503_HAVEN");
    NPC_REFRESH(MIL_13523_MILITIA);
    TELEPORTNPCTOWP(0xeafe, MIL_13523_MILITIA.WP);
    MIL_13523_MILITIA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(MIL_13524_MILITIA, "SQ503_HAVEN");
    NPC_REFRESH(MIL_13524_MILITIA);
    TELEPORTNPCTOWP(0xeb02, MIL_13524_MILITIA.WP);
    MIL_13524_MILITIA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(MIL_13525_MILITIA, "SQ503_HAVEN");
    NPC_REFRESH(MIL_13525_MILITIA);
    TELEPORTNPCTOWP(0xeb06, MIL_13525_MILITIA.WP);
    MIL_13525_MILITIA.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(SLD_13526_ARAXOS, "SQ503_HAVEN");
    NPC_REFRESH(SLD_13526_ARAXOS);
    TELEPORTNPCTOWP(0xeb47, SLD_13526_ARAXOS.WP);
    SLD_13526_ARAXOS.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(SLD_13527_ARAXOS, "SQ503_HAVEN");
    NPC_REFRESH(SLD_13527_ARAXOS);
    TELEPORTNPCTOWP(0xeb4b, SLD_13527_ARAXOS.WP);
    SLD_13527_ARAXOS.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(SLD_13528_ARAXOS, "SQ503_HAVEN");
    NPC_REFRESH(SLD_13528_ARAXOS);
    TELEPORTNPCTOWP(0xeb4f, SLD_13528_ARAXOS.WP);
    SLD_13528_ARAXOS.AIVAR[15] = TRUE;
}

func void SQ503_SIMON_FINISHCAMERA_APPLY() {
    SQ503_SIMON_FINISHCAMERA_COUNT = (SQ503_SIMON_FINISHCAMERA_COUNT) + (1);
    if ((SQ503_SIMON_FINISHCAMERA_COUNT) == (4)) {
        if ((SQ503_HAVENDECISION) == (1)) {
            WLD_SENDUNTRIGGER("SQ503_SIMON_01");
            WLD_SENDUNTRIGGER("SQ503_SIMON_02");
            WLD_SENDUNTRIGGER("SQ503_SIMON_03");
            WLD_SENDUNTRIGGER("SQ503_SIMON_04");
            WLD_SENDUNTRIGGER("SQ503_SIMON_05");
            WLD_SENDUNTRIGGER("SQ503_SIMON_06");
            WLD_SENDUNTRIGGER("SQ503_SIMON_07");
            WLD_SENDUNTRIGGER("SQ503_SIMON_08");
            WLD_SENDUNTRIGGER("SQ503_SIMON_09");
            WLD_SENDUNTRIGGER("SQ503_SIMON_10");
            WLD_SENDUNTRIGGER("SQ503_SIMON_11");
            WLD_SENDUNTRIGGER("SQ503_SIMON_12");
            WLD_SENDUNTRIGGER("SQ503_SIMON_13");
            WLD_SENDUNTRIGGER("SQ503_SIMON_14");
            WLD_SENDUNTRIGGER("SQ503_SIMON_15");
            WLD_SENDUNTRIGGER("SQ503_SIMON_16");
            WLD_SENDUNTRIGGER("SQ503_SIMON_17");
            WLD_SENDUNTRIGGER("SQ503_SIMON_18");
            DIACAM_ENABLE();
            HERO.AIVAR[4] = FALSE;
            WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
            SQ503_PREPAREMILITIAAXAROS();
        } else {
            CUTSCENE_START(0x16b53);
        };
    };
}

var int SQ503_SIMON_FINISHCAMERA_APPLY.SQ503_SIMON_FINISHCAMERA_COUNT = 0;
func void SQ503_FIGHTINHAVEN() {
    if ((HERO.ATTRIBUTE[0]) != (HERO.ATTRIBUTE[1])) {
        HERO.ATTRIBUTE[0] = HERO.ATTRIBUTE[1];
    };
    PRINTD("Walka");
    SQ503_FIGHTINARENA = 1;
    PIR_1306_RODRIGO.FLAGS = 0;
    PIR_1308_SIMON.FLAGS = 0;
    PIR_1311_THIAGO.FLAGS = 0;
    PIR_1313_GETTER.FLAGS = 0;
    PIR_1304_IVAN.FLAGS = 0;
    PIR_1306_RODRIGO.AIVAR[52] = TRUE;
    PIR_1308_SIMON.AIVAR[52] = TRUE;
    PIR_1311_THIAGO.AIVAR[52] = TRUE;
    PIR_1313_GETTER.AIVAR[52] = TRUE;
    PIR_1304_IVAN.AIVAR[52] = TRUE;
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "SQ503_FINALFIGHT");
    NPC_REFRESH(PIR_1306_RODRIGO);
    PIR_1306_RODRIGO.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(PIR_1308_SIMON, "SQ503_FINALFIGHT");
    NPC_REFRESH(PIR_1308_SIMON);
    PIR_1308_SIMON.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(PIR_1311_THIAGO, "SQ503_FINALFIGHT");
    NPC_REFRESH(PIR_1311_THIAGO);
    PIR_1311_THIAGO.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(PIR_1313_GETTER, "SQ503_FINALFIGHT");
    NPC_REFRESH(PIR_1313_GETTER);
    PIR_1313_GETTER.AIVAR[15] = FALSE;
    B_STARTOTHERROUTINE(PIR_1304_IVAN, "SQ503_FINALFIGHT");
    NPC_REFRESH(PIR_1304_IVAN);
    PIR_1304_IVAN.AIVAR[15] = FALSE;
    B_IMMEDIATEATTACKPLAYER(PIR_1306_RODRIGO, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(PIR_1308_SIMON, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(PIR_1311_THIAGO, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(PIR_1313_GETTER, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(PIR_1304_IVAN, AR_KILL);
}

func void SQ503_FINALHAVENFIGHT_END_APPLY() {
    SQ503_FINALHAVENFIGHT_END_COUNT = (SQ503_FINALHAVENFIGHT_END_COUNT) + (1);
    if ((SQ503_FINALHAVENFIGHT_END_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("SQ503_SIMON_01");
        WLD_SENDUNTRIGGER("SQ503_SIMON_02");
        WLD_SENDUNTRIGGER("SQ503_SIMON_03");
        WLD_SENDUNTRIGGER("SQ503_SIMON_04");
        WLD_SENDUNTRIGGER("SQ503_SIMON_05");
        WLD_SENDUNTRIGGER("SQ503_SIMON_06");
        WLD_SENDUNTRIGGER("SQ503_SIMON_07");
        WLD_SENDUNTRIGGER("SQ503_SIMON_08");
        WLD_SENDUNTRIGGER("SQ503_SIMON_09");
        WLD_SENDUNTRIGGER("SQ503_SIMON_10");
        WLD_SENDUNTRIGGER("SQ503_SIMON_11");
        WLD_SENDUNTRIGGER("SQ503_SIMON_12");
        WLD_SENDUNTRIGGER("SQ503_SIMON_13");
        WLD_SENDUNTRIGGER("SQ503_SIMON_14");
        WLD_SENDUNTRIGGER("SQ503_SIMON_15");
        WLD_SENDUNTRIGGER("SQ503_SIMON_16");
        WLD_SENDUNTRIGGER("SQ503_SIMON_17");
        WLD_SENDUNTRIGGER("SQ503_SIMON_18");
        WLD_SENDUNTRIGGER("SQ503_FINALFIGHT_01");
        WLD_SENDUNTRIGGER("SQ503_FINALFIGHT_02");
        DIACAM_ENABLE();
        HERO.AIVAR[4] = FALSE;
        SQ503_FIGHTINHAVEN();
    };
}

var int SQ503_FINALHAVENFIGHT_END_APPLY.SQ503_FINALHAVENFIGHT_END_COUNT = 0;
func int SQ503_FIGHTINARENADONE() {
    if (((((NPC_ISDEAD(PIR_1306_RODRIGO)) && (NPC_ISDEAD(PIR_1308_SIMON))) && (NPC_ISDEAD(PIR_1311_THIAGO))) && (NPC_ISDEAD(PIR_1313_GETTER))) && (NPC_ISDEAD(PIR_1304_IVAN))) {
        return TRUE;
    };
    return FALSE;
}

func void SQ503_FINALHAVENFIGHT_BEYONDARENA() {
    CHANGEVOBCOLLISION("SQ503_VOB_FIGHT_01", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("SQ503_VOB_FIGHT_02", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("SQ503_VOB_FIGHT_03", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("SQ503_VOB_FIGHT_04", FALSE, FALSE, FALSE, FALSE);
    CHANGEVOBCOLLISION("SQ503_VOB_FIGHT_05", FALSE, FALSE, FALSE, FALSE);
    NPC_SETTRUEGUILD(NOV_200_HIERRO, GIL_BDT);
    NOV_200_HIERRO.GUILD = GIL_BDT;
    NOV_200_HIERRO.FLAGS = 0;
    B_STARTOTHERROUTINE(NOV_200_HIERRO, "SQ503_FINALFIGHT");
    NPC_REFRESH(NOV_200_HIERRO);
    TELEPORTNPCTOWP(0xe4ef, NOV_200_HIERRO.WP);
    NOV_200_HIERRO.AIVAR[15] = FALSE;
    if ((NPC_ISDEAD(PIR_1300_LEONARDO)) == (FALSE)) {
        B_REMOVENPC(0xe502);
    };
    if (((Q305_JAVAD_WENTTONEWHOME) == (1)) && ((Q509_JAVADVOLFZACKE) != (1))) {
        NPC_SETTRUEGUILD(NONE_6331_JAVAD, GIL_BDT);
        NONE_6331_JAVAD.GUILD = GIL_BDT;
        NONE_6331_JAVAD.FLAGS = 0;
        B_STARTOTHERROUTINE(NONE_6331_JAVAD, "SQ503_FINALFIGHT");
        NPC_REFRESH(NONE_6331_JAVAD);
        TELEPORTNPCTOWP(0xe4c6, NONE_6331_JAVAD.WP);
        NONE_6331_JAVAD.AIVAR[15] = FALSE;
    };
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        if ((NPC_ISDEAD(PIR_1324_MORITZ)) == (FALSE)) {
            SQ503_MORITZ_RTNCHECK = 1;
            PIR_1324_MORITZ.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1324_MORITZ, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1324_MORITZ);
            TELEPORTNPCTOWP(0xe59e, PIR_1324_MORITZ.WP);
            B_KILLNPC(0xe59e);
        };
    };
    if ((NPC_KNOWSINFO(HERO, 0x14b37)) == (FALSE)) {
        if ((NPC_ISDEAD(PIR_1325_FOX)) == (FALSE)) {
            PIR_1325_FOX.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1325_FOX, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1325_FOX);
            TELEPORTNPCTOWP(0xe5a9, PIR_1325_FOX.WP);
            B_KILLNPC(0xe5a9);
        };
    };
    if ((SQ406_DAN_POTION) != (3)) {
        NPC_SETTRUEGUILD(PIR_1326_DAN, GIL_BDT);
        PIR_1326_DAN.GUILD = GIL_BDT;
        PIR_1326_DAN.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_1326_DAN, "SQ503_FINALFIGHT");
        NPC_REFRESH(PIR_1326_DAN);
        TELEPORTNPCTOWP(0xe5b0, PIR_1326_DAN.WP);
        PIR_1326_DAN.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_1327_LAUTENIST)) == (FALSE)) {
        PIR_1327_LAUTENIST.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_1327_LAUTENIST, "SQ503_FINALFIGHT");
        NPC_REFRESH(PIR_1327_LAUTENIST);
        TELEPORTNPCTOWP(0xe5bb, PIR_1327_LAUTENIST.WP);
        B_KILLNPC(0xe5bb);
    };
    if ((Q305_BERTELWAY) == (1)) {
        NPC_SETTRUEGUILD(NONE_6332_BERTEL, GIL_BDT);
        NONE_6332_BERTEL.GUILD = GIL_BDT;
        NONE_6332_BERTEL.FLAGS = 0;
        B_STARTOTHERROUTINE(NONE_6332_BERTEL, "SQ503_FINALFIGHT");
        NPC_REFRESH(NONE_6332_BERTEL);
        TELEPORTNPCTOWP(0xe4d4, NONE_6332_BERTEL.WP);
        NONE_6332_BERTEL.AIVAR[15] = FALSE;
    };
    if (((LOG_GETSTATUS(MIS_SQ310)) == (LOG_SUCCESS)) && ((LOG_GETSTATUS(MIS_SQ408)) != (LOG_SUCCESS))) {
        PIR_11125_BERTER.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_11125_BERTER, "SQ503_FINALFIGHT");
        NPC_REFRESH(PIR_11125_BERTER);
        TELEPORTNPCTOWP(0xe4fb, PIR_11125_BERTER.WP);
        B_KILLNPC(0xe4fb);
    };
    if ((Q307_POISONWAY) != (1)) {
        NPC_SETTRUEGUILD(PIR_1309_OSCAR, GIL_BDT);
        PIR_1309_OSCAR.GUILD = GIL_BDT;
        PIR_1309_OSCAR.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_1309_OSCAR, "SQ503_FINALFIGHT");
        NPC_REFRESH(PIR_1309_OSCAR);
        TELEPORTNPCTOWP(0xe566, PIR_1309_OSCAR.WP);
        PIR_1309_OSCAR.AIVAR[15] = FALSE;
        NPC_SETTRUEGUILD(PIR_1310_VICENTE, GIL_BDT);
        PIR_1310_VICENTE.GUILD = GIL_BDT;
        PIR_1310_VICENTE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_1310_VICENTE, "SQ503_FINALFIGHT");
        NPC_REFRESH(PIR_1310_VICENTE);
        TELEPORTNPCTOWP(0xe56e, PIR_1310_VICENTE.WP);
        PIR_1310_VICENTE.AIVAR[15] = FALSE;
        B_REMOVENPC(0xe48d);
        if ((SQ406_GHOST_POTION) != (3)) {
            NPC_SETTRUEGUILD(PIR_6322_GHOST, GIL_BDT);
            PIR_6322_GHOST.GUILD = GIL_BDT;
            PIR_6322_GHOST.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_6322_GHOST, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_6322_GHOST);
            TELEPORTNPCTOWP(0xe481, PIR_6322_GHOST.WP);
            PIR_6322_GHOST.AIVAR[15] = FALSE;
        };
        if ((NPC_ISDEAD(PIR_1330_ALVAREZ)) == (FALSE)) {
            NPC_SETTRUEGUILD(PIR_1330_ALVAREZ, GIL_BDT);
            PIR_1330_ALVAREZ.GUILD = GIL_BDT;
            PIR_1330_ALVAREZ.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1330_ALVAREZ, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1330_ALVAREZ);
            TELEPORTNPCTOWP(0xe5cc, PIR_1330_ALVAREZ.WP);
            PIR_1330_ALVAREZ.AIVAR[15] = FALSE;
        };
        if ((LOG_GETSTATUS(MIS_SQ408)) != (LOG_SUCCESS)) {
            PIR_1329_SAUL.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1329_SAUL, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1329_SAUL);
            TELEPORTNPCTOWP(0xe5c2, PIR_1329_SAUL.WP);
            B_KILLNPC(0xe5c2);
        };
        if ((NPC_ISDEAD(PIR_1312_LARRY)) == (FALSE)) {
            PIR_1312_LARRY.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1312_LARRY, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1312_LARRY);
            TELEPORTNPCTOWP(0xe586, PIR_1312_LARRY.WP);
            B_KILLNPC(0xe586);
        };
        if ((NPC_ISDEAD(PIR_1307_PROXIMO)) == (FALSE)) {
            PIR_1307_PROXIMO.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1307_PROXIMO, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1307_PROXIMO);
            TELEPORTNPCTOWP(0xe548, PIR_1307_PROXIMO.WP);
            B_KILLNPC(0xe548);
        };
        if ((NPC_ISDEAD(PIR_1305_OTIS)) == (FALSE)) {
            PIR_1305_OTIS.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1305_OTIS, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1305_OTIS);
            TELEPORTNPCTOWP(0xe528, PIR_1305_OTIS.WP);
            B_KILLNPC(0xe528);
        };
        if ((NPC_ISDEAD(PIR_1302_MORTY)) == (FALSE)) {
            NPC_SETTRUEGUILD(PIR_1302_MORTY, GIL_BDT);
            PIR_1302_MORTY.GUILD = GIL_BDT;
            PIR_1302_MORTY.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1302_MORTY, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1302_MORTY);
            TELEPORTNPCTOWP(0xe50e, PIR_1302_MORTY.WP);
            PIR_1302_MORTY.AIVAR[15] = FALSE;
        };
        if ((NPC_ISDEAD(PIR_1301_GREGOR)) == (FALSE)) {
            NPC_SETTRUEGUILD(PIR_1301_GREGOR, GIL_BDT);
            PIR_1301_GREGOR.GUILD = GIL_BDT;
            PIR_1301_GREGOR.FLAGS = 0;
            B_STARTOTHERROUTINE(PIR_1301_GREGOR, "SQ503_FINALFIGHT");
            NPC_REFRESH(PIR_1301_GREGOR);
            TELEPORTNPCTOWP(0xe509, PIR_1301_GREGOR.WP);
            PIR_1301_GREGOR.AIVAR[15] = FALSE;
        };
    };
    B_REMOVENPC(0xe498);
    B_REMOVENPC(0xe4a0);
    if ((Q305_HERDIS_FINISHWAY) == (1)) {
        B_REMOVENPC(0xe214);
        B_REMOVENPC(0xe220);
    };
    if ((Q305_HARRISTATUS) == (4)) {
        B_REMOVENPC(0xe4e0);
    };
    if ((NPC_ISDEAD(PIR_13557_PIRATETRADER)) == (FALSE)) {
        B_REMOVENPC(0xe612);
    };
    if ((NPC_ISDEAD(PIR_13550_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13550_PIRATE, GIL_BDT);
        PIR_13550_PIRATE.GUILD = GIL_BDT;
        PIR_13550_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13550_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13550_PIRATE);
        TELEPORTNPCTOWP(0xe5fb, PIR_13550_PIRATE.WP);
        PIR_13550_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_1314_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_1314_PIRATE, GIL_BDT);
        PIR_1314_PIRATE.GUILD = GIL_BDT;
        PIR_1314_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_1314_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_1314_PIRATE);
        TELEPORTNPCTOWP(0xe5f6, PIR_1314_PIRATE.WP);
        PIR_1314_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13551_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13551_PIRATE, GIL_BDT);
        PIR_13551_PIRATE.GUILD = GIL_BDT;
        PIR_13551_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13551_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13551_PIRATE);
        TELEPORTNPCTOWP(0xe5ff, PIR_13551_PIRATE.WP);
        PIR_13551_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13552_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13552_PIRATE, GIL_BDT);
        PIR_13552_PIRATE.GUILD = GIL_BDT;
        PIR_13552_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13552_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13552_PIRATE);
        TELEPORTNPCTOWP(0xe603, PIR_13552_PIRATE.WP);
        PIR_13552_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13553_DINKEL)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13553_DINKEL, GIL_BDT);
        PIR_13553_DINKEL.GUILD = GIL_BDT;
        PIR_13553_DINKEL.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13553_DINKEL, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13553_DINKEL);
        TELEPORTNPCTOWP(0xe5ea, PIR_13553_DINKEL.WP);
        PIR_13553_DINKEL.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13554_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13554_PIRATE, GIL_BDT);
        PIR_13554_PIRATE.GUILD = GIL_BDT;
        PIR_13554_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13554_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13554_PIRATE);
        TELEPORTNPCTOWP(0xe607, PIR_13554_PIRATE.WP);
        PIR_13554_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13555_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13555_PIRATE, GIL_BDT);
        PIR_13555_PIRATE.GUILD = GIL_BDT;
        PIR_13555_PIRATE.FLAGS = 0;
        B_STARTOTHERROUTINE(PIR_13555_PIRATE, "SQ503_RUNAWAY");
        NPC_REFRESH(PIR_13555_PIRATE);
        TELEPORTNPCTOWP(0xe60b, PIR_13555_PIRATE.WP);
        PIR_13555_PIRATE.AIVAR[15] = FALSE;
    };
    if ((NPC_ISDEAD(PIR_13556_PIRATE)) == (FALSE)) {
        NPC_SETTRUEGUILD(PIR_13556_PIRATE, GIL_BDT);
        PIR_13556_PIRATE.GUILD = GIL_BDT;
        PIR_13556_PIRATE.FLAGS = 0;
        TELEPORTNPCTOWP(0xe60b, PIR_13555_PIRATE.WP);
        PIR_13556_PIRATE.AIVAR[15] = FALSE;
    };
}

func void SQ503_FINISHQUEST() {
    AI_LOGENTRY(TOPIC_SQ503, LOG_SQ503_FINISH);
    LOG_SETSTATUS(_@(MIS_SQ503), TOPIC_SQ503, LOG_SUCCESS);
    RESTOREROUTINE_GAROS();
    RESTOREROUTINE_WINSTAN();
    B_GIVEPLAYERXP(XP_SQ503_FINISH);
    MAXWEAPONSKILL = MAXOF4(HERO.HITCHANCE[1], HERO.HITCHANCE[2], HERO.HITCHANCE[3], HERO.HITCHANCE[4]);
    if ((MARVIN_MILITIASPECIALIZATION) == (MILITIA_SPECIALIZATION_MASTERCROSSBOWMAN)) {
        CREATEINVITEMS(MIL_4000_RODERICH, 0x9b3c, 1);
    };
    if ((MARVIN_ARAXOSSPECIALIZATION) == (ARAXOS_SPECIALIZATION_MASTERARCHER)) {
        CREATEINVITEMS(SLD_5000_LORENZO, 0x9b3f, 1);
    };
    if ((MAXWEAPONSKILL) == (HERO.HITCHANCE[2])) {
        if ((HERO.ATTRIBUTE[4]) >= (HERO.ATTRIBUTE[5])) {
            if ((HERO.GUILD) == (GIL_MIL)) {
                CREATEINVITEMS(MIL_4000_RODERICH, 0x9a9c, 1);
            } else {
                CREATEINVITEMS(SLD_5000_LORENZO, 0x9a9c, 1);
                B_GIVEINVITEMS(SLD_5000_LORENZO, HERO, 0x9a9c, 1);
            } else {
                /* set_instance(0) */;
            };
        };
        if ((HERO.GUILD) == (GIL_MIL)) {
            CREATEINVITEMS(MIL_4000_RODERICH, 0x9ac9, 1);
        } else {
            CREATEINVITEMS(SLD_5000_LORENZO, 0x9ac9, 1);
            B_GIVEINVITEMS(SLD_5000_LORENZO, HERO, 0x9ac9, 1);
        } else {
            /* set_instance(0) */;
        };
    };
    if ((HERO.GUILD) == (GIL_MIL)) {
        CREATEINVITEMS(MIL_4000_RODERICH, 0x9a86, 1);
    };
    CREATEINVITEMS(SLD_5000_LORENZO, 0x9a86, 1);
    B_GIVEINVITEMS(SLD_5000_LORENZO, HERO, 0x9a86, 1);
    B_STARTOTHERROUTINE(MIL_924_WINSTAN, START);
    NPC_REFRESH(MIL_924_WINSTAN);
    TELEPORTNPCTOWP(0xccd7, MIL_924_WINSTAN.WP);
    MIL_924_WINSTAN.AIVAR[15] = FALSE;
    TELEPORTNPCTOWP(0xcb49, SLD_1017_GAROS.WP);
    SLD_1017_GAROS.AIVAR[15] = FALSE;
    B_REMOVENPC(0xeafe);
    B_REMOVENPC(0xeb02);
    B_REMOVENPC(0xeb06);
    B_REMOVENPC(0xeb47);
    B_REMOVENPC(0xeb4b);
    B_REMOVENPC(0xeb4f);
    if (((LOG_GETSTATUS(MIS_SQ507)) != (LOG_RUNNING)) && ((LOG_GETSTATUS(MIS_SQ507)) != (LOG_SUCCESS))) {
        B_REMOVENPC(0xe5d3);
        if ((LOG_GETSTATUS(MIS_SQ316)) == (LOG_RUNNING)) {
            SQ316_HOLLYSHITDUDE = TRUE;
            B_STARTOTHERROUTINE(VLK_13570_NADINE, "HOLLYSHIT");
        };
    };
    if ((SQ503_HAVENDECISION) == (1)) {
        B_REMOVENPC(0xe5fb);
        B_REMOVENPC(0xe60f);
        B_REMOVENPC(0xe5f6);
        B_REMOVENPC(0xe612);
        B_REMOVENPC(0xe4ef);
        B_REMOVENPC(0xe535);
        B_REMOVENPC(0xe54f);
        B_REMOVENPC(0xe577);
        if ((SQ406_GETTER_POTION) != (3)) {
            B_REMOVENPC(0xe590);
        };
        if ((NPC_ISDEAD(PIR_1304_IVAN)) == (FALSE)) {
            B_REMOVENPC(0xe521);
        };
        if ((NPC_ISDEAD(PIR_1300_LEONARDO)) == (FALSE)) {
            B_REMOVENPC(0xe502);
        };
        if (((Q305_JAVAD_WENTTONEWHOME) == (1)) && ((Q509_JAVADVOLFZACKE) != (1))) {
            B_REMOVENPC(0xe4c6);
        };
        if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
            if ((NPC_ISDEAD(PIR_1324_MORITZ)) == (FALSE)) {
                B_REMOVENPC(0xe59e);
            };
        };
        if ((NPC_KNOWSINFO(HERO, 0x14b37)) == (FALSE)) {
            if ((NPC_ISDEAD(PIR_1325_FOX)) == (FALSE)) {
                B_REMOVENPC(0xe5a9);
            };
        };
        if ((SQ406_DAN_POTION) != (3)) {
            B_REMOVENPC(0xe5b0);
        };
        if ((NPC_ISDEAD(PIR_1327_LAUTENIST)) == (FALSE)) {
            B_REMOVENPC(0xe5bb);
        };
        if ((Q305_BERTELWAY) == (1)) {
            B_REMOVENPC(0xe4d4);
        };
        if (((LOG_GETSTATUS(MIS_SQ310)) == (LOG_SUCCESS)) && ((LOG_GETSTATUS(MIS_SQ408)) != (LOG_SUCCESS))) {
            B_REMOVENPC(0xe4fb);
        };
        if ((Q307_POISONWAY) != (1)) {
            B_REMOVENPC(0xe566);
            B_REMOVENPC(0xe56e);
            B_REMOVENPC(0xe48d);
            if ((SQ406_GHOST_POTION) != (3)) {
                B_REMOVENPC(0xe481);
            };
            if ((NPC_ISDEAD(PIR_1330_ALVAREZ)) == (FALSE)) {
                B_REMOVENPC(0xe5cc);
            };
            if ((LOG_GETSTATUS(MIS_SQ408)) != (LOG_SUCCESS)) {
                B_REMOVENPC(0xe5c2);
            };
            if ((NPC_ISDEAD(PIR_1312_LARRY)) == (FALSE)) {
                B_REMOVENPC(0xe586);
            };
            if ((NPC_ISDEAD(PIR_1307_PROXIMO)) == (FALSE)) {
                B_REMOVENPC(0xe548);
            };
            if ((NPC_ISDEAD(PIR_1305_OTIS)) == (FALSE)) {
                B_REMOVENPC(0xe528);
            };
            if ((NPC_ISDEAD(PIR_1302_MORTY)) == (FALSE)) {
                B_REMOVENPC(0xe50e);
            };
            if ((NPC_ISDEAD(PIR_1301_GREGOR)) == (FALSE)) {
                B_REMOVENPC(0xe509);
            };
        };
        B_REMOVENPC(0xe498);
        B_REMOVENPC(0xe4a0);
        if ((Q305_HERDIS_FINISHWAY) == (1)) {
            B_REMOVENPC(0xe214);
            B_REMOVENPC(0xe220);
        };
        if ((Q305_HARRISTATUS) == (4)) {
            B_REMOVENPC(0xe4e0);
        };
    };
}

var int SQ503_FINISHQUEST.MAXWEAPONSKILL = 0;
func void SQ503_CORTEZ_RUNTOHERO() {
    if (NPC_ISINSTATE(PIR_1303_CORTEZ, 0xab50)) {
        NPC_SETSTATETIME(PIR_1303_CORTEZ, (SPL_TIME_FREEZE) + (1));
    };
    if (NPC_ISINSTATE(PIR_1303_CORTEZ, 0xab85)) {
        NPC_SETSTATETIME(PIR_1303_CORTEZ, (SPL_TIME_SHORTZAPPED) + (1));
    };
    if (NPC_ISINSTATE(PIR_1303_CORTEZ, 0xab81)) {
        NPC_SETSTATETIME(PIR_1303_CORTEZ, (SPL_TIME_WHIRLWIND) + (1));
    };
    MDL_APPLYOVERLAYMDS(PIR_1303_CORTEZ, "HUMANS_Sprint.mds");
    NPC_CLEARAIQUEUE(PIR_1303_CORTEZ);
    B_CLEARPERCEPTIONS(PIR_1303_CORTEZ);
    AI_TURNTONPC(PIR_1303_CORTEZ, HERO);
    AI_GOTONPC(PIR_1303_CORTEZ, HERO);
}

func void SQ503_CORTEZ_ATTACK() {
    NPC_CLEARAIQUEUE(PIR_1303_CORTEZ);
    AI_PLAYANI(PIR_1303_CORTEZ, "T_BOSS_SWORDATTACK");
    if ((PIR_1303_CORTEZ.AIVAR[17]) == (TRUE)) {
        FF_APPLYONCEEXT(0xf9b0, 360, 14);
    };
    FF_APPLYONCEEXT(0xf9b0, 180, 14);
}

func void SQ503_CORTEZ_ATTACK_APPLY() {
    SQ503_CORTEZ_ATTACK_COUNT = (SQ503_CORTEZ_ATTACK_COUNT) + (1);
    if ((SQ503_CORTEZ_ATTACK_COUNT) == (2)) {
        if ((NPC_GETDISTTONPC(HERO, PIR_1303_CORTEZ)) <= (300)) {
            NPC_CLEARAIQUEUE(HERO);
            PRINTD("Przewracasz siê!");
            AI_PLAYANI(HERO, "T_BOSSFALLDOWN");
        };
        B_IMMEDIATEATTACKPLAYER(PIR_1303_CORTEZ, AR_NONE);
    };
    if ((SQ503_CORTEZ_ATTACK_COUNT) == (14)) {
        SQ503_CORTEZ_ATTACK_COUNT = 0;
        MDL_REMOVEOVERLAYMDS(PIR_1303_CORTEZ, "Humans_Sprint.mds");
    };
}

var int SQ503_CORTEZ_ATTACK_APPLY.SQ503_CORTEZ_ATTACK_COUNT = 0;
