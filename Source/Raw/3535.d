func void SQ508_NOVIZESMALLTALKCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0xf75a, 75, 4);
}

func void SQ508_NOVIZESMALLTALKCUTSCENE_APPLY() {
    SQ508_NOVIZESMALLTALKCUTSCENE_COUNT = (SQ508_NOVIZESMALLTALKCUTSCENE_COUNT) + (1);
    if ((SQ508_NOVIZESMALLTALKCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(0x16b60);
    };
}

var int SQ508_NOVIZESMALLTALKCUTSCENE_APPLY.SQ508_NOVIZESMALLTALKCUTSCENE_COUNT = 0;
func void SQ508_TRIALOGNOVIZE_START() {
    SQ508_NOVIZESMALLTALKCUTSCENE_STATUS = 3;
    NOV_205_NOVIZE.AIVAR[92] = FALSE;
    NOV_208_NOVIZE.AIVAR[92] = FALSE;
    HERO.AIVAR[4] = FALSE;
    AI_STARTSTATE(NOV_205_NOVIZE, 0xf09f, 1, "");
    AI_STARTSTATE(HERO, 0xf09f, 1, "");
}

func void SQ508_TRIALOGNOVIZE_FINISH() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0xf75e, 75, 4);
}

func void SQ508_TRIALOGNOVIZE_FINISH_APPLY() {
    SQ508_TRIALOGNOVIZE_FINISH_COUNT = (SQ508_TRIALOGNOVIZE_FINISH_COUNT) + (1);
    if ((SQ508_TRIALOGNOVIZE_FINISH_COUNT) == (4)) {
        HERO.AIVAR[4] = FALSE;
        WLD_SENDUNTRIGGER("SQ508_NOVIZESMALLTALK_01");
        WLD_SENDUNTRIGGER("SQ508_NOVIZESMALLTALK_02");
        B_STARTOTHERROUTINE(NOV_208_NOVIZE, "SQ508_SMALLTALK");
        NPC_REFRESH(NOV_208_NOVIZE);
        B_STARTOTHERROUTINE(NOV_205_NOVIZE, "SQ508_SMALLTALK");
        NPC_REFRESH(NOV_205_NOVIZE);
    };
}

var int SQ508_TRIALOGNOVIZE_FINISH_APPLY.SQ508_TRIALOGNOVIZE_FINISH_COUNT = 0;
func void SQ508_CORPSESONGRAVEYARD_PREPARE() {
    FF_APPLYONCEEXTGT(0xf761, 0, -(1));
}

func void SQ508_CORPSESONGRAVEYARD_APPLY() {
    if ((SQ508_CORPSESONGRAVEYARD_COUNT) == (0)) {
        PRINTD("Rozpoczynam - SQ508_CorpsesOnGraveyard_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_GOBBOCORPSE");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_WOLFCORPSE");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        MOVPTR3 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_LURKERCORPSE");
        MOVER3 = MEM_PTRTOINST(MOVPTR3);
        CHANGEVOBCOLLISION("SQ508_GOBBOCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_WOLFCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_LURKERCORPSE", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("SQ508_MOVER_GOBBOCORPSE");
        WLD_SENDTRIGGER("SQ508_MOVER_WOLFCORPSE");
        WLD_SENDTRIGGER("SQ508_MOVER_LURKERCORPSE");
        SQ508_CORPSESONGRAVEYARD_COUNT = 1;
    };
    if (((((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER3.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ508_CorpsesOnGraveyard_Apply");
        CHANGEVOBCOLLISION("SQ508_GOBBOCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_WOLFCORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ508_LURKERCORPSE", FALSE, FALSE, FALSE, TRUE);
        FF_REMOVE(0xf761);
        SQ508_CORPSESONGRAVEYARD_COUNT = 0;
    };
}

var int SQ508_CORPSESONGRAVEYARD_APPLY.SQ508_CORPSESONGRAVEYARD_COUNT = 0;
instance SQ508_CORPSESONGRAVEYARD_APPLY.MOVER1(ZCMOVER)
instance SQ508_CORPSESONGRAVEYARD_APPLY.MOVER2(ZCMOVER)
instance SQ508_CORPSESONGRAVEYARD_APPLY.MOVER3(ZCMOVER)
var int SQ508_CORPSESONGRAVEYARD_APPLY.MOVPTR1 = 0;
var int SQ508_CORPSESONGRAVEYARD_APPLY.MOVPTR2 = 0;
var int SQ508_CORPSESONGRAVEYARD_APPLY.MOVPTR3 = 0;
func void SQ508_HELPNOVIZE_PREPARE() {
    MOB_CHANGEFOCUSNAME("SQ508_LURKERCORPSE", "MOBNAME_CORPSEINVESTIGATE");
    WLD_INSERTNPC(0xc4d7, "PART8_MOB_08");
    MOB_CHANGEFOCUSNAME("SQ508_WOLFCORPSE", "MOBNAME_CORPSEINVESTIGATE");
}

func void SQ508_CANDACREADYFORGRAVEYARD() {
    NPC_EXCHANGEROUTINE(PAL_100_CANDAC, "SQ508_WAIT");
    B_STARTOTHERROUTINE(NOV_208_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_208_NOVIZE);
    B_STARTOTHERROUTINE(NOV_205_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_205_NOVIZE);
}

func void SQ508_PREPAREGRAVEYARD() {
    SQ508_CANDACFIGHT = 1;
    B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_INNOS");
    NPC_REFRESH(NONE_6239_CASPAR);
    TELEPORTNPCTOWP(0xcaf2, NONE_6239_CASPAR.WP);
    FF_APPLYONCEEXTGT(0xf771, 0, -(1));
    WLD_INSERTNPC(0xc560, "PART8_SQ508_SPAWN_01");
    WLD_INSERTNPC(0xc561, "PART8_SQ508_SPAWN_02");
    WLD_INSERTNPC(0xc562, "PART8_SQ508_SPAWN_03");
    WLD_INSERTNPC(0xc563, "PART8_SQ508_SPAWN_04");
    WLD_INSERTNPC(0xc564, "PART8_SQ508_SPAWN_05");
}

func void SQ508_SPAWNSKELETONS() {
    FF_APPLYONCEEXT(0xf76d, 1000, 5);
}

func void SQ508_SPAWNSKELETONS_APPLY() {
    SQ508_SPAWNSKELETONS_COUNT = (SQ508_SPAWNSKELETONS_COUNT) + (1);
    if ((SQ508_SPAWNSKELETONS_COUNT) == (1)) {
        WLD_INSERTNPC(0xc6a0, "PART8_SQ508_SPAWN_01");
        WLD_PLAYEFFECT("spellFX_INCOVATION_VIOLET", SKELETON_SQ508_01, SKELETON_SQ508_01, 0, 0, 0, FALSE);
        WLD_PLAYEFFECT("FX_EarthQuake", SKELETON_SQ508_01, SKELETON_SQ508_01, 0, 0, 0, FALSE);
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (2)) {
        WLD_INSERTNPC(0xc6a1, "PART8_SQ508_SPAWN_02");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (3)) {
        WLD_INSERTNPC(0xc6a2, "PART8_SQ508_SPAWN_03");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (4)) {
        WLD_INSERTNPC(0xc6a3, "PART8_SQ508_SPAWN_04");
    };
    if ((SQ508_SPAWNSKELETONS_COUNT) == (5)) {
        WLD_INSERTNPC(0xc6a4, "PART8_SQ508_SPAWN_05");
        SQ508_CANDACFIGHT = 3;
    };
}

var int SQ508_SPAWNSKELETONS_APPLY.SQ508_SPAWNSKELETONS_COUNT = 0;
func int SQ508_GOBBSAREDEAD() {
    if (((((NPC_ISDEAD(GOBBO_SKELETON_SQ508_01)) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_02))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_03))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_04))) && (NPC_ISDEAD(GOBBO_SKELETON_SQ508_05))) {
        return TRUE;
    };
    return FALSE;
}

func int SQ508_SKELETONSAREDEAD() {
    if (((((NPC_ISDEAD(SKELETON_SQ508_01)) && (NPC_ISDEAD(SKELETON_SQ508_02))) && (NPC_ISDEAD(SKELETON_SQ508_03))) && (NPC_ISDEAD(SKELETON_SQ508_04))) && (NPC_ISDEAD(SKELETON_SQ508_05))) {
        return TRUE;
    };
    return FALSE;
}

func void SQ508_DOORSMOVER_APPLY() {
    if ((SQ508_DOORSMOVER_COUNT) == (0)) {
        PRINTD("Rozpoczynam - SQ508_DoorsMover_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ508_MOVER_DOOR_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("SQ508_DOOR_01", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("SQ508_MOVER_DOOR_01");
        SQ508_DOORSMOVER_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ508_DoorsMover_Apply");
        CHANGEVOBCOLLISION("SQ508_DOOR_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_01", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_02", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ508_BROKENDOOR_03", TRUE, FALSE, TRUE, TRUE);
        FF_REMOVE(0xf771);
        SQ508_DOORSMOVER_COUNT = 0;
    };
}

var int SQ508_DOORSMOVER_APPLY.SQ508_DOORSMOVER_COUNT = 0;
instance SQ508_DOORSMOVER_APPLY.MOVER1(ZCMOVER)
var int SQ508_DOORSMOVER_APPLY.MOVPTR1 = 0;
func void SQ508_JUDGMENTCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_WAIT");
    NPC_REFRESH(NONE_6239_CASPAR);
    B_STARTOTHERROUTINE(PAL_100_CANDAC, "SQ508_WAIT_INNOS");
    NPC_REFRESH(PAL_100_CANDAC);
    WLD_SENDTRIGGER("SQ508_MOVER_TRIGGERCUTSCENE");
    FF_APPLYONCEEXT(0xf776, 150, 4);
}

func void SQ508_JUDGMENTCUTSCENE_APPLY() {
    SQ508_JUDGMENTCUTSCENE_COUNT = (SQ508_JUDGMENTCUTSCENE_COUNT) + (1);
    if ((SQ508_JUDGMENTCUTSCENE_COUNT) == (4)) {
        SQ508_JUDGMENT = 3;
        CUTSCENE_START(0x16b58);
    };
}

var int SQ508_JUDGMENTCUTSCENE_APPLY.SQ508_JUDGMENTCUTSCENE_COUNT = 0;
func void SQ508_CANDACTRIALOG_START() {
    SQ508_JUDGMENT = 4;
    PAL_100_CANDAC.AIVAR[92] = FALSE;
    HERO.AIVAR[4] = FALSE;
    AI_STARTSTATE(NONE_6239_CASPAR, 0xf09f, 1, "");
    AI_STARTSTATE(HERO, 0xf09f, 1, "");
}

func void SQ508_KILLCUTSCENE_PREPARE() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0xf77a, 75, 4);
}

func void SQ508_KILLCUTSCENE_APPLY() {
    SQ508_KILLCUTSCENE_COUNT = (SQ508_KILLCUTSCENE_COUNT) + (1);
    if ((SQ508_KILLCUTSCENE_COUNT) == (4)) {
        CUTSCENE_START(0x16b5c);
    };
}

var int SQ508_KILLCUTSCENE_APPLY.SQ508_KILLCUTSCENE_COUNT = 0;
func void SQ508_FINISHCUTSCENES() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0xf77d, 75, 4);
}

func void SQ508_FINISHCUTSCENES_APPLY() {
    SQ508_FINISHCUTSCENES_COUNT = (SQ508_FINISHCUTSCENES_COUNT) + (1);
    if ((SQ508_FINISHCUTSCENES_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_01");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_02");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_03");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_04");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_05");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_06");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_07");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_08");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_09");
        WLD_SENDUNTRIGGER("SQ508_JUDGMENT_10");
        DIACAM_ENABLE();
        B_STARTOTHERROUTINE(NOV_205_NOVIZE, "SQ508_SEARCH");
        NPC_REFRESH(NOV_205_NOVIZE);
        TELEPORTNPCTOWP(0xdd13, NOV_205_NOVIZE.WP);
        B_STARTOTHERROUTINE(NOV_208_NOVIZE, "SQ508_SEARCH");
        NPC_REFRESH(NOV_208_NOVIZE);
        TELEPORTNPCTOWP(0xdd19, NOV_208_NOVIZE.WP);
        if ((SQ508_RESULT) == (2)) {
            B_STARTOTHERROUTINE(NONE_6239_CASPAR, "SQ508_FLEE");
            NPC_REFRESH(NONE_6239_CASPAR);
        };
        HERO.AIVAR[4] = FALSE;
    };
}

var int SQ508_FINISHCUTSCENES_APPLY.SQ508_FINISHCUTSCENES_COUNT = 0;
func void SQ508_JUDGMENT_RUNAWAY() {
    SQ508_RESULT = 2;
    SQ508_CASPARRUNAWAY = 1;
    SQ508_FINISHCUTSCENES();
}

func void SQ508_NOVIZEGOBACKTOWORK() {
    B_STARTOTHERROUTINE(NOV_208_NOVIZE, "NORMALDAY");
    NPC_REFRESH(NOV_208_NOVIZE);
    NPC_EXCHANGEROUTINE(NOV_205_NOVIZE, "NORMALDAY");
}

