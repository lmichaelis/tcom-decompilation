instance Q101_SHIP_FINAL(CUTSCENE) {
    ONSTART = FUNCTION(0x168fd);
}

func void Q101_SHIP_FINAL_START() {
    WLD_SENDTRIGGER("SHIP_FINAL_01");
    WLD_SENDUNTRIGGER("Q101_SND_SCARED");
    WLD_SENDTRIGGER("Q101_SND_PIRATES_03");
    WLD_SENDTRIGGER("Q101_BIGSEA");
    FF_APPLYONCEEXT(0x16902, 1000, 3);
    TELEPORTNPCTOWP(0xc9a9, "SHIP_PIRATE_CUTSCENE_01");
    TELEPORTNPCTOWP(0xc999, "SHIP_PIRATE_CUTSCENE_02");
    TELEPORTNPCTOWP(0xc959, "SHIP_BEGINNING_21");
    TELEPORTNPCTOWP(0xc91b, "SHIP_CAPTAIN_04");
    TELEPORTNPCTOWP(0x71b, "SHIP_MARVIN_02");
    AI_PLAYANI(PIR_1323_SMUGGLER, T_1HATTACKL);
    AI_PLAYANI(PIR_1323_SMUGGLER, T_1HATTACKR);
    AI_WAIT(PIR_1321_SMUGGLER, 0x3fb33333);
    AI_PLAYANI(PIR_1321_SMUGGLER, T_1HATTACKR);
    AI_WAIT(PIR_1318_SMUGGLER, 0x400ccccd);
    AI_PLAYANI(PIR_1318_SMUGGLER, T_1HATTACKL);
    TELEPORTNPCTOWP(0xc9a5, "SHIP_BEGINNING_19");
    AI_TURNAWAY(PIR_1320_SMUGGLER, HERO);
    AI_TURNTONPC(NONE_7_RUPERT, PIR_2_CAPTAIN);
    AI_TURNTONPC(PIR_2_CAPTAIN, NONE_7_RUPERT);
}

func void Q101_SHIP_FINAL_CAMERA_01() {
    WLD_SENDTRIGGER("SHIP_FINAL_03");
    WLD_SENDUNTRIGGER("SHIP_FINAL_02");
    TELEPORTNPCTOWP(0xc9a5, "SHIP_BEGINNING_19");
}

func void Q101_SHIP_FINAL_CAMERA_02() {
    WLD_SENDTRIGGER("SHIP_FINAL_05");
    WLD_SENDUNTRIGGER("SHIP_FINAL_04");
    TELEPORTNPCTOWP(0xc9a5, "SHIP_BEGINNING_19");
}

func void Q101_SHIP_FINAL_CAMERA_03() {
    WLD_SENDTRIGGER("SHIP_FINAL_07");
    WLD_SENDUNTRIGGER("SHIP_FINAL_06");
    TELEPORTNPCTOWP(0xc9a5, "SHIP_BEGINNING_19");
    TELEPORTNPCTOWP(0x71b, "SHIP_BEGINNING_JUMP");
}

func void Q101_SHIP_FINAL_CAMERA_UNLOCK() {
    Q101_CAPTAIN_CUTSCENEENABLE = 9;
    Q101_SHIPT_BLOCKPATH();
    PIR_2_CAPTAIN.NOFOCUS = TRUE;
    PIR_1318_SMUGGLER.NOFOCUS = TRUE;
    PIR_1319_SMUGGLER.NOFOCUS = TRUE;
    PIR_1320_SMUGGLER.NOFOCUS = TRUE;
    PIR_1321_SMUGGLER.NOFOCUS = TRUE;
    PIR_1322_SMUGGLER.NOFOCUS = TRUE;
    PIR_1323_SMUGGLER.NOFOCUS = TRUE;
}

func void Q101_SHIP_FINAL_APPLY() {
    Q101_SHIP_FINAL_COUNT = (Q101_SHIP_FINAL_COUNT) + (1);
    if ((Q101_SHIP_FINAL_COUNT) == (3)) {
        TELEPORTNPCTOWP(0x71b, "SHIP_BEGINNING_10");
        WLD_SENDTRIGGER("SHIP_FINAL_02");
        WLD_SENDUNTRIGGER("SHIP_FINAL_01");
        AI_STARTFACEANI(NONE_7_RUPERT, T_HURT, 1, -(1));
        AI_PLAYANI(NONE_7_RUPERT, T_JUMPB);
        AI_PLAYANI(NONE_7_RUPERT, T_JUMPB);
        AI_PLAYANI(NONE_7_RUPERT, T_NO);
        AI_FUNCTION(NONE_7_RUPERT, 0x168fe);
        AI_TURNTONPC(PIR_1320_SMUGGLER, NONE_7_RUPERT);
        AI_PLAYANI(PIR_1320_SMUGGLER, T_1HATTACKR);
        AI_WAIT(PIR_1320_SMUGGLER, 0x3e99999a);
        AI_PLAYANI(PIR_1320_SMUGGLER, T_1HATTACKL);
        AI_TURNAWAY(NONE_7_RUPERT, PIR_1320_SMUGGLER);
        AI_PLAYANI(NONE_7_RUPERT, "T_CUTSCENEJUMP_START");
        Q101_SHIP_REMOVE_FIRSTHALF();
    };
}

var int Q101_SHIP_FINAL_APPLY.Q101_SHIP_FINAL_COUNT = 0;
func void Q101_SHIP_FINAL_CAPTAIN() {
    TELEPORTNPCTOWP(0xc8ef, "SHIP_BEGINNING_JUMP");
    WLD_SENDTRIGGER("SHIP_FINAL_04");
    WLD_SENDUNTRIGGER("SHIP_FINAL_03");
    AI_TURNAWAY(NONE_1_JORN, PIR_2_CAPTAIN);
    AI_STARTFACEANI(PIR_2_CAPTAIN, S_SMUG, 1, -(1));
    AI_WAIT(PIR_2_CAPTAIN, 0x3ecccccd);
    AI_PLAYANI(PIR_2_CAPTAIN, T_STAND_2_LGUARD);
    AI_WAIT(PIR_2_CAPTAIN, 0x3fc00000);
    AI_FUNCTION(PIR_2_CAPTAIN, 0x168ff);
    AI_WAITTILLEND(PIR_1320_SMUGGLER, PIR_2_CAPTAIN);
    AI_WAITTILLEND(NONE_1_JORN, PIR_2_CAPTAIN);
    AI_PLAYANI(NONE_1_JORN, "T_CUTSCENEJUMP_START");
    AI_PLAYANI(PIR_1320_SMUGGLER, "T_1HATTACKL");
    AI_PLAYANI(PIR_1320_SMUGGLER, T_1HATTACKR);
    Q101_SHIP_REMOVE_SECONDHALF();
}

func void Q101_STARTSND() {
    WLD_SENDTRIGGER("Q101_SND_PIRATES_02");
}

func void Q101_SHIP_FINAL_MARVIN() {
    WLD_SENDTRIGGER("SHIP_FINAL_06");
    WLD_SENDUNTRIGGER("SHIP_FINAL_05");
    AI_PLAYANI(PIR_2_CAPTAIN, T_LGUARD_2_STAND);
    TELEPORTNPCTOWP(0x71b, "SHIP_BEGINNING_19");
    TELEPORTNPCTOWP(0xc9a5, "SHIP_MARVIN_02");
    AI_TURNAWAY(HERO, PIR_2_CAPTAIN);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_GOTOWP(HERO, "SHIP_BEGINNING_JUMP");
    AI_WAITTILLEND(PIR_2_CAPTAIN, HERO);
    AI_WAITTILLEND(PIR_1320_SMUGGLER, HERO);
    AI_WAIT(PIR_2_CAPTAIN, 0x3f800000);
    AI_PLAYANI(HERO, "T_EXPLOSION_SCARED_HERO");
    AI_PLAYANI(PIR_1320_SMUGGLER, T_1HATTACKR);
    AI_WAIT(PIR_1320_SMUGGLER, 0x3e99999a);
    AI_PLAYANI(PIR_1320_SMUGGLER, T_1HATTACKL);
    AI_FUNCTION(PIR_2_CAPTAIN, 0x16900);
    AI_FUNCTION(PIR_2_CAPTAIN, 0x16905);
    AI_PLAYANI(PIR_2_CAPTAIN, "T_THREAT_DEATH");
    AI_WAIT(PIR_2_CAPTAIN, 0x3f800000);
    AI_FUNCTION(PIR_2_CAPTAIN, 0x16901);
}

