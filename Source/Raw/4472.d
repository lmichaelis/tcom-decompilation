func void EVT_SQ206_REPAIR() {
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(HERO))) {
        HERO.AIVAR[4] = TRUE;
        if ((SQ206_REPAIRROOF) == (FALSE)) {
            if ((NPC_HASITEMS(HERO, 0x910b)) >= (5)) {
                WLD_SENDTRIGGER("SQ206_MOVER_REPAIR_01");
                MOB_CHANGEFOCUSNAME("SQ206_HAMMERGROUND_02", "MOBNAME_NOTHING");
                AI_WAIT(HERO, 0x40400000);
                AI_USEMOB(HERO, NPC_GETDETECTEDMOB(HERO), -(1));
                AI_FUNCTION(HERO, 0x16790);
            } else {
                AI_FUNCTION(SELF, 0x16795);
            };
        };
    };
}

func void SQ206_FINISHREPAIR() {
    FF_APPLYONCEEXTGT(0x16791, 0, -(1));
}

func void SQ206_FINISHREPAIR_APPLY() {
    if ((SQ206_FINISHREPAIR_COUNT) == (0)) {
        PRINTD("Rozpoczynam - SQ206_FinishRepair_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ206_MOVER_ROOF");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("SQ206_ROOF", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("SQ206_MOVER_ROOF");
        SQ206_FINISHREPAIR_COUNT = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ206_FinishRepair_Apply");
        CHANGEVOBCOLLISION("SQ206_ROOF", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0x16791);
        SQ206_FINISHREPAIR_COUNT = 0;
        SQ206_REPAIRROOF = TRUE;
        B_LOGENTRY(TOPIC_SQ206, LOG_SQ206_BLATTCRAWLERSDEFEATED);
        NPC_REMOVEINVITEMS(HERO, 0x910b, NPC_HASITEMS(HERO, 0x910b));
        HERO.AIVAR[4] = FALSE;
    };
}

var int SQ206_FINISHREPAIR_APPLY.SQ206_FINISHREPAIR_COUNT = 0;
instance SQ206_FINISHREPAIR_APPLY.MOVER1(ZCMOVER)
var int SQ206_FINISHREPAIR_APPLY.MOVPTR1 = 0;
func void SQ206_REPAIRROOF_NOITEMS() {
    HERO.AIVAR[4] = FALSE;
    B_SAY(HERO, HERO, "$MARVIN_NOITEMS");
}

