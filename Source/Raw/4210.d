instance DIA_TONAN_EXIT(C_INFO) {
    NPC = 0xe3d3;
    NR = 999;
    CONDITION = DIA_TONAN_EXIT_CONDITION;
    INFORMATION = DIA_TONAN_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_TONAN_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_TONAN_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_TONAN_HELLO(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_HELLO_CONDITION;
    INFORMATION = DIA_TONAN_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TONAN_HELLO_CONDITION() {
    if (NPC_ISINSTATE(SELF, 0xf09f)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_HELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_HELLO_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_HELLO_03_02");
}

instance DIA_TONAN_WHO(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_WHO_CONDITION;
    INFORMATION = DIA_TONAN_WHO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Who are you guarding them from?";
}

func int DIA_TONAN_WHO_CONDITION() {
    return TRUE;
}

func void DIA_TONAN_WHO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_Who_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_Who_03_02");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_Who_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_Who_03_04");
    AI_RESETFACEANI(OTHER);
}

instance DIA_TONAN_SQ414_START(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_START_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_START_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Boring, huh?";
}

func int DIA_TONAN_SQ414_START_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x14e13)) && ((KAPITEL) == (4))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_START_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Start_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Start_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Start_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Start_03_04");
    AI_RESETFACEANI(SELF);
}

instance DIA_TONAN_SQ414_TREASURES(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_TREASURES_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_TREASURES_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "The mages hid their treasures?";
}

func int DIA_TONAN_SQ414_TREASURES_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x14e16)) && ((KAPITEL) == (4))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_TREASURES_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Treasures_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Treasures_03_02");
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(0x14e19);
    INFO_ADDCHOICE(0x14e19, "This is very interesting, but I have to go now.", 0x14e1e);
    INFO_ADDCHOICE(0x14e19, "You intrigued me.", 0x14e1d);
}

var int TONAN_SQ414_TAKEQUEST = 0;
func void DIA_TONAN_SQ414_TREASURES_GOON() {
    TONAN_SQ414_TAKEQUEST = FALSE;
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Treasures_GoOn_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Treasures_GoOn_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Treasures_GoOn_03_03");
    INFO_CLEARCHOICES(0x14e19);
}

func void DIA_TONAN_SQ414_TREASURES_BYE() {
    TONAN_SQ414_TAKEQUEST = TRUE;
    AI_STARTFACEANI(OTHER, S_DISGUST, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Treasures_Bye_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Treasures_Bye_03_02");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    INFO_CLEARCHOICES(0x14e19);
}

instance DIA_TONAN_SQ414_TAKEQUEST(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_TAKEQUEST_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_TAKEQUEST_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "You mentioned something earlier about a tower and treasures.";
}

func int DIA_TONAN_SQ414_TAKEQUEST_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x14e19)) && ((KAPITEL) == (4))) && ((TONAN_SQ414_TAKEQUEST) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_TAKEQUEST_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_TakeQuest_15_01");
    DIA_TONAN_SQ414_TREASURES_GOON();
}

instance DIA_TONAN_SQ414_TOWER(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_TOWER_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_TOWER_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Where's the tower?";
}

func int DIA_TONAN_SQ414_TOWER_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x14e19)) && ((KAPITEL) == (4))) && ((TONAN_SQ414_TAKEQUEST) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_TOWER_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Tower_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Tower_03_02");
}

instance DIA_TONAN_SQ414_GUIDEME(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_GUIDEME_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_GUIDEME_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Take me there.";
}

func int DIA_TONAN_SQ414_GUIDEME_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x14e22)) && ((SQ414_GOTOTOWER) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void TONAN_SQ414_GOTOFARM() {
    if ((SQ414_GOTOTOWER) == (0)) {
        SQ414_GOTOTOWER = 1;
    };
    B_STANDUP();
    NPC_EXCHANGEROUTINE(SELF, "SQ414_FARM");
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_TONAN_SQ414_NOTYET() {
    SQ414_NOTNOW = TRUE;
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_06");
    if ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) {
        AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_NOTYET);
    };
}

func void DIA_TONAN_SQ414_GUIDEME_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_GuideMe_15_01");
    if (((KAPITEL) == (5)) && ((KQ407_ORCLEADER_PART6_DEAD) == (FALSE))) {
        DIA_TONAN_SQ414_NOTYET();
    };
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_GuideMe_15_03");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_05");
    AI_RESETFACEANI(SELF);
    TONAN_SQ414_GOTOFARM();
    LOG_CREATETOPIC(TOPIC_SQ414, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ414), TOPIC_SQ414, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_START);
}

instance DIA_TONAN_SQ414_WHAT(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_WHAT_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_WHAT_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What are you doing here?";
}

func int DIA_TONAN_SQ414_WHAT_CONDITION() {
    if (((SQ414_TELEPORTTONAN) == (2)) && ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_WHAT_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Fred_TrueHello_15_01");
    DIA_TONAN_SQ414_NOTYET();
}

instance DIA_TONAN_SQ414_NOMOREORCS(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_NOMOREORCS_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_NOMOREORCS_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "(Head to the tower with Tonan.)";
}

func int DIA_TONAN_SQ414_NOMOREORCS_CONDITION() {
    if ((SQ414_NOTNOW) == (TRUE)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int SQ414_TONANAGREED = 0;
func void DIA_TONAN_SQ414_ORCSWOAH() {
    B_STANDUP();
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoMoreOrcs_03_02");
}

func void DIA_TONAN_SQ414_NOMOREORCS_LETSGO() {
    DIA_TONAN_SQ414_ORCSWOAH();
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoMoreOrcs_03_03");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    if (NPC_KNOWSINFO(OTHER, 0x14e3e)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoMoreOrcs_03_04");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoMoreOrcs_03_05");
    if ((LOG_GETSTATUS(MIS_SQ414)) != (LOG_RUNNING)) {
        LOG_CREATETOPIC(TOPIC_SQ414, LOG_MISSION);
        LOG_SETSTATUS(_@(MIS_SQ414), TOPIC_SQ414, LOG_RUNNING);
        AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_START);
    };
    if (NPC_KNOWSINFO(OTHER, 0x14e3e)) {
        AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_NOMOREORCS_V1);
    };
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_NOMOREORCS_V2);
    AI_RESETFACEANI(SELF);
    TONAN_SQ414_GOTOFARM();
}

func void DIA_TONAN_SQ414_ABOUTGHOST() {
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_04");
}

func void DIA_TONAN_SQ414_CONVINCEHIM() {
    SQ414_TONANAGREED = TRUE;
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_06");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_07");
    AI_FUNCTION(OTHER, 0x14e48);
    AI_WAIT(OTHER, 0x3f8ccccd);
    AI_FUNCTION(OTHER, 0x14e49);
    AI_WAIT(OTHER, 0x3f8ccccd);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_09");
    INFO_CLEARCHOICES(0x14e45);
    INFO_ADDCHOICE(0x14e45, "You wanted to prove yourself? Now's your chance!", 0x14e4c);
    INFO_ADDCHOICE(0x14e45, "This spirit has suffered for centuries!", 0x14e4b);
    INFO_ADDCHOICE(0x14e45, "What if I pay?", 0x14e4a);
    INFO_CLEARCHOICES(0x14e2d);
    INFO_ADDCHOICE(0x14e2d, "You wanted to prove yourself? Now's your chance!", 0x14e4c);
    INFO_ADDCHOICE(0x14e2d, "This spirit has suffered for centuries!", 0x14e4b);
    INFO_ADDCHOICE(0x14e2d, "What if I pay?", 0x14e4a);
}

func void DIA_TONAN_SQ414_NOMOREORCS_INFO() {
    if ((KQ407_ORCLEADER_PART6_DEAD) == (FALSE)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Ready_Yes_15_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_06");
    };
    SQ414_NOTNOW = 2;
    if ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoMoreOrcs_15_01");
        if (((SQ414_TONANAGREED) == (TRUE)) || ((NPC_KNOWSINFO(OTHER, 0x14e3e)) == (FALSE))) {
            AI_OUTPUT(OTHER, SELF, "DIA_Ivy_AfterExecution_No_15_01");
            DIA_TONAN_SQ414_NOMOREORCS_LETSGO();
        } else {
            DIA_TONAN_SQ414_ORCSWOAH();
            AI_RESETFACEANI(SELF);
            DIA_TONAN_SQ414_ABOUTGHOST();
            DIA_TONAN_SQ414_CONVINCEHIM();
        } else {
            /* set_instance(0) */;
        };
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_GuideMe_15_01");
    DIA_TONAN_SQ414_NOMOREORCS_LETSGO();
}

instance DIA_TONAN_SQ414_READY(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_READY_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_READY_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

var int TONAN_SQ414_GUIDE = 0;
func int DIA_TONAN_SQ414_READY_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_ISINSTATE(SELF, 0xf09f))) && ((NPC_GETDISTTOWP(SELF, "PART6_SQ414_TONAN")) <= (750))) && ((TONAN_SQ414_GUIDE) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_READY_INFO() {
    if ((SQ414_NOTNOW) == (2)) {
        SQ414_NOTNOW = 3;
        AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_OrcReaction_03_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_OrcReaction_03_02");
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_OrcReaction_03_03");
        AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
        AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_OrcReaction_03_04");
        AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
        if (NPC_KNOWSINFO(OTHER, 0x14e3e)) {
            AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_OrcReaction_03_05");
        };
        AI_RESETFACEANI(SELF);
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Ready_03_01");
    INFO_CLEARCHOICES(0x14e35);
    INFO_ADDCHOICE(0x14e35, "Let's go!", 0x14e39);
    INFO_ADDCHOICE(0x14e35, "I need a moment.", 0x14e3a);
}

func void DIA_TONAN_SQ414_READY_YES() {
    TONAN_SQ414_GUIDE = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Ready_Yes_15_01");
    INFO_CLEARCHOICES(0x14e35);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = TRUE;
    if ((SQ414_GOTALLDOCS) == (2)) {
        NPC_EXCHANGEROUTINE(SELF, "SQ414_GUIDE_V2");
    };
    NPC_EXCHANGEROUTINE(SELF, "SQ414_GUIDE_V1");
}

func void DIA_TONAN_SQ414_READY_NO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Ready_No_15_01");
    INFO_CLEARCHOICES(0x14e35);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_TONAN_SQ414_NEARTOWER(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_NEARTOWER_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_NEARTOWER_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TONAN_SQ414_NEARTOWER_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, "PART6_FOREST_33")) <= (700))) && ((TONAN_SQ414_GUIDE) == (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_NEARTOWER_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NearTower_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NearTower_03_02");
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "SQ414_TOWER");
    WLD_INSERTITEM(0x920a, "FP_PART6_SQ414_SKULL");
}

instance DIA_TONAN_SQ414_ATTACKGHOST(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_ATTACKGHOST_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_ATTACKGHOST_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TONAN_SQ414_ATTACKGHOST_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x1320c)) && ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_ATTACKGHOST_INFO() {
    AI_DRAWWEAPON(SELF);
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_03_01");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_15_02");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_03_03");
    AI_REMOVEWEAPON(SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_15_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_15_05");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_03_06");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_03_07");
    INFO_CLEARCHOICES(0x14e3e);
    INFO_ADDCHOICE(0x14e3e, "What do you need it for?", 0x14e41);
}

func void DIA_TONAN_SQ414_ATTACKGHOST_WHY() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_Why_15_01");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_Why_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_Why_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_Why_03_04");
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_AttackGhost_Why_15_05");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_AttackGhost_Why_03_06");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
    CREATEINVITEMS(SELF, 0x920d, 1);
    B_GIVEINVITEMS(OTHER, SELF, 0x920a, 1);
    INFO_CLEARCHOICES(0x14e3e);
    B_GIVEINVITEMS(SELF, OTHER, 0x920d, 1);
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = FALSE;
    NPC_EXCHANGEROUTINE(SELF, START);
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_TONAN_LEAVE);
    AI_FUNCTION(SELF, 0x14e50);
}

instance DIA_TONAN_SQ414_SORRY(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_SORRY_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_SORRY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TONAN_SQ414_SORRY_CONDITION() {
    if (((SQ414_GOTALLDOCS) == (2)) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_SUCCESS))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_SORRY_INFO() {
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Sorry_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Sorry_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Sorry_03_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Sorry_03_04");
    CREATEINVITEMS(SELF, 0x9545, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x9545, 1);
}

instance DIA_TONAN_SQ414_NOPROBLEM(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_NOPROBLEM_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_NOPROBLEM_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Apology accepted.";
}

func int DIA_TONAN_SQ414_NOPROBLEM_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x14e42)) {
        if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) || ((LOG_GETSTATUS(MIS_SQ414)) == (LOG_SUCCESS))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_NOPROBLEM_INFO() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_02");
    if ((SQ414_FINISHWAY) == (1)) {
        AI_RESETFACEANI(OTHER);
        AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_03");
        AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_04");
        if (((KAPITEL) == (5)) && ((KQ407_ORCLEADER_PART6_DEAD) == (FALSE))) {
            DIA_TONAN_SQ414_NOTYET();
        } else {
            DIA_TONAN_SQ414_CONVINCEHIM();
        } else {
            /* set_instance(0) */;
        };
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_10");
    AI_STARTFACEANI(SELF, S_SMUG, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_11");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_15_12");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_03_13");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

func void TONAN_SQ414_NOPROBLEM_FADESCREEN_IN() {
    FADESCREENTOBLACK(1);
}

func void TONAN_SQ414_NOPROBLEM_FADESCREEN_OUT() {
    FADESCREENFROMBLACK(1);
}

func void DIA_TONAN_SQ414_NOPROBLEM_GOLD() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Gold_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_Gold_03_02");
    AI_RESETFACEANI(OTHER);
}

func void DIA_TONAN_SQ414_NOPROBLEM_PAIN() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Pain_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Pain_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_Pain_03_03");
}

func void DIA_TONAN_SQ414_NOPROBLEM_CHANCE() {
    SQ414_TRIALOGENABLE = 1;
    TONAN_SQ414_GUIDE = 0;
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Chance_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_Chance_03_02");
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Chance_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_NoProblem_Chance_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_Chance_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_NoProblem_Chance_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_GuideMe_03_05");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    TONAN_SQ414_GOTOFARM();
    INFO_CLEARCHOICES(0x14e45);
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_TONAN_HELP);
}

instance DIA_TONAN_SQ414_FINISH(C_INFO) {
    NPC = 0xe3d3;
    NR = 1;
    CONDITION = DIA_TONAN_SQ414_FINISH_CONDITION;
    INFORMATION = DIA_TONAN_SQ414_FINISH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TONAN_SQ414_FINISH_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ414)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13219))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_SQ414_FINISH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Finish_15_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Finish_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tonan_SQ414_Finish_15_03");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Finish_03_04");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Tonan_SQ414_Finish_03_05");
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_SQ414, LOG_SQ414_FINISH);
    SQ414_FINISHQUEST();
    SELF.AIVAR[15] = FALSE;
    NPC_EXCHANGEROUTINE(SELF, START);
    AI_FUNCTION(SELF, 0x14e50);
}

func void TONAN_TELEPORTOUTOFTOWER() {
    FADESCREENTOBLACKF(1, 0x14e51, 1000);
}

func void TONAN_TELEPORTOUTOFTOWER_FADESCREEN() {
    TELEPORTNPCTOWP(0xe3d3, DJG_13329_TONAN.WP);
    FADESCREENFROMBLACK(1);
    HERO.AIVAR[4] = FALSE;
}

instance DIA_TONAN_PICKPOCKET(C_INFO) {
    NPC = 0xe3d3;
    NR = 900;
    CONDITION = DIA_TONAN_PICKPOCKET_CONDITION;
    INFORMATION = DIA_TONAN_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_40;
}

func int DIA_TONAN_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TONAN_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x14e52);
    INFO_ADDCHOICE(0x14e52, DIALOG_BACK, 0x14e56);
    INFO_ADDCHOICE(0x14e52, DIALOG_PICKPOCKET, 0x14e55);
}

func void DIA_TONAN_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x14e52);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x14e52);
}

func void DIA_TONAN_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x14e52);
}

