instance DIA_TENGRAL_Q602_EXIT(C_INFO) {
    NPC = 0xe8f0;
    NR = 999;
    CONDITION = DIA_TENGRAL_Q602_EXIT_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_TENGRAL_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_TENGRAL_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_TENGRAL_Q602_HELP(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_HELP_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_HELP_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_HELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_GUILD_V1) == (1))) {
        if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
            if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
                if (((NPC_GETDISTTOWP(KDF_9004_TENGRAL_Q602, "PARTM1_RICHHOUSE03_33")) <= (400)) && ((NPC_GETDISTTOWP(PAL_101_SILVESTR_Q602, "PARTM1_RICHHOUSE03_23")) <= (600))) {
                    return TRUE;
                };
            };
        } else {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_HELP_INFO() {
    Q602_REMOVESALLTEAM();
    CHANGEVOBCOLLISION("Q602_TENGRALDOOR", FALSE, FALSE, FALSE, FALSE);
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            TRIA_INVITE(PAL_101_SILVESTR_Q602);
            TRIA_START();
        };
    };
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_03_03");
    INFO_CLEARCHOICES(0x16037);
    INFO_ADDCHOICE(0x16037, "I'm sorry, Tengral...", 0x1603a);
}

func void DIA_TENGRAL_Q602_HELP_SORRY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Sorry_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_Sorry_03_02");
    INFO_CLEARCHOICES(0x16037);
    INFO_ADDCHOICE(0x16037, "How did these mercenaries manage to defeat the powerful Fire Mages?", 0x1603b);
    INFO_ADDCHOICE(0x16037, "We must move as soon as possible to help Roderich.", 0x1603c);
}

func void DIA_TENGRAL_Q602_HELP_SORRY_HOW() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_How_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_How_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_How_03_03");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_How_03_04");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_How_03_05");
    INFO_ADDCHOICE(0x16037, "It was Ulryk along with the Usurer who attacked the city.", 0x1603d);
}

func void DIA_TENGRAL_Q602_HELP_SORRY_RODERICH() {
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Roderich_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Roderich_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_Roderich_03_03");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            TRIA_FINISH();
        };
    };
    INFO_CLEARCHOICES(0x16037);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x1603e);
}

func void DIA_TENGRAL_Q602_HELP_SORRY_HOW_ULRYK() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Ulryk_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Ulryk_15_02");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_Ulryk_03_03");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_Ulryk_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Help_Ulryk_15_05");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Help_Ulryk_03_06");
}

func void TENGRAL_Q602_CHANGERTN_V1() {
    KDF_9004_TENGRAL_Q602.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_GUIDE_V1");
    if ((NPC_ISDEAD(PAL_101_SILVESTR_Q602)) == (FALSE)) {
        B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_FOLLOW_V1");
        NPC_REFRESH(PAL_101_SILVESTR_Q602);
    };
}

instance DIA_TENGRAL_Q602_CHURCH(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_CHURCH_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_CHURCH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_CHURCH_CONDITION() {
    if ((((NPC_GETDISTTOWP(SELF, "PARTM1_PATH_66")) <= (500)) && ((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING))) && (NPC_KNOWSINFO(OTHER, 0x16037))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_CHURCH_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Church_03_01");
    INFO_CLEARCHOICES(0x1603f);
    INFO_ADDCHOICE(0x1603f, "Let's hope the people of Usher and Ulryk didn't get there.", 0x16043);
    INFO_ADDCHOICE(0x1603f, "You said there was no time to waste.", 0x16044);
}

func void TENGRAL_Q602_CHANGERTN_V2() {
    INFO_CLEARCHOICES(0x1603f);
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q602_GUIDE_V2");
    AI_FUNCTION(SELF, 0x16045);
}

func void DIA_TENGRAL_Q602_CHURCH_HOPE() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Church_Hope_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Church_Hope_03_02");
    TENGRAL_Q602_CHANGERTN_V2();
}

func void DIA_TENGRAL_Q602_CHURCH_NOTIME() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Church_NoTime_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Church_NoTime_03_02");
    TENGRAL_Q602_CHANGERTN_V2();
}

func void TENGRAL_Q602_CHANGERTN_V8() {
    if ((NPC_ISDEAD(PAL_101_SILVESTR_Q602)) == (FALSE)) {
        B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_FOLLOW_V3");
        NPC_REFRESH(PAL_101_SILVESTR_Q602);
    };
}

instance DIA_TENGRAL_Q602_CLOSEDGATES(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_CLOSEDGATES_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_CLOSEDGATES_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_CLOSEDGATES_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, PARTM8_PATH_12)) <= (500))) && (NPC_KNOWSINFO(OTHER, 0x1603f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void TENGRAL_Q602_CHANGERTN_V3() {
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_SEARCH");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_SEARCH");
            NPC_REFRESH(PAL_101_SILVESTR_Q602);
        };
    };
    if ((Q602_HELPSALL) == (1)) {
        if ((Q602_SALLFLEE) == (0)) {
            if (HLP_ISVALIDNPC(MIL_4044_SALL_Q602)) {
                if (!(NPC_ISDEAD(MIL_4044_SALL_Q602))) {
                    B_STARTOTHERROUTINE(MIL_4044_SALL_Q602, "Q602_SEARCH");
                    NPC_REFRESH(MIL_4044_SALL_Q602);
                };
            };
        };
    };
}

func void DIA_TENGRAL_Q602_CLOSEDGATES_INFO() {
    CREATEINVITEMS(SELF, 0x901b, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x901b, 1);
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_ClosedGates_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_ClosedGates_03_02");
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_TENGRAL_KEY);
    TENGRAL_Q602_CHANGERTN_V3();
}

instance DIA_TENGRAL_Q602_RESULT(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_RESULT_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_RESULT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_RESULT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_TRIMEGISTO_FINISHWAY) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_RESULT_GUIDE() {
    INFO_CLEARCHOICES(0x1604a);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x16053);
}

func void DIA_TENGRAL_Q602_RESULT_SPEECHCITIZEN() {
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_TURNTONPC(SELF, VLK_6300_GROEN_Q602);
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_09");
    DIA_TENGRAL_Q602_RESULT_GUIDE();
}

func void DIA_TENGRAL_Q602_RESULT_SMALLCUTSCENE() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_FUNCTION(SELF, 0x16054);
    AI_TURNTONPC(SELF, VLK_10080_CITIZEN_Q602);
    AI_REMOVEWEAPON(OTHER);
    AI_TURNTONPC(OTHER, VLK_10079_CITIZEN_Q602);
    AI_SETWALKMODE(OTHER, NPC_WALK);
    AI_GOTOWP(OTHER, "PARTM8_PATH_41");
    AI_GOTONPC(SELF, KDF_6404_TRIMEGISTO_Q602);
    AI_PLAYANI(SELF, T_PLUNDER);
    DIA_TENGRAL_Q602_RESULT_SPEECHCITIZEN();
}

func void DIA_TENGRAL_SPEECH_SAD() {
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_04");
}

func void DIA_TENGRAL_Q602_RESULT_INFO() {
    if ((Q602_TRIMEGISTO_FINISHWAY) == (3)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_10");
        INFO_CLEARCHOICES(0x1604a);
        INFO_ADDCHOICE(0x1604a, "Trimegisto burned both himself and the faithful.", 0x16052);
        INFO_ADDCHOICE(0x1604a, "Unfortunately, no.", 0x16051);
    };
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_01");
    if ((Q602_TRIMEGISTO_FINISHWAY) == (2)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_RESULT_15_02");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_RESULT_15_03");
    if ((Q602_TRIMEGISTO_FINISHWAY) == (1)) {
        AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
        DIA_TENGRAL_SPEECH_SAD();
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_05");
        DIA_TENGRAL_Q602_RESULT_SPEECHCITIZEN();
    };
    if ((Q602_TRIMEGISTO_FINISHWAY) == (2)) {
        AI_RESETFACEANI(SELF);
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_06");
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_03_07");
        DIA_TENGRAL_Q602_RESULT_SMALLCUTSCENE();
    };
}

func void DIA_TENGRAL_Q602_RESULT_NO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_RESULT_No_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_No_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_No_03_03");
    DIA_TENGRAL_Q602_RESULT_GUIDE();
}

func void DIA_TENGRAL_Q602_RESULT_YES() {
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_RESULT_Yes_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_Yes_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_RESULT_Yes_15_03");
    DIA_TENGRAL_SPEECH_SAD();
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_Yes_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_RESULT_Yes_03_06");
    DIA_TENGRAL_Q602_RESULT_GUIDE();
}

func void TENGRAL_Q602_CHANGERTN_V4() {
    WLD_SENDUNTRIGGER("Q602_CHURCH_02");
    DIACAM_ENABLE();
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_GUIDE_V3");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_FOLLOW_V2");
            NPC_REFRESH(PAL_101_SILVESTR_Q602);
        };
    };
    if ((Q602_HELPSALL) == (1)) {
        if ((Q602_SALLFLEE) == (0)) {
            if (!(NPC_ISDEAD(MIL_4044_SALL_Q602))) {
                B_STARTOTHERROUTINE(MIL_4044_SALL_Q602, "Q602_FOLLOW_V2");
                NPC_REFRESH(MIL_4044_SALL_Q602);
            };
        };
    };
    if ((Q602_TRIMEGISTO_FINISHWAY) < (3)) {
        Q602_CHANGECITIZENFROMCHURCHRTN();
    };
}

func void TENGRAL_CHURCH_CAMERA_01() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q602_CHURCH_02");
    TELEPORTNPCTOWP(0x71b, "PARTM8_PATH_37");
    TELEPORTNPCTOWP(0xe8f0, "PARTE8_PATH_05");
}

instance DIA_TENGRAL_Q602_WAIT(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_WAIT_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_WAIT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_WAIT_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x1604a))) && ((NPC_GETDISTTOWP(SELF, "PARTM3_PATH_51")) <= (400))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_WAIT_INFO() {
    Q602_HELPSALL = 2;
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Wait_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_FUNCTION(SELF, 0x16058);
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Wait_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Wait_03_03");
    AI_FUNCTION(SELF, 0x1605a);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q602, LOG_Q602_TENGRAL_SHOOT);
}

func void TENGRAL_Q602_SHOOT_CAMERA() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("KM_Q602_SHOOT_01");
    TELEPORTNPCTOWP(0x71b, "PARTE3_SHOOT_HERO");
    TELEPORTNPCTOWP(0xe8f0, "PARTM3_PATH_51");
    AI_TURNTONPC(HERO, KDF_9004_TENGRAL_Q602);
    AI_TURNTONPC(KDF_9004_TENGRAL_Q602, HERO);
}

func void TENGRAL_Q602_SHOOT_CAMERA_DISABLE() {
    WLD_SENDUNTRIGGER("KM_Q602_SHOOT_01");
    DIACAM_ENABLE();
}

func void TENGRAL_Q602_CHANGERTN_V5() {
    WLD_SENDUNTRIGGER("KM_Q602_SHOOT_01");
    DIACAM_ENABLE();
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_WAIT");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_WAIT");
            NPC_REFRESH(PAL_101_SILVESTR_Q602);
        };
    };
    if ((Q602_HELPSALL) >= (1)) {
        if ((Q602_SALLFLEE) == (0)) {
            if (!(NPC_ISDEAD(MIL_4044_SALL_Q602))) {
                B_STARTOTHERROUTINE(MIL_4044_SALL_Q602, "Q602_WAIT");
                NPC_REFRESH(MIL_4044_SALL_Q602);
            };
        };
    };
    if ((Q602_TRIMEGISTO_FINISHWAY) < (3)) {
        Q602_CHANGECITIZENFROMCHURCHRTN_V2();
    };
}

instance DIA_TENGRAL_Q602_GATE(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_GATE_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_GATE_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_TENGRAL_Q602_GATE_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_HELPSALL) == (3))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_GATE_INFO() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_03_01");
    AI_RESETFACEANI(SELF);
    AI_PLAYANI(SELF, T_SEARCH);
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_15_04");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_03_05");
    INFO_CLEARCHOICES(0x1605b);
    if (NPC_KNOWSINFO(OTHER, 0x161a1)) {
        INFO_ADDCHOICE(0x1605b, "Lennart hid in the quarters along with several guards.", 0x16060);
    };
    INFO_ADDCHOICE(0x1605b, "Not yet.", 0x1605e);
}

func void DIA_TENGRAL_Q602_GATE_NO() {
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_No_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_No_03_02");
    INFO_CLEARCHOICES(0x1605b);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q602_BARRACK_SEARCH");
    AI_FUNCTION(SELF, 0x16067);
}

var int TENGRAL_Q602_LENNART = 0;
func void DIA_TENGRAL_Q602_GATE_LENNART() {
    TENGRAL_Q602_LENNART = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_Lennart_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Lennart_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Lennart_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_Lennart_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Lennart_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Lennart_03_06");
    INFO_CLEARCHOICES(0x1605b);
    INFO_ADDCHOICE(0x1605b, "You take care of the wounded, I'll clear the way.", 0x16063);
    INFO_ADDCHOICE(0x1605b, "I have some matter to attend...", 0x16062);
    INFO_CLEARCHOICES(0x16064);
    INFO_ADDCHOICE(0x16064, "You take care of the wounded, I'll clear the way.", 0x16063);
    INFO_ADDCHOICE(0x16064, "I have some matter to attend...", 0x16062);
}

func void DIA_TENGRAL_Q602_GOBARRACK() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(0x1605b);
    INFO_CLEARCHOICES(0x16064);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 0x16068);
}

func void DIA_TENGRAL_Q602_GATE_LENNART_NOWAY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_NoWay_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_NoWay_03_02");
    };
    if ((MARVIN_LOSTGUILDMILITA) == (TRUE)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_NoWay_03_03");
    };
    if (((HERO.GUILD) == (GIL_SLD)) || ((MARVIN_LOSTGUILDARAXOS) == (TRUE))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_NoWay_03_04");
    };
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_NoWay_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_NoWay_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_NoWay_03_07");
    DIA_TENGRAL_Q602_GOBARRACK();
}

func void DIA_TENGRAL_Q602_GATE_LENNART_LATER() {
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_Later_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Later_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Tengral_Q602_Gate_Later_15_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Tengral_Q602_Gate_Later_03_04");
    DIA_TENGRAL_Q602_GOBARRACK();
}

instance DIA_TENGRAL_Q602_FOUNDLENNART(C_INFO) {
    NPC = 0xe8f0;
    NR = 1;
    CONDITION = DIA_TENGRAL_Q602_FOUNDLENNART_CONDITION;
    INFORMATION = DIA_TENGRAL_Q602_FOUNDLENNART_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Lennart hid in the quarters along with several guards.";
}

func int DIA_TENGRAL_Q602_FOUNDLENNART_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x1605b))) && (NPC_KNOWSINFO(OTHER, 0x161a1))) && ((TENGRAL_Q602_LENNART) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_TENGRAL_Q602_FOUNDLENNART_INFO() {
    DIA_TENGRAL_Q602_GATE_LENNART();
}

func void TENGRAL_Q602_CHANGERTN_V6() {
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_BARRACK_WAIT");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_BARRACK_WAIT");
            NPC_REFRESH(PAL_101_SILVESTR_Q602);
        };
    };
    if ((Q602_HELPSALL) >= (1)) {
        if ((Q602_SALLFLEE) == (0)) {
            if (HLP_ISVALIDNPC(MIL_4044_SALL_Q602)) {
                if (!(NPC_ISDEAD(MIL_4044_SALL_Q602))) {
                    B_STARTOTHERROUTINE(MIL_4044_SALL_Q602, "Q602_BARRACK_WAIT");
                    NPC_REFRESH(MIL_4044_SALL_Q602);
                };
            };
        };
    };
    if ((Q602_TRIMEGISTO_FINISHWAY) < (3)) {
        Q602_CHANGECITIZENFROMCHURCHRTN_V3();
    };
}

func void TENGRAL_Q602_CHANGERTN_V7() {
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL_Q602, "Q602_BARRACK");
    if (HLP_ISVALIDNPC(PAL_101_SILVESTR_Q602)) {
        if (!(NPC_ISDEAD(PAL_101_SILVESTR_Q602))) {
            B_STARTOTHERROUTINE(PAL_101_SILVESTR_Q602, "Q602_BARRACK");
            NPC_REFRESH(PAL_101_SILVESTR_Q602);
        };
    };
    if ((Q602_HELPSALL) >= (1)) {
        if ((Q602_SALLFLEE) == (0)) {
            if (HLP_ISVALIDNPC(MIL_4044_SALL_Q602)) {
                if (!(NPC_ISDEAD(MIL_4044_SALL_Q602))) {
                    B_STARTOTHERROUTINE(MIL_4044_SALL_Q602, "Q602_BARRACK");
                    NPC_REFRESH(MIL_4044_SALL_Q602);
                };
            };
        };
    };
    if ((Q602_TRIMEGISTO_FINISHWAY) < (3)) {
        Q602_CHANGECITIZENFROMCHURCHRTN_V4();
    };
}

