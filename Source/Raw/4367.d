instance DIA_CARAMON_Q602_EXIT(C_INFO) {
    NPC = 0xea62;
    NR = 999;
    CONDITION = DIA_CARAMON_Q602_EXIT_CONDITION;
    INFORMATION = DIA_CARAMON_Q602_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_CARAMON_Q602_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_CARAMON_Q602_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_CARAMON_Q602_DEAD(C_INFO) {
    NPC = 0xea62;
    NR = 1;
    CONDITION = DIA_CARAMON_Q602_DEAD_CONDITION;
    INFORMATION = DIA_CARAMON_Q602_DEAD_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_CARAMON_Q602_DEAD_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q602)) == (LOG_RUNNING)) && ((Q602_CARAMONCUTSCENE_ENABLE) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_CARAMON_Q602_DEAD_INFO() {
    FINALBOARDS_CARAMONISDEAD = TRUE;
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_STARTFACEANI(OTHER, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_03_02");
    INFO_CLEARCHOICES(0x16213);
    INFO_ADDCHOICE(0x16213, DIALOG_BESILENT, 0x16217);
    INFO_ADDCHOICE(0x16213, "Caramon, you were a wonderful companion...", 0x16218);
    if (((((NPC_HASITEMS(OTHER, 0x838e)) >= (1)) || ((NPC_HASITEMS(OTHER, 0x8630)) >= (1))) || ((NPC_HASITEMS(OTHER, 0x8632)) >= (1))) || ((NPC_HASITEMS(OTHER, 0x8635)) >= (1))) {
        INFO_ADDCHOICE(0x16213, "It's going to be okay, I have healing potions with me...", 0x16219);
    };
}

func void DIA_CARAMON_Q602_DEAD_NEXT() {
    AI_WAITTILLEND(SELF, OTHER);
    AI_FUNCTION(SELF, 0x1621c);
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_Next_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_Next_03_02");
    CREATEINVITEMS(SELF, 0x92f9, 1);
    B_GIVEINVITEMS(SELF, OTHER, 0x92f9, 1);
    AI_FUNCTION(SELF, 0x1621d);
    AI_WAITTILLEND(OTHER, SELF);
    AI_RESETFACEANI(OTHER);
    AI_PLAYANIBS(SLD_1009_CARAMON_Q602, "T_STAND_2_PRAY", BS_SIT);
    INFO_CLEARCHOICES(0x16213);
    AI_STOPPROCESSINFOS(SELF);
    AI_STOPPROCESSINFOS(HERO);
}

func void DIA_CARAMON_Q602_DEAD_SILENCE() {
    DIA_CARAMON_Q602_DEAD_NEXT();
}

func void DIA_CARAMON_Q602_DEAD_GOODBYE() {
    AI_FUNCTION(SELF, 0x1621a);
    AI_OUTPUT(OTHER, SELF, "DIA_Caramon_Q602_Dead_Goodbye_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_FUNCTION(SELF, 0x1621b);
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_Goodbye_03_02");
    DIA_CARAMON_Q602_DEAD_NEXT();
}

func void DIA_CARAMON_Q602_DEAD_POTIONS() {
    AI_FUNCTION(SELF, 0x1621a);
    AI_OUTPUT(OTHER, SELF, "DIA_Caramon_Q602_Dead_Potions_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_FUNCTION(SELF, 0x1621b);
    AI_OUTPUT(SELF, OTHER, "DIA_Caramon_Q602_Dead_Potions_03_02");
    DIA_CARAMON_Q602_DEAD_NEXT();
}

func void CARAMON_Q602_CHANGECAMERA_01() {
    WLD_SENDTRIGGER("KM_Q602_CARAMON_03");
    WLD_SENDUNTRIGGER("KM_Q602_CARAMON_02");
}

func void CARAMON_Q602_CHANGECAMERA_02() {
    WLD_SENDTRIGGER("KM_Q602_CARAMON_04");
    WLD_SENDUNTRIGGER("KM_Q602_CARAMON_03");
}

func void CARAMON_Q602_CHANGECAMERA_03() {
    WLD_SENDTRIGGER("KM_Q602_CARAMON_05");
    WLD_SENDUNTRIGGER("KM_Q602_CARAMON_02");
    WLD_SENDUNTRIGGER("KM_Q602_CARAMON_04");
}

func void CARAMON_Q602_CHANGECAMERA_END() {
    DIACAM_ENABLE();
    FADESCREENTOBLACKF(1, 0x1621e, 1000);
}

func void CARAMON_Q602_CHANGECAMERA_END_FADESCREEN() {
    WLD_SENDUNTRIGGER("KM_Q602_CARAMON_05");
    B_REMOVENPC(0xea62);
    Q602_CARAMONBODY();
    FADESCREENFROMBLACK(3);
    B_LOGENTRY(TOPIC_Q602, LOG_Q602_CARAMON_DEAD);
    HERO.AIVAR[4] = FALSE;
}

