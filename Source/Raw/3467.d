func void Q207_PREPARESCENE() {
    FF_APPLYONCEEXTGT(0xf343, 0, -(1));
    B_STARTOTHERROUTINE(BAU_726_RIK, "FARM");
    B_STARTOTHERROUTINE(BAU_2310_FARMER, TOT);
    B_STARTOTHERROUTINE(BAU_900_GASPAR, START);
    B_STARTOTHERROUTINE(BAU_2272_FARMER, START);
    REMOVEHODINSERTORC();
    WLD_INSERTITEM(0x911b, "FP_PART15_WITHOUTTRACE_WINECHEST_01");
    WLD_INSERTITEM(0x911b, "FP_PART15_WITHOUTTRACE_WINECHEST_02");
}

func void Q207_CHESTSMOVER() {
    if ((Q207_CHESTSMOVER_COLLISION) == (0)) {
        PRINTD("Rozpoczynam - Q207_ChestsMover");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("KM_VINEYARD_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("WITHOUTRACE_VINEYARD_CHEST_01", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("KM_VINEYARD_01");
        Q207_CHESTSMOVER_COLLISION = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - Q207_ChestsMover");
        CHANGEVOBCOLLISION("WITHOUTRACE_VINEYARD_CHEST_01", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(0xf343);
        Q207_CHESTSMOVER_COLLISION = 0;
    };
}

var int Q207_CHESTSMOVER.Q207_CHESTSMOVER_COLLISION = 0;
instance Q207_CHESTSMOVER.MOVER1(ZCMOVER)
var int Q207_CHESTSMOVER.MOVPTR1 = 0;
func int C_Q207_GOTSOBER(var C_NPC NPC) {
    if ((((NPC_HASITEMS(NPC, 0x8e25)) >= (1)) || ((NPC_HASITEMS(NPC, 0x84be)) >= (1))) || ((NPC_HASITEMS(NPC, 0x84c6)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void B_Q207_GIVESOBER_USEIT() {
    AI_STOPLOOKAT(SELF);
    if ((NPC_HASITEMS(OTHER, 0x8e25)) >= (1)) {
        B_GIVEINVITEMS(OTHER, SELF, 0x8e25, 1);
        AI_USEITEM(SELF, 0x8e25);
    };
    if ((NPC_HASITEMS(OTHER, 0x84be)) >= (1)) {
        B_GIVEINVITEMS(OTHER, SELF, 0x84be, 1);
        AI_USEITEM(SELF, 0x84be);
    };
    if ((NPC_HASITEMS(OTHER, 0x84c6)) >= (1)) {
        B_GIVEINVITEMS(OTHER, SELF, 0x84c6, 1);
        AI_USEITEM(SELF, 0x84c6);
    };
}

func void Q207_SPAWNGOBBO() {
    PRINTD("Gobliny + bandyci stworzone!");
    WLD_INSERTNPC(0xc53b, "FP_ROAM_PART15_220");
    WLD_INSERTNPC(0xc53b, "FP_ROAM_PART15_245");
    WLD_INSERTNPC(0xc53b, "FP_ROAM_PART15_246");
    WLD_INSERTNPC(0xc3fb, "FP_ROAM_PART15_248");
    WLD_INSERTNPC(0xc3fb, "FP_ROAM_PART15_247");
    WLD_INSERTNPC(0xe2b4, "PART15_PATH_226");
    WLD_INSERTNPC(0xe25b, "PART15_PATH_227");
    WLD_INSERTNPC(0xe264, "PART15_PATH_228");
}

func void Q207_TELEPORTBANDITS() {
    PRINTD("Bandyci tepnieci!");
    B_STARTOTHERROUTINE(BDT_6288_MYRMIDON, START);
    TELEPORTNPCTOWP(0xe2b4, BDT_6288_MYRMIDON.WP);
    B_STARTOTHERROUTINE(BDT_6289_VILLAN, START);
    TELEPORTNPCTOWP(0xe25b, BDT_6289_VILLAN.WP);
    B_STARTOTHERROUTINE(BDT_6290_BANDIT, START);
    TELEPORTNPCTOWP(0xe264, BDT_6290_BANDIT.WP);
}

func void Q207_MOVEBANDITS() {
    PRINTD("Bandyci ruszyli!");
    B_STARTOTHERROUTINE(BDT_6288_MYRMIDON, CUTSCENERTN);
    B_STARTOTHERROUTINE(BDT_6289_VILLAN, CUTSCENERTN);
    B_STARTOTHERROUTINE(BDT_6290_BANDIT, CUTSCENERTN);
}

func void Q207_REMOVEMONSTERS() {
    if ((NPC_ISDEAD(GOBBO_Q207_01)) == (FALSE)) {
        B_REMOVENPC(0xc53e);
    };
    if ((NPC_ISDEAD(GOBBO_Q207_02)) == (FALSE)) {
        B_REMOVENPC(0xc53f);
    };
    if ((NPC_ISDEAD(GOBBO_Q207_03)) == (FALSE)) {
        B_REMOVENPC(0xc540);
    };
    if ((NPC_ISDEAD(GOBBO_Q207_04)) == (FALSE)) {
        B_REMOVENPC(0xc541);
    };
    if ((NPC_ISDEAD(GOBBO_Q207_05)) == (FALSE)) {
        B_REMOVENPC(0xc542);
    };
    if ((NPC_ISDEAD(BEAR_Q207)) == (FALSE)) {
        B_REMOVENPC(0xc490);
    };
    if ((NPC_ISDEAD(WOLF_Q207_01)) == (FALSE)) {
        B_REMOVENPC(0xc79f);
    };
    if ((NPC_ISDEAD(WOLF_Q207_02)) == (FALSE)) {
        B_REMOVENPC(0xc7a0);
    };
}

