instance Q406_CROSSBOW_SECOND(CUTSCENE) {
    ONSTART = FUNCTION(0x169e5);
}

func void Q406_CROSSBOW_SECOND_START() {
    WLD_SENDTRIGGER("KM_CROSSBOW_02");
    TELEPORTNPCTOWP(0xde07, NONE_6445_VOLKERGUARD.WP);
    TELEPORTNPCTOWP(0xde20, NONE_6452_VOLKERGUARD_CROSSBOW.WP);
    TELEPORTNPCTOWP(0xde25, NONE_6453_VOLKERGUARD_CROSSBOW.WP);
    TELEPORTNPCTOWP(0x71b, "PART9_PATH_86");
    TELEPORTNPCTOWP(0xdd70, "PART9_PATH_85");
    NPC_CLEARAIQUEUE(NONE_6445_VOLKERGUARD);
    NPC_CLEARAIQUEUE(NONE_6452_VOLKERGUARD_CROSSBOW);
    NPC_CLEARAIQUEUE(NONE_6453_VOLKERGUARD_CROSSBOW);
    AI_TURNTONPC(NONE_6445_VOLKERGUARD, HERO);
    AI_TURNTONPC(NONE_6452_VOLKERGUARD_CROSSBOW, HERO);
    AI_TURNTONPC(NONE_6453_VOLKERGUARD_CROSSBOW, HERO);
    AI_WAITTILLEND(HERO, NONE_6445_VOLKERGUARD);
    AI_WAITTILLEND(HERO, NONE_6452_VOLKERGUARD_CROSSBOW);
    AI_WAITTILLEND(HERO, NONE_6453_VOLKERGUARD_CROSSBOW);
    AI_FUNCTION(HERO, 0x169e6);
}

func void Q406_CROSSBOW_SECOND_END() {
    FF_APPLYONCEEXT(0x169e7, 1000, 4);
}

func void Q406_CROSSBOW_SECOND_APPLY() {
    Q406_CROSSBOW_SECOND_COUNT = (Q406_CROSSBOW_SECOND_COUNT) + (1);
    if ((Q406_CROSSBOW_SECOND_COUNT) == (1)) {
        NPC_CLEARAIQUEUE(NONE_202_KESSEL);
        B_SAY(NONE_202_KESSEL, HERO, "$Q406_KESSEL_RUNAWAY_V2");
        B_STARTOTHERROUTINE(NONE_6452_VOLKERGUARD_CROSSBOW, "AIM");
        NPC_REFRESH(NONE_6452_VOLKERGUARD_CROSSBOW);
        B_STARTOTHERROUTINE(NONE_6453_VOLKERGUARD_CROSSBOW, "AIM");
        NPC_REFRESH(NONE_6453_VOLKERGUARD_CROSSBOW);
    };
    if ((Q406_CROSSBOW_SECOND_COUNT) == (2)) {
        B_STARTOTHERROUTINE(NONE_6445_VOLKERGUARD, "AIM");
        NPC_REFRESH(NONE_6445_VOLKERGUARD);
    };
    if ((Q406_CROSSBOW_SECOND_COUNT) == (3)) {
        AI_PLAYANI(NONE_6452_VOLKERGUARD_CROSSBOW, "T_CROSSBOW_SHOOT");
    };
    if ((Q406_CROSSBOW_SECOND_COUNT) == (4)) {
        AI_PLAYANI(NONE_6453_VOLKERGUARD_CROSSBOW, "T_CROSSBOW_SHOOT");
        WLD_SENDUNTRIGGER("KM_CROSSBOW_02");
        HERO.AIVAR[4] = FALSE;
        B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q406_HOUSEFLEE3");
        Q406_KESSEL_RTNCHECK = 6;
        NPC_REFRESH(NONE_202_KESSEL);
    };
}

var int Q406_CROSSBOW_SECOND_APPLY.Q406_CROSSBOW_SECOND_COUNT = 0;
