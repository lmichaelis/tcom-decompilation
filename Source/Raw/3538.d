func void Q502_BEGINNING() {
    HERO.AIVAR[4] = TRUE;
    FF_APPLYONCEEXT(0xf7b8, 75, 4);
}

func void Q502_BEGINNING_APPLY() {
    Q502_BEGINNING_COUNT = (Q502_BEGINNING_COUNT) + (1);
    if ((Q502_BEGINNING_COUNT) == (4)) {
        CUTSCENE_START(0x169f3);
    };
}

var int Q502_BEGINNING_APPLY.Q502_BEGINNING_COUNT = 0;
func void Q502_BEGINNINGCUTSCENE_END() {
    FF_APPLYONCEEXT(0xf7bb, 75, 4);
}

func void Q502_BEGINNINGCUTSCENE_END_APPLY() {
    Q502_BEGINNINGCUTSCENE_END_COUNT = (Q502_BEGINNINGCUTSCENE_END_COUNT) + (1);
    if ((Q502_BEGINNINGCUTSCENE_END_COUNT) == (4)) {
        WLD_SENDUNTRIGGER("Q501_NOVIZE_01");
        WLD_SENDUNTRIGGER("Q501_NOVIZE_02");
        NOV_13690_NOVIZE.AIVAR[92] = FALSE;
        NONE_100008_ANA.AIVAR[92] = FALSE;
        B_STARTOTHERROUTINE(NOV_13690_NOVIZE, "Q502_GUIDE_TOWER");
        NPC_REFRESH(NOV_13690_NOVIZE);
        NOV_13690_NOVIZE.AIVAR[15] = TRUE;
        B_STARTOTHERROUTINE(NOV_228_NOVIZE, "Q502_GUIDE_TOWER");
        NPC_REFRESH(NOV_228_NOVIZE);
        NOV_228_NOVIZE.AIVAR[15] = TRUE;
        B_STARTOTHERROUTINE(NONE_100008_ANA, "MONASTERY");
        NPC_REFRESH(NONE_100008_ANA);
        LOG_CREATETOPIC(TOPIC_Q502, LOG_MISSION);
        LOG_SETSTATUS(_@(MIS_Q502), TOPIC_Q502, LOG_RUNNING);
        B_LOGENTRY(TOPIC_Q502, LOG_Q502_START);
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q502_BEGINNINGCUTSCENE_END_APPLY.Q502_BEGINNINGCUTSCENE_END_COUNT = 0;
func void Q502_KESSELGUIDE() {
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q502_GUIDE");
    Q502_KESSEL_RTNCHECK = 3;
    NPC_REFRESH(NONE_202_KESSEL);
}

func void Q502_PREPARENPCV2() {
    NPC_EXCHANGEROUTINE(KDW_216_INGOLF, "NORMALDAY");
    NPC_EXCHANGEROUTINE(KDW_214_BADULF, START);
    NPC_EXCHANGEROUTINE(KDW_301_CUSTO, START);
}

func void Q502_PREPARENPCV3() {
    TELEPORTNPCTOWP(0xdd5d, "PART8_MONASTERY_PLACE_03");
    TELEPORTNPCTOWP(0xdd1f, "PART8_MONASTERY_PLACE_08");
    TELEPORTNPCTOWP(0xdd70, "PART8_MONASTERY_PLACE_09");
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q502_SMALLTALK");
    Q502_KESSEL_RTNCHECK = 4;
    NPC_REFRESH(NONE_202_KESSEL);
    B_STARTOTHERROUTINE(KDW_200_PRIOR, START);
    NPC_REFRESH(KDW_200_PRIOR);
    B_STARTOTHERROUTINE(KDW_215_NOTGER, START);
    NPC_REFRESH(KDW_215_NOTGER);
}

func void Q502_PREPARENPCV4() {
    PRINTD("Teleportacja");
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q503TRIALOG");
    Q503_KESSEL_RTNCHECK = 2;
    NPC_REFRESH(NONE_202_KESSEL);
    TELEPORTNPCTOWP(0xdd70, NONE_202_KESSEL.WP);
    NONE_202_KESSEL.AIVAR[15] = TRUE;
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q503TRIALOG");
    NPC_REFRESH(KDW_203_RIORDIAN);
    TELEPORTNPCTOWP(0xdd28, KDW_203_RIORDIAN.WP);
    KDW_203_RIORDIAN.AIVAR[15] = TRUE;
    if ((NPC_ISDEAD(HARPIE_BLACK_Q503_01)) == (FALSE)) {
        B_REMOVENPC(0xc570);
    };
    if ((NPC_ISDEAD(HARPIE_BLACK_Q503_02)) == (FALSE)) {
        B_REMOVENPC(0xc571);
    };
    WLD_INSERTNPC(0xeaf9, "PART5_Q503_MANHUNTER_01");
    WLD_INSERTNPC(0xeaf5, "PART5_Q503_MANHUNTER_02");
    WLD_INSERTNPC(0xeaf7, "PART5_Q503_MANHUNTER_03");
}

func void Q502_PREPARENPCV5() {
    B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q503TRIALOG");
    Q503_KESSEL_RTNCHECK = 2;
    NPC_REFRESH(NONE_202_KESSEL);
    B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q503TRIALOG");
    NPC_REFRESH(KDW_203_RIORDIAN);
}

func void Q502_MONASTERYTRIALOG() {
    Q502_MONASTERYTRIALOGCAMERA = (Q502_MONASTERYTRIALOGCAMERA) + (1);
    if ((Q502_MONASTERYTRIALOGCAMERA) == (1)) {
        TELEPORTNPCTOWP(0xdd28, "PART8_MONASTERY_66");
        PRINTD("Teleport");
    };
    if ((Q502_MONASTERYTRIALOGCAMERA) == (2)) {
        B_STARTOTHERROUTINE(KDW_203_RIORDIAN, "Q502SMALLTALK");
        NPC_REFRESH(KDW_203_RIORDIAN);
        PRINTD("Idzie Riordian");
        TELEPORTNPCTOWP(0x71b, "PART8_MONASTERY_TRIALOG_HERO");
        TELEPORTNPCTOWP(0xdd70, "PART8_MONASTERY_TRIALOG_KESSEL");
        TELEPORTNPCTOWP(0xdd5d, "PART8_MONASTERY_PLACE_05");
        TELEPORTNPCTOWP(0xdd1f, "PART8_MONASTERY_PLACE_10");
    };
    if ((Q502_MONASTERYTRIALOGCAMERA) == (3)) {
        AI_TURNTONPC(HERO, KDW_200_PRIOR);
        AI_TURNTONPC(NONE_202_KESSEL, KDW_215_NOTGER);
        AI_TURNTONPC(KDW_215_NOTGER, NONE_202_KESSEL);
        AI_TURNTONPC(KDW_200_PRIOR, HERO);
        PRINTD("Obórt");
    };
}

var int Q502_MONASTERYTRIALOG.Q502_MONASTERYTRIALOGCAMERA = 0;
func void Q502_STARTTRIALOG_APPLY() {
    Q502_STARTTRIALOG_COUNT = (Q502_STARTTRIALOG_COUNT) + (1);
    if ((Q502_STARTTRIALOG_COUNT) == (2)) {
        DIACAM_DISABLE();
        WLD_SENDTRIGGER("KM_P8_CHURCHTRIALOG_01");
        TELEPORTNPCTOWP(0x71b, "PART8_CHURCH_STAND_HERO");
        TELEPORTNPCTOWP(0xdd70, "PART8_CHURCH_STAND_10");
        TELEPORTNPCTOWP(0xdd1f, KDW_200_PRIOR.WP);
        TELEPORTNPCTOWP(0xdd5d, KDW_215_NOTGER.WP);
        TELEPORTNPCTOWP(0xdd64, KDW_216_INGOLF.WP);
        TELEPORTNPCTOWP(0xdd58, KDW_214_BADULF.WP);
        TELEPORTNPCTOWP(0xdd24, KDW_301_CUSTO.WP);
        AI_WAIT(HERO, 0x40000000);
        AI_TURNTONPC(KDW_200_PRIOR, HERO);
        AI_TURNTONPC(KDW_215_NOTGER, HERO);
        AI_TURNTONPC(KDW_216_INGOLF, HERO);
        AI_TURNTONPC(KDW_214_BADULF, HERO);
        AI_TURNTONPC(KDW_301_CUSTO, HERO);
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q502_STARTTRIALOG_APPLY.Q502_STARTTRIALOG_COUNT = 0;
func void Q502_QUITTRIALOG_APPLY() {
    Q502_QUITTRIALOG_COUNT = (Q502_QUITTRIALOG_COUNT) + (1);
    if ((Q502_QUITTRIALOG_COUNT) == (2)) {
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_10");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_09");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_08");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_07");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_06");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_05");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_04");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_03");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_02");
        WLD_SENDUNTRIGGER("KM_P8_MONASTERYTRIALOG_01");
        Q502_PREPARENPCV3();
        HERO.AIVAR[4] = FALSE;
    };
}

var int Q502_QUITTRIALOG_APPLY.Q502_QUITTRIALOG_COUNT = 0;
