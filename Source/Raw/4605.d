instance Q602_TRIMEGISTO(CUTSCENE) {
    ONSTART = FUNCTION(0x16a56);
}

func void Q602_TRIMEGISTO_STANDUP() {
    B_STARTOTHERROUTINE(VLK_10076_CITIZEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_10076_CITIZEN_Q602);
    B_STARTOTHERROUTINE(VLK_6300_GROEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_6300_GROEN_Q602);
    B_STARTOTHERROUTINE(VLK_10079_CITIZEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_10079_CITIZEN_Q602);
    B_STARTOTHERROUTINE(VLK_10077_CITIZEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_10077_CITIZEN_Q602);
    B_STARTOTHERROUTINE(VLK_10078_CITIZEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_10078_CITIZEN_Q602);
    B_STARTOTHERROUTINE(VLK_10080_CITIZEN_Q602, "Q602_STANDUP");
    NPC_REFRESH(VLK_10080_CITIZEN_Q602);
}

func void Q602_TRIMEGISTO_KILLNPC() {
    B_KILLNPC(0xea88);
    B_KILLNPC(0xeadf);
    B_KILLNPC(0xeaa0);
    B_KILLNPC(0xea90);
    B_KILLNPC(0xea98);
    B_KILLNPC(0xeaa8);
}

func void Q602_TRIMEGISTO_START() {
    TELEPORTNPCTOWP(0xe8ed, "PARTM8_PATH_PREACH");
    if ((Q602_TRIMEGISTO_CUTSCENEENABLE) == (2)) {
        TELEPORTNPCTOWP(0x71b, "PARTM8_BENCH_01");
    };
    Q602_TRIMEGISTO_STANDUP();
    CREATEINVITEMS(KDF_6404_TRIMEGISTO_Q602, 0x9529, 1);
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q602_CHURCH_01");
    AI_TURNTONPC(KDF_6404_TRIMEGISTO_Q602, VLK_6300_GROEN_Q602);
    B_READYSPELL(KDF_6404_TRIMEGISTO_Q602, SPL_FIREWAVE, SPL_COST_FIREWAVE);
    AI_PLAYANI(KDF_6404_TRIMEGISTO_Q602, "T_TRIMEGISTO_SPELL");
    AI_FUNCTION(KDF_6404_TRIMEGISTO_Q602, 0x16a57);
}

func void Q602_TRIMEGISTO_END() {
    Q602_TRIMEGISTO_FINISHWAY = 3;
    FF_APPLYONCEEXT(0x16a59, 500, 4);
    WLD_SENDUNTRIGGER("Q602_CHURCH_01");
    DIACAM_ENABLE();
    WLD_PLAYEFFECT("FX_FireWave", KDF_6404_TRIMEGISTO_Q602, KDF_6404_TRIMEGISTO_Q602, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("FX_FireRain", KDF_6404_TRIMEGISTO_Q602, KDF_6404_TRIMEGISTO_Q602, 0, 0, 0, FALSE);
    WLD_PLAYEFFECT("FX_EarthQuake", KDF_6404_TRIMEGISTO_Q602, KDF_6404_TRIMEGISTO_Q602, 0, 0, 0, FALSE);
    Q602_TRIMEGISTO_KILLNPC();
    if ((Q602_TRIMEGISTO_CUTSCENEENABLE) == (2)) {
        if ((HERO.ATTRIBUTE[0]) > ((FIRERAINDAMAGE) + (2))) {
            HERO.ATTRIBUTE[0] -= FIRERAINDAMAGE;
        } else {
            HERO.ATTRIBUTE[0] = 2;
        };
    };
    HERO.AIVAR[4] = FALSE;
}

const int Q602_TRIMEGISTO_END.FIRERAINDAMAGE = 500;
func void Q602_TRIMEGISTO_KILLYOURSELF() {
    Q602_TRIMEGISTO_KILLYOURSELF_COUNT = (Q602_TRIMEGISTO_KILLYOURSELF_COUNT) + (1);
    if ((Q602_TRIMEGISTO_KILLYOURSELF_COUNT) == (1)) {
        AI_PLAYANI(KDF_6404_TRIMEGISTO_Q602, "T_DEADB");
    };
    if ((Q602_TRIMEGISTO_KILLYOURSELF_COUNT) == (4)) {
        B_KILLNPC(0xe8ed);
    };
}

var int Q602_TRIMEGISTO_KILLYOURSELF.Q602_TRIMEGISTO_KILLYOURSELF_COUNT = 0;
