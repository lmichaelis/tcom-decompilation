instance Q306_THIRDROUND(CUTSCENE) {
    ONSTART = FUNCTION(0x1696e);
}

func void Q306_THIRDROUND_WAIT() {
    AI_WAITTILLEND(PIR_1307_PROXIMO, HERO);
    AI_WAITTILLEND(PIR_1307_PROXIMO, NONE_1331_ORCSLAVE);
    AI_WAITTILLEND(NONE_1331_ORCSLAVE, HERO);
    AI_WAITTILLEND(NONE_1331_ORCSLAVE, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, NONE_1331_ORCSLAVE);
}

func void Q306_THIRDROUND_START() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q306_ARENACROWD");
    WLD_SENDTRIGGER("KM_ARENAFIGHT_4_01");
    NPC_CLEARAIQUEUE(PIR_1307_PROXIMO);
    NPC_CLEARAIQUEUE(NONE_1331_ORCSLAVE);
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
    TELEPORTNPCTOWP(0xeb9c, NONE_1331_ORCSLAVE.WP);
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_INSIDE_08");
    PIR_1307_PROXIMO.AIVAR[92] = TRUE;
    AI_SETWALKMODE(NONE_1331_ORCSLAVE, NPC_WALK);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_TURNTONPC(PIR_1307_PROXIMO, PIR_1306_RODRIGO);
    Q306_THIRDROUND_WAIT();
    AI_WAIT(PIR_1307_PROXIMO, 0x3e4ccccd);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeRound3_13_01");
    Q306_THIRDROUND_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x1696f);
    AI_PLAYANI(HERO, "R_STRETCH_RANDOM_01");
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_GOTOWP(HERO, "P17_HAVEN_ARENA_PLAYER_02");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeRound3_13_02");
    Q306_THIRDROUND_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16970);
    AI_LOOKATNPC(HERO, NONE_1331_ORCSLAVE);
    AI_SETWALKMODE(NONE_1331_ORCSLAVE, NPC_WALK);
    AI_GOTOWP(NONE_1331_ORCSLAVE, "P17_HAVEN_ARENA_OPPONENT_02");
    NONE_1331_ORCSLAVE.WP = "P17_HAVEN_ARENA_OPPONENT_02";
    NONE_1331_ORCSLAVE.SPAWNPOINT = "P17_HAVEN_ARENA_OPPONENT_02";
    Q306_THIRDROUND_WAIT();
    AI_FUNCTION(NONE_1331_ORCSLAVE, 0x16971);
}

func void Q306_THIRDROUND_CAMERACHANGE_01() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_4_02");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_4_01");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_PLAYER_01");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_INSIDE_08");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
}

func void Q306_THIRDROUND_CAMERACHANGE_02() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_4_03");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_4_02");
    TELEPORTNPCTOWP(0xeb9c, "P17_HAVEN_ARENA_INSIDE_14");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_PLAYER_02");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
}

func void Q306_THIRDROUND_END() {
    PRINTD("Walka z Orkiem");
    Q306_STATE = 18;
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    NPC_REFRESH(PIR_1307_PROXIMO);
    NPC_REFRESH(NONE_1331_ORCSLAVE);
    NPC_CLEARAIQUEUE(HERO);
    PIR_1307_PROXIMO.AIVAR[92] = FALSE;
    AI_STOPLOOKAT(HERO);
    HERO.AIVAR[4] = FALSE;
}

