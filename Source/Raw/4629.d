instance SQ225_HOLDWIGWAY_FINISH(CUTSCENE) {
    ONSTART = FUNCTION(0x16aef);
}

func void SQ225_HOLDWIGWAY_FINISH_WAIT() {
    AI_WAITTILLEND(HERO, BAU_11182_FARMER);
    AI_WAITTILLEND(HERO, BAU_2265_FARMER);
    AI_WAITTILLEND(HERO, BAU_2267_FARMER);
    AI_WAITTILLEND(HERO, BAU_2245_HOLDWIG);
    AI_WAITTILLEND(BAU_11182_FARMER, HERO);
    AI_WAITTILLEND(BAU_11182_FARMER, BAU_2265_FARMER);
    AI_WAITTILLEND(BAU_11182_FARMER, BAU_2267_FARMER);
    AI_WAITTILLEND(BAU_11182_FARMER, BAU_2245_HOLDWIG);
    AI_WAITTILLEND(BAU_2267_FARMER, HERO);
    AI_WAITTILLEND(BAU_2267_FARMER, BAU_2265_FARMER);
    AI_WAITTILLEND(BAU_2267_FARMER, BAU_11182_FARMER);
    AI_WAITTILLEND(BAU_2267_FARMER, BAU_2245_HOLDWIG);
    AI_WAITTILLEND(BAU_2265_FARMER, HERO);
    AI_WAITTILLEND(BAU_2265_FARMER, BAU_2267_FARMER);
    AI_WAITTILLEND(BAU_2265_FARMER, BAU_11182_FARMER);
    AI_WAITTILLEND(BAU_2265_FARMER, BAU_2245_HOLDWIG);
    AI_WAITTILLEND(BAU_2245_HOLDWIG, BAU_11182_FARMER);
    AI_WAITTILLEND(BAU_2245_HOLDWIG, BAU_2265_FARMER);
    AI_WAITTILLEND(BAU_2245_HOLDWIG, BAU_2267_FARMER);
    AI_WAITTILLEND(BAU_2245_HOLDWIG, HERO);
}

func void SQ225_HOLDWIGWAY_FINISH_START() {
    WLD_SENDTRIGGER("KM_SQ225_ANDERASFINISH_01");
    MDL_APPLYOVERLAYMDS(BAU_2245_HOLDWIG, "HumanS_Leader.mds");
    TELEPORTNPCTOWP(0x71b, "PART9_SQ225_CUTSCENE_HERO");
    TELEPORTNPCTOWP(0xdef2, "PART9_SQ225_CUTSCENE_GERHARD");
    TELEPORTNPCTOWP(0xdefe, "PART9_SQ225_CUTSCENE_HOLDWIG_DOWN");
    TELEPORTNPCTOWP(0xdea9, "PART9_SQ225_CUTSCENE_FARMER_01");
    TELEPORTNPCTOWP(0xdeb5, "PART9_SQ225_CUTSCENE_FARMER_02");
    TELEPORTNPCTOWP(0xde2d, "PART9_VINEYARD_40");
    NPC_CLEARAIQUEUE(BAU_2245_HOLDWIG);
    NPC_CLEARAIQUEUE(BAU_11182_FARMER);
    BAU_2245_HOLDWIG.AIVAR[92] = TRUE;
    BAU_2265_FARMER.AIVAR[92] = TRUE;
    BAU_2267_FARMER.AIVAR[92] = TRUE;
    BAU_11182_FARMER.AIVAR[92] = TRUE;
    B_TURNTONPC(BAU_2265_FARMER, VLK_11181_ANDERAS_VINEYARDFIGHT);
    B_TURNTONPC(BAU_2267_FARMER, VLK_11181_ANDERAS_VINEYARDFIGHT);
    B_TURNTONPC(BAU_11182_FARMER, VLK_11181_ANDERAS_VINEYARDFIGHT);
    B_TURNTONPC(BAU_2245_HOLDWIG, BAU_2265_FARMER);
    B_TURNTONPC(HERO, BAU_2267_FARMER);
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_SETWALKMODE(BAU_11182_FARMER, NPC_RUN);
    AI_GOTOWP(BAU_11182_FARMER, "PART9_VINEYARD_50");
    AI_TURNTONPC(BAU_11182_FARMER, BAU_2245_HOLDWIG);
    AI_STARTFACEANI(BAU_2265_FARMER, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(BAU_2267_FARMER, S_ANGRY, 1, -(1));
    AI_STARTFACEANI(BAU_11182_FARMER, S_ANGRY, 1, -(1));
    AI_OUTPUT(BAU_2265_FARMER, HERO, "DIA_Farmer_HoldwigFinish_Cutscene_03_01");
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_OUTPUT(BAU_2267_FARMER, HERO, "DIA_Farmer_HoldwigFinish_Cutscene_03_02");
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_OUTPUT(BAU_11182_FARMER, HERO, "DIA_Farmer_HoldwigFinish_Cutscene_03_03");
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_FUNCTION(BAU_2245_HOLDWIG, 0x16af2);
    AI_TURNTONPC(BAU_2245_HOLDWIG, BAU_11182_FARMER);
    AI_OUTPUT(BAU_2245_HOLDWIG, HERO, "DIA_Holdwig_HoldwigFinish_Cutscene_03_04");
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_FUNCTION(BAU_2245_HOLDWIG, 0x16af3);
    AI_TURNTONPC(BAU_2265_FARMER, BAU_2245_HOLDWIG);
    AI_TURNTONPC(BAU_2267_FARMER, BAU_2245_HOLDWIG);
    AI_TURNTONPC(BAU_11182_FARMER, HERO);
    AI_WAIT(BAU_2245_HOLDWIG, 0x40d00000);
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_FUNCTION(BAU_2245_HOLDWIG, 0x16af6);
    if ((NPC_HASITEMS(BAU_2245_HOLDWIG, 0x8cc5)) == (0)) {
        CREATEINVITEM(BAU_2245_HOLDWIG, 0x8cc5);
        AI_USEITEMTOSTATE(BAU_2245_HOLDWIG, 0x8cc5, 1);
        AI_WAIT(BAU_2245_HOLDWIG, 0x40800000);
        AI_USEITEMTOSTATE(BAU_2245_HOLDWIG, 0x8cc5, -(1));
    };
    AI_WAIT(BAU_2245_HOLDWIG, 0x3dcccccd);
    AI_FUNCTION(BAU_2245_HOLDWIG, 0x16af7);
    AI_WAIT(BAU_2245_HOLDWIG, 0x3e4ccccd);
    AI_TURNTONPC(BAU_2245_HOLDWIG, VLK_11181_ANDERAS_VINEYARDFIGHT);
    AI_OUTPUT(BAU_2245_HOLDWIG, HERO, "DIA_Holdwig_HoldwigFinish_Cutscene_03_05");
    SQ225_HOLDWIGWAY_FINISH_WAIT();
    AI_FUNCTION(BAU_2245_HOLDWIG, 0x16af1);
    AI_SETWALKMODE(BAU_2245_HOLDWIG, NPC_WALK);
    AI_GOTOWP(BAU_2245_HOLDWIG, "PART9_SQ225_CUTSCENE_ANDERAS");
}

func void SQ225_HOLDWIGWAY_FINISH_WATCHFIGHT() {
    AI_STARTFACEANI(BAU_2265_FARMER, S_SMILE, 1, -(1));
    AI_STARTFACEANI(BAU_2267_FARMER, S_SMILE, 1, -(1));
    AI_STARTFACEANI(BAU_11182_FARMER, S_SMILE, 1, -(1));
    AI_WAIT(BAU_2265_FARMER, 0x3e99999a);
    AI_PLAYANI(BAU_2265_FARMER, "T_WATCHFIGHT_YEAH_02");
    AI_WAIT(BAU_2267_FARMER, 0x3f333333);
    AI_PLAYANI(BAU_2267_FARMER, "T_WATCHFIGHT_YEAH_03");
    AI_WAIT(BAU_11182_FARMER, 0x3ecccccd);
    AI_PLAYANI(BAU_11182_FARMER, "T_WATCHFIGHT_YEAH_03");
}

func void SQ225_HOLDWIGWAY_FINISH_END() {
    SQ225_REMOVEHOLDWIGPORTALCHECK = FALSE;
    WLD_ASSIGNROOMTOGUILD("9WINERY01", GIL_PUBLIC);
    FADESCREENTOBLACKF(5, 0xeead, 1000);
}

func void SQ225_HOLDWIGWAY_CHANGECAMERA_01() {
    WLD_SENDTRIGGER("KM_SQ225_ANDERASFINISH_02");
    WLD_SENDUNTRIGGER("KM_SQ225_ANDERASFINISH_01");
}

func void SQ225_HOLDWIGWAY_CHANGECAMERA_02() {
    WLD_SENDTRIGGER("KM_SQ225_ANDERASFINISH_04");
    WLD_SENDUNTRIGGER("KM_SQ225_ANDERASFINISH_02");
    TELEPORTNPCTOWP(0xdef2, "PART9_VINEYARD_STAND_08");
    TELEPORTNPCTOWP(0xdefe, "PART9_SQ225_CUTSCENE_ANDERAS");
    TELEPORTNPCTOWP(0xdea9, "PART9_SQ225_CUTSCENE_FARMER_03");
    TELEPORTNPCTOWP(0xdeb5, "PART9_VINEYARD_43");
    TELEPORTNPCTOWP(0xde2d, "PART9_VINEYARD_32");
    TELEPORTNPCTOWP(0x71b, "PART9_VINEYARD_47");
    FF_APPLYONCEEXT(0x16af4, 1000, 6);
}

func void SQ225_HOLDWIGWAY_PREPAREANDERAS() {
    SQ225_HOLDWIGWAY_PREPAREANDERAS_COUNT = (SQ225_HOLDWIGWAY_PREPAREANDERAS_COUNT) + (1);
    if ((SQ225_HOLDWIGWAY_PREPAREANDERAS_COUNT) == (1)) {
        VLK_11181_ANDERAS_VINEYARDFIGHT.AIVAR[96] = 0;
        AI_TURNTONPC(VLK_11181_ANDERAS_VINEYARDFIGHT, BAU_2245_HOLDWIG);
    };
    if ((SQ225_HOLDWIGWAY_PREPAREANDERAS_COUNT) == (6)) {
        MDL_APPLYOVERLAYMDS(VLK_11181_ANDERAS_VINEYARDFIGHT, "Humans_Marvin_RenegadePrison.MDS");
        MDL_STARTFACEANI(VLK_11181_ANDERAS_VINEYARDFIGHT, "S_EYESCLOSED", 0x3f800000, -1082130432);
    };
}

var int SQ225_HOLDWIGWAY_PREPAREANDERAS.SQ225_HOLDWIGWAY_PREPAREANDERAS_COUNT = 0;
func void SQ225_HOLDWIGWAY_CHANGECAMERA_03() {
    WLD_SENDTRIGGER("KM_SQ225_ANDERASFINISH_05");
    WLD_SENDUNTRIGGER("KM_SQ225_ANDERASFINISH_04");
}

func void SQ225_HOLDWIGWAY_CHANGECAMERA_04() {
    WLD_SENDTRIGGER("KM_SQ225_ANDERASFINISH_06");
    WLD_SENDUNTRIGGER("KM_SQ225_ANDERASFINISH_05");
    TELEPORTNPCTOWP(0x71b, "PART9_VINEYARD_38");
}

