func void SQ229_SPAWN_MARCO() {
    if (!(NPC_ISDEAD(LURKER_SQ229_01))) {
        B_REMOVENPC(0xc5a5);
    };
    if (!(NPC_ISDEAD(LURKER_SQ229_02))) {
        B_REMOVENPC(0xc5a6);
    };
    if (!(NPC_ISDEAD(KM_LURKER_SQ229))) {
        B_REMOVENPC(0xc59a);
    };
    WLD_INSERTNPC(0xd6fe, "PART1_LIGHTHOUSE_BEACH_08");
    WLD_INSERTNPC(0xd715, "PART1_LIGHTHOUSE_BEACH_07");
}

instance DIA_NEVIL_EXIT(C_INFO) {
    NPC = 0xd4cb;
    NR = 999;
    CONDITION = DIA_NEVIL_EXIT_CONDITION;
    INFORMATION = DIA_NEVIL_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_NEVIL_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_NEVIL_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_SQ229_HELLO(C_INFO) {
    NPC = 0xd4cb;
    NR = 1;
    CONDITION = DIA_NEVIL_SQ229_HELLO_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_HELLO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Hey, how's it going?";
}

func int DIA_NEVIL_SQ229_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_NEVIL_SQ229_HELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_Hello_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Hello_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Hello_03_03");
}

instance DIA_NEVIL_SQ229_FISHINGPLACE(C_INFO) {
    NPC = 0xd4cb;
    NR = 2;
    CONDITION = DIA_NEVIL_SQ229_FISHINGPLACE_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_FISHINGPLACE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "What's the problem?";
}

func int DIA_NEVIL_SQ229_FISHINGPLACE_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x10d3d)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_FISHINGPLACE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_FishingPlace_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_FishingPlace_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_FishingPlace_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_FishingPlace_03_04");
}

instance DIA_NEVIL_SQ229_LONGING(C_INFO) {
    NPC = 0xd4cb;
    NR = 3;
    CONDITION = DIA_NEVIL_SQ229_LONGING_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_LONGING_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Then what are you missing?";
}

func int DIA_NEVIL_SQ229_LONGING_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x10d40)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_LONGING_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_Longing_15_01");
    AI_PLAYANI(SELF, T_SEARCH);
    if (NPC_HASGUILDARMOREQUIPPED(HERO, GIL_MIL)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Longing_03_02");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Longing_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Longing_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Longing_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Longing_03_06");
}

instance DIA_NEVIL_SQ229_REALSTART(C_INFO) {
    NPC = 0xd4cb;
    NR = 4;
    CONDITION = DIA_NEVIL_SQ229_REALSTART_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_REALSTART_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Then what can I do?";
}

func int DIA_NEVIL_SQ229_REALSTART_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x10d43)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_REALSTART_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_RealStart_15_01");
    AI_PLAYANI(SELF, T_SEARCH);
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_RealStart_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_RealStart_03_03");
    LOG_CREATETOPIC(TOPIC_SQ229, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ229), TOPIC_SQ229, LOG_RUNNING);
    if ((LOG_GETSTATUS(MIS_SQ202)) == (LOG_SUCCESS)) {
        AI_LOGENTRY(TOPIC_SQ229, LOG_SQ229_STARTPETRA);
    };
    AI_LOGENTRY(TOPIC_SQ229, LOG_SQ229_START);
    AI_FUNCTION(OTHER, 0x10d39);
}

instance DIA_NEVIL_SQ229_LANTERN(C_INFO) {
    NPC = 0xd4cb;
    NR = 5;
    CONDITION = DIA_NEVIL_SQ229_LANTERN_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_LANTERN_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "How do I get to this lighthouse?";
}

func int DIA_NEVIL_SQ229_LANTERN_CONDITION() {
    if ((LOG_GETSTATUS(MIS_SQ229)) == (LOG_RUNNING)) {
        if (NPC_KNOWSINFO(OTHER, 0x10d46)) {
            if ((SQ229_GOTWEED) == (FALSE)) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_LANTERN_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_Lantern_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Lantern_03_02");
    AI_LOGENTRY(TOPIC_SQ229, LOG_SQ229_LANTERN);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_SQ229_AMBIENT(C_INFO) {
    NPC = 0xd4cb;
    NR = 1;
    CONDITION = DIA_NEVIL_SQ229_AMBIENT_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_AMBIENT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_NEVIL_SQ229_AMBIENT_CONDITION() {
    if ((LOG_GETSTATUS(MIS_SQ229)) == (LOG_RUNNING)) {
        if (((NPC_KNOWSINFO(OTHER, 0x10d49)) && (NPC_ISINSTATE(SELF, 0xf09f))) && ((SQ229_GOTWEED) == (FALSE))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_AMBIENT_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Ambient_03_01");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_SQ229_PACKET(C_INFO) {
    NPC = 0xd4cb;
    NR = 1;
    CONDITION = DIA_NEVIL_SQ229_PACKET_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_PACKET_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I have your package.";
}

func int DIA_NEVIL_SQ229_PACKET_CONDITION() {
    if ((LOG_GETSTATUS(MIS_SQ229)) == (LOG_RUNNING)) {
        if (((SQ229_GOTWEED) == (TRUE)) && ((NPC_HASITEMS(OTHER, 0x9155)) >= (1))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_PACKET_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_Packet_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_Packet_03_02");
    INFO_CLEARCHOICES(0x10d4f);
    INFO_ADDCHOICE(0x10d4f, "Yeah, I just happened to catch them when they changed fishing spots.", 0x10d53);
    INFO_ADDCHOICE(0x10d4f, "I had to take the package from them by force.", 0x10d52);
}

func void DIA_NEVIL_SQ229_BEATTHEM() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_BeatThem_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_BeatThem_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_BeatThem_03_03");
    CREATEINVITEMS(SELF, 0x859b, SQ228_GOLDENDING_V1);
    B_GIVEINVITEMS(OTHER, SELF, 0x9155, 1);
    NONE_6266_NEVIL.FLAGS = 2;
    B_GIVEINVITEMS(SELF, OTHER, 0x859b, SQ228_GOLDENDING_V1);
    AI_LOGENTRY(TOPIC_SQ229, LOG_SQ229_NEVILFINISHV1);
    LOG_SETSTATUS(_@(MIS_SQ229), TOPIC_SQ229, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_SQ228_ENDINGV1);
    NPC_EXCHANGEROUTINE(SELF, TOT);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_NEVIL_SQ229_THEYAREGONE() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nevil_SQ229_TheyAreGone_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_TheyAreGone_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_TheyAreGone_03_03");
    CREATEINVITEMS(SELF, 0x859b, SQ228_GOLDENDING_V2);
    B_GIVEINVITEMS(SELF, OTHER, 0x859b, SQ228_GOLDENDING_V2);
    CREATEINVITEMS(SELF, 0x8c35, 1);
    B_GIVEINVITEMS(OTHER, SELF, 0x9155, 1);
    NONE_6266_NEVIL.FLAGS = 2;
    B_GIVEINVITEMS(SELF, OTHER, 0x8c35, 1);
    AI_LOGENTRY(TOPIC_SQ229, LOG_SQ229_NEVILFINISHV2);
    LOG_SETSTATUS(_@(MIS_SQ229), TOPIC_SQ229, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_SQ228_ENDINGV2);
    NPC_EXCHANGEROUTINE(SELF, TOT);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_SQ229_AFTERQUEST(C_INFO) {
    NPC = 0xd4cb;
    NR = 4;
    CONDITION = DIA_NEVIL_SQ229_AFTERQUEST_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_AFTERQUEST_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_NEVIL_SQ229_AFTERQUEST_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x10d4f)) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_AFTERQUEST_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Nevil_SQ229_AfterQuest_03_01");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_SQ229_ANGRY(C_INFO) {
    NPC = 0xd4cb;
    NR = 4;
    CONDITION = DIA_NEVIL_SQ229_ANGRY_CONDITION;
    INFORMATION = DIA_NEVIL_SQ229_ANGRY_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_NEVIL_SQ229_ANGRY_CONDITION() {
    if (((SQ229_NEVILINPRISON) == (TRUE)) && (NPC_ISINSTATE(SELF, 0xf09f))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_SQ229_ANGRY_INFO() {
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    B_SAY(SELF, OTHER, "$NOTNOW");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NEVIL_PICKPOCKET(C_INFO) {
    NPC = 0xd4cb;
    NR = 900;
    CONDITION = DIA_NEVIL_PICKPOCKET_CONDITION;
    INFORMATION = DIA_NEVIL_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_40;
}

func int DIA_NEVIL_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NEVIL_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x10d5a);
    INFO_ADDCHOICE(0x10d5a, DIALOG_BACK, 0x10d5e);
    INFO_ADDCHOICE(0x10d5a, DIALOG_PICKPOCKET, 0x10d5d);
}

func void DIA_NEVIL_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) {
        CREATEINVITEMS(SELF, 0x8592, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x8592, 1);
        B_PICKPOCKET_AMBIENT_TIER_1();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x10d5a);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x10d5a);
}

func void DIA_NEVIL_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x10d5a);
}

