instance Q306_FIRSTFIGHT(CUTSCENE) {
    ONSTART = FUNCTION(0x1695e);
}

func void Q306_FIRSTFIGHT_WAIT() {
    AI_WAITTILLEND(PIR_1307_PROXIMO, HERO);
    AI_WAITTILLEND(PIR_1307_PROXIMO, PIR_1312_LARRY);
    AI_WAITTILLEND(PIR_1312_LARRY, HERO);
    AI_WAITTILLEND(PIR_1312_LARRY, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, PIR_1312_LARRY);
}

func void Q306_FIRSTFIGHT_START() {
    HERO.AIVAR[95] = TRUE;
    MUSIC_OVERRIDETRACK(0x55be);
    WLD_SENDTRIGGER("Q306_ARENACROWD");
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_03");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_LOCKER_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_LOCKER_OPPONENT");
    NPC_CLEARAIQUEUE(PIR_1307_PROXIMO);
    NPC_CLEARAIQUEUE(PIR_1312_LARRY);
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
    TELEPORTNPCTOWP(0xe586, PIR_1312_LARRY.WP);
    TELEPORTNPCTOWP(0xe521, PIR_1304_IVAN.WP);
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_INSIDE_08");
    PIR_1307_PROXIMO.AIVAR[92] = TRUE;
    AI_SETWALKMODE(PIR_1312_LARRY, NPC_WALK);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_TURNTONPC(PIR_1307_PROXIMO, PIR_1306_RODRIGO);
    Q306_FIRSTFIGHT_WAIT();
    AI_WAIT(PIR_1307_PROXIMO, 0x3e4ccccd);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeTournament_13_01");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeTournament_13_02");
    Q306_FIRSTFIGHT_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x1695f);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeTournament_13_03");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeTournament_13_04");
    Q306_FIRSTFIGHT_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16960);
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeTournament_13_05");
    Q306_FIRSTFIGHT_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16961);
    AI_PLAYANI(HERO, "R_STRETCH_RANDOM_01");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeRound1_13_01");
    Q306_FIRSTFIGHT_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16962);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_PLAYANI(HERO, "R_STRETCH_RANDOM_02");
    AI_GOTOWP(HERO, "P17_HAVEN_ARENA_PLAYER_02");
    AI_PLAYANI(HERO, R_LEGSHAKE);
    AI_GOTOWP(PIR_1312_LARRY, "P17_HAVEN_ARENA_OPPONENT_02");
    AI_PLAYANI(PIR_1312_LARRY, "R_STRETCH_RANDOM_01");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeRound1_13_02");
    AI_OUTPUT(PIR_1307_PROXIMO, HERO, "DIA_Proximo_BeforeRound1_13_03");
    Q306_FIRSTFIGHT_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 0x16963);
}

func void Q306_FIRSTFIGHT_CAMERACHANGE_01() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_04");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_03");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_INSIDE_08");
}

func void Q306_FIRSTFIGHT_CAMERACHANGE_02() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_05");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_04");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_18");
}

func void Q306_FIRSTFIGHT_CAMERACHANGE_03() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_01");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_05");
    TELEPORTNPCTOWP(0x71b, "P17_HAVEN_ARENA_PLAYER_01");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_INSIDE_07");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
}

func void Q306_FIRSTFIGHT_CAMERACHANGE_04() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_1_02");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_01");
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_INSIDE_08");
}

func void Q306_FIRSTFIGHT_END() {
    PRINTD("Walka z Larrym");
    Q306_STATE = 2;
    TELEPORTNPCTOWP(0xe548, "P17_HAVEN_ARENA_SPEAKER_01");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_1_02");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    NPC_REFRESH(PIR_1307_PROXIMO);
    NPC_REFRESH(PIR_1312_LARRY);
    PIR_1307_PROXIMO.AIVAR[92] = FALSE;
    B_STARTOTHERROUTINE(PIR_1312_LARRY, "ArenaFightPlayer");
    HERO.AIVAR[4] = FALSE;
}

