instance DIA_INNKEEPER_EXIT(C_INFO) {
    NPC = 0xe30d;
    NR = 999;
    CONDITION = DIA_INNKEEPER_EXIT_CONDITION;
    INFORMATION = DIA_INNKEEPER_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_INNKEEPER_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_INNKEEPER_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_INNKEEPER_SEARCHING(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_SEARCHING_CONDITION;
    INFORMATION = DIA_INNKEEPER_SEARCHING_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I'm looking for Henk and Legrif.";
}

func int DIA_INNKEEPER_SEARCHING_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q402)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 0x13e78))) {
        if ((Q402_FOUNDVARHALANDLEGRIF) == (FALSE)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_SEARCHING_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Searching_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Searching_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Searching_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Searching_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Searching_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Searching_03_06");
}

instance DIA_INNKEEPER_DALMON(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_DALMON_CONDITION;
    INFORMATION = DIA_INNKEEPER_DALMON_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I'm looking for someone strong for some work.";
}

func int DIA_INNKEEPER_DALMON_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q404)) == (LOG_RUNNING)) && ((Q404_GUARDMINE_NEEDHELP) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_DALMON_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Dalmon_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Dalmon_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Dalmon_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Dalmon_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Dalmon_15_05");
}

instance DIA_INNKEEPER_IVY(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_IVY_CONDITION;
    INFORMATION = DIA_INNKEEPER_IVY_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "There was a girl staying here recently.";
}

func int DIA_INNKEEPER_IVY_CONDITION() {
    if (((Q404_MARVINFINISHEDMINE) == (2)) && ((LOG_GETSTATUS(MIS_Q402)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_IVY_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Ivy_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Ivy_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Ivy_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Ivy_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Ivy_03_05");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Ivy_15_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Ivy_03_07");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Ivy_15_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Ivy_03_09");
    AI_LOGENTRY(TOPIC_Q402, LOG_Q402_WHEREIVY);
}

instance DIA_INNKEEPER_JONHOUSE(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_JONHOUSE_CONDITION;
    INFORMATION = DIA_INNKEEPER_JONHOUSE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Do you happen to know which house Jon lived in?";
}

func int DIA_INNKEEPER_JONHOUSE_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x13fa9)) && ((LOG_GETSTATUS(MIS_Q402)) == (LOG_RUNNING))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_JONHOUSE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_JonHouse_15_01");
    if ((Q402_AFTERMINE) == (TRUE)) {
        if ((Q402_AFTERMINE_DAY) == ((WLD_GETDAY()) - (1))) {
            AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_JonHouse_03_02");
            AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_JonHouse_15_03");
        } else {
            AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_JonHouse_03_04");
            AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_JonHouse_15_05");
        };
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_JonHouse_03_06");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_JonHouse_15_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_JonHouse_03_08");
    AI_LOGENTRY(TOPIC_Q402, LOG_Q402_INNKEEPER_JONHOUSE);
}

instance DIA_INNKEEPER_SQ405_HELLO(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_SQ405_HELLO_CONDITION;
    INFORMATION = DIA_INNKEEPER_SQ405_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_INNKEEPER_SQ405_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_INNKEEPER_SQ405_HELLO_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Hello_03_01");
}

instance DIA_INNKEEPER_SQ405_AFTERHELLO(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_SQ405_AFTERHELLO_CONDITION;
    INFORMATION = DIA_INNKEEPER_SQ405_AFTERHELLO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Yeah, why do you ask?";
}

func int DIA_INNKEEPER_SQ405_AFTERHELLO_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x13faf)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_SQ405_AFTERHELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_SQ405_AfterHello_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_AfterHello_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_SQ405_AfterHello_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_AfterHello_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_AfterHello_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_AfterHello_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_AfterHello_03_07");
}

instance DIA_DIRK_TRADE(C_INFO) {
    NPC = 0xe30d;
    NR = 10;
    CONDITION = DIA_DIRK_TRADE_CONDITION;
    INFORMATION = DIA_DIRK_TRADE_INFO;
    PERMANENT = TRUE;
    TRADE = TRUE;
    DESCRIPTION = "Let's deal.";
}

func int DIA_DIRK_TRADE_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x13fb2)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DIRK_TRADE_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_LetsTrade");
    B_GIVETRADEINV(SELF);
}

instance DIA_INNKEEPER_SQ405_REALSTART(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_SQ405_REALSTART_CONDITION;
    INFORMATION = DIA_INNKEEPER_SQ405_REALSTART_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I'm not promising anything, but I'll see what I can do.";
}

func int DIA_INNKEEPER_SQ405_REALSTART_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 0x13fb2)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_SQ405_REALSTART_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_SQ405_RealStart_15_01");
    LOG_CREATETOPIC(TOPIC_SQ405, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ405), TOPIC_SQ405, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_REALSTART);
}

var int INNKEEPER_LEGACYARRAZOL = 0;
var int INNKEEPER_STARKA = 0;
instance DIA_INNKEEPER_GIVEALCO(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_GIVEALCO_CONDITION;
    INFORMATION = DIA_INNKEEPER_GIVEALCO_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "(Hand over the alcohol)";
}

func int DIA_INNKEEPER_GIVEALCO_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 0x13fb8)) && ((LOG_GETSTATUS(MIS_SQ405)) == (LOG_RUNNING))) && ((INNKEEPER_DARKBEER) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_CHECKTHISOUT() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_CheckThisOut_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_CheckThisOut_03_02");
}

func void DIA_INNKEEPER_WEHAVEADEAL() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_WeHaveADeal_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_WeHaveADeal_03_03");
}

func void DIA_INNKEEPER_BAD_V1() {
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Starka_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Starka_03_04");
}

func void DIA_INNKEEPER_BAD_V2() {
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_LegacyArrazol_03_02");
}

var int INNKEEPER_ITFO_BEER = 0;
var int INNKEEPER_ITFO_BOOZE = 0;
var int INNKEEPER_ITFO_GERSTANDBEER = 0;
var int INNKEEPER_ITFO_WINE = 0;
var int INNKEEPER_ITFO_SPIRIT = 0;
var int INNKEEPER_ITFO_MOONSHINE = 0;
var int INNKEEPER_ITFO_WISP = 0;
var int INNKEEPER_ITFO_SAILOR = 0;
var int INNKEEPER_ITFO_OWBEER = 0;
var int INNKEEPER_ITFO_BEER_02 = 0;
var int INNKEEPER_ITFO_WINE_ARAXOS = 0;
var int INNKEEPER_ITFO_BEER_03 = 0;
var int INNKEEPER_WINEARRAZOL = 0;
var int INNKEEPER_ITFO_WINE_02 = 0;
var int INNKEEPER_ITFO_WINE_01 = 0;
var int INNKEEPER_ITFO_ADDON_GROG = 0;
var int INNKEEPER_ITFO_ADDON_RUM = 0;
func void DIA_INNKEEPER_GIVEALCO_INFO() {
    INFO_CLEARCHOICES(0x13fbd);
    INFO_ADDCHOICE(0x13fbd, DIALOG_BACK, 0x13fd5);
    if (((NPC_HASITEMS(OTHER, 0x8e29)) >= (1)) && ((INNKEEPER_LEGACYARRAZOL) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_LEGACYARRAZOL, 0x13fe9);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e27)) >= (1)) && ((INNKEEPER_WINEARRAZOL) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WINEARRAZOL, 0x13fda);
    };
    if ((((NPC_HASITEMS(OTHER, 0x8e0c)) >= (1)) && ((INNKEEPER_DARKBEER) == (FALSE))) && ((LOG_GETSTATUS(MIS_CQ003)) == (LOG_SUCCESS))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_DARKBEER, 0x13fea);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e03)) >= (1)) && ((INNKEEPER_STARKA) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_STARK, 0x13feb);
    };
    if (((NPC_HASITEMS(OTHER, 0x84c0)) >= (1)) && ((INNKEEPER_ITFO_BEER) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_BEER, 0x13fe8);
    };
    if (((NPC_HASITEMS(OTHER, 0x84c2)) >= (1)) && ((INNKEEPER_ITFO_BOOZE) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_BOOZE, 0x13fe7);
    };
    if (((NPC_HASITEMS(OTHER, 0x84b6)) >= (1)) && ((INNKEEPER_ITFO_GERSTANDBEER) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_GERSTANDBEER, 0x13fe6);
    };
    if (((NPC_HASITEMS(OTHER, 0x84c4)) >= (1)) && ((INNKEEPER_ITFO_WINE) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WINE, 0x13fe5);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e1f)) >= (1)) && ((INNKEEPER_ITFO_SPIRIT) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_SPIRIT, 0x13fe4);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e21)) >= (1)) && ((INNKEEPER_ITFO_MOONSHINE) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_MOONSHINE, 0x13fe3);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e23)) >= (1)) && ((INNKEEPER_ITFO_WISP) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WISP, 0x13fe2);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e25)) >= (1)) && ((INNKEEPER_ITFO_SAILOR) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_SAILOR, 0x13fe1);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e0b)) >= (1)) && ((INNKEEPER_ITFO_OWBEER) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_OWBEER, 0x13fe0);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e10)) >= (1)) && ((INNKEEPER_ITFO_BEER_02) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_BEER_02, 0x13fdf);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e12)) >= (1)) && ((INNKEEPER_ITFO_WINE_ARAXOS) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WINE_ARAXOS, 0x13fde);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e14)) >= (1)) && ((INNKEEPER_ITFO_WINE_01) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WINE_01, 0x13fdd);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e15)) >= (1)) && ((INNKEEPER_ITFO_WINE_02) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_WINE_02, 0x13fdc);
    };
    if (((NPC_HASITEMS(OTHER, 0x8e17)) >= (1)) && ((INNKEEPER_ITFO_BEER_03) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_BEER_03, 0x13fdb);
    };
    if (((NPC_HASITEMS(OTHER, 0x8374)) >= (1)) && ((INNKEEPER_ITFO_ADDON_RUM) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_RUM, 0x13fd9);
    };
    if (((NPC_HASITEMS(OTHER, 0x8376)) >= (1)) && ((INNKEEPER_ITFO_ADDON_GROG) == (FALSE))) {
        INFO_ADDCHOICE(0x13fbd, FOODNAME_GROG, 0x13fd8);
    };
}

func void DIA_INNKEEPER_GIVEALCO_BACK() {
    INFO_CLEARCHOICES(0x13fbd);
}

func void SQ405_TRYBEERCOUNT() {
    B_GIVEPLAYERXP(XP_SQ405_TRYBEER);
    SQ405_TRYBEERCOUNT_CHECK = (SQ405_TRYBEERCOUNT_CHECK) + (1);
    if ((SQ405_TRYBEERCOUNT_CHECK) >= (4)) {
        SQ405_TRYBEERCOUNT_CHECK = 50;
        AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_NOIDEA);
    };
}

var int SQ405_TRYBEERCOUNT.SQ405_TRYBEERCOUNT_CHECK = 0;
func void DIA_INNKEEPER_ITFO_ADDON_GROG() {
    INNKEEPER_ITFO_ADDON_GROG = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8376, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8376, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_ITFO_ADDON_GROG();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_GROG);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_ADDON_RUM() {
    INNKEEPER_ITFO_ADDON_RUM = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8374, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8374, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_ITFO_ADDON_RUM();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_RUM);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_WINEARRAZOL() {
    INNKEEPER_WINEARRAZOL = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e27, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e27, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WINEARRAZOL();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WINEARRAZOL);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_BEER_03() {
    INNKEEPER_ITFO_BEER_03 = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e17, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e17, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_BEER_03();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_BEER_03);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_WINE_02() {
    INNKEEPER_ITFO_WINE_02 = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e15, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e15, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WINE_02();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WINE_02);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_WINE_01() {
    INNKEEPER_ITFO_WINE_01 = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e14, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e14, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WINE_01();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WINE_01);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_WINE_ARAXOS() {
    INNKEEPER_ITFO_WINE_ARAXOS = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e12, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e12, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WINE_ARAXOS();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WINE_ARAXOS);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_BEER_02() {
    INNKEEPER_ITFO_BEER_02 = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e10, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e10, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_OWBEER();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_BEER_02);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_OWBEER() {
    INNKEEPER_ITFO_OWBEER = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e0b, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e0b, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_OWBEER();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_BEER_OW);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_SAILOR() {
    INNKEEPER_ITFO_SAILOR = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e25, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e25, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_SAILOR();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_SAILOR);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_WISP() {
    INNKEEPER_ITFO_WISP = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e23, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e23, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WISP();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WISP);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_MOONSHINE() {
    INNKEEPER_ITFO_MOONSHINE = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e21, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e21, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_MOONSHINE();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_MOONSHINE);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_SPIRIT() {
    INNKEEPER_ITFO_SPIRIT = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x8e1f, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e1f, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_SPIRIT();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_SPIRIT);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_WINE() {
    INNKEEPER_ITFO_WINE = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x84c4, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x84c4, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_WINE();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_WINE);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_GERSTANDBEER() {
    INNKEEPER_ITFO_GERSTANDBEER = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x84b6, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x84b6, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_GERSTANDBEER();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_GERSTANDBEER);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_BOOZE() {
    INNKEEPER_ITFO_BOOZE = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x84c2, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x84c2, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_BOOZE();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_BOOZE);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_ITFO_BEER() {
    INNKEEPER_ITFO_BEER = TRUE;
    NPC_REMOVEINVITEMS(SELF, 0x84c0, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x84c0, 1);
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_BEER();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_BEER);
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_LEGACYARRAZOL() {
    DIA_INNKEEPER_CHECKTHISOUT();
    NPC_REMOVEINVITEMS(SELF, 0x8e29, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e29, 1);
    B_USEFAKEBEER_LEGACYARCHOLOS();
    DIA_INNKEEPER_BAD_V2();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_LEGACYARRAZO);
    INNKEEPER_LEGACYARRAZOL = TRUE;
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_DARKBEER() {
    DIA_INNKEEPER_CHECKTHISOUT();
    AI_WAITTILLEND(SELF, OTHER);
    B_USEFAKEBEER_DARKBEER();
    B_GIVEINVITEMS(OTHER, SELF, 0x8e0c, 1);
    AI_STOPLOOKAT(SELF);
    AI_USEITEM(SELF, 0x8e0c);
    AI_WAITTILLEND(OTHER, SELF);
    AI_WAITTILLEND(SELF, OTHER);
    AI_LOOKATNPC(SELF, OTHER);
    INNKEEPER_DARKBEER = TRUE;
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_DarkBeer_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_DarkBeer_15_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_DarkBeer_15_03");
    INFO_CLEARCHOICES(0x13fbd);
    INFO_ADDCHOICE(0x13fbd, "...150 gold pieces per box.", 0x13fed);
    INFO_ADDCHOICE(0x13fbd, "...100 gold pieces per box.", 0x13fee);
}

func void DIA_INNKEEPER_STARKA() {
    DIA_INNKEEPER_CHECKTHISOUT();
    NPC_REMOVEINVITEMS(SELF, 0x8e03, 1);
    AI_WAITTILLEND(SELF, OTHER);
    B_GIVEINVITEMS(OTHER, SELF, 0x8e03, 1);
    B_USEFAKEBEER_STARKA();
    DIA_INNKEEPER_BAD_V1();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_STARK);
    INNKEEPER_STARKA = TRUE;
    SQ405_TRYBEERCOUNT();
}

func void DIA_INNKEEPER_GOLD200() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Gold200_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Gold200_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_Gold200_03_03");
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_FAIL);
    LOG_SETSTATUS(_@(MIS_SQ405), TOPIC_SQ405, LOG_FAILED);
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_INNKEEPER_GOLD150() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Gold150_15_01");
    DIA_INNKEEPER_WEHAVEADEAL();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_DARKBEERV2);
    SQ405_WEHAVEADEAL = 2;
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_INNKEEPER_GOLD100() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_Gold100_15_01");
    DIA_INNKEEPER_WEHAVEADEAL();
    AI_LOGENTRY(TOPIC_SQ405, LOG_SQ405_DARKBEERV1);
    SQ405_WEHAVEADEAL = 1;
    AI_STOPPROCESSINFOS(SELF);
}

var int INNKEEPER_SQ405_GOTSBEER = 0;
instance DIA_INNKEEPER_SQ405_AFTERMATCH(C_INFO) {
    NPC = 0xe30d;
    NR = 1;
    CONDITION = DIA_INNKEEPER_SQ405_AFTERMATCH_CONDITION;
    INFORMATION = DIA_INNKEEPER_SQ405_AFTERMATCH_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Tomas agreed to your proposal.";
}

func int DIA_INNKEEPER_SQ405_AFTERMATCH_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 0x110c8)) && ((INNKEEPER_SQ405_GOTSBEER) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_SQ405_AFTERMATCH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Innkeeper_SQ405_Aftermatch_15_01");
    if ((SQ405_DAYSUPPLY) == (WLD_GETDAY())) {
        AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Aftermatch_03_02");
        AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Aftermatch_03_03");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Aftermatch_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Aftermatch_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Innkeeper_SQ405_Aftermatch_03_06");
    CREATEINVITEMS(SELF, 0x8374, 3);
    B_GIVEINVITEMS(SELF, OTHER, 0x8374, 3);
    INNKEEPER_SQ405_GOTSBEER = TRUE;
}

instance DIA_INNKEEPER_PICKPOCKET(C_INFO) {
    NPC = 0xe30d;
    NR = 900;
    CONDITION = DIA_INNKEEPER_PICKPOCKET_CONDITION;
    INFORMATION = DIA_INNKEEPER_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_80;
}

func int DIA_INNKEEPER_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_INNKEEPER_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(0x13ff3);
    INFO_ADDCHOICE(0x13ff3, DIALOG_BACK, 0x13ff7);
    INFO_ADDCHOICE(0x13ff3, DIALOG_PICKPOCKET, 0x13ff6);
}

func void DIA_INNKEEPER_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        CREATEINVITEMS(SELF, 0x8e19, 1);
        B_GIVEINVITEMS(SELF, OTHER, 0x8e19, 1);
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(0x13ff3);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(0x13ff3);
}

func void DIA_INNKEEPER_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(0x13ff3);
}

