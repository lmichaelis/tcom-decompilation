func int DIA_OLDCITYGUARD_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_OLDCITYGUARD_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
    AI_RESETFACEANI(SELF);
}

const string OLDCITYGUARD_CHECKPOINT_01 = "PARTM5_OLDCITYGUARD_01";
const string OLDCITYGUARD_CHECKPOINT_02 = "PARTM5_OLDCITYGUARD_02";
const string OLDCITYGUARD_CHECKPOINT_03 = "PARTM5_OLDCITYGUARD_03";
const string OLDCITYGUARD_CHECKPOINT_04 = "PARTM5_OLDCITYGUARD_04";
instance DIA_OLDCITYGUARD_FIRSTWARN(C_INFO) {
    NR = 1;
    CONDITION = DIA_OLDCITYGUARD_FIRSTWARN_CONDITION;
    INFORMATION = DIA_OLDCITYGUARD_FIRSTWARN_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_OLDCITYGUARD_FIRSTWARN_CONDITION() {
    if ((OLDCITYENTERED) == (FALSE)) {
        SELF.AIVAR[14] = FALSE;
    };
    SELF.AIVAR[14] = TRUE;
    if ((NPC_GETDISTTONPC(SELF, HERO)) <= (700)) {
        if (((((SELF.AIVAR[12]) == (GP_NONE)) && ((SELF.AIVAR[14]) == (FALSE))) && ((HLP_STRCMP(NPC_GETNEARESTWP(SELF), SELF.WP)) == (TRUE))) && ((NPC_REFUSETALK(SELF)) == (FALSE))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void OLDCITYGUARD_KILLHERO() {
    OTHER.AIVAR[13] = 0;
    SELF.AIVAR[12] = GP_NONE;
    AI_DRAWWEAPON(SELF);
    AI_STOPPROCESSINFOS(SELF);
    B_ATTACK(SELF, OTHER, AR_GUARDSTOPSINTRUDER, 1);
}

func void OLDCITYGUARD_CHECKLASTDISTWP() {
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4031_OLDCITYGUARD))) {
        OTHER.AIVAR[13] = NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_01);
    };
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4032_OLDCITYGUARD))) {
        OTHER.AIVAR[13] = NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_02);
    };
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4033_OLDCITYGUARD))) {
        OTHER.AIVAR[13] = NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_03);
    };
    if ((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4034_OLDCITYGUARD))) {
        OTHER.AIVAR[13] = NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_04);
    };
}

func void DIA_OLDCITYGUARD_CHOICES() {
    INFO_ADDCHOICE(42329, DIALOG_ENDE, 42337);
    INFO_ADDCHOICE(42329, "Why not?", 42336);
}

func void DIA_OLDCITYGUARD_FIRSTWARN_INFO() {
    INFO_CLEARCHOICES(42329);
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_15_02");
    if ((B_GETGREATESTPETZCRIME(SELF)) >= (CRIME_ATTACK)) {
        AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_03_03");
        AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_03_04");
        AI_STOPPROCESSINFOS(SELF);
    };
    if ((HERO.GUILD) == (GIL_MIL)) {
        AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_15_06");
        AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_03_07");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_03_11");
    DIA_OLDCITYGUARD_CHOICES();
    OLDCITYGUARD_CHECKLASTDISTWP();
    SELF.AIVAR[12] = GP_FIRSTWARNGIVEN;
}

func void DIA_OLDCITYGUARD_FIRSTWARN_PASS() {
    AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_Pass_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_Pass_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_Pass_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_Pass_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_Pass_03_05");
}

func void DIA_OLDCITYGUARD_FIRSTWARN_WHY() {
    AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_Why_15_01");
    if ((HERO.GUILD) == (GIL_VLK)) {
        AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_Why_15_02");
    };
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_Why_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_OldCityGuard_FirstWarn_Why_15_04");
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_FirstWarn_Why_03_05");
    INFO_ADDCHOICE(42329, "I didn't know I needed a pass for that.", 42335);
}

func void DIA_OLDCITYGUARD_FIRSTWARN_DIALOG_ENDE() {
    DIA_OLDCITYGUARD_EXIT_INFO();
}

instance DIA_OLDCITYGUARD_SECONDWARN(C_INFO) {
    NR = 1;
    CONDITION = DIA_OLDCITYGUARD_SECONDWARN_CONDITION;
    INFORMATION = DIA_OLDCITYGUARD_SECONDWARN_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_OLDCITYGUARD_SECONDWARN_CONDITION() {
    if ((((SELF.AIVAR[12]) == (GP_FIRSTWARNGIVEN)) && ((SELF.AIVAR[14]) == (FALSE))) && ((HLP_STRCMP(NPC_GETNEARESTWP(SELF), SELF.WP)) == (TRUE))) {
        if ((((((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4031_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_01)) < ((OTHER.AIVAR[13]) - (50)))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4032_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_02)) < ((OTHER.AIVAR[13]) - (50))))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4033_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_03)) < ((OTHER.AIVAR[13]) - (50))))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4034_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_04)) < ((OTHER.AIVAR[13]) - (50))))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_OLDCITYGUARD_SECONDWARN_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_SecondWarn_03_01");
    OLDCITYGUARD_CHECKLASTDISTWP();
    SELF.AIVAR[12] = GP_SECONDWARNGIVEN;
}

instance DIA_OLDCITYGUARD_LASTWARN(C_INFO) {
    NR = 1;
    CONDITION = DIA_OLDCITYGUARD_LASTWARN_CONDITION;
    INFORMATION = DIA_OLDCITYGUARD_LASTWARN_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_OLDCITYGUARD_LASTWARN_CONDITION() {
    if ((((SELF.AIVAR[12]) == (GP_SECONDWARNGIVEN)) && ((SELF.AIVAR[14]) == (FALSE))) && ((HLP_STRCMP(NPC_GETNEARESTWP(SELF), SELF.WP)) == (TRUE))) {
        if ((((((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4031_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_01)) < ((OTHER.AIVAR[13]) - (50)))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4032_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_02)) < ((OTHER.AIVAR[13]) - (50))))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4033_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_03)) < ((OTHER.AIVAR[13]) - (50))))) || (((HLP_GETINSTANCEID(SELF)) == (HLP_GETINSTANCEID(MIL_4034_OLDCITYGUARD))) && ((NPC_GETDISTTOWP(OTHER, OLDCITYGUARD_CHECKPOINT_04)) < ((OTHER.AIVAR[13]) - (50))))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_OLDCITYGUARD_LASTWARN_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_OldCityGuard_LastWarn_03_01");
    AI_STOPPROCESSINFOS(SELF);
    OLDCITYGUARD_KILLHERO();
}

func void B_ASSIGNAMBIENTINFOS_MIL_OLDCITYGUIDE(var C_NPC SLF) {
    DIA_OLDCITYGUARD_EXIT.NPC = HLP_GETINSTANCEID(SLF);
    DIA_OLDCITYGUARD_FIRSTWARN.NPC = HLP_GETINSTANCEID(SLF);
    DIA_OLDCITYGUARD_SECONDWARN.NPC = HLP_GETINSTANCEID(SLF);
    DIA_OLDCITYGUARD_LASTWARN.NPC = HLP_GETINSTANCEID(SLF);
}

