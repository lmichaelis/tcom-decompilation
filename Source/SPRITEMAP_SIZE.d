const int SPRITEMAP_SIZE = 512;
const int SPRITEMAP_POSX = 0;
const int SPRITEMAP_POSY = 0;
const int SPRITEMAP_TEXSIZE = 512;
const string SPRITEMAP_ARROW = "L.tga";
const string SPRITEMAP_MARKER = "U.tga";
var int SPRITEMAP_SPRITEHNDL;
var int SPRITEMAP_SPRITECURSORHNDL;
var int SPRITEMAP_SPRITEMARKERHNDL;
var int SPRITEMAP_MINXF;
var int SPRITEMAP_MINYF;
var int SPRITEMAP_DISTXF;
var int SPRITEMAP_DISTYF;
var int SPRITEMAP_SIZEF;
var int SPRITEMAP_UVDISTF;
var int SPRITEMAP_UVDISTHALFF;
var int SPRITEMAP_MARKERS;
var int SPRITEMAP_POSXF;
var int SPRITEMAP_POSYF;
var int SPRITEMAP_MAXXF;
var int SPRITEMAP_MAXYF;
var int SPRITEMAP_ROTATE90;
func void SPRITEMAP_DESTROY() {
    FF_REMOVE(21796);
    if (SPRITEMAP_SPRITEHNDL) {
        DELETE(SPRITEMAP_SPRITEHNDL);
        SPRITEMAP_SPRITEHNDL = 0;
    };
    if (SPRITEMAP_SPRITECURSORHNDL) {
        DELETE(SPRITEMAP_SPRITECURSORHNDL);
        SPRITEMAP_SPRITECURSORHNDL = 0;
    };
}

func void SPRITEMAP_CREATE(var string MAPTEX, var int SHOWCURSOR) {
    SPRITEMAP_SPRITEHNDL = SPRITE_CREATEPXL(SPRITEMAP_POSX, SPRITEMAP_POSY, SPRITEMAP_SIZE, SPRITEMAP_SIZE, COL_WHITE, MAPTEX);
    SPRITE_SETUV(SPRITEMAP_SPRITEHNDL, FLOATNULL, FLOATNULL, FLOATEINS, FLOATEINS);
    if (SHOWCURSOR) {
        SPRITEMAP_SPRITECURSORHNDL = SPRITE_CREATEPXL(0, 0, 16, 16, COL_WHITE, SPRITEMAP_ARROW);
        SPRITE_SETPRIO(SPRITEMAP_SPRITECURSORHNDL, 100);
    };
    FF_APPLYONCE(21796);
}

func void SPRITEMAP_LOOP() {
    var ZCVOB HER;
    if ((((((((MEM_KEYSTATE(KEY_ESCAPE)) == (KEY_PRESSED)) || ((MEM_KEYSTATE(KEY_RETURN)) == (KEY_PRESSED))) || ((MEM_KEYSTATE(MOUSE_BUTTONRIGHT)) == (KEY_PRESSED))) || ((MEM_KEYSTATE(MEM_GETKEY("keyInventory"))) == (KEY_PRESSED))) || ((MEM_KEYSTATE(MEM_GETSECONDARYKEY("keyInventory"))) == (KEY_PRESSED))) || ((MEM_KEYSTATE(MEM_GETKEY("keyShowMap"))) == (KEY_PRESSED))) || ((MEM_KEYSTATE(MEM_GETSECONDARYKEY("keyShowMap"))) == (KEY_PRESSED))) {
        MEM_ARRAYREMOVEVALUEONCE(MEMINT_KEYBUFFER_OFFSET, KEY_ESCAPE);
        SPRITEMAP_DESTROY();
        return;
    };
    if (SPRITEMAP_SPRITECURSORHNDL) {
        HER = HLP_GETNPC(1819);
        SPRITE_SETROTATIONSC(SPRITEMAP_SPRITECURSORHNDL, HER.TRAFOOBJTOWORLD[0], HER.TRAFOOBJTOWORLD[8]);
        if (SPRITEMAP_ROTATE90) {
            SPRITE_ROTATE(SPRITEMAP_SPRITECURSORHNDL, 90);
        };
        _SPRITEMAP_SETSPRITEPOSITION(SPRITEMAP_SPRITECURSORHNDL, HER.TRAFOOBJTOWORLD[3], HER.TRAFOOBJTOWORLD[11]);
    };
}

