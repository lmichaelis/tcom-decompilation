func void VOLKERGUARDS_CHANGERTN() {
    AI_USEMOB(NONE_6398_VOLKERGUARD, NPC_GETDETECTEDMOB(NONE_6398_VOLKERGUARD), -(1));
    B_STARTOTHERROUTINE(NONE_6398_VOLKERGUARD, "FIGHT");
    AI_USEMOB(NONE_6399_VOLKERGUARD, NPC_GETDETECTEDMOB(NONE_6399_VOLKERGUARD), -(1));
    B_STARTOTHERROUTINE(NONE_6399_VOLKERGUARD, "FIGHT");
    AI_USEMOB(NONE_6434_VOLKERGUARD, NPC_GETDETECTEDMOB(NONE_6434_VOLKERGUARD), -(1));
    B_STARTOTHERROUTINE(NONE_6434_VOLKERGUARD, "FIGHT");
}

func void VOLKERGUARDS_KILLMARVIN() {
    Q405_VOLKERGUARDSATTACK = 1;
    Q405_DIALOGUEWITHVOLKERGUARDS = 1;
    B_IMMEDIATEATTACKPLAYER(NONE_6434_VOLKERGUARD, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_6398_VOLKERGUARD, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_6399_VOLKERGUARD, AR_KILL);
    NONE_6434_VOLKERGUARD.GUILD = GIL_BDT;
    NONE_6398_VOLKERGUARD.GUILD = GIL_BDT;
    NONE_6399_VOLKERGUARD.GUILD = GIL_BDT;
    NPC_SETTRUEGUILD(HERO, HERO.GUILD);
    HERO.AIVAR[4] = FALSE;
    NPC_SETTRUEGUILD(NONE_6399_VOLKERGUARD, GIL_BDT);
}

func void VOLKERGUARDS_MAKEMORTAL() {
    NONE_6398_VOLKERGUARD.FLAGS = 0;
    NONE_6399_VOLKERGUARD.FLAGS = 0;
    NONE_6434_VOLKERGUARD.FLAGS = 0;
    NONE_6398_VOLKERGUARD.AIVAR[52] = TRUE;
    NONE_6399_VOLKERGUARD.AIVAR[52] = TRUE;
    NONE_6434_VOLKERGUARD.AIVAR[52] = TRUE;
    HERO.AIVAR[4] = FALSE;
}

func void VOLKERGUARDS_PREPARESCENE() {
    B_STARTOTHERROUTINE(NONE_6396_VOLKERGUARD, "JORNHOUSEWAIT");
    NPC_REFRESH(NONE_6396_VOLKERGUARD);
    B_STARTOTHERROUTINE(NONE_6397_VOLKERGUARD, "JORNHOUSEWAIT");
    NPC_REFRESH(NONE_6397_VOLKERGUARD);
    B_STARTOTHERROUTINE(NONE_6398_VOLKERGUARD, "JORNHOUSE");
    NPC_REFRESH(NONE_6398_VOLKERGUARD);
    B_STARTOTHERROUTINE(NONE_6399_VOLKERGUARD, "JORNHOUSE");
    NPC_REFRESH(NONE_6399_VOLKERGUARD);
    B_STARTOTHERROUTINE(NONE_6413_SACHS, "JORNHOUSE");
    NPC_REFRESH(NONE_6413_SACHS);
    B_REMOVENPC(54964);
    WLD_INSERTNPC(53197, "SLUMS_HOUSE17_14");
    WLD_INSERTNPC(55070, "SLUMS_HOUSE17_52");
    WLD_INSERTNPC(55072, "SLUMS_VOLKGERGUARD_01");
    WLD_INSERTNPC(55074, "SLUMS_VOLKGERGUARD_02");
}

func void Q405_VOLKERTIMELIMIT() {
    FF_APPLYONCEEXT(63830, 1000, 10);
}

func void Q405_DOORCLOSED_TIMELIMIT() {
    var int VOLKERGUARDATTACK_DOORCLOSED_COUNT;
    if ((Q405_CLOSEDDOORLOGENTRY) == (1)) {
        VOLKERGUARDATTACK_DOORCLOSED_COUNT = (VOLKERGUARDATTACK_DOORCLOSED_COUNT) + (1);
        PRINTD(CS2("Na 10 wyjd¹ ludzie lichwiarza: ", INTTOSTRING(VOLKERGUARDATTACK_DOORCLOSED_COUNT)));
        if ((VOLKERGUARDATTACK_DOORCLOSED_COUNT) == (10)) {
            PRINTD("Koniec czasu!");
            Q405_CLOSEDDOORLOGENTRY = 3;
            MOB_CHANGEFOCUSNAME("JORNHOUSE_BARREL_02", "MOBNAME_NOTHING");
            TELEPORTNPCTOWP(53168, "SLUMS_HOUSE17_VOLKERGUARD_01");
            MOB_CHANGEFOCUSNAME("JORNHOUSE_BARREL_01", "MOBNAME_NOTHING");
            AI_TELEPORTALWAYS(NONE_6396_VOLKERGUARD, NONE_6396_VOLKERGUARD.WP, TRUE);
            B_STARTOTHERROUTINE(NONE_6396_VOLKERGUARD, "JORNHOUSEOUTSIDE3");
            NPC_REFRESH(NONE_6396_VOLKERGUARD);
            CREATEINVITEM(NONE_6396_VOLKERGUARD, 36888);
            TELEPORTNPCTOWP(53177, "SLUMS_HOUSE17_VOLKERGUARD_02");
            AI_TELEPORTALWAYS(NONE_6397_VOLKERGUARD, NONE_6397_VOLKERGUARD.WP, TRUE);
            B_STARTOTHERROUTINE(NONE_6397_VOLKERGUARD, "JORNHOUSEOUTSIDE3");
            NPC_REFRESH(NONE_6397_VOLKERGUARD);
        };
    };
}

func void Q405_FOUNDJORN_APPLY() {
    var int Q405_FOUNDJORN_COUNT;
    Q405_FOUNDJORN_COUNT = (Q405_FOUNDJORN_COUNT) + (1);
    if ((Q405_FOUNDJORN_COUNT) == (2)) {
        B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q405_BEFORECUTSCENE");
        NPC_REFRESH(NONE_202_KESSEL);
        TELEPORTNPCTOWP(56688, NONE_202_KESSEL.WP);
        Q405_KESSEL_RTNCHECK = 1;
    };
    if ((Q405_FOUNDJORN_COUNT) == (4)) {
        RESERVED_VAR_INT_13 = TRUE;
        HERO.AIVAR[4] = TRUE;
        CUTSCENE_START(92599);
    };
}

func void Q405_FOUNDJORN_SACHS_APPLY() {
    var int Q405_FOUNDJORN_SACHS_COUNT;
    Q405_FOUNDJORN_SACHS_COUNT = (Q405_FOUNDJORN_SACHS_COUNT) + (1);
    if ((Q405_FOUNDJORN_SACHS_COUNT) == (4)) {
        HERO.AIVAR[4] = TRUE;
        CUTSCENE_START(92617);
    };
}

func void Q405_FOUNDJORN_DISABLE() {
    var int Q405_FOUNDJORN_DISABLE_COUNT;
    Q405_FOUNDJORN_DISABLE_COUNT = (Q405_FOUNDJORN_DISABLE_COUNT) + (1);
    if ((Q405_FOUNDJORN_DISABLE_COUNT) == (4)) {
        RESERVED_VAR_INT_13 = FALSE;
        WLD_SENDUNTRIGGER("Q405_JORN_01");
        WLD_SENDUNTRIGGER("Q405_JORN_02");
        WLD_SENDUNTRIGGER("Q405_JORN_03");
        WLD_SENDUNTRIGGER("Q405_JORN_04");
        WLD_SENDUNTRIGGER("Q405_JORN_05");
        WLD_SENDUNTRIGGER("Q405_JORN_06");
        WLD_SENDUNTRIGGER("Q405_JORN_07");
        WLD_SENDUNTRIGGER("Q405_JORN_08");
        WLD_SENDUNTRIGGER("Q405_JORN_09");
        WLD_SENDUNTRIGGER("Q405_JORN_10");
        WLD_SENDUNTRIGGER("Q405_JORN_11");
        WLD_SENDUNTRIGGER("Q405_JORN_12");
        WLD_SENDUNTRIGGER("Q405_JORN_13");
        WLD_SENDUNTRIGGER("Q405_JORN_14");
        WLD_SENDUNTRIGGER("Q405_JORN_15");
        WLD_SENDUNTRIGGER("Q405_JORN_16");
        WLD_SENDUNTRIGGER("Q405_JORN_17");
        WLD_SENDUNTRIGGER("Q405_JORN_18");
        WLD_SENDUNTRIGGER("Q405_JORN_19");
        WLD_SENDUNTRIGGER("Q405_JORN_20");
        WLD_SENDUNTRIGGER("Q405_JORN_21");
        WLD_SENDUNTRIGGER("Q405_JORN_22");
        WLD_SENDUNTRIGGER("Q405_JORN_23");
        WLD_SENDUNTRIGGER("Q405_JORN_24");
        WLD_SENDUNTRIGGER("Q405_JORN_25");
        WLD_SENDUNTRIGGER("Q405_JORN_26");
        WLD_SENDUNTRIGGER("Q405_JORN_27");
        WLD_SENDUNTRIGGER("Q405_JORN_28");
        B_STARTOTHERROUTINE(NONE_202_KESSEL, "Q405_WAIT");
        NPC_REFRESH(NONE_202_KESSEL);
        Q405_KESSEL_RTNCHECK = 2;
        NPC_SETTALENTSKILL(NONE_202_KESSEL, NPC_TALENT_BOW, 60);
        NONE_202_KESSEL.HITCHANCE[3] = 60;
        NPC_SETTALENTSKILL(NONE_202_KESSEL, NPC_TALENT_CROSSBOW, 60);
        NONE_202_KESSEL.HITCHANCE[4] = 60;
        NPC_SETTALENTSKILL(NONE_202_KESSEL, NPC_TALENT_1H, 60);
        NONE_202_KESSEL.HITCHANCE[1] = 60;
        NPC_SETTALENTSKILL(NONE_202_KESSEL, NPC_TALENT_2H, 60);
        NONE_202_KESSEL.HITCHANCE[1] = 60;
        AI_REMOVEWEAPON(HERO);
        AI_UNEQUIPWEAPONS(HERO);
        MDL_REMOVEOVERLAYMDS(HERO, "Humans_Crossbow_Dialogue.MDS");
        MDL_REMOVEOVERLAYMDS(NONE_202_KESSEL, "Humans_Crossbow_Dialogue.MDS");
        B_LOGENTRY(TOPIC_Q405, LOG_Q405_FOUNDJORN);
        HERO.AIVAR[4] = FALSE;
    };
}

func void Q405_FOUNDJORN_CLOSEDOOR() {
    var ZCMOVER MOVER2;
    var int MOVPTR2;
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int Q405_FOUNDJORN_CLOSEDOOR_COUNT;
    if ((Q405_FOUNDJORN_CLOSEDOOR_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q405_FoundJorn_CloseDoor");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q405_MOVER_DOOR_KESSEL_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("Q405_MOVER_DOOR_KESSEL_02");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_02", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("Q405_MOVER_DOOR_KESSEL_01");
        WLD_SENDTRIGGER("Q405_MOVER_DOOR_KESSEL_02");
        Q405_FOUNDJORN_CLOSEDOOR_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - Q405_FoundJorn_CloseDoor");
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_02", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(63838);
        Q405_FOUNDJORN_CLOSEDOOR_COUNT = 0;
    };
}

func void Q405_FOUNDJORN_CLOSEDOOR_V2() {
    var ZCMOVER MOVER2;
    var int MOVPTR2;
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int Q405_FOUNDJORN_CLOSEDOOR_V2_COUNT;
    if ((Q405_FOUNDJORN_CLOSEDOOR_V2_COUNT) == (0)) {
        PRINTD("Rozpoczynam - Q405_FoundJorn_CloseDoor_V2");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("Q405_MOVER_DOOR_KESSEL_02");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("Q405_MOVER_DOOR_KESSEL_03");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_02", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_03", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("Q405_MOVER_DOOR_KESSEL_02");
        WLD_SENDTRIGGER("Q405_MOVER_DOOR_KESSEL_03");
        Q405_FOUNDJORN_CLOSEDOOR_V2_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - Q405_FoundJorn_CloseDoor_V2");
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_02", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("Q405_DOOR_KESSEL_03", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(63844);
        Q405_FOUNDJORN_CLOSEDOOR_V2_COUNT = 0;
    };
}

