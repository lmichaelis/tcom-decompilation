instance DIA_MIRON_EXIT(C_INFO) {
    NPC = 53446;
    NR = 999;
    CONDITION = DIA_MIRON_EXIT_CONDITION;
    INFORMATION = DIA_MIRON_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_MIRON_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_MIRON_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
    RUNESTRADE_CHECKBOUGHTRUNES();
}

instance DIA_MIRON_Q503_KEY(C_INFO) {
    NPC = 53446;
    NR = 1;
    CONDITION = DIA_MIRON_Q503_KEY_CONDITION;
    INFORMATION = DIA_MIRON_Q503_KEY_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Do you have anything similar to this stone at your place?";
}

func int DIA_MIRON_Q503_KEY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 79668))) {
        if ((((NPC_HASITEMS(OTHER, 37542)) >= (1)) || ((NPC_HASITEMS(OTHER, 37543)) >= (1))) || ((NPC_HASITEMS(OTHER, 37544)) >= (1))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_MIRON_Q503_KEY_INFO() {
    var C_ITEM ITM;
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_15_01");
    B_STANDUP();
    Q503_SHOWKEYS();
    B_USEFAKEVOLFZACKKEY_START();
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_03_02");
    Q503_SHOWKEYS_BACK();
    B_USEFAKEVOLFZACKKEY_REMOVE();
    AI_RESETFACEANI(OTHER);
    INFO_CLEARCHOICES(76067);
    ITM = NPC_GETEQUIPPEDARMOR(OTHER);
    if ((NPC_HASEQUIPPEDARMOR(OTHER)) == (TRUE)) {
        if (((((((HLP_ISITEM(ITM, 35506)) == (TRUE)) || ((HLP_ISITEM(ITM, 35507)) == (TRUE))) || ((HLP_ISITEM(ITM, 35508)) == (TRUE))) || ((HLP_ISITEM(ITM, 35498)) == (TRUE))) || ((HLP_ISITEM(ITM, 35499)) == (TRUE))) || ((HLP_ISITEM(ITM, 35500)) == (TRUE))) {
            INFO_ADDCHOICE(76067, "This item is related to an investigation I am conducting.", 76075);
        };
    };
    if ((SQ411_MARVINGOTKEYS) == (TRUE)) {
        INFO_ADDCHOICE(76067, "I wanted to add it to my collection at home in Old Town.", 76073);
    };
    INFO_ADDCHOICE(76067, "It's irrelevant, I just want to buy another one.", 76072);
}

var int MIRON_Q503_KEYCOST;
func void DIA_MIRON_Q503_KEY_NOTIMPORTANT() {
    MIRON_Q503_KEYCOST = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_NotImportant_15_01");
    AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_NotImportant_03_02");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_NotImportant_03_04");
    AI_RESETFACEANI(SELF);
    INFO_CLEARCHOICES(76067);
}

func void DIA_MIRON_Q503_KEY_CITY() {
    MIRON_Q503_KEYCOST = 2;
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_City_15_01");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_City_03_02");
    AI_STARTFACEANI(OTHER, S_SMUG, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_City_15_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_City_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_City_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_City_03_06");
    INFO_CLEARCHOICES(76067);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

func void DIA_MIRON_Q503_KEY_GOTKEY() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    CREATEINVITEMS(SELF, 37544, 1);
    B_GIVEINVITEMS(SELF, OTHER, 37544, 1);
    Q503_GOTMUSEUMKEY = TRUE;
    AI_LOGENTRY(TOPIC_Q503, LOG_Q503_MIRON_GOTKEY);
    B_GIVEPLAYERXP(XP_Q503_GOTKEY);
    WLD_SENDTRIGGER("Q503_MOVER_KEY_MUSEUM");
}

func void DIA_MIRON_Q503_KEY_MILITIA() {
    AI_STARTFACEANI(OTHER, S_SERIOUS, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_Militia_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_Militia_15_02");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_Militia_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_Q503_Key_Militia_15_04");
    AI_STARTFACEANI(SELF, S_FRIGHTENED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_Q503_Key_Militia_03_05");
    INFO_CLEARCHOICES(76067);
    DIA_MIRON_Q503_KEY_GOTKEY();
}

instance DIA_MIRON_Q503_PAY1000(C_INFO) {
    NPC = 53446;
    NR = 1;
    CONDITION = DIA_MIRON_Q503_PAY1000_CONDITION;
    INFORMATION = DIA_MIRON_Q503_PAY1000_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_KEYBUY1000G;
}

func int DIA_MIRON_Q503_PAY1000_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 76067))) && ((MIRON_Q503_KEYCOST) == (1))) && ((Q503_GOTMUSEUMKEY) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_MIRON_Q503_PAY1000_INFO() {
    if ((NPC_HASITEMS(OTHER, 34203)) >= (Q503_KEYCOST_V1)) {
        NPC_REMOVEINVITEMS(SELF, 34203, Q503_KEYCOST_V1);
        DIA_MIRON_Q503_KEY_GOTKEY();
    };
    B_SAY(SELF, OTHER, "$NOGOLD");
}

instance DIA_MIRON_Q503_PAY500(C_INFO) {
    NPC = 53446;
    NR = 1;
    CONDITION = DIA_MIRON_Q503_PAY500_CONDITION;
    INFORMATION = DIA_MIRON_Q503_PAY500_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_KEYBUY500G;
}

func int DIA_MIRON_Q503_PAY500_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_Q503)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 76067))) && ((MIRON_Q503_KEYCOST) == (2))) && ((Q503_GOTMUSEUMKEY) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_MIRON_Q503_PAY500_INFO() {
    if ((NPC_HASITEMS(OTHER, 34203)) >= (Q503_KEYCOST_V2)) {
        NPC_REMOVEINVITEMS(SELF, 34203, Q503_KEYCOST_V2);
        DIA_MIRON_Q503_KEY_GOTKEY();
    };
    B_SAY(SELF, OTHER, "$NOGOLD");
}

instance DIA_MIRON_HELLO(C_INFO) {
    NPC = 53446;
    NR = 1;
    CONDITION = DIA_MIRON_HELLO_CONDITION;
    INFORMATION = DIA_MIRON_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_MIRON_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_MIRON_HELLO_INFO() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_HELLO_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_HELLO_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_HELLO_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_HELLO_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_HELLO_03_05");
    AI_RESETFACEANI(SELF);
    TEACHER_LOGENTRY_MUSEUM();
}

instance DIA_MIRON_GOTOLDCOINS(C_INFO) {
    NPC = 53446;
    NR = 900;
    CONDITION = DIA_MIRON_GOTOLDCOINS_CONDITION;
    INFORMATION = DIA_MIRON_GOTOLDCOINS_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "I brought some old coins...";
}

func int DIA_MIRON_GOTOLDCOINS_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 76082)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

var int MIRON_COUNTOLDCOINS;
var int MIRON_REWARD_TIER1;
var int MIRON_REWARD_TIER2;
var int MIRON_REWARD_TIER3;
func void DIA_MIRON_GOTOLDCOINS_CHOCIES() {
    INFO_CLEARCHOICES(76085);
    INFO_ADDCHOICE(76085, DIALOG_BACK, 76098);
    if ((NPC_HASITEMS(OTHER, 34204)) >= (1)) {
        INFO_ADDCHOICE(76085, "(Give 1 old coin)", 76095);
    };
    if ((NPC_HASITEMS(OTHER, 34204)) >= (5)) {
        INFO_ADDCHOICE(76085, "(Give 5 old coins)", 76096);
    };
    if (((NPC_HASITEMS(OTHER, 34204)) >= (1)) && ((MIRON_REWARD_TIER3) == (TRUE))) {
        INFO_ADDCHOICE(76085, "(Give all old coins)", 76097);
    };
}

func void DIA_MIRON_GOTOLDCOINS_REWARD() {
    var int RND_MIRON;
    RND_MIRON = HLP_RANDOM(2);
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    if ((RND_MIRON) == (0)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_02");
    };
    if ((RND_MIRON) == (1)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_03");
    };
    if ((MIRON_REWARD_TIER1) == (FALSE)) {
        if ((MIRON_COUNTOLDCOINS) >= (15)) {
            MIRON_REWARD_TIER1 = TRUE;
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_04");
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_05");
            CREATEINVITEMS(SELF, 34354, 3);
            B_GIVEINVITEMS(SELF, OTHER, 34354, 3);
            CREATEINVITEMS(SELF, 37730, 1);
            B_GIVEINVITEMS(SELF, OTHER, 37730, 1);
            CREATEINVITEMS(SELF, 37734, 1);
            B_GIVEINVITEMS(SELF, OTHER, 37734, 1);
        };
    };
    if ((MIRON_REWARD_TIER2) == (FALSE)) {
        if ((MIRON_COUNTOLDCOINS) >= (30)) {
            MIRON_REWARD_TIER2 = TRUE;
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_06");
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_07");
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_08");
            LOG_CREATETOPIC(TOPIC_CITYTRADER, LOG_NOTE);
            AI_LOGENTRY(TOPIC_CITYTRADER, LOG_TRADER_CITY_MIRON);
        };
    };
    if ((MIRON_REWARD_TIER3) == (FALSE)) {
        if ((MIRON_COUNTOLDCOINS) >= (45)) {
            MIRON_REWARD_TIER3 = TRUE;
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_09");
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_10");
            AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_11");
            CREATEINVITEMS(SELF, 39563, 1);
            B_GIVEINVITEMS(SELF, OTHER, 39563, 1);
        };
    };
    if ((MIRON_COUNTOLDCOINS) >= (60)) {
        MIRON_COUNTOLDCOINS = 45;
        AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_12");
        CREATEINVITEMS(SELF, 37718, 1);
        B_GIVEINVITEMS(SELF, OTHER, 37718, 1);
        CREATEINVITEMS(SELF, 37702, 1);
        B_GIVEINVITEMS(SELF, OTHER, 37702, 1);
        CREATEINVITEMS(SELF, 37706, 1);
        B_GIVEINVITEMS(SELF, OTHER, 37706, 1);
    };
}

func void DIA_MIRON_GOTOLDCOINS_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Miron_GotOldCoins_15_01");
    if ((NPC_HASITEMS(OTHER, 34204)) >= (1)) {
        DIA_MIRON_GOTOLDCOINS_CHOCIES();
    };
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Miron_GotOldCoins_03_13");
    AI_RESETFACEANI(SELF);
}

func void DIA_MIRON_GOTOLDCOINS_1() {
    CREATEINVITEMS(SELF, 34203, (MIRON_OLDCOINPRICE) * (1));
    B_GIVEINVITEMS(SELF, OTHER, 34203, (MIRON_OLDCOINPRICE) * (1));
    B_GIVEPLAYERXP((XP_MIRON_OLDCOIN) * (1));
    MIRON_COUNTOLDCOINS = (MIRON_COUNTOLDCOINS) + (1);
    NPC_REMOVEINVITEMS(SELF, 34204, 1);
    DIA_MIRON_GOTOLDCOINS_REWARD();
    B_GIVEINVITEMS(OTHER, SELF, 34204, 1);
    DIA_MIRON_GOTOLDCOINS_CHOCIES();
}

func void DIA_MIRON_GOTOLDCOINS_5() {
    CREATEINVITEMS(SELF, 34203, (MIRON_OLDCOINPRICE) * (5));
    B_GIVEINVITEMS(SELF, OTHER, 34203, (MIRON_OLDCOINPRICE) * (5));
    B_GIVEPLAYERXP((XP_MIRON_OLDCOIN) * (5));
    MIRON_COUNTOLDCOINS = (MIRON_COUNTOLDCOINS) + (5);
    NPC_REMOVEINVITEMS(SELF, 34204, 5);
    DIA_MIRON_GOTOLDCOINS_REWARD();
    B_GIVEINVITEMS(OTHER, SELF, 34204, 5);
    DIA_MIRON_GOTOLDCOINS_CHOCIES();
}

func void DIA_MIRON_GOTOLDCOINS_ALL() {
    CREATEINVITEMS(SELF, 34203, (MIRON_OLDCOINPRICE) * (NPC_HASITEMS(OTHER, 34204)));
    B_GIVEINVITEMS(SELF, OTHER, 34203, (MIRON_OLDCOINPRICE) * (NPC_HASITEMS(OTHER, 34204)));
    B_GIVEPLAYERXP((XP_MIRON_OLDCOIN) * (NPC_HASITEMS(OTHER, 34204)));
    MIRON_COUNTOLDCOINS = (MIRON_COUNTOLDCOINS) + (NPC_HASITEMS(OTHER, 34204));
    NPC_REMOVEINVITEMS(SELF, 34204, NPC_HASITEMS(SELF, 34204));
    DIA_MIRON_GOTOLDCOINS_REWARD();
    B_GIVEINVITEMS(OTHER, SELF, 34204, NPC_HASITEMS(OTHER, 34204));
    DIA_MIRON_GOTOLDCOINS_CHOCIES();
}

func void DIA_MIRON_GOTOLDCOINS_BACK() {
    INFO_CLEARCHOICES(76085);
}

instance DIA_MIRON_TRADE(C_INFO) {
    NPC = 53446;
    NR = 850;
    CONDITION = DIA_MIRON_TRADE_CONDITION;
    INFORMATION = DIA_MIRON_TRADE_INFO;
    PERMANENT = TRUE;
    TRADE = TRUE;
    DESCRIPTION = "Let's deal.";
}

func int DIA_MIRON_TRADE_CONDITION() {
    if ((MIRON_REWARD_TIER2) == (TRUE)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_MIRON_TRADE_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_LetsTrade");
    B_GIVETRADEINV(SELF);
}

instance DIA_MIRON_PICKPOCKET(C_INFO) {
    NPC = 53446;
    NR = 900;
    CONDITION = DIA_MIRON_PICKPOCKET_CONDITION;
    INFORMATION = DIA_MIRON_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_80;
}

func int DIA_MIRON_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_MIRON_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(76102);
    INFO_ADDCHOICE(76102, DIALOG_BACK, 76106);
    INFO_ADDCHOICE(76102, DIALOG_PICKPOCKET, 76105);
}

func void DIA_MIRON_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(76102);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(76102);
}

func void DIA_MIRON_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(76102);
}

