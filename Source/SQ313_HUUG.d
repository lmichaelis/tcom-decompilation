instance SQ313_HUUG(CUTSCENE) {
    ONSTART = FUNCTION(92940);
}

func void SQ313_HUUG_WAIT() {
    AI_WAITTILLEND(HERO, KDF_6404_TRIMEGISTO);
    AI_WAITTILLEND(KDF_6404_TRIMEGISTO, HERO);
}

func void SQ313_HUUG_START() {
    TRIMEGISTO_SQ313_FOLLOWME = 0;
    WLD_SENDTRIGGER("SQ313_ESCAPE_02");
    TELEPORTNPCTOWP(1819, "SLUMS_SQ313_CUTSCENE_HERO");
    TELEPORTNPCTOWP(51943, KDF_6404_TRIMEGISTO.WP);
    TELEPORTNPCTOWP(55041, NONE_1004_HUUG.WP);
    NPC_CLEARAIQUEUE(KDF_6404_TRIMEGISTO);
    NPC_CLEARAIQUEUE(NONE_1004_HUUG);
    KDF_6404_TRIMEGISTO.AIVAR[92] = TRUE;
    NONE_1004_HUUG.AIVAR[92] = TRUE;
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_SETWALKMODE(KDF_6404_TRIMEGISTO, NPC_WALK);
    AI_SETWALKMODE(NONE_1004_HUUG, NPC_WALK);
    AI_WAIT(KDF_6404_TRIMEGISTO, 1050253722);
    AI_WAIT(NONE_1004_HUUG, 1036831949);
    AI_GOTOWP(HERO, "SLUMS_SQ313_CUTSCENE_HERO_02");
    AI_GOTOWP(KDF_6404_TRIMEGISTO, "SLUMS_SQ313_CUTSCENE_MAGE_02");
    AI_GOTOWP(NONE_1004_HUUG, "SLUMS_PATH_121");
    AI_TURNAWAY(KDF_6404_TRIMEGISTO, HERO);
    AI_TURNAWAY(HERO, KDF_6404_TRIMEGISTO);
    AI_WAIT(KDF_6404_TRIMEGISTO, 1058642330);
    AI_WAIT(HERO, 1053609165);
    AI_PLAYANI(KDF_6404_TRIMEGISTO, R_SCRATCHHEAD);
    AI_WAIT(KDF_6404_TRIMEGISTO, 1071225242);
    AI_PLAYANI(KDF_6404_TRIMEGISTO, "T_DONTKNOW");
    AI_PLAYANI(HERO, R_SCRATCHLSHOULDER);
    AI_WAIT(HERO, 1074161254);
    AI_PLAYANI(HERO, R_LEGSHAKE);
    AI_WAIT(HERO, 1077516698);
    SQ313_HUUG_WAIT();
    AI_FUNCTION(HERO, 92943);
    AI_WAIT(HERO, 1050253722);
    AI_PLAYANI(HERO, R_SCRATCHRSHOULDER);
    AI_WAIT(KDF_6404_TRIMEGISTO, 1063675494);
    AI_PLAYANI(KDF_6404_TRIMEGISTO, T_CANNOTTAKE);
    AI_WAIT(HERO, 1065353216);
    SQ313_HUUG_WAIT();
    AI_FUNCTION(HERO, 92942);
    AI_WAIT(KDF_6404_TRIMEGISTO, 1036831949);
    AI_PLAYANI(KDF_6404_TRIMEGISTO, "T_EXPLOSION_SCARED_HERO");
    AI_TURNTONPC(KDF_6404_TRIMEGISTO, NONE_1004_HUUG);
    AI_WAIT(HERO, 1050253722);
    AI_PLAYANI(HERO, T_SEARCH);
    AI_TURNTONPC(HERO, NONE_1004_HUUG);
    AI_WAIT(HERO, 1036831949);
    SQ313_HUUG_WAIT();
    AI_FUNCTION(HERO, 92944);
    AI_WAIT(HERO, 1036831949);
    AI_PLAYANI(HERO, "T_FACEPALM");
    AI_WAIT(KDF_6404_TRIMEGISTO, 1053609165);
    AI_PLAYANI(KDF_6404_TRIMEGISTO, "T_FORGETIT");
    AI_WAIT(HERO, 1036831949);
    SQ313_HUUG_WAIT();
    AI_FUNCTION(HERO, 92941);
}

func void SQ313_HUUG_END() {
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_01");
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_02");
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_03");
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_04");
    SQ313_HUUGCUTSCENEENABLE = 3;
    NONE_1004_HUUG.AIVAR[92] = FALSE;
    KDF_6404_TRIMEGISTO.AIVAR[92] = FALSE;
    B_STARTOTHERROUTINE(NONE_1004_HUUG, "SQ313_TRAP");
    NPC_REFRESH(NONE_1004_HUUG);
    B_STARTOTHERROUTINE(KDF_6404_TRIMEGISTO, "SQ313_TRAP");
    NPC_REFRESH(KDF_6404_TRIMEGISTO);
    TELEPORTNPCTOWP(51943, KDF_6404_TRIMEGISTO.WP);
    HERO.AIVAR[4] = FALSE;
    DIACAM_ENABLE();
}

func void SQ313_HUUG_CLOSEDOOR() {
    SQ313_HUUGDOOR();
    SND_PLAY("DOOR_SLAM");
}

func void SQ313_HUUG_CAMERA_01() {
    WLD_SENDTRIGGER("SQ313_ESCAPE_03");
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_02");
    TELEPORTNPCTOWP(55041, "SLUMS_PATH_241");
}

func void SQ313_HUUG_CAMERA_02() {
    WLD_SENDTRIGGER("SQ313_ESCAPE_04");
    WLD_SENDUNTRIGGER("SQ313_ESCAPE_03");
}

