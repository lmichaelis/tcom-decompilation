instance DIA_NELSON_EXIT(C_INFO) {
    NPC = 58222;
    NR = 999;
    CONDITION = DIA_NELSON_EXIT_CONDITION;
    INFORMATION = DIA_NELSON_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_NELSON_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_NELSON_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NELSON_WHO(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_WHO_CONDITION;
    INFORMATION = DIA_NELSON_WHO_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Who are you?";
}

func int DIA_NELSON_WHO_CONDITION() {
    return TRUE;
}

func void DIA_NELSON_WHO_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhoAreYou");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Who_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Who_03_03");
    if ((TRADER_LOGENTRY_WOLFSDEN_LUCY) == (FALSE)) {
        TRADER_LOGENTRY_WOLFSDEN_LUCY = TRUE;
        LOG_CREATETOPIC(TOPIC_WOLFSDENTRADER, LOG_NOTE);
        AI_LOGENTRY(TOPIC_WOLFSDENTRADER, LOG_TRADE_WOLFSDEN_LUCY);
    };
    NELSON_CANTEACH = TRUE;
}

instance DIA_NELSON_BOW(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_BOW_CONDITION;
    INFORMATION = DIA_NELSON_BOW_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Nice bow.";
}

func int DIA_NELSON_BOW_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 81060)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_BOW_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Bow_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Bow_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Bow_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_03_08");
    INFO_CLEARCHOICES(81063);
    INFO_ADDCHOICE(81063, "I have to think about it.", 81077);
    INFO_ADDCHOICE(81063, "Well... why not?", 81076);
}

var int NELSON_QUEST_BUY;
var int NELSON_QUEST_TALK;
var int NELSON_QUEST_WHAT;
var int NELSON_TAKEQUEST;
func void DIA_NELSON_QUEST_CHOICES() {
    INFO_CLEARCHOICES(81078);
    if ((NELSON_QUEST_WHAT) == (FALSE)) {
        INFO_ADDCHOICE(81078, "So what do you want from me?", 81074);
    };
    INFO_ADDCHOICE(81078, DIALOG_BACK, 81075);
    if ((NELSON_QUEST_TALK) == (FALSE)) {
        INFO_ADDCHOICE(81078, "Are you sure that your father cannot be reasoned with?", 81073);
    };
    if ((NELSON_QUEST_BUY) == (FALSE)) {
        INFO_ADDCHOICE(81078, "Can't you just buy that horn?", 81072);
    };
    INFO_CLEARCHOICES(81063);
    if ((NELSON_QUEST_WHAT) == (FALSE)) {
        INFO_ADDCHOICE(81063, "So what do you want from me?", 81074);
    };
    INFO_ADDCHOICE(81063, DIALOG_ENDE, 81075);
    if ((NELSON_QUEST_TALK) == (FALSE)) {
        INFO_ADDCHOICE(81063, "Are you sure that your father cannot be reasoned with?", 81073);
    };
    if ((NELSON_QUEST_BUY) == (FALSE)) {
        INFO_ADDCHOICE(81063, "Can't you just buy that horn?", 81072);
    };
}

func void DIA_NELSON_QUEST() {
    NELSON_TAKEQUEST = FALSE;
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Quest_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Quest_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Quest_03_03");
    LOG_CREATETOPIC(TOPIC_SQ402, LOG_MISSION);
    LOG_SETSTATUS(_@(MIS_SQ402), TOPIC_SQ402, LOG_RUNNING);
    AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_START);
    DIA_NELSON_QUEST_CHOICES();
}

func void DIA_NELSON_TAKEQUEST_QUEST_BUY() {
    NELSON_QUEST_BUY = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TakeQuest_Buy_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Buy_03_03");
    DIA_NELSON_QUEST_CHOICES();
}

func void DIA_NELSON_TAKEQUEST_QUEST_TALK() {
    NELSON_QUEST_TALK = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TakeQuest_Talk_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Talk_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_Talk_03_03");
    AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_NELSON_FATHER);
    DIA_NELSON_QUEST_CHOICES();
}

func void DIA_NELSON_TAKEQUEST_QUEST_WHAT() {
    NELSON_QUEST_WHAT = TRUE;
    SQ402_NELSON_READYFORHUNT = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TakeQuest_What_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_What_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TakeQuest_What_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_What_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_What_03_05");
    AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_NELSON_SHADOWBEAST);
    NPC_EXCHANGEROUTINE(SELF, "FIRETOWER");
    DIA_NELSON_QUEST_CHOICES();
}

func void DIA_NELSON_TAKEQUEST_QUEST_END() {
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_03_03");
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_NELSON_BOW_YES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Bow_Yes_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_Yes_03_02");
    DIA_NELSON_QUEST();
}

func void DIA_NELSON_BOW_MAYBE() {
    NELSON_TAKEQUEST = TRUE;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Bow_Maybe_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Bow_Maybe_03_02");
    INFO_CLEARCHOICES(81063);
}

instance DIA_NELSON_TAKEQUEST(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_TAKEQUEST_CONDITION;
    INFORMATION = DIA_NELSON_TAKEQUEST_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I've thought it over. I'll help you.";
}

func int DIA_NELSON_TAKEQUEST_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 81063)) && ((NELSON_TAKEQUEST) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_TAKEQUEST_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TakeQuest_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TakeQuest_03_02");
    DIA_NELSON_QUEST();
}

instance DIA_NELSON_LETSHUNT(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_LETSHUNT_CONDITION;
    INFORMATION = DIA_NELSON_LETSHUNT_INFO;
    PERMANENT = TRUE;
    IMPORTANT = TRUE;
}

func int DIA_NELSON_LETSHUNT_CONDITION() {
    if (((LOG_GETSTATUS(MIS_SQ402)) == (LOG_RUNNING)) && (NPC_ISINSTATE(SELF, 61599))) {
        if (((SQ402_NELSON_READYFORHUNT) == (1)) || ((SQ402_NELSON_READYFORHUNT) == (3))) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_LETSHUNT_INFO() {
    if ((SQ402_NELSON_READYFORHUNT) == (1)) {
        if ((NPC_GETDISTTOWP(SELF, "PART15_PATH_39")) <= (2000)) {
            AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_15_01");
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_03_02");
            INFO_CLEARCHOICES(81081);
            INFO_ADDCHOICE(81081, "Yes. Lead the way.", 81084);
            INFO_ADDCHOICE(81081, "I need to gather my strength.", 81085);
        } else {
            DIA_NELSON_TAKEQUEST_QUEST_END();
        };
    };
    if ((SQ402_NELSON_READYFORHUNT) == (3)) {
        SQ402_NELSON_READYFORHUNT = 4;
        SQ402_NELSON_TALKWITHGASTON_DAY = WLD_GETDAY();
        AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_15_03");
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_03_04");
        AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_15_05");
        AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_15_06");
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_03_07");
        AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_NELSON_FINISHHUNT_V2);
        NPC_EXCHANGEROUTINE(SELF, TALK);
        B_STARTOTHERROUTINE(BAU_10029_GASTON, TALK);
    };
}

func void DIA_NELSON_LETSHUNT_YES() {
    SQ402_NELSON_READYFORHUNT = 2;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_Yes_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_Yes_03_02");
    INFO_CLEARCHOICES(81081);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_NELSON_STARTHUNT);
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "GUIDE");
    WLD_INSERTNPC(50786, "PART10_FOREST_SHADOWBEAST");
    if ((NPC_ISDEAD(SHADOWBEAST_BEFORE_NELSON)) == (FALSE)) {
        B_REMOVENPC(50785);
    };
}

func void DIA_NELSON_LETSHUNT_NO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_LetsHunt_No_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_LetsHunt_No_03_02");
    INFO_CLEARCHOICES(81081);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_NELSON_NEARSHADOW(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_NEARSHADOW_CONDITION;
    INFORMATION = DIA_NELSON_NEARSHADOW_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_NELSON_NEARSHADOW_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ402)) == (LOG_RUNNING)) && ((NPC_GETDISTTOWP(SELF, "PART10_FOREST_02")) <= (700))) && ((SQ402_NELSON_READYFORHUNT) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_NEARSHADOW_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_NEARSHADOW_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_NEARSHADOW_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_NEARSHADOW_03_03");
    INFO_CLEARCHOICES(81086);
    INFO_ADDCHOICE(81086, "Neither do I. We better back off.", 81090);
    INFO_ADDCHOICE(81086, "We can't retreat now. Stay here and cover me.", 81089);
}

func void DIA_NELSON_NEARSHADOW_NO() {
    B_HEALNPC_SELF();
    SELF.FLAGS = 0;
    SELF.ATTRIBUTE[0] = 2500;
    SELF.ATTRIBUTE[1] = 2500;
    SQ402_NELSON_READYFORHUNT = 6;
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_NEARSHADOW_No_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_NEARSHADOW_No_03_02");
    INFO_CLEARCHOICES(81086);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, FOLLOW);
}

func void DIA_NELSON_NEARSHADOW_YES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_NEARSHADOW_Yes_15_01");
    INFO_CLEARCHOICES(81086);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, FLEE);
    AI_LOGENTRY(TOPIC_SQ402, LOG_SQ402_FAILED_V1);
    LOG_SETSTATUS(_@(MIS_SQ402), TOPIC_SQ402, LOG_FAILED);
    SELF.AIVAR[15] = FALSE;
}

instance DIA_NELSON_STOPFOLLOW(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_STOPFOLLOW_CONDITION;
    INFORMATION = DIA_NELSON_STOPFOLLOW_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_NELSON_STOPFOLLOW_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 81086)) && ((LOG_GETSTATUS(MIS_SQ402)) == (LOG_RUNNING))) && ((SQ402_NELSON_READYFORHUNT) == (6))) {
        if ((NPC_GETDISTTONPC(HERO, SHADOWBEAST_NELSON)) >= (4400)) {
            return TRUE;
        };
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_STOPFOLLOW_INFO() {
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_StopFollow_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_StopFollow_03_02");
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "FIGHT");
}

instance DIA_NELSON_AFTERFIGHT(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_AFTERFIGHT_CONDITION;
    INFORMATION = DIA_NELSON_AFTERFIGHT_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_NELSON_AFTERFIGHT_CONDITION() {
    if ((LOG_GETSTATUS(MIS_SQ402)) == (LOG_RUNNING)) {
        if (NPC_ISDEAD(SHADOWBEAST_NELSON)) {
            if (((SQ402_NELSON_READYFORHUNT) == (6)) || ((SQ402_NELSON_READYFORHUNT) == (2))) {
                return TRUE;
            };
        };
    };
    return 0 /* !broken stack! */;
}

var int NELSON_AFTERHUNT;
var int NELSON_AFTERHUNT_DAY;
func void DIA_NELSON_AFTERFIGHT_INFO() {
    B_HEALNPC_SELF();
    SELF.FLAGS = 2;
    NELSON_AFTERHUNT = TRUE;
    NELSON_AFTERHUNT_DAY = WLD_GETDAY();
    SQ402_NELSON_READYFORHUNT = 7;
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_AfterFight_03_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_AfterFight_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_AfterFight_03_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_AfterFight_15_04");
    AI_STOPPROCESSINFOS(SELF);
    B_LOGENTRY(TOPIC_SQ402, LOG_SQ402_FINISH_V1);
    LOG_SETSTATUS(_@(MIS_SQ402), TOPIC_SQ402, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_SQ402_FINISH_V1);
    CREATEINVITEMS(SELF, 34203, SQ402_REWARD_V2);
    B_GIVEINVITEMS(SELF, OTHER, 34203, SQ402_REWARD_V2);
    NPC_EXCHANGEROUTINE(SELF, START);
    MDL_APPLYOVERLAYMDS(SELF, HUMANSRELAXEDMDS);
    SELF.AIVAR[15] = FALSE;
}

instance DIA_NELSON_SQ402_FATHER(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_SQ402_FATHER_CONDITION;
    INFORMATION = DIA_NELSON_SQ402_FATHER_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "And how is it, did your father leave you alone?";
}

func int DIA_NELSON_SQ402_FATHER_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_SQ402)) == (LOG_SUCCESS)) && ((NELSON_AFTERHUNT) == (TRUE))) && ((NELSON_AFTERHUNT_DAY) <= ((WLD_GETDAY()) - (1)))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_SQ402_FATHER_INFO() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_SQ402_Father_15_01");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_SQ402_Father_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_SQ402_Father_03_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_SQ402_Father_03_04");
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_SQ402_Father_15_05");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_SQ402_Father_03_06");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    B_GIVEPLAYERXP(XP_SQ402_BONUSEXP_WOLFSDEN);
}

instance DIA_NELSON_CANYOUTEACH(C_INFO) {
    NPC = 58222;
    NR = 3;
    CONDITION = DIA_NELSON_CANYOUTEACH_CONDITION;
    INFORMATION = DIA_NELSON_CANYOUTEACH_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Could you teach me something?";
}

func int DIA_NELSON_CANYOUTEACH_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 81060)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_CANYOUTEACH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_CanYouTeach_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_CanYouTeach_09_01");
    LOG_CREATETOPIC(TOPIC_WOLFSDENTEACHER, LOG_NOTE);
    AI_LOGENTRY(TOPIC_WOLFSDENTEACHER, LOG_WOLFSDENTEACHER_NELSON);
}

var int NELSON_GOODSTUDENT;
var int NELSON_GOODSTUDENT_GIFT;
var int NELSON_NOMORE;
var string NELSON_PRINTS;
var int NELSON_CURRENTBLEVEL;
instance DIA_NELSON_TEACH(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_TEACH_CONDITION;
    INFORMATION = DIA_NELSON_TEACH_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Teach me.";
}

func int DIA_NELSON_TEACH_CONDITION() {
    if ((((NELSON_CANTEACH) == (TRUE)) && (NPC_KNOWSINFO(OTHER, 81102))) && ((NELSON_NOMORE) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_TEACH_CHOICES() {
    var int NELSON_GOLDCOST;
    NELSON_GOLDCOST = 15;
    NELSON_CURRENTBLEVEL = OTHER.AIVAR[86];
    INFO_CLEARCHOICES(81110);
    INFO_ADDCHOICE(81110, DIALOG_BACK, 81115);
    INFO_ADDCHOICE(81110, B_BUILDLEARNSTRING2(PRINT_LEARNBOW1, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_BOW, 1), NELSON_GOLDCOST), 81116);
    INFO_ADDCHOICE(81110, B_BUILDLEARNSTRING2(PRINT_LEARNBOW5, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_BOW, 5), (NELSON_GOLDCOST) * (5)), 81117);
    if ((OTHER.AIVAR[86]) >= (60)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_NoMore_13_01");
        NELSON_NOMORE = TRUE;
    };
}

func void DIA_NELSON_TEACH_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Teach_15_00");
    DIA_NELSON_TEACH_CHOICES();
}

func void DIA_NELSON_TEACH_BACK() {
    INFO_CLEARCHOICES(81110);
    if (((NELSON_GOODSTUDENT) >= (60)) && ((NELSON_GOODSTUDENT_GIFT) == (FALSE))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TeachBack_13_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_TeachBack_13_03");
        B_GIVEINVITEMS(SELF, OTHER, 35348, 1);
        NELSON_GOODSTUDENT_GIFT = TRUE;
        AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TeachBack_15_04");
    };
}

func void DIA_NELSON_TEACH_BOW1() {
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_PAYMENT1)) {
        if ((NELSON_CURRENTBLEVEL) < (OTHER.AIVAR[86])) {
            SND_PLAY(GELDBEUTEL);
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_PAYMENT1);
            NELSON_GOODSTUDENT += 1;
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_PAYMENT1);
        };
        B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_BOW, 1, 60);
        DIA_NELSON_TEACH_CHOICES();
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_PAYMENT1)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Teach_BOW1_13_01");
        NELSON_PRINTS = CONCATSTRINGS(PRINT_RGOLD, INTTOSTRING(NELSON_PAYMENT1));
        PRINTSCREEN(NELSON_PRINTS, -(1), -(1), FONT_SCREEN, 2);
        DIA_NELSON_TEACH_CHOICES();
    };
}

func void DIA_NELSON_TEACH_BOW5() {
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_PAYMENT5)) {
        if ((NELSON_CURRENTBLEVEL) < (OTHER.AIVAR[86])) {
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_PAYMENT5);
            SND_PLAY(GELDBEUTEL);
            NELSON_GOODSTUDENT += 5;
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_PAYMENT5);
        };
        B_TEACHFIGHTTALENTPERCENT(SELF, OTHER, NPC_TALENT_BOW, 5, 60);
        DIA_NELSON_TEACH_CHOICES();
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_PAYMENT5)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Teach_BOW5_13_01");
        NELSON_PRINTS = CONCATSTRINGS(PRINT_RGOLD, INTTOSTRING(NELSON_PAYMENT5));
        PRINTSCREEN(NELSON_PRINTS, -(1), -(1), FONT_SCREEN, 2);
        DIA_NELSON_TEACH_CHOICES();
    };
}

instance DIA_NELSON_WL_AMBIENT(C_INFO) {
    NPC = 58222;
    NR = 997;
    CONDITION = DIA_NELSON_AMBIENT_WL_CONDITION;
    INFORMATION = DIA_NELSON_AMBIENT_WL_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How are you doing?";
}

func int DIA_NELSON_AMBIENT_WL_CONDITION() {
    if (NPC_KNOWSINFO(OTHER, 81060)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_AMBIENT_WL_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Ambient_WL_15_00");
    if (!(NPC_KNOWSINFO(OTHER, 81099))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Ambient_WL_13_01");
    };
    if (NPC_KNOWSINFO(OTHER, 81099)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Ambient_WL_13_02");
    };
}

instance DIA_NELSON_HUNTING_BASE(C_INFO) {
    NPC = 58222;
    NR = 940;
    CONDITION = DIA_NELSON_HUNTING_BASE_CONDITION;
    INFORMATION = DIA_NELSON_HUNTING_BASE_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = B_BUILDLEARNSTRING2(PRINT_LEARN_HUNTING_BASE, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_FUR), NELSON_BASETROPHY);
}

func int DIA_NELSON_HUNTING_BASE_CONDITION() {
    if ((((NELSON_CANTEACH) == (TRUE)) && (NPC_KNOWSINFO(OTHER, 81102))) && ((PLAYER_TALENT_TAKEANIMALTROPHY[2]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_HUNTING_BASE_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Base_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_BASETROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[2]) == (TRUE)) {
            if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_SNEAK)) == (0)) {
                PRINTSCREEN(PRINT_LEARNSNEAK, -(1), YPOS_LEVELUP, FONT_SCREEN, 2);
                AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Base_Sneak_03_01");
                B_TEACHTHIEFTALENT(BAU_10028_NELSON, HERO, NPC_TALENT_SNEAK, 1);
                AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Base_Sneak_03_02");
            };
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_BASETROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_03_02");
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_BASETROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_03_03");
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_03_04");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHY, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 10;
            if (((NELSON_GOODSTUDENT) >= (60)) && ((NELSON_GOODSTUDENT_GIFT) == (FALSE))) {
                AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_13_06");
                AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_13_07");
                B_GIVEINVITEMS(SELF, OTHER, 35348, 1);
                NELSON_GOODSTUDENT_GIFT = TRUE;
                AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TeachBack_15_04");
            };
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_BASETROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Base_03_05");
    };
}

instance DIA_NELSON_HUNTING_SPECIAL(C_INFO) {
    NPC = 58222;
    NR = 1;
    CONDITION = DIA_NELSON_HUNTING_SPECIAL_CONDITION;
    INFORMATION = DIA_NELSON_HUNTING_SPECIAL_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "Can you teach me something about hunting?";
}

func int DIA_NELSON_HUNTING_SPECIAL_CONDITION() {
    if (((((NELSON_CANTEACH) == (TRUE)) && (NPC_KNOWSINFO(OTHER, 81102))) && ((NELSON_ALLHUNT) == (FALSE))) && ((PLAYER_TALENT_TAKEANIMALTROPHY[2]) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_HUNTING_SPECIAL_CHOICES() {
    INFO_CLEARCHOICES(81124);
    if (((NELSON_GOODSTUDENT_GIFT) == (FALSE)) && ((NELSON_GOODSTUDENT) >= (60))) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_SpecialGift_13_01");
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_SpecialGift_13_03");
        B_GIVEINVITEMS(SELF, OTHER, 35348, 1);
        NELSON_GOODSTUDENT_GIFT = TRUE;
        AI_OUTPUT(OTHER, SELF, "DIA_Nelson_TeachBack_15_04");
    };
    INFO_ADDCHOICE(81124, DIALOG_BACK, 81128);
    if ((PLAYER_TALENT_TAKEANIMALTROPHY[7]) == (FALSE)) {
        INFO_ADDCHOICE(81124, B_BUILDLEARNSTRING2(PRINT_TEACHBFSTING, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_BFSTING), NELSON_STINGSTROPHY), 81129);
    };
    if ((PLAYER_TALENT_TAKEANIMALTROPHY[8]) == (FALSE)) {
        INFO_ADDCHOICE(81124, B_BUILDLEARNSTRING2(PRINT_TEACHMANDIBLES, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_MANDIBLES), NELSON_MANDIBLESTROPHY), 81130);
    };
    if ((PLAYER_TALENT_TAKEANIMALTROPHY[6]) == (FALSE)) {
        INFO_ADDCHOICE(81124, B_BUILDLEARNSTRING2(PRINT_TEACHBFWING, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_BFWING), NELSON_WINGSTROPHY), 81131);
    };
    if ((PLAYER_TALENT_TAKEANIMALTROPHY[15]) == (FALSE)) {
        INFO_ADDCHOICE(81124, B_BUILDLEARNSTRING2(PRINT_TEACHFATS, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_FATS), NELSON_FATSTROPHY), 81133);
    };
    if ((PLAYER_TALENT_TAKEANIMALTROPHY[17]) == (FALSE)) {
        INFO_ADDCHOICE(81124, B_BUILDLEARNSTRING2(PRINT_TEACHSHELLS, B_GETLEARNCOSTTALENT(OTHER, NPC_TALENT_TAKEANIMALTROPHY, TROPHY_SHELLS), NELSON_SHELLSTROPHY), 81132);
    };
}

func void DIA_NELSON_HUNTING_SPECIAL_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_CanYouTeachMeHunting");
    AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_03_01");
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

func void DIA_NELSON_HUNTING_SPECIAL_BACK() {
    INFO_CLEARCHOICES(81124);
    if ((((((PLAYER_TALENT_TAKEANIMALTROPHY[7]) == (TRUE)) && ((PLAYER_TALENT_TAKEANIMALTROPHY[8]) == (TRUE))) && ((PLAYER_TALENT_TAKEANIMALTROPHY[6]) == (TRUE))) && ((PLAYER_TALENT_TAKEANIMALTROPHY[15]) == (TRUE))) && ((PLAYER_TALENT_TAKEANIMALTROPHY[17]) == (TRUE))) {
        NELSON_ALLHUNT = TRUE;
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_AllHunt_03_01");
    };
}

func void DIA_NELSON_HUNTING_SPECIAL_BFSTING() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Special_BFSting_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_STINGSTROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[7]) == (TRUE)) {
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_STINGSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_BFSting_03_02");
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_STINGSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_BFSting_03_03");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHYSTING, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 15;
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_STINGSTROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_BFSting_03_04");
    };
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

func void DIA_NELSON_HUNTING_SPECIAL_MANDIBLES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Special_Mandibles_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_MANDIBLESTROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[8]) == (TRUE)) {
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_MANDIBLESTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Mandibles_03_02");
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_MANDIBLESTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Mandibles_03_03");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHYMANDIBLES, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 10;
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_MANDIBLESTROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Mandibles_03_04");
    };
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

func void DIA_NELSON_HUNTING_SPECIAL_BFWING() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Special_BFWing_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_WINGSTROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[6]) == (TRUE)) {
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_WINGSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_BFWing_03_02");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHYWING, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 10;
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_WINGSTROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_BFWing_03_03");
    };
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

func void DIA_NELSON_HUNTING_SPECIAL_SHELLS() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Special_Shells_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_SHELLSTROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[17]) == (TRUE)) {
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_SHELLSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Shells_03_02");
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_SHELLSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Shells_03_03");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHYSHELLS, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 15;
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_SHELLSTROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Shells_03_04");
    };
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

func void DIA_NELSON_HUNTING_SPECIAL_FATS() {
    AI_OUTPUT(OTHER, SELF, "DIA_Nelson_Hunting_Special_Fats_15_01");
    if ((NPC_HASITEMS(OTHER, 34203)) >= (NELSON_FATSTROPHY)) {
        if ((PLAYER_TALENT_TAKEANIMALTROPHY[15]) == (TRUE)) {
            NPC_REMOVEINVITEMS(SELF, 34203, NELSON_FATSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Fats_03_02");
            B_GIVEINVITEMS(OTHER, SELF, 34203, NELSON_FATSTROPHY);
            AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Fats_03_03");
            PRINTSCREEN(PRINT_LEARNTAKEANIMALTROPHYFAT, -(1), -(1), FONT_SCREEN, 2);
            NELSON_GOODSTUDENT += 10;
        };
    };
    if ((NPC_HASITEMS(OTHER, 34203)) < (NELSON_FATSTROPHY)) {
        AI_OUTPUT(SELF, OTHER, "DIA_Nelson_Hunting_Special_Fats_03_04");
    };
    DIA_NELSON_HUNTING_SPECIAL_CHOICES();
}

instance DIA_NELSON_PICKPOCKET(C_INFO) {
    NPC = 58222;
    NR = 900;
    CONDITION = DIA_NELSON_PICKPOCKET_CONDITION;
    INFORMATION = DIA_NELSON_PICKPOCKET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = PICKPOCKET_80;
}

func int DIA_NELSON_PICKPOCKET_CONDITION() {
    if (((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (1)) && ((SELF.AIVAR[6]) == (FALSE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_NELSON_PICKPOCKET_INFO() {
    INFO_CLEARCHOICES(81134);
    INFO_ADDCHOICE(81134, DIALOG_BACK, 81138);
    INFO_ADDCHOICE(81134, DIALOG_PICKPOCKET, 81137);
}

func void DIA_NELSON_PICKPOCKET_DOIT() {
    if ((NPC_GETTALENTSKILL(OTHER, NPC_TALENT_PICKPOCKET)) >= (2)) {
        CREATEINVITEMS(SELF, 34383, 4);
        B_GIVEINVITEMS(SELF, OTHER, 34383, 4);
        B_PICKPOCKET_AMBIENT_TIER_2();
        SELF.AIVAR[6] = TRUE;
        INFO_CLEARCHOICES(81134);
    };
    AI_PLAYANI(HERO, T_CANNOTTAKE);
    PRINTSCREEN(PRINT_CANTPICKPOCKETTHISPERSON, -(1), -(1), FONT_SCREEN, 4);
    INFO_CLEARCHOICES(81134);
}

func void DIA_NELSON_PICKPOCKET_BACK() {
    INFO_CLEARCHOICES(81134);
}

