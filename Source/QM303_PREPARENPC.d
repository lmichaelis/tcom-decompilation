func void QM303_PREPARENPC() {
    FF_APPLYONCEEXTGT(63518, 0, -(1));
    WLD_INSERTNPC(56207, "PART6_QM303_MILITIA");
    WLD_INSERTNPC(50788, "PART4_MOB_78");
    WLD_INSERTITEM(37229, "FP_PARTM4_QM303_PACKET_01");
    WLD_INSERTITEM(37229, "FP_PARTM4_QM303_PACKET_02");
    WLD_INSERTITEM(37229, "FP_PARTM4_QM303_PACKET_03");
    WLD_INSERTITEM(37229, "FP_PARTM4_QM303_PACKET_05");
    WLD_INSERTNPC(50759, "PART4_PATHFOREST_06");
    WLD_INSERTNPC(50759, "PART4_MOB_62");
    WLD_INSERTNPC(50759, "PART4_MOB_74");
    WLD_INSERTNPC(50759, "PART4_PATHFOREST_61");
    WLD_INSERTNPC(50759, "FP_ROAM_PART4_65");
    WLD_INSERTNPC(50759, "FP_ROAM_PART4_83");
}

func void QM303_PREPARENPC_APPLY() {
    var ZCMOVER MOVER2;
    var int MOVPTR2;
    var int MOVPTR1;
    var ZCMOVER MOVER1;
    var int QM303_PREPARENPC_COUNT;
    if ((QM303_PREPARENPC_COUNT) == (0)) {
        PRINTD("Rozpoczynam - QM303_PrepareNPC_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("QM303_MOVER_MILITIA_CORPSE");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        MOVPTR2 = MEM_SEARCHVOBBYNAME("QM303_MOVER_CORPSESANIMAL");
        MOVER2 = MEM_PTRTOINST(MOVPTR2);
        CHANGEVOBCOLLISION("QM303_MILITIA_CORPSE", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("QM303_ANIMAL_CORPSE_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("QM303_ANIMAL_CORPSE_02", FALSE, FALSE, FALSE, TRUE);
        WLD_SENDTRIGGER("QM303_MOVER_MILITIA_CORPSE");
        WLD_SENDTRIGGER("QM303_MOVER_CORPSESANIMAL");
        QM303_PREPARENPC_COUNT = 1;
    };
    if (((((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_OPENING))) && ((MOVER2.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - QM303_PrepareNPC_Apply");
        CHANGEVOBCOLLISION("QM303_MILITIA_CORPSE", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("QM303_ANIMAL_CORPSE_01", TRUE, TRUE, TRUE, TRUE);
        CHANGEVOBCOLLISION("QM303_ANIMAL_CORPSE_02", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(63518);
        QM303_PREPARENPC_COUNT = 0;
    };
}

func void QM303_FINISHQUEST() {
    var int MARVINCURRENT_ITMIS_QM303_PACKET;
    QM303_FINISH = TRUE;
    QM303_FINISH_DAY = WLD_GETDAY();
    MARVINCURRENT_ITMIS_QM303_PACKET = NPC_HASITEMS(OTHER, 37229);
    CREATEINVITEMS(SELF, 34203, (QM303_FINISHGOLD) * (MARVINCURRENT_ITMIS_QM303_PACKET));
    NPC_REMOVEINVITEMS(SELF, 37229, MARVINCURRENT_ITMIS_QM303_PACKET);
    LOG_SETSTATUS(_@(MIS_QM303), TOPIC_QM303, LOG_SUCCESS);
    if (NPC_ISDEAD(SHADOWBEAST_QM303)) {
        B_GIVEPLAYERXP(XP_QM303_FINISH_V2);
    };
    B_GIVEINVITEMS(OTHER, SELF, 37229, MARVINCURRENT_ITMIS_QM303_PACKET);
    B_GIVEPLAYERXP(XP_QM303_FINISH_V1);
    if ((QM303_GIVEMILITIAPOTION) == (TRUE)) {
        QM303_GIVEMILITIAPOTION_CHECKTIME = TRUE;
        QM303_GIVEMILITIAPOTION_CHECKTIME_DAY = WLD_GETDAY();
    };
    B_GIVEINVITEMS(SELF, OTHER, 34203, (QM303_FINISHGOLD) * (MARVINCURRENT_ITMIS_QM303_PACKET));
}

func void QM303_REMOVENPC() {
    if ((QM303_GIVEMILITIAPOTION) == (FALSE)) {
        B_REMOVENPC(56207);
    };
    B_STARTOTHERROUTINE(MIL_13589_MILITIA, TOT);
    NPC_REFRESH(MIL_13589_MILITIA);
    TELEPORTNPCTOWP(56207, MIL_13589_MILITIA.WP);
    FF_APPLYONCEEXTGT(63518, 0, -(1));
}

func void MILITIA_QM303_BACK_TELEPORT() {
    FADESCREENTOBLACKF(1, 63528, 1000);
}

func void MILITIA_QM303_BACK_TELEPORT_FADESCREEN() {
    HERO.AIVAR[4] = FALSE;
    TELEPORTNPCTOWP(1819, "PARTM3_PATH_04");
    AI_TURNTONPC(HERO, NONE_2009_LENNART);
    FADESCREENFROMBLACK(1);
    B_STARTOTHERROUTINE(MIL_13589_MILITIA, "QM303_CITYWOUNDED");
    NPC_REFRESH(MIL_13589_MILITIA);
    TELEPORTNPCTOWP(56207, MIL_13589_MILITIA.WP);
}

