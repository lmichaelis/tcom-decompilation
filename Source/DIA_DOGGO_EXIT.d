instance DIA_DOGGO_EXIT(C_INFO) {
    NPC = 53535;
    NR = 9999;
    CONDITION = DIA_DOGGO_EXIT_CONDITION;
    INFORMATION = DIA_DOGGO_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_DOGGO_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_DOGGO_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_DOGGO_HELLO(C_INFO) {
    NPC = 53535;
    NR = 1;
    CONDITION = DIA_DOGGO_HELLO_CONDITION;
    INFORMATION = DIA_DOGGO_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_DOGGO_HELLO_CONDITION() {
    return TRUE;
}

func void DIA_DOGGO_HELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Doggo_HELLO_15_01");
    INFO_CLEARCHOICES(68140);
    INFO_ADDCHOICE(68140, "(End the suffering)", 68144);
    INFO_ADDCHOICE(68140, "(Take home)", 68143);
}

func void DIA_DOGGO_HELLO_TAKE() {
    TAKEDOGGO = TRUE;
    AI_REMOVEWEAPON(OTHER);
    AI_TURNTONPC(OTHER, SELF);
    AI_SETWALKMODE(OTHER, NPC_WALK);
    AI_GOTONPC(OTHER, SELF);
    AI_FUNCTION(SELF, 68145);
    AI_PLAYANI(OTHER, T_PLUNDER);
}

func void DIA_DOGGO_HELLO_KILL() {
    B_MARVIN_ATTACKINDIALOGUE_PREPARE();
    AI_FUNCTION(OTHER, 68146);
    AI_PLAYANI(OTHER, "T_1HSFINISH");
    AI_STOPPROCESSINFOS(OTHER);
    LOG_CREATETOPIC(TOPIC_OURHOUME, LOG_NOTE);
    AI_LOGENTRY(TOPIC_OURHOUME, LOG_OURHOME_DOGGO_KILL);
}

func void DOGGO_TAKEHOME() {
    FADESCREENTOBLACKF(2, 68149, 1000);
}

func void DOGGO_DAMAGE() {
    FF_APPLYONCEEXT(68147, 500, 2);
}

func void DOGGO_DAMAGE_APPLY() {
    var int DOGGO_DAMAGE_COUNT;
    DOGGO_DAMAGE_COUNT = (DOGGO_DAMAGE_COUNT) + (1);
    if ((DOGGO_DAMAGE_COUNT) == (2)) {
        NONE_13336_DOGGO.FLAGS = 0;
        B_MAGICHURTNPC(HERO, NONE_13336_DOGGO, 9999);
        HERO.AIVAR[4] = FALSE;
    };
}

func void DOGGO_TAKEHOME_FADESCREEN() {
    TELEPORTNPCTOWP(1819, "PARTM5_HEROHOUSE_HERO_DOGGO");
    TELEPORTNPCTOWP(53535, "PARTM5_HEROHOUSE_DOGGO");
    MDL_REMOVEOVERLAYMDS(NONE_13336_DOGGO, "Wolf_Dialogue_HURT.mds");
    MDL_SETMODELFATNESS(NONE_13336_DOGGO, 0);
    AI_STOPPROCESSINFOS(NONE_13336_DOGGO);
    AI_STOPPROCESSINFOS(HERO);
    NPC_EXCHANGEROUTINE(NONE_13336_DOGGO, "HOME");
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(2);
    LOG_CREATETOPIC(TOPIC_OURHOUME, LOG_NOTE);
    B_LOGENTRY(TOPIC_OURHOUME, LOG_OURHOME_DOGGO_TAKE);
}

instance DIA_DOGGO_PET(C_INFO) {
    NPC = 53535;
    NR = 1;
    CONDITION = DIA_DOGGO_PET_CONDITION;
    INFORMATION = DIA_DOGGO_PET_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_PET;
}

func int DIA_DOGGO_PET_CONDITION() {
    if (((TAKEDOGGO) == (TRUE)) && ((Q505_VIKTORDOG) == (0))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DOGGO_PET_INFO() {
    GAMESERVICES_UNLOCKACHIEVEMENT(ACH_30);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STANDUP(SELF);
    AI_PLAYANIBS(SELF, T_SIT_2_STAND, BS_STAND);
    AI_TURNTONPC(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_TURNTONPC(OTHER, SELF);
    AI_SETWALKMODE(SELF, NPC_WALK);
    AI_GOTONPC(SELF, OTHER);
    AI_WAIT(SELF, 1036831949);
    AI_PLAYANIBS(SELF, "T_READYTOPET", BS_SIT);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_PLAYANI(SELF, "T_PET_START");
    AI_SETWALKMODE(OTHER, NPC_WALK);
    AI_GOTONPC(OTHER, SELF);
    AI_PLAYANI(OTHER, "T_PET_START");
    AI_FUNCTION(SELF, 68153);
    INFO_CLEARCHOICES(68150);
    INFO_ADDCHOICE(68150, DIALOG_FINISH, 68154);
}

func void DOGGO_APPLYMDS() {
    MDL_APPLYOVERLAYMDS(HERO, "Humans_PetDog.mds");
}

func void DIA_DOGGO_PET_STOP() {
    AI_PLAYANI(OTHER, "T_PET_REMVOE");
    AI_FUNCTION(OTHER, 68155);
    INFO_CLEARCHOICES(68150);
    AI_WAITTILLEND(SELF, OTHER);
    AI_PLAYANIBS(SELF, "T_UNREADYTOPET", BS_STAND);
    AI_WAIT(OTHER, 1045220557);
    AI_STOPPROCESSINFOS(OTHER);
}

func void DOGGO_REMOVEMDS() {
    MDL_REMOVEOVERLAYMDS(HERO, "Humans_PetDog.mds");
}

instance DIA_DOGGO_NAME(C_INFO) {
    NPC = 53535;
    NR = DIALOG_ANSWER_NR;
    CONDITION = DIA_DOGGO_NAME_CONDITION;
    INFORMATION = DIA_DOGGO_NAME_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = DIALOG_GIVEANAME;
}

func int DIA_DOGGO_NAME_CONDITION() {
    return TRUE;
}

func void DIA_DOGGO_NAME_INFO() {
    INFO_CLEARCHOICES(68156);
    INFO_ADDCHOICE(68156, CHOICE_ANSWER_NAME_DOG, 68168);
}

func void FILLDOGGONAMEANDDIALOGS(var string NAME) {
    NONE_13336_DOGGO.NAME[0] = NAME;
}

func void SETDOGGONAME(var string NAME) {
    var PERSISTENTSTRINGS DATA;
    var int HANDLE;
    HANDLE = GETPERSISTENTSTRINGSHANDLE();
    DATA = GET(HANDLE);
    DATA.DOGGONAME = NAME;
    FILLDOGGONAMEANDDIALOGS(NAME);
}

instance DIA_DOGGO_GOODBYE(C_INFO) {
    NPC = 53535;
    NR = 90;
    CONDITION = DIA_DOGGO_GOODBYE_CONDITION;
    INFORMATION = DIA_DOGGO_GOODBYE_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = DIALOG_DOGGOVICTOR;
}

func int DIA_DOGGO_GOODBYE_CONDITION() {
    if (((Q505_VIKTORDOG) == (1)) && ((TAKEDOGGO) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DOGGO_GOODBYE_INFO() {
    GAMESERVICES_UNLOCKACHIEVEMENT(ACH_30);
    AI_STOPLOOKAT(SELF);
    AI_STOPLOOKAT(OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STANDUP(SELF);
    AI_PLAYANIBS(SELF, T_SIT_2_STAND, BS_STAND);
    AI_TURNTONPC(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_TURNTONPC(OTHER, SELF);
    AI_SETWALKMODE(SELF, NPC_WALK);
    AI_GOTONPC(SELF, OTHER);
    AI_WAIT(SELF, 1036831949);
    AI_PLAYANIBS(SELF, "T_READYTOPET", BS_SIT);
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    AI_PLAYANI(SELF, "T_PET_START");
    AI_SETWALKMODE(OTHER, NPC_WALK);
    AI_GOTONPC(OTHER, SELF);
    AI_PLAYANI(OTHER, "T_PET_START");
    AI_FUNCTION(SELF, 68153);
    AI_WAITTILLEND(OTHER, SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Doggo_Goodbye_15_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Doggo_Goodbye_15_02");
    AI_WAITTILLEND(SELF, OTHER);
    AI_WAITTILLEND(OTHER, SELF);
    DIA_DOGGO_PET_STOP();
    AI_FUNCTION(SELF, 68172);
}

func void DOGGO_GOODBYEFADE() {
    FADESCREENTOBLACKF(1, 68173, 1000);
}

func void DOGGO_GOODBYEFADESCREEN() {
    Q505_VIKTORDOG = 2;
    TELEPORTNPCTOWP(1819, "VILLAGE_PATH_38");
    NPC_EXCHANGEROUTINE(NONE_13336_DOGGO, "SILBACH");
    TELEPORTNPCTOWP(53535, NONE_13336_DOGGO.WP);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(1);
    LOG_CREATETOPIC(TOPIC_OURHOUME, LOG_NOTE);
    B_LOGENTRY(TOPIC_OURHOUME, LOG_OURHOME_DOGGO_TAKETOVIKTOR);
}

instance DIA_DOGGO_AMBIENT(C_INFO) {
    NPC = 53535;
    NR = 998;
    CONDITION = DIA_DOGGO_AMBIENT_CONDITION;
    INFORMATION = DIA_DOGGO_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_TALKTODOGGO;
}

func int DIA_DOGGO_AMBIENT_CONDITION() {
    if ((TAKEDOGGO) == (TRUE)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_DOGGO_AMBIENT_INFO() {
    NPC_INITAMBIENTS(SELF, 5);
    if ((NPC_GETLASTAMBIENT(SELF)) == (1)) {
        B_SAY(OTHER, SELF, "$MARVIN_WhatNew");
        AI_OUTPUT(SELF, OTHER, "DIA_Doggo_Ambient_03_01");
    };
    if ((NPC_GETLASTAMBIENT(SELF)) == (2)) {
        B_SAY(OTHER, SELF, "$MARVIN_WhatNew2");
        AI_OUTPUT(SELF, OTHER, "DIA_Doggo_Ambient_03_02");
    };
    if ((NPC_GETLASTAMBIENT(SELF)) == (3)) {
        B_SAY(OTHER, SELF, "$MARVIN_WhatNew4");
        AI_OUTPUT(SELF, OTHER, "DIA_Doggo_Ambient_03_03");
    };
    if ((NPC_GETLASTAMBIENT(SELF)) == (4)) {
        B_SAY(OTHER, SELF, "$MARVIN_WhatNew5");
        AI_OUTPUT(SELF, OTHER, "DIA_Doggo_Ambient_03_04");
    };
    if ((NPC_GETLASTAMBIENT(SELF)) == (5)) {
        B_SAY(OTHER, SELF, "$MARVIN_WhoIsImportantHere");
        AI_OUTPUT(SELF, OTHER, "DIA_Doggo_Ambient_03_05");
    };
}

