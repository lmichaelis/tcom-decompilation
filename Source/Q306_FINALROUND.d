instance Q306_FINALROUND(CUTSCENE) {
    ONSTART = FUNCTION(92504);
}

func void Q306_FINALROUND_WAIT() {
    AI_WAITTILLEND(PIR_1307_PROXIMO, HERO);
    AI_WAITTILLEND(PIR_1307_PROXIMO, NONE_7500_BEN);
    AI_WAITTILLEND(NONE_7500_BEN, HERO);
    AI_WAITTILLEND(NONE_7500_BEN, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, PIR_1307_PROXIMO);
    AI_WAITTILLEND(HERO, NONE_7500_BEN);
}

func void Q306_FINALROUND_START() {
    NONE_7500_BEN.FLAGS = NPC_FLAG_IMPORTANT;
    WLD_SENDTRIGGER("Q306_ARENACROWD");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    WLD_SENDTRIGGER("KM_ARENAFIGHT_3_01");
    PIR_1330_ALVAREZ.AIVAR[15] = TRUE;
    NONE_6331_JAVAD.AIVAR[15] = TRUE;
    PIR_13050_OTIS_ARENA.AIVAR[15] = TRUE;
    NPC_CLEARAIQUEUE(PIR_1307_PROXIMO);
    NPC_CLEARAIQUEUE(NONE_7500_BEN);
    TELEPORTNPCTOWP(58696, "P17_HAVEN_ARENA_SPEAKER_01");
    TELEPORTNPCTOWP(58599, "P17_HAVEN_ARENA_OPPONENT_01");
    TELEPORTNPCTOWP(1819, "P17_HAVEN_ARENA_PLAYER_01");
    PIR_1307_PROXIMO.AIVAR[92] = TRUE;
    AI_SETWALKMODE(NONE_7500_BEN, NPC_WALK);
    AI_SETWALKMODE(HERO, NPC_WALK);
    AI_TURNTONPC(PIR_1307_PROXIMO, PIR_1306_RODRIGO);
    Q306_BEN_REMEMBERTHISVISUAL = TRUE;
    MDL_SETVISUALBODY(NONE_7500_BEN, "HUM_BODY_NAKED0", 1, 0, HUMHEADNOTHING, FACE_N_BIGBEN, 0, 35387);
    NPC_REMOVEINVITEMS(NONE_7500_BEN, 35383, 1);
    Q306_FINALROUND_WAIT();
    AI_WAIT(HERO, 1070386381);
    AI_WAIT(NONE_7500_BEN, 1072064102);
    AI_GOTOWP(HERO, "P17_HAVEN_ARENA_PLAYER_02");
    AI_GOTOWP(NONE_7500_BEN, "P17_HAVEN_ARENA_OPPONENT_02");
    AI_TURNTONPC(HERO, NONE_7500_BEN);
    AI_TURNTONPC(NONE_7500_BEN, HERO);
    Q306_FINALROUND_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 92505);
    AI_STARTFACEANI(HERO, S_ANGRY, 1, -(1));
    AI_PLAYANI(HERO, "R_STRETCH_RANDOM_02");
    Q306_FINALROUND_WAIT();
    AI_FUNCTION(PIR_1307_PROXIMO, 92506);
    AI_STARTFACEANI(NONE_7500_BEN, S_ANGRY, 1, -(1));
    AI_PLAYANI(NONE_7500_BEN, "T_THREAT_DEATH");
    Q306_FINALROUND_WAIT();
    AI_FUNCTION(NONE_7500_BEN, 92507);
}

func void Q306_FINALROUND_CAMERACHANGE_01() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_5_01");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_3_01");
    TELEPORTNPCTOWP(1819, "P17_HAVEN_ARENA_PLAYER_02");
    TELEPORTNPCTOWP(58599, "P17_HAVEN_ARENA_OPPONENT_02");
}

func void Q306_FINALROUND_CAMERACHANGE_02() {
    WLD_SENDTRIGGER("KM_ARENAFIGHT_5_02");
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_5_01");
}

func void Q306_FINALROUND_END() {
    MUSIC_OVERRIDETRACK(21948);
    PRINTD("Walka z Benem");
    Q306_STATE = 25;
    NONE_7500_BEN.AIVAR[96] = -(1);
    HERO.AIVAR[95] = TRUE;
    HERO.AIVAR[94] = TRUE;
    NONE_7500_BEN.AIVAR[94] = TRUE;
    NONE_7500_BEN.AIVAR[45] = AF_RUNNING;
    WLD_SENDUNTRIGGER("KM_ARENAFIGHT_5_02");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_PLAYER");
    WLD_SENDTRIGGER("P17_HAVEN_ARENA_OPPONENT");
    NPC_REFRESH(NONE_7500_BEN);
    NPC_REFRESH(PIR_1307_PROXIMO);
    NPC_CLEARAIQUEUE(HERO);
    PIR_1307_PROXIMO.AIVAR[92] = FALSE;
    AI_STOPLOOKAT(HERO);
    B_STARTOTHERROUTINE(NONE_7500_BEN, "ArenaFightPlayer");
    HERO.AIVAR[4] = FALSE;
    START_BOSSUI(NONE_7500_BEN, 2);
    B_IMMEDIATEATTACKPLAYER(NONE_7500_BEN, AR_NONE);
}

