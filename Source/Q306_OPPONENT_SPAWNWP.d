const string Q306_OPPONENT_SPAWNWP = "P17_HAVEN_ARENA_INSIDE_14";
func void Q306_PREPAREFIRSTFIGHT() {
    NPC_CHANGEARMOR(PIR_1312_LARRY, 35398);
    NPC_REMOVEINVITEMS(PIR_1312_LARRY, 35542, 1);
    B_SETATTRIBUTESTOLEVEL(PIR_1312_LARRY, 35);
    AI_EQUIPBESTMELEEWEAPON(PIR_1312_LARRY);
    B_STARTOTHERROUTINE(PIR_1312_LARRY, "ArenaFightWait");
    NPC_REFRESH(PIR_1312_LARRY);
    TELEPORTNPCTOWP(58758, PIR_1312_LARRY.WP);
}

func void Q306_PREPARESECONDFIGHT() {
    TELEPORTNPCTOWP(58671, Q306_OPPONENT_SPAWNWP);
    AI_TELEPORTALWAYS(PIR_13050_OTIS_ARENA, Q306_OPPONENT_SPAWNWP, TRUE);
    AI_EQUIPBESTMELEEWEAPON(PIR_13050_OTIS_ARENA);
    B_STARTOTHERROUTINE(PIR_13050_OTIS_ARENA, "ARENAFIGHTPLAYER");
    NPC_REFRESH(PIR_13050_OTIS_ARENA);
}

func void Q306_PREPARESAULFIGHT() {
    NPC_CHANGEARMOR(PIR_1329_SAUL, 35403);
    AI_EQUIPBESTMELEEWEAPON(PIR_1329_SAUL);
    PIR_1329_SAUL.AIVAR[15] = FALSE;
    NPC_REMOVEINVITEMS(PIR_1329_SAUL, 33570, 1);
    B_STARTOTHERROUTINE(PIR_1329_SAUL, "ArenaFightWait");
    NPC_REFRESH(PIR_1329_SAUL);
    TELEPORTNPCTOWP(58818, Q306_OPPONENT_SPAWNWP);
    PRINTD("Teleport Saul");
}

func void Q306_STARTSAULFIGHT() {
    B_STARTOTHERROUTINE(PIR_1329_SAUL, "ArenaFightPlayer");
    NPC_REFRESH(PIR_1329_SAUL);
    TELEPORTNPCTOWP(58818, Q306_OPPONENT_SPAWNWP);
    PRINTD("Saul biegnie");
}

func void Q306_PREPAREFIGHTORC() {
    NONE_1331_ORCSLAVE.WP = Q306_OPPONENT_SPAWNWP;
    NONE_1331_ORCSLAVE.SPAWNPOINT = Q306_OPPONENT_SPAWNWP;
    AI_TELEPORTALWAYS(NONE_1331_ORCSLAVE, Q306_OPPONENT_SPAWNWP, TRUE);
    PRINTD("Teleport Ork");
}

func void Q306_STARTFIGHTWITHSNAKE() {
    var C_NPC SNAKE;
    SNAKE = HLP_GETNPC(50770);
    HERO.AIVAR[95] = TRUE;
    HERO.AIVAR[94] = TRUE;
    SNAKE.AIVAR[94] = TRUE;
    SNAKE.FLAGS = 0;
    B_ATTACK(SNAKE, HERO, AR_KILL, 0);
}

func void Q306_ENDFINALROUND_CROWDSTOP() {
    B_STARTOTHERROUTINE(NOV_200_HIERRO, "TOURNAMENTSTOP");
    NPC_REFRESH(NOV_200_HIERRO);
    B_STARTOTHERROUTINE(PIR_1300_LEONARDO, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1300_LEONARDO);
    B_STARTOTHERROUTINE(PIR_1303_CORTEZ, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1303_CORTEZ);
    Q301_CORTEZ_RTNCHECK = 2;
    B_STARTOTHERROUTINE(PIR_1304_IVAN, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1304_IVAN);
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1306_RODRIGO);
    B_STARTOTHERROUTINE(PIR_1309_OSCAR, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1309_OSCAR);
    B_STARTOTHERROUTINE(PIR_1308_SIMON, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1308_SIMON);
    B_STARTOTHERROUTINE(PIR_1310_VICENTE, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1310_VICENTE);
    B_STARTOTHERROUTINE(PIR_1311_THIAGO, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1311_THIAGO);
    B_STARTOTHERROUTINE(PIR_1313_GETTER, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1313_GETTER);
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        Q306_MORITZ_RTNCHECK = 2;
        B_STARTOTHERROUTINE(PIR_1324_MORITZ, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1324_MORITZ);
    };
    if ((NPC_KNOWSINFO(HERO, 84791)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1325_FOX, "TOURNAMENTSTOP");
        NPC_REFRESH(PIR_1325_FOX);
    };
    B_STARTOTHERROUTINE(PIR_1327_LAUTENIST, "TOURNAMENTSTOP");
    NPC_REFRESH(PIR_1327_LAUTENIST);
    if ((Q305_BERTELWAY) == (1)) {
        B_STARTOTHERROUTINE(NONE_6332_BERTEL, "TOURNAMENTSTOP");
        NPC_REFRESH(NONE_6332_BERTEL);
    };
    B_STARTOTHERROUTINE(NONE_1316_TARA, "TOURNAMENTSTOP");
    NPC_REFRESH(NONE_1316_TARA);
    B_STARTOTHERROUTINE(NONE_1315_ROSITA, "TOURNAMENTSTOP");
    NPC_REFRESH(NONE_1315_ROSITA);
}

func void Q306_ENDFINALROUND_HAPPYCROWD_START() {
    WLD_SENDTRIGGER("Q306_ARENACROWD");
    B_STARTOTHERROUTINE(NOV_200_HIERRO, "TOURNAMENT");
    NPC_REFRESH(NOV_200_HIERRO);
    B_STARTOTHERROUTINE(PIR_1300_LEONARDO, "TOURNAMENT");
    NPC_REFRESH(PIR_1300_LEONARDO);
    B_STARTOTHERROUTINE(PIR_1303_CORTEZ, "TOURNAMENT");
    NPC_REFRESH(PIR_1303_CORTEZ);
    Q301_CORTEZ_RTNCHECK = 1;
    B_STARTOTHERROUTINE(PIR_1304_IVAN, "TOURNAMENT");
    NPC_REFRESH(PIR_1304_IVAN);
    B_STARTOTHERROUTINE(PIR_1306_RODRIGO, "TOURNAMENT");
    NPC_REFRESH(PIR_1306_RODRIGO);
    B_STARTOTHERROUTINE(PIR_1309_OSCAR, "TOURNAMENT");
    NPC_REFRESH(PIR_1309_OSCAR);
    B_STARTOTHERROUTINE(PIR_1308_SIMON, "TOURNAMENT");
    NPC_REFRESH(PIR_1308_SIMON);
    B_STARTOTHERROUTINE(PIR_1310_VICENTE, "TOURNAMENT");
    NPC_REFRESH(PIR_1310_VICENTE);
    B_STARTOTHERROUTINE(PIR_1311_THIAGO, "TOURNAMENT");
    NPC_REFRESH(PIR_1311_THIAGO);
    B_STARTOTHERROUTINE(PIR_1313_GETTER, "TOURNAMENT");
    NPC_REFRESH(PIR_1313_GETTER);
    if ((LOG_GETSTATUS(MIS_SQ304)) != (LOG_RUNNING)) {
        Q306_MORITZ_RTNCHECK = 1;
        B_STARTOTHERROUTINE(PIR_1324_MORITZ, "TOURNAMENT");
        NPC_REFRESH(PIR_1324_MORITZ);
    };
    if ((NPC_KNOWSINFO(HERO, 84791)) == (FALSE)) {
        B_STARTOTHERROUTINE(PIR_1325_FOX, "TOURNAMENT");
        NPC_REFRESH(PIR_1325_FOX);
    };
    B_STARTOTHERROUTINE(PIR_1326_DAN, "TOURNAMENT");
    NPC_REFRESH(PIR_1326_DAN);
    B_STARTOTHERROUTINE(PIR_1327_LAUTENIST, "TOURNAMENT");
    NPC_REFRESH(PIR_1327_LAUTENIST);
    if ((Q305_BERTELWAY) == (1)) {
        B_STARTOTHERROUTINE(NONE_6332_BERTEL, "TOURNAMENT");
        NPC_REFRESH(NONE_6332_BERTEL);
    };
    B_STARTOTHERROUTINE(NONE_1316_TARA, "TOURNAMENT");
    NPC_REFRESH(NONE_1316_TARA);
    B_STARTOTHERROUTINE(NONE_1315_ROSITA, "TOURNAMENT");
    NPC_REFRESH(NONE_1315_ROSITA);
}

func void Q306_LOSTTOURNAMENT_DELAY() {
    var int Q306_LOSTTOURNAMENT_COUNT;
    Q306_LOSTTOURNAMENT_COUNT = (Q306_LOSTTOURNAMENT_COUNT) + (1);
    if ((Q306_LOSTTOURNAMENT_COUNT) == (3)) {
        CUTSCENE_START(92516);
        Q306_LOSTTOURNAMENT_COUNT = 0;
    };
}

func int Q306_ONDROPUNCONSCIOUS(var C_NPC NPC) {
    if (((NPC_ISPLAYER(NPC)) && ((LOG_GETSTATUS(MIS_Q306)) == (LOG_RUNNING))) && ((Q306_LOSTWEAPONINTOURNAMENT) == (1))) {
        Q306_LOSTWEAPONINTOURNAMENT = 2;
        PRINTD("Q306_OnDropUnconscious");
        return TRUE;
    };
    return FALSE;
}

func void Q306_REFRESHBENHEADONLOAD() {
    if ((Q306_BEN_REMEMBERTHISVISUAL) == (TRUE)) {
        MDL_SETVISUALBODY(NONE_7500_BEN, "HUM_BODY_NAKED0", 1, 0, HUMHEADNOTHING, FACE_N_BIGBEN, 0, 35387);
        PRINTD("Refresh - G³owa");
    };
}

func void Q306_BEN_RUNTOHERO() {
    if (NPC_ISINSTATE(NONE_7500_BEN, 43856)) {
        NPC_SETSTATETIME(NONE_7500_BEN, (SPL_TIME_FREEZE) + (1));
    };
    if (NPC_ISINSTATE(NONE_7500_BEN, 43909)) {
        NPC_SETSTATETIME(NONE_7500_BEN, (SPL_TIME_SHORTZAPPED) + (1));
    };
    if (NPC_ISINSTATE(NONE_7500_BEN, 43905)) {
        NPC_SETSTATETIME(NONE_7500_BEN, (SPL_TIME_WHIRLWIND) + (1));
    };
    MDL_APPLYOVERLAYMDS(NONE_7500_BEN, "HUMANS_BigBen_SpecialAttack.mds");
    NPC_CLEARAIQUEUE(NONE_7500_BEN);
    B_CLEARPERCEPTIONS(NONE_7500_BEN);
    AI_TURNTONPC(NONE_7500_BEN, HERO);
    AI_GOTONPC(NONE_7500_BEN, HERO);
}

func void Q306_BEN_ATTACK() {
    NPC_CLEARAIQUEUE(NONE_7500_BEN);
    AI_PLAYANI(NONE_7500_BEN, "T_2HATTACKMOVE");
    if ((NONE_7500_BEN.AIVAR[17]) == (TRUE)) {
        FF_APPLYONCEEXT(63298, 800, 2);
    };
    FF_APPLYONCEEXT(63298, 400, 2);
}

func void Q306_BEN_ATTACK_APPLY() {
    var int Q306_BENATTACK_COUNT;
    Q306_BENATTACK_COUNT = (Q306_BENATTACK_COUNT) + (1);
    if ((Q306_BENATTACK_COUNT) == (2)) {
        Q306_BENATTACK_COUNT = 0;
        if ((NPC_GETDISTTONPC(HERO, NONE_7500_BEN)) <= (300)) {
            NPC_CLEARAIQUEUE(HERO);
            PRINTD("Przewracasz siê!");
            AI_PLAYANI(HERO, "T_FALLDOWN_QUICK");
            WLD_PLAYEFFECT("FX_EarthQuake", HERO, HERO, 0, 0, 0, FALSE);
        };
        MDL_REMOVEOVERLAYMDS(NONE_7500_BEN, "HUMANS_BigBen_SpecialAttack.mds");
        B_IMMEDIATEATTACKPLAYER(NONE_7500_BEN, AR_NONE);
    };
}

