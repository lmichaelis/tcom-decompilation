instance Q304_HIDE(CUTSCENE) {
    ONSTART = FUNCTION(92456);
}

func void Q304_HIDE_START() {
    TELEPORTNPCTOWP(58412, "PART17_PATH_215");
    TELEPORTNPCTOWP(58460, "PART17_CAVE_BODYGUARD");
    NONE_63369_BODYGUARD.AIVAR[92] = TRUE;
    NONE_63409_SMUGGLER.AIVAR[92] = TRUE;
    NPC_CLEARAIQUEUE(NONE_63369_BODYGUARD);
    NPC_CLEARAIQUEUE(NONE_63409_SMUGGLER);
    AI_TURNTONPC(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_TURNTONPC(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_LOOKATNPC(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_LOOKATNPC(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    TELEPORTNPCTOWP(58444, TOT);
    TELEPORTNPCTOWP(58400, TOT);
    HERO.AIVAR[4] = FALSE;
    FADESCREENFROMBLACK(3);
    if (TORCH_HEROHOLDINGTORCH()) {
        TORCH_UNEQUIP();
    };
    MDL_APPLYOVERLAYMDS(HERO, HUMANSMARVINSNEAKMDS);
    if ((Q304_CUTSCENEPOSITION) == (1)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_01_A");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_01");
    };
    if ((Q304_CUTSCENEPOSITION) == (2)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_01_B");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_02");
    };
    if ((Q304_CUTSCENEPOSITION) == (3)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_01_C");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_03");
    };
    if ((Q304_CUTSCENEPOSITION) == (4)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_01_D");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_04");
    };
    AI_TURNTONPC(HERO, NONE_63409_SMUGGLER);
    AI_WAIT(NONE_63369_BODYGUARD, 1084227584);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_FUNCTION(NONE_63369_BODYGUARD, 92457);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_PLAYANI(NONE_63409_SMUGGLER, R_SCRATCHLSHOULDER);
    AI_OUTPUT(NONE_63369_BODYGUARD, HERO, "DIA_Q304_CUTSCENE_03_01");
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_PLAYANI(NONE_63369_BODYGUARD, R_SCRATCHRSHOULDER);
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_02");
    if ((Q304_SMUGGLERQUESTIONCOUNT) == (2)) {
        Q304_CUTSCENEENDING = 1;
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_03");
        AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
        AI_OUTPUT(NONE_63369_BODYGUARD, HERO, "DIA_Q304_CUTSCENE_03_04");
        AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
        AI_FUNCTION(NONE_63369_BODYGUARD, 92458);
        AI_WAITTILLEND(NONE_63369_BODYGUARD, HERO);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, HERO);
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_05");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_06");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_07");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_08");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_09");
        AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
        AI_OUTPUT(NONE_63369_BODYGUARD, HERO, "DIA_Q304_CUTSCENE_03_10");
        AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_11");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_12");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_13");
        AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
        AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
        AI_FUNCTION(NONE_63369_BODYGUARD, 92459);
        AI_WAIT(NONE_63369_BODYGUARD, 1073741824);
        AI_FUNCTION(NONE_63369_BODYGUARD, 92460);
    };
    Q304_CUTSCENEENDING = 2;
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_14");
    if ((Q304_MARVINGIVEMONEY) == (TRUE)) {
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_15");
        AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_16");
    };
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_FUNCTION(NONE_63369_BODYGUARD, 92458);
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_17");
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_18");
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_OUTPUT(NONE_63369_BODYGUARD, HERO, "DIA_Q304_CUTSCENE_03_10");
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_12");
    AI_OUTPUT(NONE_63409_SMUGGLER, HERO, "DIA_Q304_CUTSCENE_03_13");
    AI_WAITTILLEND(NONE_63369_BODYGUARD, NONE_63409_SMUGGLER);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, NONE_63369_BODYGUARD);
    AI_FUNCTION(NONE_63369_BODYGUARD, 92459);
    AI_WAITTILLEND(NONE_63369_BODYGUARD, HERO);
    AI_WAITTILLEND(NONE_63409_SMUGGLER, HERO);
    AI_WAIT(NONE_63369_BODYGUARD, 1073741824);
    AI_FUNCTION(NONE_63369_BODYGUARD, 92460);
}

func void Q304_CUTSCENE_CAMERAV1() {
    TELEPORTNPCTOWP(1819, "PART17_PATH_213");
    AI_WAIT(HERO, 1065353216);
    if ((Q304_CUTSCENEPOSITION) == (1)) {
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_A");
    };
    if ((Q304_CUTSCENEPOSITION) == (2)) {
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_B");
    };
    if ((Q304_CUTSCENEPOSITION) == (3)) {
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_C");
    };
    if ((Q304_CUTSCENEPOSITION) == (4)) {
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_D");
    };
    WLD_SENDTRIGGER("KM_BLOODCURRENCY_02");
    HERO.AIVAR[4] = FALSE;
}

func void Q304_CUTSCENE_CAMERAV2() {
    TELEPORTNPCTOWP(1819, "PART17_PATH_218");
    WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_02");
    WLD_SENDTRIGGER("KM_BLOODCURRENCY_03");
}

func void Q304_CUTSCENE_CAMERAV3() {
    WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_03");
    if ((Q304_CUTSCENEPOSITION) == (1)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_04_A");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_01");
    };
    if ((Q304_CUTSCENEPOSITION) == (2)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_04_B");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_02");
    };
    if ((Q304_CUTSCENEPOSITION) == (3)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_04_C");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_03");
    };
    if ((Q304_CUTSCENEPOSITION) == (4)) {
        WLD_SENDTRIGGER("KM_BLOODCURRENCY_04_D");
        TELEPORTNPCTOWP(1819, "PART17_BLOODCURRENCY_HERO_04");
    };
}

func void Q304_CUTSCENE_END() {
    FADESCREENTOBLACKF(1, 92461, 1000);
}

func void Q304_CUTSCENE_END_FADEESCREEN() {
    FF_APPLYONCEEXT(92462, 75, 4);
}

func void Q304_CUTSCENE_END_FADEESCREEN_APPLY() {
    var int Q304_CUTSCENE_END_FADEESCREEN_COUNT;
    Q304_CUTSCENE_END_FADEESCREEN_COUNT = (Q304_CUTSCENE_END_FADEESCREEN_COUNT) + (1);
    if ((Q304_CUTSCENE_END_FADEESCREEN_COUNT) == (4)) {
        Q304_CUTSCENE_END_FADEESCREEN_COUNT = 0;
        B_REMOVENPC(58460);
        B_REMOVENPC(58412);
        HERO.AIVAR[4] = FALSE;
        FADESCREENFROMBLACK(3);
        MDL_REMOVEOVERLAYMDS(HERO, HUMANSMARVINSNEAKMDS);
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_A");
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_B");
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_C");
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_01_D");
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_02");
        WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_03");
        if ((Q304_CUTSCENEPOSITION) == (1)) {
            WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_04_A");
        } else if ((Q304_CUTSCENEPOSITION) == (2)) {
            WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_04_B");
        } else if ((Q304_CUTSCENEPOSITION) == (3)) {
            WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_04_C");
        } else if ((Q304_CUTSCENEPOSITION) == (4)) {
            WLD_SENDUNTRIGGER("KM_BLOODCURRENCY_04_D");
        };
        NPC_CLEARAIQUEUE(NONE_63369_BODYGUARD);
        NPC_CLEARAIQUEUE(NONE_63409_SMUGGLER);
        NONE_63369_BODYGUARD.AIVAR[92] = FALSE;
        NONE_63409_SMUGGLER.AIVAR[92] = FALSE;
        B_STARTOTHERROUTINE(NONE_6340_SMUGGLER, START);
        B_STARTOTHERROUTINE(NONE_6337_BODYGUARD, START);
        NONE_6337_BODYGUARD.FLAGS = 0;
        NONE_6337_BODYGUARD.AIVAR[52] = TRUE;
        B_STARTOTHERROUTINE(BAU_6287_GONZALO, "ANTONIOVINEYARD");
        TELEPORTNPCTOWP(58444, "PART17_PATH_223");
        TELEPORTNPCTOWP(58026, "PART15_VINEYARD_PATH_32");
        if ((Q304_CUTSCENEENDING) == (1)) {
            B_STARTOTHERROUTINE(NONE_6336_BODYGUARD, "SWAMP");
            B_LOGENTRY(TOPIC_Q304, LOG_Q304_FIGHT);
            TELEPORTNPCTOWP(58400, "PART17_PATH_64");
        } else if ((Q304_CUTSCENEENDING) == (2)) {
            B_STARTOTHERROUTINE(NONE_6336_BODYGUARD, "RENEGADE");
            B_LOGENTRY(TOPIC_Q304, LOG_Q304_IGOTTRICKED);
            TELEPORTNPCTOWP(58400, "PART7_CAVE_PLUNDER_02");
        };
        AI_STANDUP(HERO);
    };
}

