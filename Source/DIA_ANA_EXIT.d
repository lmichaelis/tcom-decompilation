instance DIA_ANA_EXIT(C_INFO) {
    NPC = 51576;
    NR = 999;
    CONDITION = DIA_ANA_EXIT_CONDITION;
    INFORMATION = DIA_ANA_EXIT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = DIALOG_ENDE;
}

func int DIA_ANA_EXIT_CONDITION() {
    return TRUE;
}

func void DIA_ANA_EXIT_INFO() {
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ANA_Q102_HELLO(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q102_HELLO_CONDITION;
    INFORMATION = DIA_ANA_Q102_HELLO_INFO;
    DESCRIPTION = "Hey, are you okay?";
}

func int DIA_ANA_Q102_HELLO_CONDITION() {
    if ((LOG_GETSTATUS(MIS_Q102)) == (LOG_RUNNING)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q102_HELLO_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_08_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_08_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_08_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_08_05");
    INFO_CLEARCHOICES(91407);
    INFO_ADDCHOICE(91407, "It would look much worse on your corpse.", 91410);
    INFO_ADDCHOICE(91407, "This is... really tragic news.", 91411);
    INFO_ADDCHOICE(91407, "Relax, when it's all over, I'll buy you a new one!", 91412);
}

func void DIA_ANA_Q102_HELLO_YOURBODY() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_YourBody_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_YourBody_08_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_YourBody_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_YourBody_08_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_YourBody_08_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_YourBody_15_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_YourBody_08_06");
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_ANA_Q102_HELLO_TERRIFIC() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_Terrific_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_Terrific_08_01");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_Terrific_15_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_Terrific_08_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_Terrific_08_04");
    AI_STOPPROCESSINFOS(SELF);
}

func void DIA_ANA_Q102_HELLO_NOWORRIES() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q102_Hello_NoWorries_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_NoWorries_08_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q102_Hello_NoWorries_08_02");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ANA_Q104_WORKFORALBYN(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q104_WORKFORALBYN_CONDITION;
    INFORMATION = DIA_ANA_Q104_WORKFORALBYN_INFO;
    DESCRIPTION = "I'm looking for people to work.";
}

func int DIA_ANA_Q104_WORKFORALBYN_CONDITION() {
    if (((NPC_KNOWSINFO(OTHER, 87695)) && ((LOG_GETSTATUS(MIS_Q104)) == (LOG_RUNNING))) && ((KAPITEL) != (5))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q104_WORKFORALBYN_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q104_WorkForAlbyn_15_00");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q104_WorkForAlbyn_08_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q104_WorkForAlbyn_08_02");
    AI_LOGENTRY(TOPIC_Q104, LOG_Q104_ANA);
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ANA_GQ001_WHEREISJORN(C_INFO) {
    NPC = 51576;
    NR = 10;
    CONDITION = DIA_ANA_GQ001_WHEREISJORN_CONDITION;
    INFORMATION = DIA_ANA_GQ001_WHEREISJORN_INFO;
    DESCRIPTION = "Have you witnessed anything suspicious recently?";
}

func int DIA_ANA_GQ001_WHEREISJORN_CONDITION() {
    if ((NPC_KNOWSINFO(OTHER, 87898)) && ((KAPITEL) != (5))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_GQ001_WHEREISJORN_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_GQ001_WhereIsJorn_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_GQ001_WhereIsJorn_08_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_GQ001_WhereIsJorn_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_GQ001_WhereIsJorn_08_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_GQ001_WhereIsJorn_08_05");
    if ((GQ001_INFOFROMFABIO) == (TRUE)) {
        AI_OUTPUT(OTHER, SELF, "DIA_Ana_GQ001_WhereIsJorn_15_06");
        AI_OUTPUT(SELF, OTHER, "DIA_Ana_GQ001_WhereIsJorn_08_07");
    };
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_GQ001_WhereIsJorn_15_08");
    AI_STOPPROCESSINFOS(SELF);
}

instance DIA_ANA_Q501_HELLO(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_HELLO_CONDITION;
    INFORMATION = DIA_ANA_Q501_HELLO_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ANA_Q501_HELLO_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 79752))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_HELLO_INFO() {
    NPC_EXCHANGEROUTINE(SELF, "Q501_HEALREFUGEE");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Hello_03_01");
    INFO_CLEARCHOICES(91419);
    INFO_ADDCHOICE(91419, "Do we know each other?", 91422);
    INFO_ADDCHOICE(91419, "Ana?", 91423);
}

func void DIA_ANA_Q501_HELLO_KNOW() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Hello_Know_15_01");
    AI_STARTFACEANI(SELF, S_SURPRISE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Hello_Know_03_02");
}

func void DIA_ANA_Q501_HELLO_ANA() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Hello_Ana_15_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Hello_Ana_03_02");
    INFO_CLEARCHOICES(91419);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_ANA_Q501_BANDITS(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_BANDITS_CONDITION;
    INFORMATION = DIA_ANA_Q501_BANDITS_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "My friend and I were attacked by... bandits.";
}

func int DIA_ANA_Q501_BANDITS_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91419))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_BANDITS_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Bandits_15_01");
    AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_02");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_04");
    AI_STARTFACEANI(SELF, S_NOPE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_05");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_06");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_07");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_08");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_03_09");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_HISTORY);
    INFO_CLEARCHOICES(91424);
    INFO_ADDCHOICE(91424, DIALOG_BESILENT, 91429);
    INFO_ADDCHOICE(91424, "I'm glad you made it out okay.", 91428);
}

func void DIA_ANA_Q501_BANDITS_NEXT() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_Next_03_01");
    INFO_CLEARCHOICES(91424);
    INFO_ADDCHOICE(91424, "Unfortunately, Jorn is dead.", 91430);
}

func void DIA_ANA_Q501_BANDITS_HAPPY() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Bandits_Happy_15_01");
    DIA_ANA_Q501_BANDITS_NEXT();
}

func void DIA_ANA_Q501_BANDITS_SILENCE() {
    AI_WAIT(OTHER, 1056964608);
    AI_WAITTILLEND(SELF, OTHER);
    DIA_ANA_Q501_BANDITS_NEXT();
}

func void DIA_ANA_Q501_BANDITS_DEAD() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Bandits_Dead_15_01");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_Dead_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Bandits_Dead_03_03");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_CANHELP);
    INFO_CLEARCHOICES(91424);
    AI_RESETFACEANI(SELF);
}

instance DIA_ANA_Q501_HELP(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_HELP_CONDITION;
    INFORMATION = DIA_ANA_Q501_HELP_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "(Ask for help with getting the recipe)";
}

func int DIA_ANA_Q501_HELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91424))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_HELP_INFO() {
    Q501_MARVINGOTOSLEEP = 1;
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Help_15_01");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Help_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Help_15_03");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Help_15_04");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Help_03_05");
    AI_RESETFACEANI(SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Help_03_06");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_WILLSEARCH);
}

instance DIA_ANA_Q501_NEXTDAY(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_NEXTDAY_CONDITION;
    INFORMATION = DIA_ANA_Q501_NEXTDAY_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ANA_Q501_NEXTDAY_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && ((Q501_MARVINGOTOSLEEP) == (2))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_NEXTDAY_INFO() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_03_01");
    INFO_CLEARCHOICES(91434);
    INFO_ADDCHOICE(91434, "To be honest, I'm feeling pretty good today.", 91439);
    INFO_ADDCHOICE(91434, "I've been better...", 91438);
}

func void DIA_ANA_Q501_NEXTDAY_NEXT() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Next_03_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Next_03_02");
    INFO_CLEARCHOICES(91434);
    INFO_ADDCHOICE(91434, "Can I just walk out of the infirmary like that?", 91441);
    INFO_ADDCHOICE(91434, "Where are Riordian and Rierol?", 91440);
}

func void DIA_ANA_Q501_NEXTDAY_BETTER() {
    AI_STARTFACEANI(OTHER, S_TIRED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_NextDay_Better_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Better_03_02");
    DIA_ANA_Q501_NEXTDAY_NEXT();
}

func void DIA_ANA_Q501_NEXTDAY_NOTBAD() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_NextDay_NotBad_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_NotBad_03_02");
    DIA_ANA_Q501_NEXTDAY_NEXT();
}

func void DIA_ANA_Q501_NEXTDAY_NOTBAD_NEXT_WHERE() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_NextDay_Where_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Where_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Where_03_03");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_WHEREAREMAGES);
}

func void DIA_ANA_Q501_NEXTDAY_NOTBAD_NEXT_LEAVE() {
    CREATEINVITEMS(SELF, 35594, 1);
    B_GIVEINVITEMS(SELF, OTHER, 35594, 1);
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_NextDay_Leave_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Leave_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Leave_03_03");
    AI_WAITTILLEND(OTHER, SELF);
    AI_PLAYANI(OTHER, T_PLUNDER);
    AI_EQUIPARMOR(OTHER, 35594);
    AI_WAITTILLEND(SELF, OTHER);
    AI_PLAYANI(SELF, T_LAUGH_FEMALE);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Leave_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Leave_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NextDay_Leave_03_06");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_GUIDETORIEROL);
    INFO_CLEARCHOICES(91434);
    AI_STOPPROCESSINFOS(SELF);
    SELF.AIVAR[15] = TRUE;
    NPC_EXCHANGEROUTINE(SELF, "Q501_GUIDE_RIEROL");
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_ANA_Q501_RIEROLROOM(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_RIEROLROOM_CONDITION;
    INFORMATION = DIA_ANA_Q501_RIEROLROOM_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ANA_Q501_RIEROLROOM_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91434))) && ((NPC_GETDISTTOWP(SELF, "PART8_MONASTERY_87")) <= (500))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_RIEROLROOM_INFO() {
    Q501_SPYCUTSCENESTATUS = 1;
    WLD_SENDTRIGGER("Q501_MOVER_CUTSCENETRIGGERBOX");
    SELF.AIVAR[15] = FALSE;
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_RierolRoom_03_01");
    AI_TURNTONPC(SELF, KDW_303_RIEROL);
    AI_FUNCTION(SELF, 91445);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_RierolRoom_03_02");
    NPC_EXCHANGEROUTINE(SELF, "Q501_WAITFORRIEROL");
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 91446);
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_PLAN);
}

func void Q501_ANA_RIEROLROOM_CAMERA_ON() {
    DIACAM_DISABLE();
    WLD_SENDTRIGGER("Q501_RIEROL_01");
}

func void Q501_ANA_RIEROLROOM_CAMERA_OFF() {
    FF_APPLYONCEEXT(63375, 75, 4);
}

instance DIA_ANA_PROBLEM(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_PROBLEM_CONDITION;
    INFORMATION = DIA_ANA_PROBLEM_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Mages have no problem with a woman running around the monastery?";
}

func int DIA_ANA_PROBLEM_CONDITION() {
    if ((Q501_MARVINGOTOSLEEP) >= (2)) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_PROBLEM_INFO() {
    AI_STARTFACEANI(OTHER, S_SURPRISE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Problem_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Problem_03_02");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Problem_03_03");
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Problem_03_04");
    AI_RESETFACEANI(OTHER);
    AI_RESETFACEANI(SELF);
}

instance DIA_ANA_Q501_WHERERIORDIAN(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_WHERERIORDIAN_CONDITION;
    INFORMATION = DIA_ANA_Q501_WHERERIORDIAN_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Do you know where Riordian is?";
}

func int DIA_ANA_Q501_WHERERIORDIAN_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && ((Q501_MARVINGOTOSLEEP) == (6))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_WHERERIORDIAN_INFO() {
    AI_STARTFACEANI(OTHER, S_WHAT, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_WhereRiordian_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_WhereRiordian_03_02");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_WhereRiordian_03_03");
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_WHEREISRIORDIAN);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
}

instance DIA_ANA_Q501_DOORCLOSED(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_DOORCLOSED_CONDITION;
    INFORMATION = DIA_ANA_Q501_DOORCLOSED_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Do you know that storage room upstairs?";
}

func int DIA_ANA_Q501_DOORCLOSED_CONDITION() {
    if ((((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91450))) && ((Q501_TRYEDOPENLABROOM) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_DOORCLOSED_INFO() {
    AI_STARTFACEANI(OTHER, S_THINK, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_DoorClosed_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_DoorClosed_03_02");
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_DoorClosed_15_03");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_DoorClosed_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_DoorClosed_03_05");
    CREATEINVITEMS(SELF, 36903, 1);
    B_GIVEINVITEMS(SELF, OTHER, 36903, 1);
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_GOTKEY);
    AI_FUNCTION(SELF, 63397);
}

instance DIA_ANA_Q501_NEEDHELP(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_NEEDHELP_CONDITION;
    INFORMATION = DIA_ANA_Q501_NEEDHELP_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Ana, I need your help again.";
}

func int DIA_ANA_Q501_NEEDHELP_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && ((Q501_NEEDHELPWITHPOTION) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_NEEDHELP_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_NeedHelp_15_01");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_NeedHelp_03_02");
    AI_RESETFACEANI(SELF);
}

instance DIA_ANA_Q501_HELPPOTION(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_HELPPOTION_CONDITION;
    INFORMATION = DIA_ANA_Q501_HELPPOTION_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "I need you to help me make a potion.";
}

func int DIA_ANA_Q501_HELPPOTION_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91456))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_HELPPOTION_INFO() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_15_01");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_HelpPotion_03_02");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_15_03");
    AI_STARTFACEANI(SELF, S_WHAT, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_HelpPotion_03_04");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_15_05");
    INFO_CLEARCHOICES(91459);
    INFO_ADDCHOICE(91459, "Think of that man who once helped you...", 91465);
    INFO_ADDCHOICE(91459, "I need to get well so I can avenge my brother.", 91464);
    INFO_ADDCHOICE(91459, "Without this potion, my friend may not survive.", 91463);
}

func void DIA_ANA_Q501_HELPPOTION_NEXT() {
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_HelpPotion_Next_03_01");
    INFO_CLEARCHOICES(91459);
    AI_STOPPROCESSINFOS(SELF);
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_ANA_WILLHELP);
    NPC_EXCHANGEROUTINE(SELF, "Q501_POTION_WAIT");
}

func void DIA_ANA_Q501_HELPPOTION_KESSEL() {
    AI_STARTFACEANI(OTHER, S_TIRED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_Kessel_15_01");
    DIA_ANA_Q501_HELPPOTION_NEXT();
}

func void DIA_ANA_Q501_HELPPOTION_BROTHER() {
    AI_STARTFACEANI(OTHER, S_SERIOUS, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_Brother_15_01");
    DIA_ANA_Q501_HELPPOTION_NEXT();
}

func void DIA_ANA_Q501_HELPPOTION_PAST() {
    AI_STARTFACEANI(OTHER, S_SMILE, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_HelpPotion_Past_15_01");
    DIA_ANA_Q501_HELPPOTION_NEXT();
}

instance DIA_ANA_Q501_MAKINGPOTION(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_MAKINGPOTION_CONDITION;
    INFORMATION = DIA_ANA_Q501_MAKINGPOTION_INFO;
    PERMANENT = FALSE;
    DESCRIPTION = "Let's get on with this potion.";
}

func int DIA_ANA_Q501_MAKINGPOTION_CONDITION() {
    if (((((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && (NPC_KNOWSINFO(OTHER, 91459))) && ((NPC_GETDISTTOWP(SELF, "PART8_NOV_ROOM_RIORDRIAN")) <= (500))) && ((NPC_HASITEMS(OTHER, 37536)) >= (1))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT() {
    Q501_MAKINGPOTION_GOODANWSERS = (Q501_MAKINGPOTION_GOODANWSERS) + (1);
    PRINTD(CS2("Dobrych odpowiedzi: ", INTTOSTRING(Q501_MAKINGPOTION_GOODANWSERS)));
}

func void DIA_ANA_Q501_MAKINGPOTION_RESULT() {
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_05");
    DIACAM_ENABLE();
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    AI_WAIT(SELF, 1077936128);
    AI_WAITTILLEND(OTHER, SELF);
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_15_06");
    AI_USEMOB(SELF, "LAB", -(1));
    AI_TURNTONPC(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_07");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_08");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "(Drink the potion)", 91470);
    INFO_ADDCHOICE(91466, "If Rierol comes back here with him, they'll take the potion away from us.", 91474);
}

func void DIA_ANA_Q501_MAKINGPOTION_JUSTDRINK() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_15_09");
    B_MARVIN_USEFAKEQ501POTION();
    AI_FUNCTION(OTHER, 63402);
    AI_WAITTILLEND(SELF, OTHER);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_10");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "I'm still standing, so we didn't break anything.", 91473);
    INFO_ADDCHOICE(91466, "I feel like a newborn!", 91472);
}

func void DIA_ANA_Q501_MAKINGPOTION_FINISH() {
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_11");
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_15_12");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_13");
    INFO_CLEARCHOICES(91466);
    AI_STOPPROCESSINFOS(SELF);
    NPC_EXCHANGEROUTINE(SELF, "Q501_RUNTOKESSEL");
    AI_FUNCTION(SELF, 63403);
}

func void DIA_ANA_Q501_MAKINGPOTION_YESV1() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_YesV1_15_01");
    DIA_ANA_Q501_MAKINGPOTION_FINISH();
}

func void DIA_ANA_Q501_MAKINGPOTION_YESV2() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_YesV2_15_01");
    DIA_ANA_Q501_MAKINGPOTION_FINISH();
}

func void DIA_ANA_Q501_MAKINGPOTION_RIEROL() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_Rierol_15_01");
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV6() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_05");
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_04");
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Pour in a bottle and a half of honey.", 91495);
    INFO_ADDCHOICE(91466, "Pour in 2 tablespoons of honey.", 91496);
    INFO_ADDCHOICE(91466, "Pour in a bottle of honey.", 91497);
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV5() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_04");
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_03");
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_05");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Add goblin berries.", 91493);
    INFO_ADDCHOICE(91466, "Add dragonroot.", 91494);
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV4() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_03");
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_02");
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Add earth aloe.", 91491);
    INFO_ADDCHOICE(91466, "Add sun aloe.", 91492);
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV3() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_02");
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_01");
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_04");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Add three healing herbs.", 91488);
    INFO_ADDCHOICE(91466, "Add three healing plants.", 91489);
    INFO_ADDCHOICE(91466, "Add three healing roots.", 91490);
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV2() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_01");
    WLD_SENDUNTRIGGER("KM_P8_MARVINPOTION_06");
    TELEPORTNPCTOWP(1819, "PART8_NOV_ROOM_03");
    AI_TURNTONPC(SELF, OTHER);
    AI_PLAYANI(SELF, "R_LAB_RANDOM_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_03");
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Add meadow knotweed.", 91485);
    INFO_ADDCHOICE(91466, "Add the king's sorrel.", 91486);
    INFO_ADDCHOICE(91466, "Add river myrtle.", 91487);
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICESV1() {
    AI_STOPLOOKAT(OTHER);
    INFO_CLEARCHOICES(91466);
    INFO_ADDCHOICE(91466, "Pour in half a bottle of milk.", 91482);
    INFO_ADDCHOICE(91466, "Pour in whole bottle of milk.", 91483);
    INFO_ADDCHOICE(91466, "Pour in a tablespoon of milk.", 91484);
}

func void DIA_ANA_Q501_MAKINGPOTION_INFO() {
    B_GIVEINVITEMS(OTHER, SELF, 37536, 1);
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_15_01");
    AI_WAITTILLEND(SELF, OTHER);
    AI_STOPLOOKAT(SELF);
    AI_FUNCTION(SELF, 91498);
    AI_USEMOB(SELF, "LAB", 1);
    AI_WAITTILLEND(OTHER, SELF);
    AI_TURNTONPC(OTHER, SELF);
    AI_LOOKATNPC(OTHER, SELF);
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_MakingPotion_03_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV1();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICE_V1() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV1_15_01");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV2();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICE_V2() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV1_15_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV2();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICE_V3() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV1_15_03");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV2();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV2_V1() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV2_15_01");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV3();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV2_V2() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV2_15_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV3();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV2_V3() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV2_15_03");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV3();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV3_V1() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV3_15_01");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV4();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV3_V2() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV3_15_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV4();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV3_V3() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV3_15_03");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV4();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV4_V1() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV4_15_01");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV5();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV4_V2() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV4_15_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV5();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV5_V1() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV5_15_01");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV6();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV5_V2() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV5_15_02");
    DIA_ANA_Q501_MAKINGPOTION_CHOICESV6();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV6_V1() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV6_15_01");
    DIA_ANA_Q501_MAKINGPOTION_RESULT();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV6_V2() {
    DIA_ANA_Q501_MAKINGPOTION_COUNTPOINT();
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV6_15_02");
    DIA_ANA_Q501_MAKINGPOTION_RESULT();
}

func void DIA_ANA_Q501_MAKINGPOTION_CHOICEV6_V3() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_MakingPotion_ChoiceV6_15_03");
    DIA_ANA_Q501_MAKINGPOTION_RESULT();
}

func void DIA_ANA_Q501_MAKINGPOTION_CAMERA() {
    WLD_SENDTRIGGER("KM_P8_MARVINPOTION_06");
    DIACAM_DISABLE();
}

instance DIA_ANA_Q501_FINISH(C_INFO) {
    NPC = 51576;
    NR = 1;
    CONDITION = DIA_ANA_Q501_FINISH_CONDITION;
    INFORMATION = DIA_ANA_Q501_FINISH_INFO;
    PERMANENT = FALSE;
    IMPORTANT = TRUE;
}

func int DIA_ANA_Q501_FINISH_CONDITION() {
    if (((LOG_GETSTATUS(MIS_Q501)) == (LOG_RUNNING)) && ((Q501_AFTERLASTFADESCREEN) == (TRUE))) {
        return TRUE;
    };
    return 0 /* !broken stack! */;
}

func void DIA_ANA_Q501_FINISH_INFO() {
    AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_03_01");
    INFO_CLEARCHOICES(91499);
    INFO_ADDCHOICE(91499, "What happened this time? Where's Kessel?", 91502);
    SQ506_PREPARENPC();
}

func void DIA_ANA_Q501_FINISH_KESSEL() {
    AI_STARTFACEANI(OTHER, S_TIRED, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Finish_Kessel_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_Kessel_03_02");
    AI_STARTFACEANI(SELF, S_TIRED, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_Kessel_03_03");
    AI_STARTFACEANI(SELF, S_SAD, 1, -(1));
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_Kessel_03_04");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_Kessel_03_05");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_Kessel_03_06");
    INFO_CLEARCHOICES(91499);
    INFO_ADDCHOICE(91499, "Maybe it's for the best...", 91505);
    INFO_ADDCHOICE(91499, "What have you done?!", 91504);
}

func void DIA_ANA_Q501_FINISH_KESSEL_NEXT() {
    AI_LOGENTRY(TOPIC_Q501, LOG_Q501_FINISH);
    LOG_SETSTATUS(_@(MIS_Q501), TOPIC_Q501, LOG_SUCCESS);
    B_GIVEPLAYERXP(XP_Q501_FINISH);
    AI_RESETFACEANI(SELF);
    AI_RESETFACEANI(OTHER);
    AI_WAITTILLEND(SELF, OTHER);
    AI_STOPPROCESSINFOS(SELF);
    AI_FUNCTION(SELF, 63415);
}

func void DIA_ANA_Q501_FINISH_KESSEL_WHAT() {
    AI_STARTFACEANI(OTHER, S_ANGRY, 1, -(1));
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Finish_What_15_01");
    AI_OUTPUT(SELF, OTHER, "DIA_Ana_Q501_Finish_What_03_02");
    DIA_ANA_Q501_FINISH_KESSEL_NEXT();
}

func void DIA_ANA_Q501_FINISH_KESSEL_BETTER() {
    AI_OUTPUT(OTHER, SELF, "DIA_Ana_Q501_Finish_Better_15_01");
    DIA_ANA_Q501_FINISH_KESSEL_NEXT();
}

instance DIA_ANA_AMBIENT(C_INFO) {
    NPC = 51576;
    NR = 998;
    CONDITION = DIA_ANA_AMBIENT_CONDITION;
    INFORMATION = DIA_ANA_AMBIENT_INFO;
    PERMANENT = TRUE;
    DESCRIPTION = "How are you doing?";
}

func int DIA_ANA_AMBIENT_CONDITION() {
    return TRUE;
}

func void DIA_ANA_AMBIENT_INFO() {
    B_SAY(OTHER, SELF, "$MARVIN_WhatNew4");
    if ((LOG_GETSTATUS(MIS_Q102)) == (LOG_RUNNING)) {
        if (((Q102_FABIO_READYTOSLEEP) == (TRUE)) || ((FABIOTOSILBACH) == (TRUE))) {
            AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
            AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_06");
        } else {
            NPC_INITAMBIENTS(SELF, 2);
            if ((NPC_GETLASTAMBIENT(SELF)) == (1)) {
                AI_STARTFACEANI(SELF, S_FRIGHTENED, 1, -(1));
                AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_04");
            } else if ((NPC_GETLASTAMBIENT(SELF)) == (2)) {
                AI_STARTFACEANI(SELF, S_FRIGHTENED, 1, -(1));
                AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_05");
            };
        };
    };
    if (((SILBACHSLEEP) == (2)) && ((KAPITEL) != (5))) {
        NPC_INITAMBIENTS(SELF, 2);
        if ((NPC_GETLASTAMBIENT(SELF)) == (1)) {
            AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
            AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_07");
        } else if ((NPC_GETLASTAMBIENT(SELF)) == (2)) {
            AI_STARTFACEANI(SELF, S_ANGRY, 1, -(1));
            AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_08");
        };
    };
    if ((KAPITEL) == (5)) {
        NPC_INITAMBIENTS(SELF, 2);
        if ((NPC_GETLASTAMBIENT(SELF)) == (1)) {
            AI_STARTFACEANI(SELF, S_THINK, 1, -(1));
            AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_09");
        } else if ((NPC_GETLASTAMBIENT(SELF)) == (2)) {
            AI_STARTFACEANI(SELF, S_SMILE, 1, -(1));
            AI_OUTPUT(SELF, OTHER, "DIA_Ana_Ambient_03_10");
        };
    };
    AI_RESETFACEANI(SELF);
}

