func void SQ313_HUUGDOOR() {
    FF_APPLYONCEEXTGT(62414, 0, -(1));
}

func void SQ313_HUUGDOOR_APPLY() {
    var ZCMOVER MOVER1;
    var int MOVPTR1;
    var int HUUGDOOR_COLLISION;
    if ((HUUGDOOR_COLLISION) == (0)) {
        PRINTD("Rozpoczynam - SQ313_HuugDoor_Apply");
        MOVPTR1 = MEM_SEARCHVOBBYNAME("SQ313_MOVER_DOOR_01");
        MOVER1 = MEM_PTRTOINST(MOVPTR1);
        CHANGEVOBCOLLISION("SQ313_DOOR_01", FALSE, FALSE, FALSE, TRUE);
        CHANGEVOBCOLLISION("SQ313_BROKENDOOR_01", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ313_BROKENDOOR_02", TRUE, FALSE, TRUE, TRUE);
        CHANGEVOBCOLLISION("SQ313_BROKENDOOR_03", TRUE, FALSE, TRUE, TRUE);
        WLD_SENDTRIGGER("SQ313_MOVER_DOOR_01");
        HUUGDOOR_COLLISION = 1;
    };
    if (((MOVER1.MOVERSTATE) != (MOVER_STATE_OPENING)) && ((MOVER1.MOVERSTATE) != (MOVER_STATE_CLOSING))) {
        PRINTD("Skoñczy³em - SQ313_HuugDoor_Apply");
        if ((TRIMEGISTO_SQ313_FOLLOWME) >= (1)) {
            CHANGEVOBCOLLISION(RESERVED_CONST_STRING_77, FALSE, FALSE, FALSE, FALSE);
            CHANGEVOBCOLLISION(RESERVED_CONST_STRING_78, FALSE, FALSE, FALSE, FALSE);
            CHANGEVOBCOLLISION(RESERVED_CONST_STRING_79, FALSE, FALSE, FALSE, FALSE);
        };
        CHANGEVOBCOLLISION("SQ313_DOOR_01", TRUE, TRUE, TRUE, TRUE);
        FF_REMOVE(62414);
        HUUGDOOR_COLLISION = 0;
    };
}

func void SQ313_UNABLEHUUGCUTSCENE() {
    SQ313_HUUGCUTSCENEENABLE = 1;
    NPC_EXCHANGEROUTINE(KDF_6404_TRIMEGISTO, "SQ313_HUUGHOUSE");
    NPC_EXCHANGEROUTINE(NONE_1004_HUUG, "SQ313_HUUGHOUSE");
}

func void SQ313_HUUGCUTSCENEENABLE_START() {
    var int SQ313_HUUGCUTSCENEENABLE_COUNT;
    SQ313_HUUGCUTSCENEENABLE_COUNT = (SQ313_HUUGCUTSCENEENABLE_COUNT) + (1);
    if ((SQ313_HUUGCUTSCENEENABLE_COUNT) == (4)) {
        CUTSCENE_START(92938);
    };
}

func void SQ313_FIGHTWITHHUUG() {
    SQ313_FIGHTHUUG = 1;
    NONE_1004_HUUG.FIGHT_TACTIC = FAI_HUMAN_BAU;
    MDL_APPLYOVERLAYMDS(NONE_1004_HUUG, "HUMANS_BAU_FIGHT.mds");
    MDL_REMOVEOVERLAYMDS(NONE_1004_HUUG, HUMANSSPRINTMDS);
    B_IMMEDIATEATTACKPLAYER(NONE_6255_THUG, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_6256_THUG, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_6257_THUG, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_6258_THUG, AR_KILL);
    B_IMMEDIATEATTACKPLAYER(NONE_1004_HUUG, AR_KILL);
    NPC_SETTRUEGUILD(NONE_1004_HUUG, GIL_BDT);
    NONE_6255_THUG.GUILD = GIL_BDT;
    NPC_SETTRUEGUILD(NONE_6258_THUG, GIL_BDT);
    NONE_6256_THUG.GUILD = GIL_BDT;
    NPC_SETTRUEGUILD(NONE_6257_THUG, GIL_BDT);
    NONE_6257_THUG.GUILD = GIL_BDT;
    NPC_SETTRUEGUILD(NONE_6256_THUG, GIL_BDT);
    NONE_6258_THUG.GUILD = GIL_BDT;
    NPC_SETTRUEGUILD(NONE_6255_THUG, GIL_BDT);
    NONE_1004_HUUG.GUILD = GIL_BDT;
    NONE_6255_THUG.FLAGS = 0;
    NONE_6256_THUG.FLAGS = 0;
    NONE_6257_THUG.FLAGS = 0;
    NONE_6258_THUG.FLAGS = 0;
    NONE_1004_HUUG.FLAGS = 0;
}

func void SQ313_PREPAREMAGES_HUGHENDING() {
    SQ313_ENDING = 1;
    NPC_EXCHANGEROUTINE(KDF_6404_TRIMEGISTO, "SQ313_JUDGE");
    if ((NPC_ISINSTATE(KDF_6404_TRIMEGISTO, 61599)) == (FALSE)) {
        NPC_REFRESH(KDF_6404_TRIMEGISTO);
        TELEPORTNPCTOWP(51943, KDF_6404_TRIMEGISTO.WP);
    };
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL, "SQ313_JUDGE");
    if ((NPC_ISINSTATE(KDF_9004_TENGRAL, 61599)) == (FALSE)) {
        NPC_REFRESH(KDF_9004_TENGRAL);
        TELEPORTNPCTOWP(55422, KDF_9004_TENGRAL.WP);
    };
    B_STARTOTHERROUTINE(KDF_11261_FIREMAGE, "SQ313_JUDGE");
    NPC_REFRESH(KDF_11261_FIREMAGE);
    TELEPORTNPCTOWP(51797, KDF_11261_FIREMAGE.WP);
    B_STARTOTHERROUTINE(PAL_101_SILVESTR, "SQ313_JUDGE");
    NPC_REFRESH(PAL_101_SILVESTR);
    TELEPORTNPCTOWP(55435, PAL_101_SILVESTR.WP);
}

func void SQ313_PREPAREMAGES_TRIMEGISTOENDING() {
    SQ313_ENDING = 2;
    NPC_EXCHANGEROUTINE(KDF_9004_TENGRAL, "SQ313_JUDGE");
    if ((NPC_ISINSTATE(KDF_9004_TENGRAL, 61599)) == (FALSE)) {
        NPC_REFRESH(KDF_9004_TENGRAL);
        TELEPORTNPCTOWP(55422, KDF_9004_TENGRAL.WP);
    };
    B_STARTOTHERROUTINE(KDF_11261_FIREMAGE, "SQ313_JUDGE");
    NPC_REFRESH(KDF_11261_FIREMAGE);
    TELEPORTNPCTOWP(51797, KDF_11261_FIREMAGE.WP);
}

func void SQ313_FINISHQUEST() {
    B_GIVEPLAYERXP(XP_SQ313_FINISH);
    LOG_SETSTATUS(_@(MIS_SQ313), TOPIC_SQ313, LOG_SUCCESS);
}

func void SQ313_HUUGCUTSCENEENDING_START() {
    var int SQ313_HUUGCUTSCENEENDING_COUNT;
    SQ313_HUUGCUTSCENEENDING_COUNT = (SQ313_HUUGCUTSCENEENDING_COUNT) + (1);
    if ((SQ313_HUUGCUTSCENEENDING_COUNT) == (4)) {
        CUTSCENE_START(92945);
    };
}

func void SQ313_REMOVETRAPS() {
    if ((TRAP10_HIDDEN) == (FALSE)) {
        if ((TRAP10_SPAWNED) == (TRUE)) {
            if ((NPC_ISDEAD(NONE_11153_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54769, TOT);
                NPC_EXCHANGEROUTINE(NONE_11153_THUG, TOT);
            };
            if ((NPC_ISDEAD(NONE_11154_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54772, TOT);
                NPC_EXCHANGEROUTINE(NONE_11154_THUG, TOT);
            };
            if ((NPC_ISDEAD(NONE_11155_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54775, TOT);
                NPC_EXCHANGEROUTINE(NONE_11155_THUG, TOT);
            };
            TRAP10_HIDDEN = TRUE;
        };
    };
    if ((TRAP34_SPAWNED) == (TRUE)) {
        if ((NPC_ISDEAD(BDT_13354_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55352, TOT);
            NPC_EXCHANGEROUTINE(BDT_13354_THUG, TOT);
        };
        TRAP34_HIDDEN = TRUE;
    };
    if ((TRAP35_SPAWNED) == (TRUE)) {
        if ((NPC_ISDEAD(BDT_13355_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55355, TOT);
            NPC_EXCHANGEROUTINE(BDT_13355_THUG, TOT);
        };
        TRAP35_HIDDEN = TRUE;
    };
    if ((TRAP26_SPAWNED) == (TRUE)) {
        if ((NPC_ISDEAD(NONE_13344_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55374, TOT);
            NPC_EXCHANGEROUTINE(NONE_13344_REFUGEE, TOT);
        };
        if ((NPC_ISDEAD(NONE_13345_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55376, TOT);
            NPC_EXCHANGEROUTINE(NONE_13345_REFUGEE, TOT);
        };
        if ((NPC_ISDEAD(NONE_13346_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55378, TOT);
            NPC_EXCHANGEROUTINE(NONE_13346_REFUGEE, TOT);
        };
        TRAP26_HIDDEN = TRUE;
    };
    if ((M7_TRAP_ACTIVATED) == (TRUE)) {
        if ((NPC_ISDEAD(NONE_11236_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55358, TOT);
            NPC_EXCHANGEROUTINE(NONE_11236_THUG, TOT);
        };
        if ((NPC_ISDEAD(NONE_11237_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55360, TOT);
            NPC_EXCHANGEROUTINE(NONE_11237_THUG, TOT);
        };
        if (((SLUMSGUARDIAN_NEWTRAPS) == (TRUE)) || ((SLUMSGUARDIAN_PROTECTIONPAID) == (FALSE))) {
            if ((NPC_ISDEAD(NONE_11238_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(55362, TOT);
                NPC_EXCHANGEROUTINE(NONE_11238_THUG, TOT);
            };
        };
        TRAPM7_HIDDEN = TRUE;
    };
    if ((NS01_SPAWNED) == (TRUE)) {
        if (!(NPC_KNOWSINFO(HERO, 71977))) {
            TELEPORTNPCTOWP(54796, TOT);
            NPC_EXCHANGEROUTINE(VLK_11119_DRUNKENSAILOR, TOT);
            TELEPORTNPCTOWP(54800, TOT);
            NPC_EXCHANGEROUTINE(VLK_11120_DRUNKENSAILOR, TOT);
            TELEPORTNPCTOWP(54792, TOT);
            NPC_EXCHANGEROUTINE(VLK_11118_DRUNKENSAILOR, TOT);
            TELEPORTNPCTOWP(54804, TOT);
            NPC_EXCHANGEROUTINE(VLK_11121_DRUNKENSAILOR, TOT);
            NS01_HIDDEN = TRUE;
        };
    };
    if ((NS60_SPAWNED) == (TRUE)) {
        if (!(NPC_KNOWSINFO(HERO, 68474))) {
            TELEPORTNPCTOWP(54789, TOT);
            NPC_EXCHANGEROUTINE(NONE_13793_WIDOW, TOT);
            NS60_HIDDEN = TRUE;
        };
    };
    if ((NS25_SPAWNED) == (TRUE)) {
        if (((NPC_ISDEAD(VLK_11285_CITIZEN_RPS)) == (FALSE)) && (!(NPC_KNOWSINFO(HERO, 72386)))) {
            TELEPORTNPCTOWP(54808, TOT);
            NPC_EXCHANGEROUTINE(VLK_11285_CITIZEN_RPS, TOT);
            NS25_HIDDEN = TRUE;
        };
    };
    if ((NS39_SPAWNED) == (TRUE)) {
        if (!(NPC_KNOWSINFO(HERO, 68360))) {
            TELEPORTNPCTOWP(54778, TOT);
            NPC_EXCHANGEROUTINE(NONE_13638_FISHERMAN, TOT);
            NS39_HIDDEN = TRUE;
        };
    };
    if ((NS39_SPAWNEDSISTER) == (TRUE)) {
        if (!(NPC_KNOWSINFO(HERO, 73101))) {
            TELEPORTNPCTOWP(54811, TOT);
            NPC_EXCHANGEROUTINE(VLK_13639_GIRL, TOT);
            NS39_HIDDENSISTER = TRUE;
        };
    };
    if ((NS04_SPAWNED) == (TRUE)) {
        if ((NS04_ENDOFAPPLES) == (FALSE)) {
            TELEPORTNPCTOWP(55416, TOT);
            NPC_EXCHANGEROUTINE(VLK_11157_APPLETRADER, TOT);
            NS04_HIDDEN = TRUE;
        };
    };
    if ((NS05_SPAWNED) == (TRUE)) {
        if (!(NPC_KNOWSINFO(HERO, 72100))) {
            TELEPORTNPCTOWP(55419, TOT);
            NPC_EXCHANGEROUTINE(VLK_11158_ELDERLYWOMAN, TOT);
            NS05_HIDDEN = TRUE;
        };
    };
    if ((NS57_SPAWNED) == (TRUE)) {
        if (((NPC_ISDEAD(NONE_13783_FISHERMAN)) == (FALSE)) && (!(NPC_KNOWSINFO(HERO, 68428)))) {
            TELEPORTNPCTOWP(54781, TOT);
            NPC_EXCHANGEROUTINE(NONE_13783_FISHERMAN, TOT);
            NS57_HIDDEN = TRUE;
        };
    };
    if ((RND_PROVOCATION_M6_CH3_HIDDEN) == (FALSE)) {
        if ((RND_PROVOCATION_M6_CH3) == (1)) {
            TELEPORTNPCTOWP(53900, TOT);
            NPC_EXCHANGEROUTINE(NONE_11152_THUG, TOT);
            TELEPORTNPCTOWP(53897, TOT);
            NPC_EXCHANGEROUTINE(NONE_11151_THUG, TOT);
            RND_PROVOCATION_M6_CH3_HIDDEN = TRUE;
        };
    };
    if ((TRAP61_SPAWNED) == (TRUE)) {
        if ((CULUS_DEBUGG) != (1)) {
            TELEPORTNPCTOWP(55052, TOT);
            NPC_EXCHANGEROUTINE(NONE_11179_CULUS, TOT);
            TRAP61_HIDDEN = TRUE;
        };
    };
}

func void SQ313_BRINGBACKTRAPS() {
    if (((LOG_GETSTATUS(MIS_QA302)) != (LOG_RUNNING)) && ((LOG_GETSTATUS(MIS_SQ313)) != (LOG_RUNNING))) {
        if ((TRAP10_HIDDEN) == (TRUE)) {
            if ((NPC_ISDEAD(NONE_11153_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54769, NONE_11153_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11153_THUG, START);
            };
            if ((NPC_ISDEAD(NONE_11154_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54772, NONE_11154_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11154_THUG, START);
            };
            if ((NPC_ISDEAD(NONE_11155_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(54775, NONE_11155_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11155_THUG, START);
            };
            TRAP10_HIDDEN = FALSE;
        };
        if ((RND_PROVOCATION_M6_CH3_HIDDEN) == (TRUE)) {
            if ((NPC_ISDEAD(NONE_11152_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(53900, NONE_11152_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11152_THUG, START);
            };
            if ((NPC_ISDEAD(NONE_11152_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(53897, NONE_11151_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11151_THUG, START);
            };
            RND_PROVOCATION_M6_CH3_HIDDEN = FALSE;
        };
    };
    if ((TRAP34_HIDDEN) == (TRUE)) {
        if ((NPC_ISDEAD(BDT_13354_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55352, BDT_13354_THUG.WP);
            NPC_EXCHANGEROUTINE(BDT_13354_THUG, START);
        };
        TRAP34_HIDDEN = FALSE;
    };
    if ((TRAP35_HIDDEN) == (TRUE)) {
        if ((NPC_ISDEAD(BDT_13355_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55355, BDT_13355_THUG.WP);
            NPC_EXCHANGEROUTINE(BDT_13355_THUG, START);
        };
        TRAP35_HIDDEN = FALSE;
    };
    if ((TRAP26_HIDDEN) == (TRUE)) {
        if ((NPC_ISDEAD(NONE_13344_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55374, NONE_13344_REFUGEE.WP);
            NPC_EXCHANGEROUTINE(NONE_13344_REFUGEE, START);
        };
        if ((NPC_ISDEAD(NONE_13345_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55376, NONE_13345_REFUGEE.WP);
            NPC_EXCHANGEROUTINE(NONE_13345_REFUGEE, START);
        };
        if ((NPC_ISDEAD(NONE_13346_REFUGEE)) == (FALSE)) {
            TELEPORTNPCTOWP(55378, NONE_13346_REFUGEE.WP);
            NPC_EXCHANGEROUTINE(NONE_13346_REFUGEE, START);
        };
        TRAP26_HIDDEN = FALSE;
    };
    if ((TRAPM7_HIDDEN) == (TRUE)) {
        if ((NPC_ISDEAD(NONE_11236_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55358, NONE_11236_THUG.WP);
            NPC_EXCHANGEROUTINE(NONE_11236_THUG, START);
        };
        if ((NPC_ISDEAD(NONE_11237_THUG)) == (FALSE)) {
            TELEPORTNPCTOWP(55360, NONE_11237_THUG.WP);
            NPC_EXCHANGEROUTINE(NONE_11237_THUG, START);
        };
        if (((SLUMSGUARDIAN_NEWTRAPS) == (TRUE)) || ((SLUMSGUARDIAN_PROTECTIONPAID) == (FALSE))) {
            if ((NPC_ISDEAD(NONE_11238_THUG)) == (FALSE)) {
                TELEPORTNPCTOWP(55362, NONE_11238_THUG.WP);
                NPC_EXCHANGEROUTINE(NONE_11238_THUG, START);
            };
        };
        TRAPM7_HIDDEN = FALSE;
    };
    if ((NS01_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(54796, VLK_11119_DRUNKENSAILOR.WP);
        NPC_EXCHANGEROUTINE(VLK_11119_DRUNKENSAILOR, START);
        TELEPORTNPCTOWP(54800, VLK_11120_DRUNKENSAILOR.WP);
        NPC_EXCHANGEROUTINE(VLK_11120_DRUNKENSAILOR, START);
        TELEPORTNPCTOWP(54792, VLK_11118_DRUNKENSAILOR.WP);
        NPC_EXCHANGEROUTINE(VLK_11118_DRUNKENSAILOR, START);
        TELEPORTNPCTOWP(54804, VLK_11121_DRUNKENSAILOR.WP);
        NPC_EXCHANGEROUTINE(VLK_11121_DRUNKENSAILOR, START);
        NS01_HIDDEN = FALSE;
    };
    if ((NS60_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(54789, NONE_13793_WIDOW.WP);
        NPC_EXCHANGEROUTINE(NONE_13793_WIDOW, START);
        NS60_HIDDEN = FALSE;
    };
    if ((NS25_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(54808, VLK_11285_CITIZEN_RPS.WP);
        NPC_EXCHANGEROUTINE(VLK_11285_CITIZEN_RPS, START);
        NS25_HIDDEN = FALSE;
    };
    if ((NS39_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(54778, NONE_13638_FISHERMAN.WP);
        NPC_EXCHANGEROUTINE(NONE_13638_FISHERMAN, START);
        NS39_HIDDEN = FALSE;
    };
    if ((NS39_HIDDENSISTER) == (TRUE)) {
        TELEPORTNPCTOWP(54811, VLK_13639_GIRL.WP);
        NPC_EXCHANGEROUTINE(VLK_13639_GIRL, START);
        NS39_HIDDENSISTER = FALSE;
    };
    if ((NS04_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(55416, VLK_11157_APPLETRADER.WP);
        NPC_EXCHANGEROUTINE(VLK_11157_APPLETRADER, START);
        NS04_HIDDEN = FALSE;
    };
    if ((NS05_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(55419, VLK_11158_ELDERLYWOMAN.WP);
        NPC_EXCHANGEROUTINE(VLK_11158_ELDERLYWOMAN, START);
        NS05_HIDDEN = FALSE;
    };
    if ((NS57_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(54781, NONE_13783_FISHERMAN.WP);
        NPC_EXCHANGEROUTINE(NONE_13783_FISHERMAN, START);
        NS57_HIDDEN = FALSE;
    };
    if ((TRAP61_HIDDEN) == (TRUE)) {
        TELEPORTNPCTOWP(55052, NONE_11179_CULUS.WP);
        NPC_EXCHANGEROUTINE(NONE_11179_CULUS, START);
        TRAP61_HIDDEN = FALSE;
    };
}

